{"version":3,"file":"array.js","sources":["../src/config.ts","../src/utils/type-utils.ts","../src/utils/globals.ts","../src/utils/logger.ts","../src/utils/index.ts","../src/autocapture-utils.ts","../src/extensions/rageclick.ts","../src/constants.ts","../src/autocapture.ts","../src/posthog-featureflags.ts","../src/uuidv7.ts","../src/storage.ts","../src/utils/request-utils.ts","../src/utils/user-agent-utils.ts","../src/utils/event-utils.ts","../src/posthog-persistence.ts","../src/extensions/replay/sessionrecording-utils.ts","../node_modules/.pnpm/@rrweb+types@2.0.0-alpha.11/node_modules/@rrweb/types/dist/types.js","../src/extensions/replay/config.ts","../src/gdpr-utils.ts","../src/extensions/replay/sessionrecording.ts","../src/decide.ts","../src/extensions/toolbar.ts","../src/base-request-queue.ts","../src/request-queue.ts","../node_modules/.pnpm/fflate@0.4.8/node_modules/fflate/esm/browser.js","../src/types.ts","../src/send-request.ts","../src/retry-queue.ts","../src/utils/request-router.ts","../src/sessionid.ts","../src/extensions/sentry-integration.ts","../src/page-view.ts","../src/posthog-surveys.ts","../src/posthog-core.ts","../src/rate-limiter.ts","../src/session-props.ts","../src/utils/blocked-uas.ts","../src/extensions/segment-integration.ts","../src/compression.ts"],"sourcesContent":["import { version } from '../package.json'\n\n// overriden in posthog-core,\n// e.g.     Config.DEBUG = Config.DEBUG || instance.config.debug\nconst Config = {\n    DEBUG: false,\n    LIB_VERSION: version,\n}\n\nexport default Config\n","// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const _isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\nexport const _isUint8Array = function (x: unknown): x is Uint8Array {\n    return toString.call(x) === '[object Uint8Array]'\n}\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const _isFunction = function (f: any): f is (...args: any[]) => any {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof f === 'function'\n}\n// Underscore Addons\nexport const _isObject = function (x: unknown): x is Record<string, any> {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !_isArray(x)\n}\nexport const _isEmptyObject = function (x: unknown): x is Record<string, any> {\n    if (_isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const _isUndefined = function (x: unknown): x is undefined {\n    return x === void 0\n}\n\nexport const _isString = function (x: unknown): x is string {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const _isEmptyString = function (x: unknown): boolean {\n    return _isString(x) && x.trim().length === 0\n}\n\nexport const _isNull = function (x: unknown): x is null {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\n\n/*\n    sometimes you want to check if something is null or undefined\n    that's what this is for\n */\nexport const _isNullish = function (x: unknown): x is null | undefined {\n    return _isUndefined(x) || _isNull(x)\n}\n\nexport const _isDate = function (x: unknown): x is Date {\n    // eslint-disable-next-line posthog-js/no-direct-date-check\n    return toString.call(x) == '[object Date]'\n}\nexport const _isNumber = function (x: unknown): x is number {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const _isBoolean = function (x: unknown): x is boolean {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n\nexport const _isDocument = (x: unknown): x is Document => {\n    // eslint-disable-next-line posthog-js/no-direct-document-check\n    return x instanceof Document\n}\n\nexport const _isFormData = (x: unknown): x is FormData => {\n    // eslint-disable-next-line posthog-js/no-direct-form-data-check\n    return x instanceof FormData\n}\n\nexport const _isFile = (x: unknown): x is File => {\n    // eslint-disable-next-line posthog-js/no-direct-file-check\n    return x instanceof File\n}\n","/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nconst navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest = global?.XMLHttpRequest\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: Window & typeof globalThis & Record<string, any> = win ?? ({} as any)\n\nexport { win as window }\n","import Config from '../config'\nimport { _isUndefined } from './type-utils'\nimport { assignableWindow, window } from './globals'\n\nconst LOGGER_PREFIX = '[PostHog.js]'\nexport const logger = {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n        if (\n            window &&\n            (Config.DEBUG || assignableWindow.POSTHOG_DEBUG) &&\n            !_isUndefined(window.console) &&\n            window.console\n        ) {\n            const consoleLog =\n                '__rrweb_original__' in window.console[level]\n                    ? (window.console[level] as any)['__rrweb_original__']\n                    : window.console[level]\n\n            // eslint-disable-next-line no-console\n            consoleLog(LOGGER_PREFIX, ...args)\n        }\n    },\n\n    info: (...args: any[]) => {\n        logger._log('log', ...args)\n    },\n\n    warn: (...args: any[]) => {\n        logger._log('warn', ...args)\n    },\n\n    error: (...args: any[]) => {\n        logger._log('error', ...args)\n    },\n\n    critical: (...args: any[]) => {\n        // Critical errors are always logged to the console\n        // eslint-disable-next-line no-console\n        console.error(LOGGER_PREFIX, ...args)\n    },\n\n    uninitializedWarning: (methodName: string) => {\n        logger.error(`You must initialize PostHog before calling ${methodName}`)\n    },\n}\n","import { Breaker, EventHandler, Properties } from '../types'\nimport {\n    _isArray,\n    _isDate,\n    _isFormData,\n    _isFunction,\n    _isNull,\n    _isNullish,\n    _isObject,\n    _isString,\n    hasOwnProperty,\n} from './type-utils'\nimport { logger } from './logger'\nimport { window, document, nativeForEach, nativeIndexOf } from './globals'\n\nconst breaker: Breaker = {}\n\n// UNDERSCORE\n// Embed part of the Underscore Library\nexport const _trim = function (str: string): string {\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\n\nexport const _bind_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = obj[func].bind(obj)\n        }\n    }\n}\n\nexport function _eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (_isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function _each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (_isNullish(obj)) {\n        return\n    }\n    if (_isArray(obj)) {\n        return _eachArray(obj, iterator, thisArg)\n    }\n    if (_isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const _extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    _eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const _include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (_isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    _each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\nexport function _includes<T = any>(str: T[] | string, needle: T): boolean {\n    return (str as any).indexOf(needle) !== -1\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function _entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const _isValidRegex = function (str: string): boolean {\n    try {\n        new RegExp(str)\n    } catch (error) {\n        return false\n    }\n    return true\n}\n\nexport const _encodeDates = function (obj: Properties): Properties {\n    _each(obj, function (v, k) {\n        if (_isDate(v)) {\n            obj[k] = _formatDate(v)\n        } else if (_isObject(v)) {\n            obj[k] = _encodeDates(v) // recurse\n        }\n    })\n    return obj\n}\n\nexport const _timestamp = function (): number {\n    Date.now =\n        Date.now ||\n        function () {\n            return +new Date()\n        }\n    return Date.now()\n}\n\nexport const _formatDate = function (d: Date): string {\n    // YYYY-MM-DDTHH:MM:SS in UTC\n    function pad(n: number) {\n        return n < 10 ? '0' + n : n\n    }\n    return (\n        d.getUTCFullYear() +\n        '-' +\n        pad(d.getUTCMonth() + 1) +\n        '-' +\n        pad(d.getUTCDate()) +\n        'T' +\n        pad(d.getUTCHours()) +\n        ':' +\n        pad(d.getUTCMinutes()) +\n        ':' +\n        pad(d.getUTCSeconds())\n    )\n}\n\nexport const _try = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch (e) {\n        return undefined\n    }\n}\n\nexport const _safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const _safewrap_class = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = _safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const _safewrap_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = _safewrap(obj[func])\n        }\n    }\n}\n\nexport const _strip_empty_properties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    _each(p, function (v, k) {\n        if (_isString(v) && v.length > 0) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (_isArray(value)) {\n            result = [] as any as T\n            _eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            _each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (_isString(value) && !_isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\nexport function _base64Encode(data: null): null\nexport function _base64Encode(data: undefined): undefined\nexport function _base64Encode(data: string): string\nexport function _base64Encode(data: string | null | undefined): string | null | undefined {\n    const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n    let o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = ''\n    const tmp_arr: string[] = []\n\n    if (!data) {\n        return data\n    }\n\n    data = _utf8Encode(data)\n\n    do {\n        // pack three octets into four hexets\n        o1 = data.charCodeAt(i++)\n        o2 = data.charCodeAt(i++)\n        o3 = data.charCodeAt(i++)\n\n        bits = (o1 << 16) | (o2 << 8) | o3\n\n        h1 = (bits >> 18) & 0x3f\n        h2 = (bits >> 12) & 0x3f\n        h3 = (bits >> 6) & 0x3f\n        h4 = bits & 0x3f\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4)\n    } while (i < data.length)\n\n    enc = tmp_arr.join('')\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '=='\n            break\n        case 2:\n            enc = enc.slice(0, -1) + '='\n            break\n    }\n\n    return enc\n}\n\nexport const _utf8Encode = function (string: string): string {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n\n    let utftext = '',\n        start,\n        end\n    let stringl = 0,\n        n\n\n    start = end = 0\n    stringl = string.length\n\n    for (n = 0; n < stringl; n++) {\n        const c1 = string.charCodeAt(n)\n        let enc = null\n\n        if (c1 < 128) {\n            end++\n        } else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128)\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128)\n        }\n        if (!_isNull(enc)) {\n            if (end > start) {\n                utftext += string.substring(start, end)\n            }\n            utftext += enc\n            start = end = n + 1\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length)\n    }\n\n    return utftext\n}\n\nexport const _register_event = (function () {\n    // written by Dean Edwards, 2005\n    // with input from Tino Zijdel - crisp@xs4all.nl\n    // with input from Carl Sverre - mail@carlsverre.com\n    // with input from PostHog\n    // http://dean.edwards.name/weblog/2005/10/add-event/\n    // https://gist.github.com/1930440\n\n    /**\n     * @param {Object} element\n     * @param {string} type\n     * @param {function(...*)} handler\n     * @param {boolean=} oldSchool\n     * @param {boolean=} useCapture\n     */\n    const register_event = function (\n        element: Element | Window | Document | Node,\n        type: string,\n        handler: EventHandler,\n        oldSchool?: boolean,\n        useCapture?: boolean\n    ) {\n        if (!element) {\n            logger.error('No valid element provided to register_event')\n            return\n        }\n\n        if (element.addEventListener && !oldSchool) {\n            element.addEventListener(type, handler, !!useCapture)\n        } else {\n            const ontype = 'on' + type\n            const old_handler = (element as any)[ontype] // can be undefined\n            ;(element as any)[ontype] = makeHandler(element, handler, old_handler)\n        }\n    }\n\n    function makeHandler(\n        element: Element | Window | Document | Node,\n        new_handler: EventHandler,\n        old_handlers: EventHandler\n    ) {\n        return function (event: Event): boolean | void {\n            event = event || fixEvent(window?.event)\n\n            // this basically happens in firefox whenever another script\n            // overwrites the onload callback and doesn't pass the event\n            // object to previously defined callbacks.  All the browsers\n            // that don't define window.event implement addEventListener\n            // so the dom_loaded handler will still be fired as usual.\n            if (!event) {\n                return undefined\n            }\n\n            let ret = true\n            let old_result: any\n\n            if (_isFunction(old_handlers)) {\n                old_result = old_handlers(event)\n            }\n            const new_result = new_handler.call(element, event)\n\n            if (false === old_result || false === new_result) {\n                ret = false\n            }\n\n            return ret\n        }\n    }\n\n    function fixEvent(event: Event | undefined): Event | undefined {\n        if (event) {\n            event.preventDefault = fixEvent.preventDefault\n            event.stopPropagation = fixEvent.stopPropagation\n        }\n        return event\n    }\n    fixEvent.preventDefault = function () {\n        ;(this as any as Event).returnValue = false\n    }\n    fixEvent.stopPropagation = function () {\n        ;(this as any as Event).cancelBubble = true\n    }\n\n    return register_event\n})()\n\nexport function loadScript(scriptUrlToLoad: string, callback: (error?: string | Event, event?: Event) => void): void {\n    const addScript = () => {\n        if (!document) {\n            return callback('document not found')\n        }\n        const scriptTag = document.createElement('script')\n        scriptTag.type = 'text/javascript'\n        scriptTag.src = scriptUrlToLoad\n        scriptTag.onload = (event) => callback(undefined, event)\n        scriptTag.onerror = (error) => callback(error)\n\n        const scripts = document.querySelectorAll('body > script')\n        if (scripts.length > 0) {\n            scripts[0].parentNode?.insertBefore(scriptTag, scripts[0])\n        } else {\n            // In exceptional situations this call might load before the DOM is fully ready.\n            document.body.appendChild(scriptTag)\n        }\n    }\n\n    if (document?.body) {\n        addScript()\n    } else {\n        document?.addEventListener('DOMContentLoaded', addScript)\n    }\n}\n\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!_isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    return hostname.split('.').slice(-2).join('.') !== 'herokuapp.com'\n}\n\nexport function isDistinctIdStringLike(value: string): boolean {\n    return ['distinct_id', 'distinctid'].includes(value.toLowerCase())\n}\n","import { AutocaptureConfig, Properties } from './types'\nimport { _each, _entries, _includes, _trim } from './utils'\n\nimport { _isArray, _isNullish, _isString, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window } from './utils/globals'\n\nexport function splitClassString(s: string): string[] {\n    return s ? _trim(s).split(/\\s+/) : []\n}\n\n/*\n * Get the className of an element, accounting for edge cases where element.className is an object\n *\n * Because this is a string it can contain unexpected characters\n * So, this method safely splits the className and returns that array.\n */\nexport function getClassNames(el: Element): string[] {\n    let className = ''\n    switch (typeof el.className) {\n        case 'string':\n            className = el.className\n            break\n        // TODO: when is this ever used?\n        case 'object': // handle cases where className might be SVGAnimatedString or some other type\n            className =\n                ('baseVal' in el.className ? (el.className as any).baseVal : null) || el.getAttribute('class') || ''\n            break\n        default:\n            className = ''\n    }\n\n    return splitClassString(className)\n}\n\nexport function makeSafeText(s: string | null | undefined): string | null {\n    if (_isNullish(s)) {\n        return null\n    }\n\n    return (\n        _trim(s)\n            // scrub potentially sensitive values\n            .split(/(\\s+)/)\n            .filter(shouldCaptureValue)\n            .join('')\n            // normalize whitespace\n            .replace(/[\\r\\n]/g, ' ')\n            .replace(/[ ]+/g, ' ')\n            // truncate\n            .substring(0, 255)\n    )\n}\n\n/*\n * Get the direct text content of an element, protecting against sensitive data collection.\n * Concats textContent of each of the element's text node children; this avoids potential\n * collection of sensitive data that could happen if we used element.textContent and the\n * element had sensitive child elements, since element.textContent includes child content.\n * Scrubs values that look like they could be sensitive (i.e. cc or ssn number).\n * @param {Element} el - element to get the text of\n * @returns {string} the element's direct text content\n */\nexport function getSafeText(el: Element): string {\n    let elText = ''\n\n    if (shouldCaptureElement(el) && !isSensitiveElement(el) && el.childNodes && el.childNodes.length) {\n        _each(el.childNodes, function (child) {\n            if (isTextNode(child) && child.textContent) {\n                elText += makeSafeText(child.textContent) ?? ''\n            }\n        })\n    }\n\n    return _trim(elText)\n}\n\n/*\n * Check whether an element has nodeType Node.ELEMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isElementNode(el: Node | Element | undefined | null): el is Element {\n    return !!el && el.nodeType === 1 // Node.ELEMENT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element is of a given tag type.\n * Due to potential reference discrepancies (such as the webcomponents.js polyfill),\n * we want to match tagNames instead of specific references because something like\n * element === document.body won't always work because element might not be a native\n * element.\n * @param {Element} el - element to check\n * @param {string} tag - tag name (e.g., \"div\")\n * @returns {boolean} whether el is of the given tag type\n */\nexport function isTag(el: Element | undefined | null, tag: string): el is HTMLElement {\n    return !!el && !!el.tagName && el.tagName.toLowerCase() === tag.toLowerCase()\n}\n\n/*\n * Check whether an element has nodeType Node.TEXT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isTextNode(el: Element | undefined | null): el is HTMLElement {\n    return !!el && el.nodeType === 3 // Node.TEXT_NODE - use integer constant for browser portability\n}\n\n/*\n * Check whether an element has nodeType Node.DOCUMENT_FRAGMENT_NODE\n * @param {Element} el - element to check\n * @returns {boolean} whether el is of the correct nodeType\n */\nexport function isDocumentFragment(el: Element | ParentNode | undefined | null): el is DocumentFragment {\n    return !!el && el.nodeType === 11 // Node.DOCUMENT_FRAGMENT_NODE - use integer constant for browser portability\n}\n\nexport const autocaptureCompatibleElements = ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n\n/*\n if there is no config, then all elements are allowed\n if there is a config, and there is an allow list, then only elements in the allow list are allowed\n assumes that some other code is checking this element's parents\n */\nfunction checkIfElementTreePassesElementAllowList(\n    elements: Element[],\n    autocaptureConfig: AutocaptureConfig | undefined\n): boolean {\n    const allowlist = autocaptureConfig?.element_allowlist\n    if (_isUndefined(allowlist)) {\n        // everything is allowed, when there is no allow list\n        return true\n    }\n\n    // check each element in the tree\n    // if any of the elements are in the allow list, then the tree is allowed\n    for (const el of elements) {\n        if (allowlist.some((elementType) => el.tagName.toLowerCase() === elementType)) {\n            return true\n        }\n    }\n\n    // otherwise there is an allow list and this element tree didn't match it\n    return false\n}\n\n/*\n if there is no config, then all elements are allowed\n if there is a config, and there is an allow list, then\n only elements that match the css selector in the allow list are allowed\n assumes that some other code is checking this element's parents\n */\nfunction checkIfElementTreePassesCSSSelectorAllowList(\n    elements: Element[],\n    autocaptureConfig: AutocaptureConfig | undefined\n): boolean {\n    const allowlist = autocaptureConfig?.css_selector_allowlist\n    if (_isUndefined(allowlist)) {\n        // everything is allowed, when there is no allow list\n        return true\n    }\n\n    // check each element in the tree\n    // if any of the elements are in the allow list, then the tree is allowed\n    for (const el of elements) {\n        if (allowlist.some((selector) => el.matches(selector))) {\n            return true\n        }\n    }\n\n    // otherwise there is an allow list and this element tree didn't match it\n    return false\n}\n\nfunction getParentElement(curEl: Element): Element | false {\n    const parentNode = curEl.parentNode\n    if (!parentNode || !isElementNode(parentNode)) return false\n    return parentNode\n}\n\n/*\n * Check whether a DOM event should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @param {Event} event - event to check\n * @param {Object} autocaptureConfig - autocapture config\n * @param {boolean} captureOnAnyElement - whether to capture on any element, clipboard autocapture doesn't restrict to \"clickable\" elements\n * @param {string[]} allowedEventTypes - event types to capture, normally just 'click', but some autocapture types react to different events, some elements have fixed events (e.g., form has \"submit\")\n * @returns {boolean} whether the event should be captured\n */\nexport function shouldCaptureDomEvent(\n    el: Element,\n    event: Event,\n    autocaptureConfig: AutocaptureConfig | undefined = undefined,\n    captureOnAnyElement?: boolean,\n    allowedEventTypes?: string[]\n): boolean {\n    if (!window || !el || isTag(el, 'html') || !isElementNode(el)) {\n        return false\n    }\n\n    if (autocaptureConfig?.url_allowlist) {\n        const url = window.location.href\n        const allowlist = autocaptureConfig.url_allowlist\n        if (allowlist && !allowlist.some((regex) => url.match(regex))) {\n            return false\n        }\n    }\n\n    if (autocaptureConfig?.dom_event_allowlist) {\n        const allowlist = autocaptureConfig.dom_event_allowlist\n        if (allowlist && !allowlist.some((eventType) => event.type === eventType)) {\n            return false\n        }\n    }\n\n    let parentIsUsefulElement = false\n    const targetElementList: Element[] = [el]\n    let parentNode: Element | boolean = true\n    let curEl: Element = el\n    while (curEl.parentNode && !isTag(curEl, 'body')) {\n        // If element is a shadow root, we skip it\n        if (isDocumentFragment(curEl.parentNode)) {\n            targetElementList.push((curEl.parentNode as any).host)\n            curEl = (curEl.parentNode as any).host\n            continue\n        }\n        parentNode = getParentElement(curEl)\n        if (!parentNode) break\n        if (captureOnAnyElement || autocaptureCompatibleElements.indexOf(parentNode.tagName.toLowerCase()) > -1) {\n            parentIsUsefulElement = true\n        } else {\n            const compStyles = window.getComputedStyle(parentNode)\n            if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer') {\n                parentIsUsefulElement = true\n            }\n        }\n\n        targetElementList.push(parentNode)\n        curEl = parentNode\n    }\n\n    if (!checkIfElementTreePassesElementAllowList(targetElementList, autocaptureConfig)) {\n        return false\n    }\n\n    if (!checkIfElementTreePassesCSSSelectorAllowList(targetElementList, autocaptureConfig)) {\n        return false\n    }\n\n    const compStyles = window.getComputedStyle(el)\n    if (compStyles && compStyles.getPropertyValue('cursor') === 'pointer' && event.type === 'click') {\n        return true\n    }\n\n    const tag = el.tagName.toLowerCase()\n    switch (tag) {\n        case 'html':\n            return false\n        case 'form':\n            return (allowedEventTypes || ['submit']).indexOf(event.type) >= 0\n        case 'input':\n        case 'select':\n        case 'textarea':\n            return (allowedEventTypes || ['change', 'click']).indexOf(event.type) >= 0\n        default:\n            if (parentIsUsefulElement) return (allowedEventTypes || ['click']).indexOf(event.type) >= 0\n            return (\n                (allowedEventTypes || ['click']).indexOf(event.type) >= 0 &&\n                (autocaptureCompatibleElements.indexOf(tag) > -1 || el.getAttribute('contenteditable') === 'true')\n            )\n    }\n}\n\n/*\n * Check whether a DOM element should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureElement(el: Element): boolean {\n    for (let curEl = el; curEl.parentNode && !isTag(curEl, 'body'); curEl = curEl.parentNode as Element) {\n        const classes = getClassNames(curEl)\n        if (_includes(classes, 'ph-sensitive') || _includes(classes, 'ph-no-capture')) {\n            return false\n        }\n    }\n\n    if (_includes(getClassNames(el), 'ph-include')) {\n        return true\n    }\n\n    // don't include hidden or password fields\n    const type = (el as HTMLInputElement).type || ''\n    if (_isString(type)) {\n        // it's possible for el.type to be a DOM element if el is a form with a child input[name=\"type\"]\n        switch (type.toLowerCase()) {\n            case 'hidden':\n                return false\n            case 'password':\n                return false\n        }\n    }\n\n    // filter out data from fields that look like sensitive fields\n    const name = (el as HTMLInputElement).name || el.id || ''\n    // See https://github.com/posthog/posthog-js/issues/165\n    // Under specific circumstances a bug caused .replace to be called on a DOM element\n    // instead of a string, removing the element from the page. Ensure this issue is mitigated.\n    if (_isString(name)) {\n        // it's possible for el.name or el.id to be a DOM element if el is a form with a child input[name=\"name\"]\n        const sensitiveNameRegex =\n            /^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i\n        if (sensitiveNameRegex.test(name.replace(/[^a-zA-Z0-9]/g, ''))) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether a DOM element is 'sensitive' and we should only capture limited data\n * @param {Element} el - element to check\n * @returns {boolean} whether the element should be captured\n */\nexport function isSensitiveElement(el: Element): boolean {\n    // don't send data from inputs or similar elements since there will always be\n    // a risk of clientside javascript placing sensitive data in attributes\n    const allowedInputTypes = ['button', 'checkbox', 'submit', 'reset']\n    if (\n        (isTag(el, 'input') && !allowedInputTypes.includes((el as HTMLInputElement).type)) ||\n        isTag(el, 'select') ||\n        isTag(el, 'textarea') ||\n        el.getAttribute('contenteditable') === 'true'\n    ) {\n        return true\n    }\n    return false\n}\n\n/*\n * Check whether a string value should be \"captured\" or if it may contain sentitive data\n * using a variety of heuristics.\n * @param {string} value - string value to check\n * @returns {boolean} whether the element should be captured\n */\nexport function shouldCaptureValue(value: string): boolean {\n    if (_isNullish(value)) {\n        return false\n    }\n\n    if (_isString(value)) {\n        value = _trim(value)\n\n        // check to see if input value looks like a credit card number\n        // see: https://www.safaribooksonline.com/library/view/regular-expressions-cookbook/9781449327453/ch04s20.html\n        const ccRegex =\n            /^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/\n        if (ccRegex.test((value || '').replace(/[- ]/g, ''))) {\n            return false\n        }\n\n        // check to see if input value looks like a social security number\n        const ssnRegex = /(^\\d{3}-?\\d{2}-?\\d{4}$)/\n        if (ssnRegex.test(value)) {\n            return false\n        }\n    }\n\n    return true\n}\n\n/*\n * Check whether an attribute name is an Angular style attr (either _ngcontent or _nghost)\n * These update on each build and lead to noise in the element chain\n * More details on the attributes here: https://angular.io/guide/view-encapsulation\n * @param {string} attributeName - string value to check\n * @returns {boolean} whether the element is an angular tag\n */\nexport function isAngularStyleAttr(attributeName: string): boolean {\n    if (_isString(attributeName)) {\n        return attributeName.substring(0, 10) === '_ngcontent' || attributeName.substring(0, 7) === '_nghost'\n    }\n    return false\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces,\n * along with the direct text content of the target element\n * @param {Element} target - element to check\n * @returns {string} text content of the target element and its child span tags\n */\nexport function getDirectAndNestedSpanText(target: Element): string {\n    let text = getSafeText(target)\n    text = `${text} ${getNestedSpanText(target)}`.trim()\n    return shouldCaptureValue(text) ? text : ''\n}\n\n/*\n * Iterate through children of a target element looking for span tags\n * and return the text content of the span tags, separated by spaces\n * @param {Element} target - element to check\n * @returns {string} text content of span tags\n */\nexport function getNestedSpanText(target: Element): string {\n    let text = ''\n    if (target && target.childNodes && target.childNodes.length) {\n        _each(target.childNodes, function (child) {\n            if (child && child.tagName?.toLowerCase() === 'span') {\n                try {\n                    const spanText = getSafeText(child)\n                    text = `${text} ${spanText}`.trim()\n\n                    if (child.childNodes && child.childNodes.length) {\n                        text = `${text} ${getNestedSpanText(child)}`.trim()\n                    }\n                } catch (e) {\n                    logger.error(e)\n                }\n            }\n        })\n    }\n    return text\n}\n\n/*\nBack in the day storing events in Postgres we use Elements for autocapture events.\nNow we're using elements_chain. We used to do this parsing/processing during ingestion.\nThis code is just copied over from ingestion, but we should optimize it\nto create elements_chain string directly.\n*/\nexport function getElementsChainString(elements: Properties[]): string {\n    return elementsToString(extractElements(elements))\n}\n\n// This interface is called 'Element' in plugin-scaffold https://github.com/PostHog/plugin-scaffold/blob/b07d3b879796ecc7e22deb71bf627694ba05386b/src/types.ts#L200\n// However 'Element' is a DOM Element when run in the browser, so we have to rename it\ninterface PHElement {\n    text?: string\n    tag_name?: string\n    href?: string\n    attr_id?: string\n    attr_class?: string[]\n    nth_child?: number\n    nth_of_type?: number\n    attributes?: Record<string, any>\n    event_id?: number\n    order?: number\n    group_id?: number\n}\n\nfunction escapeQuotes(input: string): string {\n    return input.replace(/\"|\\\\\"/g, '\\\\\"')\n}\n\nfunction elementsToString(elements: PHElement[]): string {\n    const ret = elements.map((element) => {\n        let el_string = ''\n        if (element.tag_name) {\n            el_string += element.tag_name\n        }\n        if (element.attr_class) {\n            element.attr_class.sort()\n            for (const single_class of element.attr_class) {\n                el_string += `.${single_class.replace(/\"/g, '')}`\n            }\n        }\n        const attributes: Record<string, any> = {\n            ...(element.text ? { text: element.text } : {}),\n            'nth-child': element.nth_child ?? 0,\n            'nth-of-type': element.nth_of_type ?? 0,\n            ...(element.href ? { href: element.href } : {}),\n            ...(element.attr_id ? { attr_id: element.attr_id } : {}),\n            ...element.attributes,\n        }\n        const sortedAttributes: Record<string, any> = {}\n        _entries(attributes)\n            .sort(([a], [b]) => a.localeCompare(b))\n            .forEach(\n                ([key, value]) => (sortedAttributes[escapeQuotes(key.toString())] = escapeQuotes(value.toString()))\n            )\n        el_string += ':'\n        el_string += _entries(attributes)\n            .map(([key, value]) => `${key}=\"${value}\"`)\n            .join('')\n        return el_string\n    })\n    return ret.join(';')\n}\n\nfunction extractElements(elements: Properties[]): PHElement[] {\n    return elements.map((el) => {\n        const response = {\n            text: el['$el_text']?.slice(0, 400),\n            tag_name: el['tag_name'],\n            href: el['attr__href']?.slice(0, 2048),\n            attr_class: extractAttrClass(el),\n            attr_id: el['attr__id'],\n            nth_child: el['nth_child'],\n            nth_of_type: el['nth_of_type'],\n            attributes: {} as { [id: string]: any },\n        }\n        _entries(el)\n            .filter(([key]) => key.indexOf('attr__') === 0)\n            .forEach(([key, value]) => (response.attributes[key] = value))\n        return response\n    })\n}\n\nfunction extractAttrClass(el: Properties): PHElement['attr_class'] {\n    const attr_class = el['attr__class']\n    if (!attr_class) {\n        return undefined\n    } else if (_isArray(attr_class)) {\n        return attr_class\n    } else {\n        return splitClassString(attr_class)\n    }\n}\n","// Naive rage click implementation: If mouse has not moved than RAGE_CLICK_THRESHOLD_PX\n// over RAGE_CLICK_CLICK_COUNT clicks with max RAGE_CLICK_TIMEOUT_MS between clicks, it's\n// counted as a rage click\n\nconst RAGE_CLICK_THRESHOLD_PX = 30\nconst RAGE_CLICK_TIMEOUT_MS = 1000\nconst RAGE_CLICK_CLICK_COUNT = 3\n\nexport default class RageClick {\n    clicks: { x: number; y: number; timestamp: number }[]\n    enabled: boolean\n\n    constructor(enabled: boolean) {\n        this.clicks = []\n        this.enabled = enabled\n    }\n\n    isRageClick(x: number, y: number, timestamp: number): boolean {\n        if (!this.enabled) {\n            return false\n        }\n\n        const lastClick = this.clicks[this.clicks.length - 1]\n        if (\n            lastClick &&\n            Math.abs(x - lastClick.x) + Math.abs(y - lastClick.y) < RAGE_CLICK_THRESHOLD_PX &&\n            timestamp - lastClick.timestamp < RAGE_CLICK_TIMEOUT_MS\n        ) {\n            this.clicks.push({ x, y, timestamp })\n\n            if (this.clicks.length === RAGE_CLICK_CLICK_COUNT) {\n                return true\n            }\n        } else {\n            this.clicks = [{ x, y, timestamp }]\n        }\n\n        return false\n    }\n}\n","/*\n * Constants\n */\n\n/* PROPERTY KEYS */\n\n// This key is deprecated, but we want to check for it to see whether aliasing is allowed.\nexport const PEOPLE_DISTINCT_ID_KEY = '$people_distinct_id'\nexport const DISTINCT_ID = 'distinct_id'\nexport const ALIAS_ID_KEY = '__alias'\nexport const CAMPAIGN_IDS_KEY = '__cmpns'\nexport const EVENT_TIMERS_KEY = '__timers'\nexport const AUTOCAPTURE_DISABLED_SERVER_SIDE = '$autocapture_disabled_server_side'\nexport const SESSION_RECORDING_ENABLED_SERVER_SIDE = '$session_recording_enabled_server_side'\nexport const CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE = '$console_log_recording_enabled_server_side'\nexport const SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE = '$session_recording_recorder_version_server_side' // follows rrweb versioning\nexport const SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE = '$session_recording_network_payload_capture'\nexport const SESSION_RECORDING_CANVAS_RECORDING = '$session_recording_canvas_recording'\nexport const SESSION_ID = '$sesid'\nexport const SESSION_RECORDING_IS_SAMPLED = '$session_is_sampled'\nexport const ENABLED_FEATURE_FLAGS = '$enabled_feature_flags'\nexport const PERSISTENCE_EARLY_ACCESS_FEATURES = '$early_access_features'\nexport const STORED_PERSON_PROPERTIES_KEY = '$stored_person_properties'\nexport const STORED_GROUP_PROPERTIES_KEY = '$stored_group_properties'\nexport const SURVEYS = '$surveys'\nexport const FLAG_CALL_REPORTED = '$flag_call_reported'\nexport const USER_STATE = '$user_state'\nexport const POSTHOG_QUOTA_LIMITED = '$posthog_quota_limited'\nexport const CLIENT_SESSION_PROPS = '$client_session_props'\n\n// These are properties that are reserved and will not be automatically included in events\nexport const PERSISTENCE_RESERVED_PROPERTIES = [\n    PEOPLE_DISTINCT_ID_KEY,\n    ALIAS_ID_KEY,\n    CAMPAIGN_IDS_KEY,\n    EVENT_TIMERS_KEY,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_ID,\n    ENABLED_FEATURE_FLAGS,\n    USER_STATE,\n    POSTHOG_QUOTA_LIMITED,\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    SURVEYS,\n    FLAG_CALL_REPORTED,\n    CLIENT_SESSION_PROPS,\n]\n","import { _bind_instance_methods, _each, _extend, _includes, _register_event, _safewrap_instance_methods } from './utils'\nimport {\n    autocaptureCompatibleElements,\n    getClassNames,\n    getDirectAndNestedSpanText,\n    getElementsChainString,\n    getSafeText,\n    isAngularStyleAttr,\n    isDocumentFragment,\n    isElementNode,\n    isSensitiveElement,\n    isTag,\n    isTextNode,\n    makeSafeText,\n    shouldCaptureDomEvent,\n    shouldCaptureElement,\n    shouldCaptureValue,\n    splitClassString,\n} from './autocapture-utils'\nimport RageClick from './extensions/rageclick'\nimport { AutocaptureConfig, AutoCaptureCustomProperty, DecideResponse, Properties } from './types'\nimport { PostHog } from './posthog-core'\nimport { AUTOCAPTURE_DISABLED_SERVER_SIDE } from './constants'\n\nimport { _isBoolean, _isFunction, _isNull, _isObject, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { document, window } from './utils/globals'\n\nconst COPY_AUTOCAPTURE_EVENT = '$copy_autocapture'\n\nfunction limitText(length: number, text: string): string {\n    if (text.length > length) {\n        return text.slice(0, length) + '...'\n    }\n    return text\n}\n\nconst autocapture = {\n    _initializedTokens: [] as string[],\n    _isDisabledServerSide: null as boolean | null,\n    _isAutocaptureEnabled: false as boolean,\n\n    _setIsAutocaptureEnabled: function (instance: PostHog): void {\n        const disabled_server_side = _isNull(this._isDisabledServerSide)\n            ? !!instance.persistence?.props[AUTOCAPTURE_DISABLED_SERVER_SIDE]\n            : this._isDisabledServerSide\n        const enabled_client_side = !!instance.config.autocapture\n        this._isAutocaptureEnabled = enabled_client_side && !disabled_server_side\n    },\n\n    _previousElementSibling: function (el: Element): Element | null {\n        if (el.previousElementSibling) {\n            return el.previousElementSibling\n        } else {\n            let _el: Element | null = el\n            do {\n                _el = _el.previousSibling as Element | null // resolves to ChildNode->Node, which is Element's parent class\n            } while (_el && !isElementNode(_el))\n            return _el\n        }\n    },\n\n    _getAugmentPropertiesFromElement: function (elem: Element): Properties {\n        const shouldCaptureEl = shouldCaptureElement(elem)\n        if (!shouldCaptureEl) {\n            return {}\n        }\n\n        const props: Properties = {}\n\n        _each(elem.attributes, function (attr: Attr) {\n            if (attr.name.indexOf('data-ph-capture-attribute') === 0) {\n                const propertyKey = attr.name.replace('data-ph-capture-attribute-', '')\n                const propertyValue = attr.value\n                if (propertyKey && propertyValue && shouldCaptureValue(propertyValue)) {\n                    props[propertyKey] = propertyValue\n                }\n            }\n        })\n        return props\n    },\n\n    _getPropertiesFromElement: function (elem: Element, maskInputs: boolean, maskText: boolean): Properties {\n        const tag_name = elem.tagName.toLowerCase()\n        const props: Properties = {\n            tag_name: tag_name,\n        }\n        if (autocaptureCompatibleElements.indexOf(tag_name) > -1 && !maskText) {\n            if (tag_name.toLowerCase() === 'a' || tag_name.toLowerCase() === 'button') {\n                props['$el_text'] = limitText(1024, getDirectAndNestedSpanText(elem))\n            } else {\n                props['$el_text'] = limitText(1024, getSafeText(elem))\n            }\n        }\n\n        const classes = getClassNames(elem)\n        if (classes.length > 0)\n            props['classes'] = classes.filter(function (c) {\n                return c !== ''\n            })\n\n        // capture the deny list here because this not-a-class class makes it tricky to use this.config in the function below\n        const elementAttributeIgnorelist = this.config?.element_attribute_ignorelist\n        _each(elem.attributes, function (attr: Attr) {\n            // Only capture attributes we know are safe\n            if (isSensitiveElement(elem) && ['name', 'id', 'class'].indexOf(attr.name) === -1) return\n\n            if (elementAttributeIgnorelist?.includes(attr.name)) return\n\n            if (!maskInputs && shouldCaptureValue(attr.value) && !isAngularStyleAttr(attr.name)) {\n                let value = attr.value\n                if (attr.name === 'class') {\n                    // html attributes can _technically_ contain linebreaks,\n                    // but we're very intolerant of them in the class string,\n                    // so we strip them.\n                    value = splitClassString(value).join(' ')\n                }\n                props['attr__' + attr.name] = limitText(1024, value)\n            }\n        })\n\n        let nthChild = 1\n        let nthOfType = 1\n        let currentElem: Element | null = elem\n        while ((currentElem = this._previousElementSibling(currentElem))) {\n            // eslint-disable-line no-cond-assign\n            nthChild++\n            if (currentElem.tagName === elem.tagName) {\n                nthOfType++\n            }\n        }\n        props['nth_child'] = nthChild\n        props['nth_of_type'] = nthOfType\n\n        return props\n    },\n\n    _getDefaultProperties: function (eventType: string): Properties {\n        return {\n            $event_type: eventType,\n            $ce_version: 1,\n        }\n    },\n\n    _extractCustomPropertyValue: function (customProperty: AutoCaptureCustomProperty): string {\n        const propValues: string[] = []\n        _each(document?.querySelectorAll(customProperty['css_selector']), function (matchedElem) {\n            let value\n\n            if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n                value = matchedElem['value']\n            } else if (matchedElem['textContent']) {\n                value = matchedElem['textContent']\n            }\n\n            if (shouldCaptureValue(value)) {\n                propValues.push(value)\n            }\n        })\n        return propValues.join(', ')\n    },\n\n    // TODO: delete custom_properties after changeless typescript refactor\n    _getCustomProperties: function (targetElementList: Element[]): Properties {\n        const props: Properties = {} // will be deleted\n        _each(this._customProperties, (customProperty) => {\n            _each(customProperty['event_selectors'], (eventSelector) => {\n                const eventElements = document?.querySelectorAll(eventSelector)\n                _each(eventElements, (eventElement) => {\n                    if (_includes(targetElementList, eventElement) && shouldCaptureElement(eventElement)) {\n                        props[customProperty['name']] = this._extractCustomPropertyValue(customProperty)\n                    }\n                })\n            })\n        })\n        return props\n    },\n\n    _getEventTarget: function (e: Event): Element | null {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n        if (_isUndefined(e.target)) {\n            return (e.srcElement as Element) || null\n        } else {\n            if ((e.target as HTMLElement)?.shadowRoot) {\n                return (e.composedPath()[0] as Element) || null\n            }\n            return (e.target as Element) || null\n        }\n    },\n\n    _captureEvent: function (\n        e: Event,\n        instance: PostHog,\n        eventName = '$autocapture',\n        extraProps?: Properties\n    ): boolean | void {\n        /*** Don't mess with this code without running IE8 tests on it ***/\n        let target = this._getEventTarget(e)\n        if (isTextNode(target)) {\n            // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n            target = (target.parentNode || null) as Element | null\n        }\n\n        if (eventName === '$autocapture' && e.type === 'click' && e instanceof MouseEvent) {\n            if (this.rageclicks?.isRageClick(e.clientX, e.clientY, new Date().getTime())) {\n                this._captureEvent(e, instance, '$rageclick')\n            }\n        }\n\n        const isCopyAutocapture = eventName === COPY_AUTOCAPTURE_EVENT\n        if (\n            target &&\n            shouldCaptureDomEvent(\n                target,\n                e,\n                this.config,\n                // mostly this method cares about the target element, but in the case of copy events,\n                // we want some of the work this check does without insisting on the target element's type\n                isCopyAutocapture,\n                // we also don't want to restrict copy checks to clicks,\n                // so we pass that knowledge in here, rather than add the logic inside the check\n                isCopyAutocapture ? ['copy', 'cut'] : undefined\n            )\n        ) {\n            const targetElementList = [target]\n            let curEl = target\n            while (curEl.parentNode && !isTag(curEl, 'body')) {\n                if (isDocumentFragment(curEl.parentNode)) {\n                    targetElementList.push((curEl.parentNode as any).host)\n                    curEl = (curEl.parentNode as any).host\n                    continue\n                }\n                targetElementList.push(curEl.parentNode as Element)\n                curEl = curEl.parentNode as Element\n            }\n\n            const elementsJson: Properties[] = []\n            const autocaptureAugmentProperties: Properties = {}\n            let href,\n                explicitNoCapture = false\n            _each(targetElementList, (el) => {\n                const shouldCaptureEl = shouldCaptureElement(el)\n\n                // if the element or a parent element is an anchor tag\n                // include the href as a property\n                if (el.tagName.toLowerCase() === 'a') {\n                    href = el.getAttribute('href')\n                    href = shouldCaptureEl && shouldCaptureValue(href) && href\n                }\n\n                // allow users to programmatically prevent capturing of elements by adding class 'ph-no-capture'\n                const classes = getClassNames(el)\n                if (_includes(classes, 'ph-no-capture')) {\n                    explicitNoCapture = true\n                }\n\n                elementsJson.push(\n                    this._getPropertiesFromElement(\n                        el,\n                        instance.config.mask_all_element_attributes,\n                        instance.config.mask_all_text\n                    )\n                )\n\n                const augmentProperties = this._getAugmentPropertiesFromElement(el)\n                _extend(autocaptureAugmentProperties, augmentProperties)\n            })\n\n            if (!instance.config.mask_all_text) {\n                // if the element is a button or anchor tag get the span text from any\n                // children and include it as/with the text property on the parent element\n                if (target.tagName.toLowerCase() === 'a' || target.tagName.toLowerCase() === 'button') {\n                    elementsJson[0]['$el_text'] = getDirectAndNestedSpanText(target)\n                } else {\n                    elementsJson[0]['$el_text'] = getSafeText(target)\n                }\n            }\n\n            if (href) {\n                elementsJson[0]['attr__href'] = href\n            }\n\n            if (explicitNoCapture) {\n                return false\n            }\n\n            const props = _extend(\n                this._getDefaultProperties(e.type),\n                instance.elementsChainAsString\n                    ? {\n                          $elements_chain: getElementsChainString(elementsJson),\n                      }\n                    : {\n                          $elements: elementsJson,\n                      },\n                elementsJson[0]?.['$el_text'] ? { $el_text: elementsJson[0]?.['$el_text'] } : {},\n                this._getCustomProperties(targetElementList),\n                autocaptureAugmentProperties,\n                extraProps || {}\n            )\n\n            if (eventName === COPY_AUTOCAPTURE_EVENT) {\n                // you can't read the data from the clipboard event,\n                // but you can guess that you can read it from the window's current selection\n                const selectedContent = makeSafeText(window?.getSelection()?.toString())\n                const clipType = (e as ClipboardEvent).type || 'clipboard'\n                if (!selectedContent) {\n                    return false\n                }\n                props['$selected_content'] = selectedContent\n                props['$copy_type'] = clipType\n            }\n\n            instance.capture(eventName, props)\n            return true\n        }\n    },\n\n    // only reason is to stub for unit tests\n    // since you can't override window.location props\n    _navigate: function (href: string): void {\n        if (!window) {\n            return\n        }\n        window.location.href = href\n    },\n\n    _addDomEventHandlers: function (instance: PostHog): void {\n        if (!window || !document) {\n            return\n        }\n        const handler = (e: Event) => {\n            e = e || window?.event\n            this._captureEvent(e, instance)\n        }\n\n        const copiedTextHandler = (e: Event) => {\n            e = e || window?.event\n            this._captureEvent(e, instance, COPY_AUTOCAPTURE_EVENT)\n        }\n\n        _register_event(document, 'submit', handler, false, true)\n        _register_event(document, 'change', handler, false, true)\n        _register_event(document, 'click', handler, false, true)\n\n        if (_isObject(instance.config.autocapture) && instance.config.autocapture.capture_copied_text) {\n            _register_event(document, 'copy', copiedTextHandler, false, true)\n            _register_event(document, 'cut', copiedTextHandler, false, true)\n        }\n    },\n\n    _customProperties: [] as AutoCaptureCustomProperty[],\n    rageclicks: null as RageClick | null,\n    config: undefined as AutocaptureConfig | undefined,\n\n    init: function (instance: PostHog): void {\n        if (!_isBoolean(instance.__autocapture)) {\n            this.config = instance.__autocapture\n        }\n\n        // precompile the regex\n        if (this.config?.url_allowlist) {\n            this.config.url_allowlist = this.config.url_allowlist.map((url) => new RegExp(url))\n        }\n\n        this.rageclicks = new RageClick(instance.config.rageclick)\n    },\n\n    afterDecideResponse: function (response: DecideResponse, instance: PostHog): void {\n        const token = instance.config.token\n        if (this._initializedTokens.indexOf(token) > -1) {\n            logger.info('autocapture already initialized for token \"' + token + '\"')\n            return\n        }\n\n        if (instance.persistence) {\n            instance.persistence.register({\n                [AUTOCAPTURE_DISABLED_SERVER_SIDE]: !!response['autocapture_opt_out'],\n            })\n        }\n        // store this in-memory incase persistence is disabled\n        this._isDisabledServerSide = !!response['autocapture_opt_out']\n\n        this._setIsAutocaptureEnabled(instance)\n\n        this._initializedTokens.push(token)\n\n        if (\n            response &&\n            response['config'] &&\n            response['config']['enable_collect_everything'] &&\n            this._isAutocaptureEnabled\n        ) {\n            // TODO: delete custom_properties after changeless typescript refactor\n            if (response['custom_properties']) {\n                this._customProperties = response['custom_properties']\n            }\n            this._addDomEventHandlers(instance)\n        } else {\n            instance['__autocapture'] = false\n        }\n    },\n\n    // this is a mechanism to ramp up CE with no server-side interaction.\n    // when CE is active, every page load results in a decide request. we\n    // need to gently ramp this up, so we don't overload decide. this decides\n    // deterministically if CE is enabled for this project by modding the char\n    // value of the project token.\n    enabledForProject: function (\n        token: string | null | undefined,\n        numBuckets: number,\n        numEnabledBuckets: number\n    ): boolean {\n        if (!token) {\n            return true\n        }\n        numBuckets = !_isUndefined(numBuckets) ? numBuckets : 10\n        numEnabledBuckets = !_isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10\n        let charCodeSum = 0\n        for (let i = 0; i < token.length; i++) {\n            charCodeSum += token.charCodeAt(i)\n        }\n        return charCodeSum % numBuckets < numEnabledBuckets\n    },\n\n    isBrowserSupported: function (): boolean {\n        return _isFunction(document?.querySelectorAll)\n    },\n}\n\n_bind_instance_methods(autocapture)\n_safewrap_instance_methods(autocapture)\n\nexport { autocapture }\n","import { _base64Encode, _entries, _extend } from './utils'\nimport { PostHog } from './posthog-core'\nimport {\n    DecideResponse,\n    FeatureFlagsCallback,\n    EarlyAccessFeatureCallback,\n    EarlyAccessFeatureResponse,\n    Properties,\n    JsonType,\n} from './types'\nimport { PostHogPersistence } from './posthog-persistence'\n\nimport {\n    PERSISTENCE_EARLY_ACCESS_FEATURES,\n    ENABLED_FEATURE_FLAGS,\n    STORED_GROUP_PROPERTIES_KEY,\n    STORED_PERSON_PROPERTIES_KEY,\n    FLAG_CALL_REPORTED,\n} from './constants'\n\nimport { _isArray } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\nconst PERSISTENCE_ACTIVE_FEATURE_FLAGS = '$active_feature_flags'\nconst PERSISTENCE_OVERRIDE_FEATURE_FLAGS = '$override_feature_flags'\nconst PERSISTENCE_FEATURE_FLAG_PAYLOADS = '$feature_flag_payloads'\n\nexport const filterActiveFeatureFlags = (featureFlags?: Record<string, string | boolean>) => {\n    const activeFeatureFlags: Record<string, string | boolean> = {}\n    for (const [key, value] of _entries(featureFlags || {})) {\n        if (value) {\n            activeFeatureFlags[key] = value\n        }\n    }\n    return activeFeatureFlags\n}\n\nexport const parseFeatureFlagDecideResponse = (\n    response: Partial<DecideResponse>,\n    persistence: PostHogPersistence,\n    currentFlags: Record<string, string | boolean> = {},\n    currentFlagPayloads: Record<string, JsonType> = {}\n) => {\n    const flags = response['featureFlags']\n    const flagPayloads = response['featureFlagPayloads']\n    if (flags) {\n        // using the v1 api\n        if (_isArray(flags)) {\n            const $enabled_feature_flags: Record<string, boolean> = {}\n            if (flags) {\n                for (let i = 0; i < flags.length; i++) {\n                    $enabled_feature_flags[flags[i]] = true\n                }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: flags,\n                    [ENABLED_FEATURE_FLAGS]: $enabled_feature_flags,\n                })\n        } else {\n            // using the v2+ api\n            let newFeatureFlags = flags\n            let newFeatureFlagPayloads = flagPayloads\n            if (response.errorsWhileComputingFlags) {\n                // if not all flags were computed, we upsert flags instead of replacing them\n                newFeatureFlags = { ...currentFlags, ...newFeatureFlags }\n                newFeatureFlagPayloads = { ...currentFlagPayloads, ...newFeatureFlagPayloads }\n            }\n            persistence &&\n                persistence.register({\n                    [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFeatureFlags)),\n                    [ENABLED_FEATURE_FLAGS]: newFeatureFlags || {},\n                    [PERSISTENCE_FEATURE_FLAG_PAYLOADS]: newFeatureFlagPayloads || {},\n                })\n        }\n    }\n}\n\nexport class PostHogFeatureFlags {\n    instance: PostHog\n    _override_warning: boolean\n    featureFlagEventHandlers: FeatureFlagsCallback[]\n    reloadFeatureFlagsQueued: boolean\n    reloadFeatureFlagsInAction: boolean\n    $anon_distinct_id: string | undefined\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this._override_warning = false\n        this.featureFlagEventHandlers = []\n\n        this.reloadFeatureFlagsQueued = false\n        this.reloadFeatureFlagsInAction = false\n    }\n\n    getFlags(): string[] {\n        return Object.keys(this.getFlagVariants())\n    }\n\n    getFlagVariants(): Record<string, string | boolean> {\n        const enabledFlags = this.instance.get_property(ENABLED_FEATURE_FLAGS)\n        const overriddenFlags = this.instance.get_property(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        if (!overriddenFlags) {\n            return enabledFlags || {}\n        }\n\n        const finalFlags = _extend({}, enabledFlags)\n        const overriddenKeys = Object.keys(overriddenFlags)\n        for (let i = 0; i < overriddenKeys.length; i++) {\n            if (overriddenFlags[overriddenKeys[i]] === false) {\n                delete finalFlags[overriddenKeys[i]]\n            } else {\n                finalFlags[overriddenKeys[i]] = overriddenFlags[overriddenKeys[i]]\n            }\n        }\n        if (!this._override_warning) {\n            logger.warn(' Overriding feature flags!', {\n                enabledFlags,\n                overriddenFlags,\n                finalFlags,\n            })\n            this._override_warning = true\n        }\n        return finalFlags\n    }\n\n    getFlagPayloads(): Record<string, JsonType> {\n        const flagPayloads = this.instance.get_property(PERSISTENCE_FEATURE_FLAG_PAYLOADS)\n        return flagPayloads || {}\n    }\n\n    /**\n     * Reloads feature flags asynchronously.\n     *\n     * Constraints:\n     *\n     * 1. Avoid parallel requests\n     * 2. Delay a few milliseconds after each reloadFeatureFlags call to batch subsequent changes together\n     * 3. Don't call this during initial load (as /decide will be called instead), see posthog-core.js\n     */\n    reloadFeatureFlags(): void {\n        if (!this.reloadFeatureFlagsQueued) {\n            this.reloadFeatureFlagsQueued = true\n            this._startReloadTimer()\n        }\n    }\n\n    setAnonymousDistinctId(anon_distinct_id: string): void {\n        this.$anon_distinct_id = anon_distinct_id\n    }\n\n    setReloadingPaused(isPaused: boolean): void {\n        this.reloadFeatureFlagsInAction = isPaused\n    }\n\n    resetRequestQueue(): void {\n        this.reloadFeatureFlagsQueued = false\n    }\n\n    _startReloadTimer(): void {\n        if (this.reloadFeatureFlagsQueued && !this.reloadFeatureFlagsInAction) {\n            setTimeout(() => {\n                if (!this.reloadFeatureFlagsInAction && this.reloadFeatureFlagsQueued) {\n                    this.reloadFeatureFlagsQueued = false\n                    this._reloadFeatureFlagsRequest()\n                }\n            }, 5)\n        }\n    }\n\n    _reloadFeatureFlagsRequest(): void {\n        if (this.instance.config.advanced_disable_feature_flags) {\n            return\n        }\n\n        this.setReloadingPaused(true)\n        const token = this.instance.config.token\n        const personProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY)\n        const groupProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY)\n        const json_data = JSON.stringify({\n            token: token,\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            $anon_distinct_id: this.$anon_distinct_id,\n            person_properties: personProperties,\n            group_properties: groupProperties,\n            disable_flags: this.instance.config.advanced_disable_feature_flags || undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            this.instance.requestRouter.endpointFor('api', '/decide/?v=3'),\n            { data: encoded_data },\n            { method: 'POST' },\n            (response) => {\n                // reset anon_distinct_id after at least a single request with it\n                // makes it through\n                this.$anon_distinct_id = undefined\n                this.receivedFeatureFlags(response as DecideResponse)\n\n                // :TRICKY: Reload - start another request if queued!\n                this.setReloadingPaused(false)\n                this._startReloadTimer()\n            }\n        )\n    }\n\n    /*\n     * Get feature flag's value for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('my-flag') === 'some-variant') { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options: { send_event?: boolean } = {}): boolean | string | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            logger.warn('getFeatureFlag for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        const flagValue = this.getFlagVariants()[key]\n        const flagReportValue = `${flagValue}`\n        const flagCallReported: Record<string, string[]> = this.instance.get_property(FLAG_CALL_REPORTED) || {}\n\n        if (options.send_event || !('send_event' in options)) {\n            if (!(key in flagCallReported) || !flagCallReported[key].includes(flagReportValue)) {\n                if (_isArray(flagCallReported[key])) {\n                    flagCallReported[key].push(flagReportValue)\n                } else {\n                    flagCallReported[key] = [flagReportValue]\n                }\n                this.instance.persistence?.register({ [FLAG_CALL_REPORTED]: flagCallReported })\n\n                this.instance.capture('$feature_flag_called', { $feature_flag: key, $feature_flag_response: flagValue })\n            }\n        }\n        return flagValue\n    }\n\n    getFeatureFlagPayload(key: string): JsonType {\n        const payloads = this.getFlagPayloads()\n        return payloads[key]\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} key Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options: { send_event?: boolean } = {}): boolean | undefined {\n        if (!this.instance.decideEndpointWasHit && !(this.getFlags() && this.getFlags().length > 0)) {\n            logger.warn('isFeatureEnabled for key \"' + key + '\" failed. Feature flags didn\\'t load in time.')\n            return undefined\n        }\n        return !!this.getFeatureFlag(key, options)\n    }\n\n    addFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers.push(handler)\n    }\n\n    removeFeatureFlagsHandler(handler: FeatureFlagsCallback): void {\n        this.featureFlagEventHandlers = this.featureFlagEventHandlers.filter((h) => h !== handler)\n    }\n\n    receivedFeatureFlags(response: Partial<DecideResponse>): void {\n        if (!this.instance.persistence) {\n            return\n        }\n        this.instance.decideEndpointWasHit = true\n        const currentFlags = this.getFlagVariants()\n        const currentFlagPayloads = this.getFlagPayloads()\n        parseFeatureFlagDecideResponse(response, this.instance.persistence, currentFlags, currentFlagPayloads)\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    /*\n     * Override feature flags for debugging.\n     *\n     * ### Usage:\n     *\n     *     - posthog.feature_flags.override(false)\n     *     - posthog.feature_flags.override(['beta-feature'])\n     *     - posthog.feature_flags.override({'beta-feature': 'variant', 'other-feature': True})\n     *\n     * @param {Object|Array|String} flags Flags to override with.\n     */\n    override(flags: boolean | string[] | Record<string, string | boolean>): void {\n        if (!this.instance.__loaded || !this.instance.persistence) {\n            return logger.uninitializedWarning('posthog.feature_flags.override')\n        }\n\n        this._override_warning = false\n\n        if (flags === false) {\n            this.instance.persistence.unregister(PERSISTENCE_OVERRIDE_FEATURE_FLAGS)\n        } else if (_isArray(flags)) {\n            const flagsObj: Record<string, string | boolean> = {}\n            for (let i = 0; i < flags.length; i++) {\n                flagsObj[flags[i]] = true\n            }\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flagsObj })\n        } else {\n            this.instance.persistence.register({ [PERSISTENCE_OVERRIDE_FEATURE_FLAGS]: flags })\n        }\n    }\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: FeatureFlagsCallback): () => void {\n        this.addFeatureFlagsHandler(callback)\n        if (this.instance.decideEndpointWasHit) {\n            const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n            callback(flags, flagVariants)\n        }\n        return () => this.removeFeatureFlagsHandler(callback)\n    }\n\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        const enrollmentPersonProp = {\n            [`$feature_enrollment/${key}`]: isEnrolled,\n        }\n        this.instance.capture('$feature_enrollment_update', {\n            $feature_flag: key,\n            $feature_enrollment: isEnrolled,\n            $set: enrollmentPersonProp,\n        })\n        this.setPersonPropertiesForFlags(enrollmentPersonProp, false)\n\n        const newFlags = { ...this.getFlagVariants(), [key]: isEnrolled }\n        this.instance.persistence?.register({\n            [PERSISTENCE_ACTIVE_FEATURE_FLAGS]: Object.keys(filterActiveFeatureFlags(newFlags)),\n            [ENABLED_FEATURE_FLAGS]: newFlags,\n        })\n        this._fireFeatureFlagsCallbacks()\n    }\n\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        const existing_early_access_features = this.instance.get_property(PERSISTENCE_EARLY_ACCESS_FEATURES)\n\n        if (!existing_early_access_features || force_reload) {\n            this.instance._send_request(\n                this.instance.requestRouter.endpointFor(\n                    'api',\n                    `/api/early_access_features/?token=${this.instance.config.token}`\n                ),\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const earlyAccessFeatures = (response as EarlyAccessFeatureResponse).earlyAccessFeatures\n                    this.instance.persistence?.register({ [PERSISTENCE_EARLY_ACCESS_FEATURES]: earlyAccessFeatures })\n                    return callback(earlyAccessFeatures)\n                }\n            )\n        } else {\n            return callback(existing_early_access_features)\n        }\n    }\n\n    _prepareFeatureFlagsForCallbacks(): { flags: string[]; flagVariants: Record<string, string | boolean> } {\n        const flags = this.getFlags()\n        const flagVariants = this.getFlagVariants()\n\n        // Return truthy\n        const truthyFlags = flags.filter((flag) => flagVariants[flag])\n        const truthyFlagVariants = Object.keys(flagVariants)\n            .filter((variantKey) => flagVariants[variantKey])\n            .reduce((res: Record<string, string | boolean>, key) => {\n                res[key] = flagVariants[key]\n                return res\n            }, {})\n\n        return {\n            flags: truthyFlags,\n            flagVariants: truthyFlagVariants,\n        }\n    }\n\n    _fireFeatureFlagsCallbacks(): void {\n        const { flags, flagVariants } = this._prepareFeatureFlagsForCallbacks()\n        this.featureFlagEventHandlers.forEach((handler) => handler(flags, flagVariants))\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        // Get persisted person properties\n        const existingProperties = this.instance.get_property(STORED_PERSON_PROPERTIES_KEY) || {}\n\n        this.instance.register({\n            [STORED_PERSON_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.instance.unregister(STORED_PERSON_PROPERTIES_KEY)\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        // Get persisted group properties\n        const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n\n        if (Object.keys(existingProperties).length !== 0) {\n            Object.keys(existingProperties).forEach((groupType) => {\n                existingProperties[groupType] = {\n                    ...existingProperties[groupType],\n                    ...properties[groupType],\n                }\n                delete properties[groupType]\n            })\n        }\n\n        this.instance.register({\n            [STORED_GROUP_PROPERTIES_KEY]: {\n                ...existingProperties,\n                ...properties,\n            },\n        })\n\n        if (reloadFeatureFlags) {\n            this.instance.reloadFeatureFlags()\n        }\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        if (group_type) {\n            const existingProperties = this.instance.get_property(STORED_GROUP_PROPERTIES_KEY) || {}\n            this.instance.register({\n                [STORED_GROUP_PROPERTIES_KEY]: { ...existingProperties, [group_type]: {} },\n            })\n        } else {\n            this.instance.unregister(STORED_GROUP_PROPERTIES_KEY)\n        }\n    }\n}\n","/**\n * uuidv7: An experimental implementation of the proposed UUID Version 7\n *\n * @license Apache-2.0\n * @copyright 2021-2023 LiosK\n * @packageDocumentation\n *\n * from https://github.com/LiosK/uuidv7/blob/e501462ea3d23241de13192ceae726956f9b3b7d/src/index.ts\n */\n\n// polyfill for IE11\nimport { window } from './utils/globals'\n\nimport { _isNumber, _isUndefined } from './utils/type-utils'\n\nif (!Math.trunc) {\n    Math.trunc = function (v) {\n        return v < 0 ? Math.ceil(v) : Math.floor(v)\n    }\n}\n\n// polyfill for IE11\nif (!Number.isInteger) {\n    Number.isInteger = function (value) {\n        return _isNumber(value) && isFinite(value) && Math.floor(value) === value\n    }\n}\n\nconst DIGITS = '0123456789abcdef'\n\n/** Represents a UUID as a 16-byte byte array. */\nexport class UUID {\n    /** @param bytes - The 16-byte byte array representation. */\n    constructor(readonly bytes: Readonly<Uint8Array>) {\n        if (bytes.length !== 16) {\n            throw new TypeError('not 128-bit length')\n        }\n    }\n\n    /**\n     * Builds a byte array from UUIDv7 field values.\n     *\n     * @param unixTsMs - A 48-bit `unix_ts_ms` field value.\n     * @param randA - A 12-bit `rand_a` field value.\n     * @param randBHi - The higher 30 bits of 62-bit `rand_b` field value.\n     * @param randBLo - The lower 32 bits of 62-bit `rand_b` field value.\n     */\n    static fromFieldsV7(unixTsMs: number, randA: number, randBHi: number, randBLo: number): UUID {\n        if (\n            !Number.isInteger(unixTsMs) ||\n            !Number.isInteger(randA) ||\n            !Number.isInteger(randBHi) ||\n            !Number.isInteger(randBLo) ||\n            unixTsMs < 0 ||\n            randA < 0 ||\n            randBHi < 0 ||\n            randBLo < 0 ||\n            unixTsMs > 0xffff_ffff_ffff ||\n            randA > 0xfff ||\n            randBHi > 0x3fff_ffff ||\n            randBLo > 0xffff_ffff\n        ) {\n            throw new RangeError('invalid field value')\n        }\n\n        const bytes = new Uint8Array(16)\n        bytes[0] = unixTsMs / 2 ** 40\n        bytes[1] = unixTsMs / 2 ** 32\n        bytes[2] = unixTsMs / 2 ** 24\n        bytes[3] = unixTsMs / 2 ** 16\n        bytes[4] = unixTsMs / 2 ** 8\n        bytes[5] = unixTsMs\n        bytes[6] = 0x70 | (randA >>> 8)\n        bytes[7] = randA\n        bytes[8] = 0x80 | (randBHi >>> 24)\n        bytes[9] = randBHi >>> 16\n        bytes[10] = randBHi >>> 8\n        bytes[11] = randBHi\n        bytes[12] = randBLo >>> 24\n        bytes[13] = randBLo >>> 16\n        bytes[14] = randBLo >>> 8\n        bytes[15] = randBLo\n        return new UUID(bytes)\n    }\n\n    /** @returns The 8-4-4-4-12 canonical hexadecimal string representation. */\n    toString(): string {\n        let text = ''\n        for (let i = 0; i < this.bytes.length; i++) {\n            text = text + DIGITS.charAt(this.bytes[i] >>> 4) + DIGITS.charAt(this.bytes[i] & 0xf)\n            if (i === 3 || i === 5 || i === 7 || i === 9) {\n                text += '-'\n            }\n        }\n\n        if (text.length !== 36) {\n            // We saw one customer whose bundling code was mangling the UUID generation\n            // rather than accept a bad UUID, we throw an error here.\n            throw new Error('Invalid UUIDv7 was generated')\n        }\n        return text\n    }\n\n    /** Creates an object from `this`. */\n    clone(): UUID {\n        return new UUID(this.bytes.slice(0))\n    }\n\n    /** Returns true if `this` is equivalent to `other`. */\n    equals(other: UUID): boolean {\n        return this.compareTo(other) === 0\n    }\n\n    /**\n     * Returns a negative integer, zero, or positive integer if `this` is less\n     * than, equal to, or greater than `other`, respectively.\n     */\n    compareTo(other: UUID): number {\n        for (let i = 0; i < 16; i++) {\n            const diff = this.bytes[i] - other.bytes[i]\n            if (diff !== 0) {\n                return Math.sign(diff)\n            }\n        }\n        return 0\n    }\n}\n\n/** Encapsulates the monotonic counter state. */\nclass V7Generator {\n    private timestamp = 0\n    private counter = 0\n    private readonly random = new DefaultRandom()\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or resets the\n     * generator upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method resets the generator and returns a new\n     * UUID based on the current timestamp.\n     */\n    generate(): UUID {\n        const value = this.generateOrAbort()\n        if (!_isUndefined(value)) {\n            return value\n        } else {\n            // reset state and resume\n            this.timestamp = 0\n            const valueAfterReset = this.generateOrAbort()\n            if (_isUndefined(valueAfterReset)) {\n                throw new Error('Could not generate UUID after timestamp reset')\n            }\n            return valueAfterReset\n        }\n    }\n\n    /**\n     * Generates a new UUIDv7 object from the current timestamp, or returns\n     * `undefined` upon significant timestamp rollback.\n     *\n     * This method returns monotonically increasing UUIDs unless the up-to-date\n     * timestamp is significantly (by ten seconds or more) smaller than the one\n     * embedded in the immediately preceding UUID. If such a significant clock\n     * rollback is detected, this method aborts and returns `undefined`.\n     */\n    generateOrAbort(): UUID | undefined {\n        const MAX_COUNTER = 0x3ff_ffff_ffff\n        const ROLLBACK_ALLOWANCE = 10_000 // 10 seconds\n\n        const ts = Date.now()\n        if (ts > this.timestamp) {\n            this.timestamp = ts\n            this.resetCounter()\n        } else if (ts + ROLLBACK_ALLOWANCE > this.timestamp) {\n            // go on with previous timestamp if new one is not much smaller\n            this.counter++\n            if (this.counter > MAX_COUNTER) {\n                // increment timestamp at counter overflow\n                this.timestamp++\n                this.resetCounter()\n            }\n        } else {\n            // abort if clock went backwards to unbearable extent\n            return undefined\n        }\n\n        return UUID.fromFieldsV7(\n            this.timestamp,\n            Math.trunc(this.counter / 2 ** 30),\n            this.counter & (2 ** 30 - 1),\n            this.random.nextUint32()\n        )\n    }\n\n    /** Initializes the counter at a 42-bit random integer. */\n    private resetCounter(): void {\n        this.counter = this.random.nextUint32() * 0x400 + (this.random.nextUint32() & 0x3ff)\n    }\n}\n\n/** A global flag to force use of cryptographically strong RNG. */\ndeclare const UUIDV7_DENY_WEAK_RNG: boolean\n\n/** Stores `crypto.getRandomValues()` available in the environment. */\nlet getRandomValues: <T extends Uint8Array | Uint32Array>(buffer: T) => T = (buffer) => {\n    // fall back on Math.random() unless the flag is set to true\n    // TRICKY: don't use the _isUndefined method here as can't pass the reference\n    if (typeof UUIDV7_DENY_WEAK_RNG !== 'undefined' && UUIDV7_DENY_WEAK_RNG) {\n        throw new Error('no cryptographically strong RNG available')\n    }\n\n    for (let i = 0; i < buffer.length; i++) {\n        buffer[i] = Math.trunc(Math.random() * 0x1_0000) * 0x1_0000 + Math.trunc(Math.random() * 0x1_0000)\n    }\n    return buffer\n}\n\n// detect Web Crypto API\nif (window && !_isUndefined(window.crypto) && crypto.getRandomValues) {\n    getRandomValues = (buffer) => crypto.getRandomValues(buffer)\n}\n\n/**\n * Wraps `crypto.getRandomValues()` and compatibles to enable buffering; this\n * uses a small buffer by default to avoid unbearable throughput decline in some\n * environments as well as the waste of time and space for unused values.\n */\nclass DefaultRandom {\n    private readonly buffer = new Uint32Array(8)\n    private cursor = Infinity\n    nextUint32(): number {\n        if (this.cursor >= this.buffer.length) {\n            getRandomValues(this.buffer)\n            this.cursor = 0\n        }\n        return this.buffer[this.cursor++]\n    }\n}\n\nlet defaultGenerator: V7Generator | undefined\n\n/**\n * Generates a UUIDv7 string.\n *\n * @returns The 8-4-4-4-12 canonical hexadecimal string representation\n * (\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\").\n */\nexport const uuidv7 = (): string => uuidv7obj().toString()\n\n/** Generates a UUIDv7 object. */\nconst uuidv7obj = (): UUID => (defaultGenerator || (defaultGenerator = new V7Generator())).generate()\n","import { _extend } from './utils'\nimport { PersistentStore, Properties } from './types'\nimport { DISTINCT_ID, SESSION_ID, SESSION_RECORDING_IS_SAMPLED } from './constants'\n\nimport { _isNull, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window, document } from './utils/globals'\nimport { uuidv7 } from './uuidv7'\n\nconst Y1970 = 'Thu, 01 Jan 1970 00:00:00 GMT'\n// we store the discovered subdomain in memory because it might be read multiple times\nlet firstNonPublicSubDomain = ''\n\n// helper to allow tests to clear this \"cache\"\nexport const resetSubDomainCache = () => {\n    firstNonPublicSubDomain = ''\n}\n\n/**\n * Browsers don't offer a way to check if something is a public suffix\n * e.g. `.com.au`, `.io`, `.org.uk`\n *\n * But they do reject cookies set on public suffixes\n * Setting a cookie on `.co.uk` would mean it was sent for every `.co.uk` site visited\n *\n * So, we can use this to check if a domain is a public suffix\n * by trying to set a cookie on a subdomain of the provided hostname\n * until the browser accepts it\n *\n * inspired by https://github.com/AngusFu/browser-root-domain\n */\nexport function seekFirstNonPublicSubDomain(hostname: string, cookieJar = document): string {\n    if (firstNonPublicSubDomain) {\n        return firstNonPublicSubDomain\n    }\n\n    if (!cookieJar) {\n        return ''\n    }\n    if (['localhost', '127.0.0.1'].includes(hostname)) return ''\n\n    const list = hostname.split('.')\n    let len = Math.min(list.length, 8) // paranoia - we know this number should be small\n    const key = 'dmn_chk_' + uuidv7()\n    const R = new RegExp('(^|;)\\\\s*' + key + '=1')\n\n    while (!firstNonPublicSubDomain && len--) {\n        const candidate = list.slice(len).join('.')\n        const candidateCookieValue = key + '=1;domain=.' + candidate\n\n        // try to set cookie\n        cookieJar.cookie = candidateCookieValue\n\n        if (R.test(cookieJar.cookie)) {\n            // the cookie was accepted by the browser, remove the test cookie\n            cookieJar.cookie = candidateCookieValue + ';expires=' + Y1970\n            firstNonPublicSubDomain = candidate\n        }\n    }\n\n    return firstNonPublicSubDomain\n}\n\nconst DOMAIN_MATCH_REGEX = /[a-z0-9][a-z0-9-]+\\.[a-z]{2,}$/i\nconst originalCookieDomainFn = (hostname: string): string => {\n    const matches = hostname.match(DOMAIN_MATCH_REGEX)\n    return matches ? matches[0] : ''\n}\n\nexport function chooseCookieDomain(hostname: string, cross_subdomain: boolean | undefined): string {\n    if (cross_subdomain) {\n        // NOTE: Could we use this for cross domain tracking?\n        let matchedSubDomain = seekFirstNonPublicSubDomain(hostname)\n\n        if (!matchedSubDomain) {\n            const originalMatch = originalCookieDomainFn(hostname)\n            if (originalMatch !== matchedSubDomain) {\n                logger.info('Warning: cookie subdomain discovery mismatch', originalMatch, matchedSubDomain)\n            }\n            matchedSubDomain = originalMatch\n        }\n\n        return matchedSubDomain ? '; domain=.' + matchedSubDomain : ''\n    }\n    return ''\n}\n\n// Methods partially borrowed from quirksmode.org/js/cookies.html\nexport const cookieStore: PersistentStore = {\n    is_supported: () => !!document,\n\n    error: function (msg) {\n        logger.error('cookieStore error: ' + msg)\n    },\n\n    get: function (name) {\n        if (!document) {\n            return\n        }\n\n        try {\n            const nameEQ = name + '='\n            const ca = document.cookie.split(';').filter((x) => x.length)\n            for (let i = 0; i < ca.length; i++) {\n                let c = ca[i]\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1, c.length)\n                }\n                if (c.indexOf(nameEQ) === 0) {\n                    return decodeURIComponent(c.substring(nameEQ.length, c.length))\n                }\n            }\n        } catch (err) {}\n        return null\n    },\n\n    parse: function (name) {\n        let cookie\n        try {\n            cookie = JSON.parse(cookieStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return cookie\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        if (!document) {\n            return\n        }\n        try {\n            let expires = '',\n                secure = ''\n\n            const cdomain = chooseCookieDomain(document.location.hostname, cross_subdomain)\n\n            if (days) {\n                const date = new Date()\n                date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000)\n                expires = '; expires=' + date.toUTCString()\n            }\n\n            if (is_secure) {\n                secure = '; secure'\n            }\n\n            const new_cookie_val =\n                name +\n                '=' +\n                encodeURIComponent(JSON.stringify(value)) +\n                expires +\n                '; SameSite=Lax; path=/' +\n                cdomain +\n                secure\n\n            // 4096 bytes is the size at which some browsers (e.g. firefox) will not store a cookie, warn slightly before that\n            if (new_cookie_val.length > 4096 * 0.9) {\n                logger.warn('cookieStore warning: large cookie, len=' + new_cookie_val.length)\n            }\n\n            document.cookie = new_cookie_val\n            return new_cookie_val\n        } catch (err) {\n            return\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            cookieStore.set(name, '', -1, cross_subdomain)\n        } catch (err) {\n            return\n        }\n    },\n}\n\nlet _localStorage_supported: boolean | null = null\n\nexport const localStore: PersistentStore = {\n    is_supported: function () {\n        if (!_isNull(_localStorage_supported)) {\n            return _localStorage_supported\n        }\n\n        let supported = true\n        if (!_isUndefined(window)) {\n            try {\n                const key = '__mplssupport__',\n                    val = 'xyz'\n                localStore.set(key, val)\n                if (localStore.get(key) !== '\"xyz\"') {\n                    supported = false\n                }\n                localStore.remove(key)\n            } catch (err) {\n                supported = false\n            }\n        } else {\n            supported = false\n        }\n        if (!supported) {\n            logger.error('localStorage unsupported; falling back to cookie store')\n        }\n\n        _localStorage_supported = supported\n        return supported\n    },\n\n    error: function (msg) {\n        logger.error('localStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        try {\n            return window?.localStorage.getItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(localStore.get(name)) || {}\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window?.localStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window?.localStorage.removeItem(name)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\n// Use localstorage for most data but still use cookie for COOKIE_PERSISTED_PROPERTIES\n// This solves issues with cookies having too much data in them causing headers too large\n// Also makes sure we don't have to send a ton of data to the server\nconst COOKIE_PERSISTED_PROPERTIES = [DISTINCT_ID, SESSION_ID, SESSION_RECORDING_IS_SAMPLED]\n\nexport const localPlusCookieStore: PersistentStore = {\n    ...localStore,\n    parse: function (name) {\n        try {\n            let extend: Properties = {}\n            try {\n                // See if there's a cookie stored with data.\n                extend = cookieStore.parse(name) || {}\n            } catch (err) {}\n            const value = _extend(extend, JSON.parse(localStore.get(name) || '{}'))\n            localStore.set(name, value)\n            return value\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value, days, cross_subdomain, is_secure) {\n        try {\n            localStore.set(name, value)\n            const cookiePersistedProperties: Record<string, any> = {}\n            COOKIE_PERSISTED_PROPERTIES.forEach((key) => {\n                if (value[key]) {\n                    cookiePersistedProperties[key] = value[key]\n                }\n            })\n\n            if (Object.keys(cookiePersistedProperties).length) {\n                cookieStore.set(name, cookiePersistedProperties, days, cross_subdomain, is_secure)\n            }\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n\n    remove: function (name, cross_subdomain) {\n        try {\n            window?.localStorage.removeItem(name)\n            cookieStore.remove(name, cross_subdomain)\n        } catch (err) {\n            localStore.error(err)\n        }\n    },\n}\n\nconst memoryStorage: Properties = {}\n\n// Storage that only lasts the length of the pageview if we don't want to use cookies\nexport const memoryStore: PersistentStore = {\n    is_supported: function () {\n        return true\n    },\n\n    error: function (msg) {\n        logger.error('memoryStorage error: ' + msg)\n    },\n\n    get: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    parse: function (name) {\n        return memoryStorage[name] || null\n    },\n\n    set: function (name, value) {\n        memoryStorage[name] = value\n    },\n\n    remove: function (name) {\n        delete memoryStorage[name]\n    },\n}\n\nlet sessionStorageSupported: boolean | null = null\nexport const resetSessionStorageSupported = () => {\n    sessionStorageSupported = null\n}\n// Storage that only lasts the length of a tab/window. Survives page refreshes\nexport const sessionStore: PersistentStore = {\n    is_supported: function () {\n        if (!_isNull(sessionStorageSupported)) {\n            return sessionStorageSupported\n        }\n        sessionStorageSupported = true\n        if (!_isUndefined(window)) {\n            try {\n                const key = '__support__',\n                    val = 'xyz'\n                sessionStore.set(key, val)\n                if (sessionStore.get(key) !== '\"xyz\"') {\n                    sessionStorageSupported = false\n                }\n                sessionStore.remove(key)\n            } catch (err) {\n                sessionStorageSupported = false\n            }\n        } else {\n            sessionStorageSupported = false\n        }\n        return sessionStorageSupported\n    },\n\n    error: function (msg) {\n        logger.error('sessionStorage error: ', msg)\n    },\n\n    get: function (name) {\n        try {\n            return window?.sessionStorage.getItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n        return null\n    },\n\n    parse: function (name) {\n        try {\n            return JSON.parse(sessionStore.get(name)) || null\n        } catch (err) {\n            // noop\n        }\n        return null\n    },\n\n    set: function (name, value) {\n        try {\n            window?.sessionStorage.setItem(name, JSON.stringify(value))\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n\n    remove: function (name) {\n        try {\n            window?.sessionStorage.removeItem(name)\n        } catch (err) {\n            sessionStore.error(err)\n        }\n    },\n}\n","import { _each, _isValidRegex } from './'\n\nimport { _isArray, _isFile, _isUndefined } from './type-utils'\nimport { logger } from './logger'\nimport { document, fetch, XMLHttpRequest } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\nexport const SUPPORTS_XHR = !!(XMLHttpRequest && 'withCredentials' in new XMLHttpRequest())\n// eslint-disable-next-line compat/compat\nexport const SUPPORTS_REQUEST = SUPPORTS_XHR || !!fetch\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (_isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const _isUrlMatchingRegex = function (url: string, pattern: string): boolean {\n    if (!_isValidRegex(pattern)) return false\n    return new RegExp(pattern).test(url)\n}\n\nexport const _formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    _each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (_isUndefined(val) || _isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(_isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\nexport const _getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n    const queryParams: string = withoutHash.split('?')[1] || ''\n\n    const queryParts = queryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!_isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch (err) {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","import { _includes } from './index'\nimport { _isFunction, _isUndefined } from './type-utils'\n\n/**\n * this device detection code is (at time of writing) about 3% of the size of the entire library\n * this is mostly because the identifiers user in regexes and results can't be minified away since\n * they have meaning\n *\n * so, there are some pre-uglifying choices in the code to help reduce the size\n * e.g. many repeated strings are stored as variables and then old-fashioned concatenated together\n *\n * TL;DR here be dragons\n */\nconst FACEBOOK = 'Facebook'\nconst MOBILE = 'Mobile'\nconst IOS = 'iOS'\nconst ANDROID = 'Android'\nconst TABLET = 'Tablet'\nconst ANDROID_TABLET = ANDROID + ' ' + TABLET\nconst IPAD = 'iPad'\nconst APPLE = 'Apple'\nconst APPLE_WATCH = APPLE + ' Watch'\nconst SAFARI = 'Safari'\nconst BLACKBERRY = 'BlackBerry'\nconst SAMSUNG = 'Samsung'\nconst SAMSUNG_BROWSER = SAMSUNG + 'Browser'\nconst SAMSUNG_INTERNET = SAMSUNG + ' Internet'\nconst CHROME = 'Chrome'\nconst CHROME_OS = CHROME + ' OS'\nconst CHROME_IOS = CHROME + ' ' + IOS\nconst INTERNET_EXPLORER = 'Internet Explorer'\nconst INTERNET_EXPLORER_MOBILE = INTERNET_EXPLORER + ' ' + MOBILE\nconst OPERA = 'Opera'\nconst OPERA_MINI = OPERA + ' Mini'\nconst EDGE = 'Edge'\nconst MICROSOFT_EDGE = 'Microsoft ' + EDGE\nconst FIREFOX = 'Firefox'\nconst FIREFOX_IOS = FIREFOX + ' ' + IOS\nconst NINTENDO = 'Nintendo'\nconst PLAYSTATION = 'PlayStation'\nconst XBOX = 'Xbox'\nconst ANDROID_MOBILE = ANDROID + ' ' + MOBILE\nconst MOBILE_SAFARI = MOBILE + ' ' + SAFARI\nconst WINDOWS = 'Windows'\nconst WINDOWS_PHONE = WINDOWS + ' Phone'\nconst NOKIA = 'Nokia'\nconst OUYA = 'Ouya'\nconst GENERIC = 'Generic'\nconst GENERIC_MOBILE = GENERIC + ' ' + MOBILE.toLowerCase()\nconst GENERIC_TABLET = GENERIC + ' ' + TABLET.toLowerCase()\nconst KONQUEROR = 'Konqueror'\n\nconst BROWSER_VERSION_REGEX_SUFFIX = '(\\\\d+(\\\\.\\\\d+)?)'\nconst DEFAULT_BROWSER_VERSION_REGEX = new RegExp('Version/' + BROWSER_VERSION_REGEX_SUFFIX)\n\nconst XBOX_REGEX = new RegExp(XBOX, 'i')\nconst PLAYSTATION_REGEX = new RegExp(PLAYSTATION + ' \\\\w+', 'i')\nconst NINTENDO_REGEX = new RegExp(NINTENDO + ' \\\\w+', 'i')\nconst BLACKBERRY_REGEX = new RegExp(BLACKBERRY + '|PlayBook|BB10', 'i')\n\nconst windowsVersionMap: Record<string, string> = {\n    'NT3.51': 'NT 3.11',\n    'NT4.0': 'NT 4.0',\n    '5.0': '2000',\n    '5.1': 'XP',\n    '5.2': 'XP',\n    '6.0': 'Vista',\n    '6.1': '7',\n    '6.2': '8',\n    '6.3': '8.1',\n    '6.4': '10',\n    '10.0': '10',\n}\n\n/**\n * Safari detection turns out to be complicated. For e.g. https://stackoverflow.com/a/29696509\n * We can be slightly loose because some options have been ruled out (e.g. firefox on iOS)\n * before this check is made\n */\nfunction isSafari(userAgent: string): boolean {\n    return _includes(userAgent, SAFARI) && !_includes(userAgent, CHROME) && !_includes(userAgent, ANDROID)\n}\n\nconst safariCheck = (ua: string, vendor?: string) => (vendor && _includes(vendor, APPLE)) || isSafari(ua)\n\n/**\n * This function detects which browser is running this script.\n * The order of the checks are important since many user agents\n * include keywords used in later checks.\n */\nexport const detectBrowser = function (user_agent: string, vendor: string | undefined, opera?: any): string {\n    if (opera) {\n        return OPERA\n    }\n    vendor = vendor || '' // vendor is undefined for at least IE9\n\n    if (_includes(user_agent, ' OPR/') && _includes(user_agent, 'Mini')) {\n        return OPERA_MINI\n    } else if (_includes(user_agent, ' OPR/')) {\n        return OPERA\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (_includes(user_agent, 'IE' + MOBILE) || _includes(user_agent, 'WPDesktop')) {\n        return INTERNET_EXPLORER_MOBILE\n    }\n    // https://developer.samsung.com/internet/user-agent-string-format\n    else if (_includes(user_agent, SAMSUNG_BROWSER)) {\n        return SAMSUNG_INTERNET\n    } else if (_includes(user_agent, EDGE) || _includes(user_agent, 'Edg/')) {\n        return MICROSOFT_EDGE\n    } else if (_includes(user_agent, 'FBIOS')) {\n        return FACEBOOK + ' ' + MOBILE\n    } else if (_includes(user_agent, CHROME)) {\n        return CHROME\n    } else if (_includes(user_agent, 'CriOS')) {\n        return CHROME_IOS\n    } else if (_includes(user_agent, 'UCWEB') || _includes(user_agent, 'UCBrowser')) {\n        return 'UC Browser'\n    } else if (_includes(user_agent, 'FxiOS')) {\n        return FIREFOX_IOS\n    } else if (_includes(user_agent, ANDROID)) {\n        return ANDROID_MOBILE\n    } else if (_includes(user_agent.toLowerCase(), KONQUEROR.toLowerCase())) {\n        return KONQUEROR\n    } else if (safariCheck(user_agent, vendor)) {\n        return _includes(user_agent, MOBILE) ? MOBILE_SAFARI : SAFARI\n    } else if (_includes(user_agent, FIREFOX)) {\n        return FIREFOX\n    } else if (_includes(user_agent, 'MSIE') || _includes(user_agent, 'Trident/')) {\n        return INTERNET_EXPLORER\n    } else if (_includes(user_agent, 'Gecko')) {\n        return FIREFOX\n    }\n\n    return ''\n}\n\nconst versionRegexes: Record<string, RegExp[]> = {\n    [INTERNET_EXPLORER_MOBILE]: [new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [MICROSOFT_EDGE]: [new RegExp(EDGE + '?\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [CHROME]: [new RegExp(CHROME + '/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [CHROME_IOS]: [new RegExp('CriOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    'UC Browser': [new RegExp('(UCBrowser|UCWEB)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [SAFARI]: [DEFAULT_BROWSER_VERSION_REGEX],\n    [MOBILE_SAFARI]: [DEFAULT_BROWSER_VERSION_REGEX],\n    [OPERA]: [new RegExp('(' + OPERA + '|OPR)\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [FIREFOX]: [new RegExp(FIREFOX + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [FIREFOX_IOS]: [new RegExp('FxiOS\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [KONQUEROR]: [new RegExp('Konqueror[:/]?' + BROWSER_VERSION_REGEX_SUFFIX, 'i')],\n    // not every blackberry user agent has the version after the name\n    [BLACKBERRY]: [new RegExp(BLACKBERRY + ' ' + BROWSER_VERSION_REGEX_SUFFIX), DEFAULT_BROWSER_VERSION_REGEX],\n    [ANDROID_MOBILE]: [new RegExp('android\\\\s' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [SAMSUNG_INTERNET]: [new RegExp(SAMSUNG_BROWSER + '\\\\/' + BROWSER_VERSION_REGEX_SUFFIX)],\n    [INTERNET_EXPLORER]: [new RegExp('(rv:|MSIE )' + BROWSER_VERSION_REGEX_SUFFIX)],\n    Mozilla: [new RegExp('rv:' + BROWSER_VERSION_REGEX_SUFFIX)],\n}\n\n/**\n * This function detects which browser version is running this script,\n * parsing major and minor version (e.g., 42.1). User agent strings from:\n * http://www.useragentstring.com/pages/useragentstring.php\n *\n * `navigator.vendor` is passed in and used to help with detecting certain browsers\n * NB `navigator.vendor` is deprecated and not present in every browser\n */\nexport const detectBrowserVersion = function (\n    userAgent: string,\n    vendor: string | undefined,\n    opera: string\n): number | null {\n    const browser = detectBrowser(userAgent, vendor, opera)\n    const regexes: RegExp[] | undefined = versionRegexes[browser as keyof typeof versionRegexes]\n    if (_isUndefined(regexes)) {\n        return null\n    }\n\n    for (let i = 0; i < regexes.length; i++) {\n        const regex = regexes[i]\n        const matches = userAgent.match(regex)\n        if (matches) {\n            return parseFloat(matches[matches.length - 2])\n        }\n    }\n    return null\n}\n\n// to avoid repeating regexes or calling them twice, we have an array of matches\n// the first regex that matches uses its matcher function to return the result\nconst osMatchers: [\n    RegExp,\n    [string, string] | ((match: RegExpMatchArray | null, user_agent: string) => [string, string])\n][] = [\n    [\n        new RegExp(XBOX + '; ' + XBOX + ' (.*?)[);]', 'i'),\n        (match) => {\n            return [XBOX, (match && match[1]) || '']\n        },\n    ],\n    [new RegExp(NINTENDO, 'i'), [NINTENDO, '']],\n    [new RegExp(PLAYSTATION, 'i'), [PLAYSTATION, '']],\n    [BLACKBERRY_REGEX, [BLACKBERRY, '']],\n    [\n        new RegExp(WINDOWS, 'i'),\n        (_, user_agent) => {\n            if (/Phone/.test(user_agent) || /WPDesktop/.test(user_agent)) {\n                return [WINDOWS_PHONE, '']\n            }\n            // not all JS versions support negative lookbehind, so we need two checks here\n            if (new RegExp(MOBILE).test(user_agent) && !/IEMobile\\b/.test(user_agent)) {\n                return [WINDOWS + ' ' + MOBILE, '']\n            }\n            const match = /Windows NT ([0-9.]+)/i.exec(user_agent)\n            if (match && match[1]) {\n                const version = match[1]\n                let osVersion = windowsVersionMap[version] || ''\n                if (/arm/i.test(user_agent)) {\n                    osVersion = 'RT'\n                }\n                return [WINDOWS, osVersion]\n            }\n            return [WINDOWS, '']\n        },\n    ],\n    [\n        /((iPhone|iPad|iPod).*?OS (\\d+)_(\\d+)_?(\\d+)?|iPhone)/,\n        (match) => {\n            if (match && match[3]) {\n                const versionParts = [match[3], match[4], match[5] || '0']\n                return [IOS, versionParts.join('.')]\n            }\n            return [IOS, '']\n        },\n    ],\n    [\n        /(watch.*\\/(\\d+\\.\\d+\\.\\d+)|watch os,(\\d+\\.\\d+),)/i,\n        (match) => {\n            // e.g. Watch4,3/5.3.8 (16U680)\n            let version = ''\n            if (match && match.length >= 3) {\n                version = _isUndefined(match[2]) ? match[3] : match[2]\n            }\n            return ['watchOS', version]\n        },\n    ],\n    [\n        new RegExp('(' + ANDROID + ' (\\\\d+)\\\\.(\\\\d+)\\\\.?(\\\\d+)?|' + ANDROID + ')', 'i'),\n        (match) => {\n            if (match && match[2]) {\n                const versionParts = [match[2], match[3], match[4] || '0']\n                return [ANDROID, versionParts.join('.')]\n            }\n            return [ANDROID, '']\n        },\n    ],\n    [\n        /Mac OS X (\\d+)[_.](\\d+)[_.]?(\\d+)?/i,\n        (match) => {\n            const result: [string, string] = ['Mac OS X', '']\n            if (match && match[1]) {\n                const versionParts = [match[1], match[2], match[3] || '0']\n                result[1] = versionParts.join('.')\n            }\n            return result\n        },\n    ],\n    [\n        /Mac/i,\n        // mop up a few non-standard UAs that should match mac\n        ['Mac OS X', ''],\n    ],\n    [/CrOS/, [CHROME_OS, '']],\n    [/Linux|debian/i, ['Linux', '']],\n]\n\nexport const detectOS = function (user_agent: string): [string, string] {\n    for (let i = 0; i < osMatchers.length; i++) {\n        const [rgex, resultOrFn] = osMatchers[i]\n        const match = rgex.exec(user_agent)\n        const result = match && (_isFunction(resultOrFn) ? resultOrFn(match, user_agent) : resultOrFn)\n        if (result) {\n            return result\n        }\n    }\n    return ['', '']\n}\n\nexport const detectDevice = function (user_agent: string): string {\n    if (NINTENDO_REGEX.test(user_agent)) {\n        return NINTENDO\n    } else if (PLAYSTATION_REGEX.test(user_agent)) {\n        return PLAYSTATION\n    } else if (XBOX_REGEX.test(user_agent)) {\n        return XBOX\n    } else if (new RegExp(OUYA, 'i').test(user_agent)) {\n        return OUYA\n    } else if (new RegExp('(' + WINDOWS_PHONE + '|WPDesktop)', 'i').test(user_agent)) {\n        return WINDOWS_PHONE\n    } else if (/iPad/.test(user_agent)) {\n        return IPAD\n    } else if (/iPod/.test(user_agent)) {\n        return 'iPod Touch'\n    } else if (/iPhone/.test(user_agent)) {\n        return 'iPhone'\n    } else if (/(watch)(?: ?os[,/]|\\d,\\d\\/)[\\d.]+/i.test(user_agent)) {\n        return APPLE_WATCH\n    } else if (BLACKBERRY_REGEX.test(user_agent)) {\n        return BLACKBERRY\n    } else if (/(kobo)\\s(ereader|touch)/i.test(user_agent)) {\n        return 'Kobo'\n    } else if (new RegExp(NOKIA, 'i').test(user_agent)) {\n        return NOKIA\n    } else if (\n        // Kindle Fire without Silk / Echo Show\n        /(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\\))/i.test(user_agent) ||\n        // Kindle Fire HD\n        /(kf[a-z]+)( bui|\\)).+silk\\//i.test(user_agent)\n    ) {\n        return 'Kindle Fire'\n    } else if (/(Android|ZTE)/i.test(user_agent)) {\n        if (\n            !new RegExp(MOBILE).test(user_agent) ||\n            /(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(user_agent)\n        ) {\n            if (\n                (/pixel[\\daxl ]{1,6}/i.test(user_agent) && !/pixel c/i.test(user_agent)) ||\n                /(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(user_agent) ||\n                (/lmy47v/i.test(user_agent) && !/QTAQZ3/i.test(user_agent))\n            ) {\n                return ANDROID\n            }\n            return ANDROID_TABLET\n        } else {\n            return ANDROID\n        }\n    } else if (new RegExp('(pda|' + MOBILE + ')', 'i').test(user_agent)) {\n        return GENERIC_MOBILE\n    } else if (new RegExp(TABLET, 'i').test(user_agent) && !new RegExp(TABLET + ' pc', 'i').test(user_agent)) {\n        return GENERIC_TABLET\n    } else {\n        return ''\n    }\n}\n\nexport const detectDeviceType = function (user_agent: string): string {\n    const device = detectDevice(user_agent)\n    if (\n        device === IPAD ||\n        device === ANDROID_TABLET ||\n        device === 'Kobo' ||\n        device === 'Kindle Fire' ||\n        device === GENERIC_TABLET\n    ) {\n        return TABLET\n    } else if (device === NINTENDO || device === XBOX || device === PLAYSTATION || device === OUYA) {\n        return 'Console'\n    } else if (device === APPLE_WATCH) {\n        return 'Wearable'\n    } else if (device) {\n        return MOBILE\n    } else {\n        return 'Desktop'\n    }\n}\n","import { _getQueryParam, convertToURL } from './request-utils'\nimport { _isNull } from './type-utils'\nimport { Properties } from '../types'\nimport Config from '../config'\nimport { _each, _extend, _strip_empty_properties, _timestamp } from './index'\nimport { assignableWindow, document, location, userAgent, window } from './globals'\nimport { detectBrowser, detectBrowserVersion, detectDevice, detectDeviceType, detectOS } from './user-agent-utils'\n\nconst URL_REGEX_PREFIX = 'https?://(.*)'\n\nexport const _info = {\n    campaignParams: function (customParams?: string[]): Record<string, any> {\n        // Should be kept in sync with https://github.com/PostHog/posthog/blob/master/plugin-server/src/utils/db/utils.ts#L60\n        const campaign_keywords = [\n            'utm_source',\n            'utm_medium',\n            'utm_campaign',\n            'utm_content',\n            'utm_term',\n            'gclid',\n            'gad_source',\n            'gbraid',\n            'wbraid',\n            'fbclid',\n            'msclkid',\n        ].concat(customParams || [])\n\n        const params: Record<string, any> = {}\n        _each(campaign_keywords, function (kwkey) {\n            const kw = document ? _getQueryParam(document.URL, kwkey) : ''\n            if (kw.length) {\n                params[kwkey] = kw\n            }\n        })\n\n        return params\n    },\n\n    searchEngine: function (): string | null {\n        const referrer = document?.referrer\n        if (!referrer) {\n            return null\n        } else {\n            if (referrer.search(URL_REGEX_PREFIX + 'google.([^/?]*)') === 0) {\n                return 'google'\n            } else if (referrer.search(URL_REGEX_PREFIX + 'bing.com') === 0) {\n                return 'bing'\n            } else if (referrer.search(URL_REGEX_PREFIX + 'yahoo.com') === 0) {\n                return 'yahoo'\n            } else if (referrer.search(URL_REGEX_PREFIX + 'duckduckgo.com') === 0) {\n                return 'duckduckgo'\n            } else {\n                return null\n            }\n        }\n    },\n\n    searchInfo: function (): Record<string, any> {\n        const search = _info.searchEngine(),\n            param = search != 'yahoo' ? 'q' : 'p',\n            ret: Record<string, any> = {}\n\n        if (!_isNull(search)) {\n            ret['$search_engine'] = search\n\n            const keyword = document ? _getQueryParam(document.referrer, param) : ''\n            if (keyword.length) {\n                ret['ph_keyword'] = keyword\n            }\n        }\n\n        return ret\n    },\n\n    /**\n     * This function detects which browser is running this script.\n     * The order of the checks are important since many user agents\n     * include keywords used in later checks.\n     */\n    browser: detectBrowser,\n\n    /**\n     * This function detects which browser version is running this script,\n     * parsing major and minor version (e.g., 42.1). User agent strings from:\n     * http://www.useragentstring.com/pages/useragentstring.php\n     *\n     * `navigator.vendor` is passed in and used to help with detecting certain browsers\n     * NB `navigator.vendor` is deprecated and not present in every browser\n     */\n    browserVersion: detectBrowserVersion,\n\n    browserLanguage: function (): string {\n        return (\n            navigator.language || // Any modern browser\n            (navigator as Record<string, any>).userLanguage // IE11\n        )\n    },\n\n    os: detectOS,\n\n    device: detectDevice,\n\n    deviceType: detectDeviceType,\n\n    referrer: function (): string {\n        return document?.referrer || '$direct'\n    },\n\n    referringDomain: function (): string {\n        if (!document?.referrer) {\n            return '$direct'\n        }\n        return convertToURL(document.referrer)?.host || '$direct'\n    },\n\n    properties: function (): Properties {\n        if (!userAgent) {\n            return {}\n        }\n        const [os_name, os_version] = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, assignableWindow.opera),\n                $device: _info.device(userAgent),\n                $device_type: _info.deviceType(userAgent),\n            }),\n            {\n                $current_url: location?.href,\n                $host: location?.host,\n                $pathname: location?.pathname,\n                $raw_user_agent: userAgent.length > 1000 ? userAgent.substring(0, 997) + '...' : userAgent,\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, assignableWindow.opera),\n                $browser_language: _info.browserLanguage(),\n                $screen_height: window?.screen.height,\n                $screen_width: window?.screen.width,\n                $viewport_height: window?.innerHeight,\n                $viewport_width: window?.innerWidth,\n                $lib: 'web',\n                $lib_version: Config.LIB_VERSION,\n                $insert_id: Math.random().toString(36).substring(2, 10) + Math.random().toString(36).substring(2, 10),\n                $time: _timestamp() / 1000, // epoch time in seconds\n            }\n        )\n    },\n\n    people_properties: function (): Properties {\n        if (!userAgent) {\n            return {}\n        }\n\n        const [os_name, os_version] = _info.os(userAgent)\n        return _extend(\n            _strip_empty_properties({\n                $os: os_name,\n                $os_version: os_version,\n                $browser: _info.browser(userAgent, navigator.vendor, assignableWindow.opera),\n            }),\n            {\n                $browser_version: _info.browserVersion(userAgent, navigator.vendor, assignableWindow.opera),\n            }\n        )\n    },\n}\n","/* eslint camelcase: \"off\" */\n\nimport { _each, _extend, _include, _strip_empty_properties } from './utils'\nimport { cookieStore, localStore, localPlusCookieStore, memoryStore, sessionStore } from './storage'\nimport { PersistentStore, PostHogConfig, Properties } from './types'\nimport {\n    PERSISTENCE_RESERVED_PROPERTIES,\n    EVENT_TIMERS_KEY,\n    ENABLED_FEATURE_FLAGS,\n    POSTHOG_QUOTA_LIMITED,\n    USER_STATE,\n} from './constants'\n\nimport { _isObject, _isUndefined } from './utils/type-utils'\nimport { _info } from './utils/event-utils'\nimport { logger } from './utils/logger'\n\nconst CASE_INSENSITIVE_PERSISTENCE_TYPES: readonly Lowercase<PostHogConfig['persistence']>[] = [\n    'cookie',\n    'localstorage',\n    'localstorage+cookie',\n    'sessionstorage',\n    'memory',\n]\n\nconst parseName = (config: PostHogConfig): string => {\n    let token = ''\n    if (config['token']) {\n        token = config['token'].replace(/\\+/g, 'PL').replace(/\\//g, 'SL').replace(/=/g, 'EQ')\n    }\n\n    if (config['persistence_name']) {\n        return 'ph_' + config['persistence_name']\n    } else {\n        return 'ph_' + token + '_posthog'\n    }\n}\n\n/**\n * PostHog Persistence Object\n * @constructor\n */\nexport class PostHogPersistence {\n    private config: PostHogConfig\n    props: Properties\n    storage: PersistentStore\n    campaign_params_saved: boolean\n    name: string\n    disabled: boolean | undefined\n    secure: boolean | undefined\n    expire_days: number | undefined\n    default_expiry: number | undefined\n    cross_subdomain: boolean | undefined\n\n    constructor(config: PostHogConfig) {\n        this.config = config\n        this.props = {}\n        this.campaign_params_saved = false\n        this.name = parseName(config)\n        this.storage = this.buildStorage(config)\n        this.load()\n        this.update_config(config, config)\n        this.save()\n    }\n\n    private buildStorage(config: PostHogConfig) {\n        if (\n            CASE_INSENSITIVE_PERSISTENCE_TYPES.indexOf(\n                config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n            ) === -1\n        ) {\n            logger.critical(\n                'Unknown persistence type ' + config['persistence'] + '; falling back to localStorage+cookie'\n            )\n            config['persistence'] = 'localStorage+cookie'\n        }\n\n        let store: PersistentStore\n        // We handle storage type in a case-insensitive way for backwards compatibility\n        const storage_type = config['persistence'].toLowerCase() as Lowercase<PostHogConfig['persistence']>\n        if (storage_type === 'localstorage' && localStore.is_supported()) {\n            store = localStore\n        } else if (storage_type === 'localstorage+cookie' && localPlusCookieStore.is_supported()) {\n            store = localPlusCookieStore\n        } else if (storage_type === 'sessionstorage' && sessionStore.is_supported()) {\n            store = sessionStore\n        } else if (storage_type === 'memory') {\n            store = memoryStore\n        } else if (storage_type === 'cookie') {\n            store = cookieStore\n        } else if (localPlusCookieStore.is_supported()) {\n            // selected storage type wasn't supported, fallback to 'localstorage+cookie' if possible\n            store = localPlusCookieStore\n        } else {\n            store = cookieStore\n        }\n\n        return store\n    }\n\n    properties(): Properties {\n        const p: Properties = {}\n        // Filter out reserved properties\n        _each(this.props, function (v, k) {\n            if (k === ENABLED_FEATURE_FLAGS && _isObject(v)) {\n                const keys = Object.keys(v)\n                for (let i = 0; i < keys.length; i++) {\n                    p[`$feature/${keys[i]}`] = v[keys[i]]\n                }\n            } else if (!_include(PERSISTENCE_RESERVED_PROPERTIES, k)) {\n                p[k] = v\n            }\n        })\n        return p\n    }\n\n    load(): void {\n        if (this.disabled) {\n            return\n        }\n\n        const entry = this.storage.parse(this.name)\n\n        if (entry) {\n            this.props = _extend({}, entry)\n        }\n    }\n\n    /**\n     * NOTE: Saving frequently causes issues with Recordings and Consent Management Platform (CMP) tools which\n     * observe cookie changes, and modify their UI, often causing infinite loops.\n     * As such callers of this should ideally check that the data has changed beforehand\n     */\n    save(): void {\n        if (this.disabled) {\n            return\n        }\n        this.storage.set(this.name, this.props, this.expire_days, this.cross_subdomain, this.secure)\n    }\n\n    remove(): void {\n        // remove both domain and subdomain cookies\n        this.storage.remove(this.name, false)\n        this.storage.remove(this.name, true)\n    }\n\n    // removes the storage entry and deletes all loaded data\n    // forced name for tests\n\n    clear(): void {\n        this.remove()\n        this.props = {}\n    }\n\n    /**\n     * @param {Object} props\n     * @param {*=} default_value\n     * @param {number=} days\n     */\n\n    register_once(props: Properties, default_value: any, days?: number): boolean {\n        if (_isObject(props)) {\n            if (_isUndefined(default_value)) {\n                default_value = 'None'\n            }\n            this.expire_days = _isUndefined(days) ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (!this.props.hasOwnProperty(prop) || this.props[prop] === default_value) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    /**\n     * @param {Object} props\n     * @param {number=} days\n     */\n\n    register(props: Properties, days?: number): boolean {\n        if (_isObject(props)) {\n            this.expire_days = _isUndefined(days) ? this.default_expiry : days\n\n            let hasChanges = false\n\n            _each(props, (val, prop) => {\n                if (props.hasOwnProperty(prop) && this.props[prop] !== val) {\n                    this.props[prop] = val\n                    hasChanges = true\n                }\n            })\n\n            if (hasChanges) {\n                this.save()\n                return true\n            }\n        }\n        return false\n    }\n\n    unregister(prop: string): void {\n        if (prop in this.props) {\n            delete this.props[prop]\n            this.save()\n        }\n    }\n\n    update_campaign_params(): void {\n        if (!this.campaign_params_saved) {\n            this.register(_info.campaignParams(this.config.custom_campaign_params))\n            this.campaign_params_saved = true\n        }\n    }\n\n    update_search_keyword(): void {\n        this.register(_info.searchInfo())\n    }\n\n    update_referrer_info(): void {\n        this.register({\n            $referrer: this.props['$referrer'] || _info.referrer(),\n            $referring_domain: this.props['$referring_domain'] || _info.referringDomain(),\n        })\n    }\n\n    get_referrer_info(): Properties {\n        return _strip_empty_properties({\n            $referrer: this['props']['$referrer'],\n            $referring_domain: this['props']['$referring_domain'],\n        })\n    }\n\n    // safely fills the passed in object with stored properties,\n    // does not override any properties defined in both\n    // returns the passed in object\n\n    safe_merge(props: Properties): Properties {\n        _each(this.props, function (val, prop) {\n            if (!(prop in props)) {\n                props[prop] = val\n            }\n        })\n\n        return props\n    }\n\n    update_config(config: PostHogConfig, oldConfig: PostHogConfig): void {\n        this.default_expiry = this.expire_days = config['cookie_expiration']\n        this.set_disabled(config['disable_persistence'])\n        this.set_cross_subdomain(config['cross_subdomain_cookie'])\n        this.set_secure(config['secure_cookie'])\n\n        if (config.persistence !== oldConfig.persistence) {\n            // If the persistence type has changed, we need to migrate the data.\n            const newStore = this.buildStorage(config)\n            const props = this.props\n\n            // clear the old store\n            this.clear()\n            this.storage = newStore\n            this.props = props\n\n            this.save()\n        }\n    }\n\n    set_disabled(disabled: boolean): void {\n        this.disabled = disabled\n        if (this.disabled) {\n            this.remove()\n        } else {\n            this.save()\n        }\n    }\n\n    set_cross_subdomain(cross_subdomain: boolean): void {\n        if (cross_subdomain !== this.cross_subdomain) {\n            this.cross_subdomain = cross_subdomain\n            this.remove()\n            this.save()\n        }\n    }\n\n    get_cross_subdomain(): boolean {\n        return !!this.cross_subdomain\n    }\n\n    set_secure(secure: boolean): void {\n        if (secure !== this.secure) {\n            this.secure = secure\n            this.remove()\n            this.save()\n        }\n    }\n\n    set_event_timer(event_name: string, timestamp: number): void {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        timers[event_name] = timestamp\n        this.props[EVENT_TIMERS_KEY] = timers\n        this.save()\n    }\n\n    remove_event_timer(event_name: string): number {\n        const timers = this.props[EVENT_TIMERS_KEY] || {}\n        const timestamp = timers[event_name]\n        if (!_isUndefined(timestamp)) {\n            delete this.props[EVENT_TIMERS_KEY][event_name]\n            this.save()\n        }\n        return timestamp\n    }\n\n    get_user_state(): 'anonymous' | 'identified' {\n        return this.props[USER_STATE] || 'anonymous'\n    }\n\n    set_user_state(state: 'anonymous' | 'identified'): void {\n        this.props[USER_STATE] = state\n        this.save()\n    }\n\n    get_quota_limits(): Record<string, number> {\n        return this.props[POSTHOG_QUOTA_LIMITED] || {}\n    }\n\n    set_quota_limits(state: Record<string, number>): void {\n        this.props[POSTHOG_QUOTA_LIMITED] = state\n        this.save()\n    }\n}\n","import type {\n    KeepIframeSrcFn,\n    RecordPlugin,\n    SamplingStrategy,\n    blockClass,\n    eventWithTime,\n    hooksParam,\n    listenerHandler,\n    maskTextClass,\n    pluginEvent,\n    mutationCallbackParam,\n} from '@rrweb/types'\nimport type { Mirror, MaskInputOptions, MaskInputFn, MaskTextFn, SlimDOMOptions, DataURLOptions } from 'rrweb-snapshot'\n\nimport { _isObject } from '../../utils/type-utils'\n\nexport const replacementImageURI =\n    'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJibGFjayIvPgo8cGF0aCBkPSJNOCAwSDE2TDAgMTZWOEw4IDBaIiBmaWxsPSIjMkQyRDJEIi8+CjxwYXRoIGQ9Ik0xNiA4VjE2SDhMMTYgOFoiIGZpbGw9IiMyRDJEMkQiLz4KPC9zdmc+Cg=='\n\nexport const FULL_SNAPSHOT_EVENT_TYPE = 2\nexport const META_EVENT_TYPE = 4\nexport const INCREMENTAL_SNAPSHOT_EVENT_TYPE = 3\nexport const PLUGIN_EVENT_TYPE = 6\nexport const MUTATION_SOURCE_TYPE = 0\n\nexport const MAX_MESSAGE_SIZE = 5000000 // ~5mb\n\nexport type rrwebRecord = {\n    (options: recordOptions<eventWithTime>): listenerHandler\n    addCustomEvent: (tag: string, payload: any) => void\n    takeFullSnapshot: () => void\n    mirror: Mirror\n}\n\nexport declare type recordOptions<T> = {\n    emit?: (e: T, isCheckout?: boolean) => void\n    checkoutEveryNth?: number\n    checkoutEveryNms?: number\n    blockClass?: blockClass\n    blockSelector?: string\n    ignoreClass?: string\n    maskTextClass?: maskTextClass\n    maskTextSelector?: string\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: MaskInputFn\n    maskTextFn?: MaskTextFn\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    ignoreCSSAttributes?: Set<string>\n    inlineStylesheet?: boolean\n    hooks?: hooksParam\n    // packFn?: PackFn\n    sampling?: SamplingStrategy\n    dataURLOptions?: DataURLOptions\n    recordCanvas?: boolean\n    recordCrossOriginIframes?: boolean\n    recordAfter?: 'DOMContentLoaded' | 'load'\n    userTriggeredOnInput?: boolean\n    collectFonts?: boolean\n    inlineImages?: boolean\n    plugins?: RecordPlugin[]\n    mousemoveWait?: number\n    keepIframeSrcFn?: KeepIframeSrcFn\n    // errorHandler?: ErrorHandler\n}\n\n/*\n * Check whether a data payload is nearing 5mb. If it is, it checks the data for\n * data URIs (the likely culprit for large payloads). If it finds data URIs, it either replaces\n * it with a generic image (if it's an image) or removes it.\n * @data {object} the rr-web data object\n * @returns {object} the rr-web data object with data uris filtered out\n */\nexport function ensureMaxMessageSize(data: eventWithTime): { event: eventWithTime; size: number } {\n    let stringifiedData = JSON.stringify(data)\n    // Note: with compression, this limit may be able to be increased\n    // but we're assuming most of the size is from a data uri which\n    // is unlikely to be compressed further\n\n    if (stringifiedData.length > MAX_MESSAGE_SIZE) {\n        // Regex that matches the pattern for a dataURI with the shape 'data:{mime type};{encoding},{data}'. It:\n        // 1) Checks if the pattern starts with 'data:' (potentially, not at the start of the string)\n        // 2) Extracts the mime type of the data uri in the first group\n        // 3) Determines when the data URI ends.Depending on if it's used in the src tag or css, it can end with a ) or \"\n        const dataURIRegex = /data:([\\w/\\-.]+);(\\w+),([^)\"]*)/gim\n        const matches = stringifiedData.matchAll(dataURIRegex)\n        for (const match of matches) {\n            if (match[1].toLocaleLowerCase().slice(0, 6) === 'image/') {\n                stringifiedData = stringifiedData.replace(match[0], replacementImageURI)\n            } else {\n                stringifiedData = stringifiedData.replace(match[0], '')\n            }\n        }\n    }\n    return { event: JSON.parse(stringifiedData), size: stringifiedData.length }\n}\n\nexport const CONSOLE_LOG_PLUGIN_NAME = 'rrweb/console@1' // The name of the rr-web plugin that emits console logs\n\n// Console logs can be really large. This function truncates large logs\n// It's a simple function that just truncates long strings.\n// TODO: Ideally this function would have better handling of objects + lists,\n// so they could still be rendered in a pretty way after truncation.\nexport function truncateLargeConsoleLogs(_event: eventWithTime) {\n    const event = _event as pluginEvent<{ payload: string[] }>\n\n    const MAX_STRING_SIZE = 2000 // Maximum number of characters allowed in a string\n    const MAX_STRINGS_PER_LOG = 10 // A log can consist of multiple strings (e.g. consol.log('string1', 'string2'))\n\n    if (\n        event &&\n        _isObject(event) &&\n        event.type === PLUGIN_EVENT_TYPE &&\n        _isObject(event.data) &&\n        event.data.plugin === CONSOLE_LOG_PLUGIN_NAME\n    ) {\n        // Note: event.data.payload.payload comes from rr-web, and is an array of strings\n        if (event.data.payload.payload.length > MAX_STRINGS_PER_LOG) {\n            event.data.payload.payload = event.data.payload.payload.slice(0, MAX_STRINGS_PER_LOG)\n            event.data.payload.payload.push('...[truncated]')\n        }\n        const updatedPayload = []\n        for (let i = 0; i < event.data.payload.payload.length; i++) {\n            if (\n                event.data.payload.payload[i] && // Value can be null\n                event.data.payload.payload[i].length > MAX_STRING_SIZE\n            ) {\n                updatedPayload.push(event.data.payload.payload[i].slice(0, MAX_STRING_SIZE) + '...[truncated]')\n            } else {\n                updatedPayload.push(event.data.payload.payload[i])\n            }\n        }\n        event.data.payload.payload = updatedPayload\n        // Return original type\n        return _event\n    }\n    return _event\n}\n\nexport class MutationRateLimiter {\n    private bucketSize = 100\n    private refillRate = 10\n    private mutationBuckets: Record<string, number> = {}\n    private loggedTracker: Record<string, boolean> = {}\n\n    constructor(\n        private readonly rrweb: rrwebRecord,\n        private readonly options: {\n            bucketSize?: number\n            refillRate?: number\n            onBlockedNode?: (id: number, node: Node | null) => void\n        } = {}\n    ) {\n        this.refillRate = this.options.refillRate ?? this.refillRate\n        this.bucketSize = this.options.bucketSize ?? this.bucketSize\n        setInterval(() => {\n            this.refillBuckets()\n        }, 1000)\n    }\n\n    private refillBuckets = () => {\n        Object.keys(this.mutationBuckets).forEach((key) => {\n            this.mutationBuckets[key] = this.mutationBuckets[key] + this.refillRate\n\n            if (this.mutationBuckets[key] >= this.bucketSize) {\n                delete this.mutationBuckets[key]\n            }\n        })\n    }\n\n    private getNodeOrRelevantParent = (id: number): [number, Node | null] => {\n        // For some nodes we know they are part of a larger tree such as an SVG.\n        // For those we want to block the entire node, not just the specific attribute\n\n        const node = this.rrweb.mirror.getNode(id)\n\n        // Check if the node is an Element and then find the closest parent that is an SVG\n        if (node?.nodeName !== 'svg' && node instanceof Element) {\n            const closestSVG = node.closest('svg')\n\n            if (closestSVG) {\n                return [this.rrweb.mirror.getId(closestSVG), closestSVG]\n            }\n        }\n\n        return [id, node]\n    }\n\n    private numberOfChanges = (data: Partial<mutationCallbackParam>) => {\n        return (\n            (data.removes?.length ?? 0) +\n            (data.attributes?.length ?? 0) +\n            (data.texts?.length ?? 0) +\n            (data.adds?.length ?? 0)\n        )\n    }\n\n    public throttleMutations = (event: eventWithTime) => {\n        if (event.type !== INCREMENTAL_SNAPSHOT_EVENT_TYPE || event.data.source !== MUTATION_SOURCE_TYPE) {\n            return event\n        }\n\n        const data = event.data as Partial<mutationCallbackParam>\n        const initialMutationCount = this.numberOfChanges(data)\n\n        if (data.attributes) {\n            // Most problematic mutations come from attrs where the style or minor properties are changed rapidly\n            data.attributes = data.attributes.filter((attr) => {\n                const [nodeId, node] = this.getNodeOrRelevantParent(attr.id)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    return false\n                }\n\n                this.mutationBuckets[nodeId] = this.mutationBuckets[nodeId] ?? this.bucketSize\n                this.mutationBuckets[nodeId] = Math.max(this.mutationBuckets[nodeId] - 1, 0)\n\n                if (this.mutationBuckets[nodeId] === 0) {\n                    if (!this.loggedTracker[nodeId]) {\n                        this.loggedTracker[nodeId] = true\n                        this.options.onBlockedNode?.(nodeId, node)\n                    }\n                }\n\n                return attr\n            })\n        }\n\n        // Check if every part of the mutation is empty in which case there is nothing to do\n        const mutationCount = this.numberOfChanges(data)\n\n        if (mutationCount === 0 && initialMutationCount !== mutationCount) {\n            // If we have modified the mutation count and the remaining count is 0, then we don't need the event.\n            return\n        }\n        return event\n    }\n}\n","var EventType = /* @__PURE__ */ ((EventType2) => {\n  EventType2[EventType2[\"DomContentLoaded\"] = 0] = \"DomContentLoaded\";\n  EventType2[EventType2[\"Load\"] = 1] = \"Load\";\n  EventType2[EventType2[\"FullSnapshot\"] = 2] = \"FullSnapshot\";\n  EventType2[EventType2[\"IncrementalSnapshot\"] = 3] = \"IncrementalSnapshot\";\n  EventType2[EventType2[\"Meta\"] = 4] = \"Meta\";\n  EventType2[EventType2[\"Custom\"] = 5] = \"Custom\";\n  EventType2[EventType2[\"Plugin\"] = 6] = \"Plugin\";\n  return EventType2;\n})(EventType || {});\nvar IncrementalSource = /* @__PURE__ */ ((IncrementalSource2) => {\n  IncrementalSource2[IncrementalSource2[\"Mutation\"] = 0] = \"Mutation\";\n  IncrementalSource2[IncrementalSource2[\"MouseMove\"] = 1] = \"MouseMove\";\n  IncrementalSource2[IncrementalSource2[\"MouseInteraction\"] = 2] = \"MouseInteraction\";\n  IncrementalSource2[IncrementalSource2[\"Scroll\"] = 3] = \"Scroll\";\n  IncrementalSource2[IncrementalSource2[\"ViewportResize\"] = 4] = \"ViewportResize\";\n  IncrementalSource2[IncrementalSource2[\"Input\"] = 5] = \"Input\";\n  IncrementalSource2[IncrementalSource2[\"TouchMove\"] = 6] = \"TouchMove\";\n  IncrementalSource2[IncrementalSource2[\"MediaInteraction\"] = 7] = \"MediaInteraction\";\n  IncrementalSource2[IncrementalSource2[\"StyleSheetRule\"] = 8] = \"StyleSheetRule\";\n  IncrementalSource2[IncrementalSource2[\"CanvasMutation\"] = 9] = \"CanvasMutation\";\n  IncrementalSource2[IncrementalSource2[\"Font\"] = 10] = \"Font\";\n  IncrementalSource2[IncrementalSource2[\"Log\"] = 11] = \"Log\";\n  IncrementalSource2[IncrementalSource2[\"Drag\"] = 12] = \"Drag\";\n  IncrementalSource2[IncrementalSource2[\"StyleDeclaration\"] = 13] = \"StyleDeclaration\";\n  IncrementalSource2[IncrementalSource2[\"Selection\"] = 14] = \"Selection\";\n  IncrementalSource2[IncrementalSource2[\"AdoptedStyleSheet\"] = 15] = \"AdoptedStyleSheet\";\n  return IncrementalSource2;\n})(IncrementalSource || {});\nvar MouseInteractions = /* @__PURE__ */ ((MouseInteractions2) => {\n  MouseInteractions2[MouseInteractions2[\"MouseUp\"] = 0] = \"MouseUp\";\n  MouseInteractions2[MouseInteractions2[\"MouseDown\"] = 1] = \"MouseDown\";\n  MouseInteractions2[MouseInteractions2[\"Click\"] = 2] = \"Click\";\n  MouseInteractions2[MouseInteractions2[\"ContextMenu\"] = 3] = \"ContextMenu\";\n  MouseInteractions2[MouseInteractions2[\"DblClick\"] = 4] = \"DblClick\";\n  MouseInteractions2[MouseInteractions2[\"Focus\"] = 5] = \"Focus\";\n  MouseInteractions2[MouseInteractions2[\"Blur\"] = 6] = \"Blur\";\n  MouseInteractions2[MouseInteractions2[\"TouchStart\"] = 7] = \"TouchStart\";\n  MouseInteractions2[MouseInteractions2[\"TouchMove_Departed\"] = 8] = \"TouchMove_Departed\";\n  MouseInteractions2[MouseInteractions2[\"TouchEnd\"] = 9] = \"TouchEnd\";\n  MouseInteractions2[MouseInteractions2[\"TouchCancel\"] = 10] = \"TouchCancel\";\n  return MouseInteractions2;\n})(MouseInteractions || {});\nvar PointerTypes = /* @__PURE__ */ ((PointerTypes2) => {\n  PointerTypes2[PointerTypes2[\"Mouse\"] = 0] = \"Mouse\";\n  PointerTypes2[PointerTypes2[\"Pen\"] = 1] = \"Pen\";\n  PointerTypes2[PointerTypes2[\"Touch\"] = 2] = \"Touch\";\n  return PointerTypes2;\n})(PointerTypes || {});\nvar CanvasContext = /* @__PURE__ */ ((CanvasContext2) => {\n  CanvasContext2[CanvasContext2[\"2D\"] = 0] = \"2D\";\n  CanvasContext2[CanvasContext2[\"WebGL\"] = 1] = \"WebGL\";\n  CanvasContext2[CanvasContext2[\"WebGL2\"] = 2] = \"WebGL2\";\n  return CanvasContext2;\n})(CanvasContext || {});\nvar MediaInteractions = /* @__PURE__ */ ((MediaInteractions2) => {\n  MediaInteractions2[MediaInteractions2[\"Play\"] = 0] = \"Play\";\n  MediaInteractions2[MediaInteractions2[\"Pause\"] = 1] = \"Pause\";\n  MediaInteractions2[MediaInteractions2[\"Seeked\"] = 2] = \"Seeked\";\n  MediaInteractions2[MediaInteractions2[\"VolumeChange\"] = 3] = \"VolumeChange\";\n  MediaInteractions2[MediaInteractions2[\"RateChange\"] = 4] = \"RateChange\";\n  return MediaInteractions2;\n})(MediaInteractions || {});\nvar ReplayerEvents = /* @__PURE__ */ ((ReplayerEvents2) => {\n  ReplayerEvents2[\"Start\"] = \"start\";\n  ReplayerEvents2[\"Pause\"] = \"pause\";\n  ReplayerEvents2[\"Resume\"] = \"resume\";\n  ReplayerEvents2[\"Resize\"] = \"resize\";\n  ReplayerEvents2[\"Finish\"] = \"finish\";\n  ReplayerEvents2[\"FullsnapshotRebuilded\"] = \"fullsnapshot-rebuilded\";\n  ReplayerEvents2[\"LoadStylesheetStart\"] = \"load-stylesheet-start\";\n  ReplayerEvents2[\"LoadStylesheetEnd\"] = \"load-stylesheet-end\";\n  ReplayerEvents2[\"SkipStart\"] = \"skip-start\";\n  ReplayerEvents2[\"SkipEnd\"] = \"skip-end\";\n  ReplayerEvents2[\"MouseInteraction\"] = \"mouse-interaction\";\n  ReplayerEvents2[\"EventCast\"] = \"event-cast\";\n  ReplayerEvents2[\"CustomEvent\"] = \"custom-event\";\n  ReplayerEvents2[\"Flush\"] = \"flush\";\n  ReplayerEvents2[\"StateChange\"] = \"state-change\";\n  ReplayerEvents2[\"PlayBack\"] = \"play-back\";\n  ReplayerEvents2[\"Destroy\"] = \"destroy\";\n  return ReplayerEvents2;\n})(ReplayerEvents || {});\nexport {\n  CanvasContext,\n  EventType,\n  IncrementalSource,\n  MediaInteractions,\n  MouseInteractions,\n  PointerTypes,\n  ReplayerEvents\n};\n//# sourceMappingURL=types.js.map\n","import { CapturedNetworkRequest, NetworkRecordOptions, PostHogConfig } from '../../types'\nimport { _isFunction, _isNullish, _isString } from '../../utils/type-utils'\nimport { convertToURL } from '../../utils/request-utils'\nimport { logger } from '../../utils/logger'\n\nexport const defaultNetworkOptions: NetworkRecordOptions = {\n    initiatorTypes: [\n        'audio',\n        'beacon',\n        'body',\n        'css',\n        'early-hint',\n        'embed',\n        'fetch',\n        'frame',\n        'iframe',\n        'icon',\n        'image',\n        'img',\n        'input',\n        'link',\n        'navigation',\n        'object',\n        'ping',\n        'script',\n        'track',\n        'video',\n        'xmlhttprequest',\n    ],\n    maskRequestFn: (data: CapturedNetworkRequest) => data,\n    recordHeaders: false,\n    recordBody: false,\n    recordInitialRequests: false,\n    recordPerformance: false,\n    performanceEntryTypeToObserve: [\n        // 'event', // This is too noisy as it covers all browser events\n        'first-input',\n        // 'mark', // Mark is used too liberally. We would need to filter for specific marks\n        // 'measure', // Measure is used too liberally. We would need to filter for specific measures\n        'navigation',\n        'paint',\n        'resource',\n    ],\n    payloadSizeLimitBytes: 1000000,\n}\n\nconst HEADER_DENYLIST = [\n    'authorization',\n    'x-forwarded-for',\n    'authorization',\n    'cookie',\n    'set-cookie',\n    'x-api-key',\n    'x-real-ip',\n    'remote-addr',\n    'forwarded',\n    'proxy-authorization',\n    'x-csrf-token',\n    'x-csrftoken',\n    'x-xsrf-token',\n]\n\n// we always remove headers on the deny list because we never want to capture this sensitive data\nconst removeAuthorizationHeader = (data: CapturedNetworkRequest): CapturedNetworkRequest => {\n    Object.keys(data.requestHeaders ?? {}).forEach((header) => {\n        if (HEADER_DENYLIST.includes(header.toLowerCase())) delete data.requestHeaders?.[header]\n    })\n    return data\n}\n\nconst POSTHOG_PATHS_TO_IGNORE = ['/s/', '/e/', '/i/']\n// want to ignore posthog paths when capturing requests, or we can get trapped in a loop\n// because calls to PostHog would be reported using a call to PostHog which would be reported....\nconst ignorePostHogPaths = (data: CapturedNetworkRequest): CapturedNetworkRequest | undefined => {\n    const url = convertToURL(data.name)\n    if (url && url.pathname && POSTHOG_PATHS_TO_IGNORE.some((path) => url.pathname.indexOf(path) === 0)) {\n        return undefined\n    }\n    return data\n}\n\nfunction estimateBytes(payload: string): number {\n    return new Blob([payload]).size\n}\n\nfunction redactPayload(\n    payload: string | null | undefined,\n    headers: Record<string, any> | undefined,\n    limit: number,\n    description: string\n): string | null | undefined {\n    if (_isNullish(payload)) {\n        return payload\n    }\n\n    let requestContentLength: string | number = headers?.['content-length'] || estimateBytes(payload)\n    if (_isString(requestContentLength)) {\n        requestContentLength = parseInt(requestContentLength)\n    }\n\n    if (requestContentLength > limit) {\n        return `[SessionReplay] ${description} body too large to record (${requestContentLength} bytes)`\n    }\n\n    return payload\n}\n\n// people can have arbitrarily large payloads on their site, but we don't want to ingest them\nconst limitPayloadSize = (\n    options: NetworkRecordOptions\n): ((data: CapturedNetworkRequest | undefined) => CapturedNetworkRequest | undefined) => {\n    // the smallest of 1MB or the specified limit if there is one\n    const limit = Math.min(1000000, options.payloadSizeLimitBytes ?? 1000000)\n\n    return (data) => {\n        if (data?.requestBody) {\n            data.requestBody = redactPayload(data.requestBody, data.requestHeaders, limit, 'Request')\n        }\n\n        if (data?.responseBody) {\n            data.responseBody = redactPayload(data.responseBody, data.responseHeaders, limit, 'Response')\n        }\n\n        return data\n    }\n}\n\n/**\n *  whether a maskRequestFn is provided or not,\n *  we ensure that we remove the denied header from requests\n *  we _never_ want to record that header by accident\n *  if someone complains then we'll add an opt-in to let them override it\n */\nexport const buildNetworkRequestOptions = (\n    instanceConfig: PostHogConfig,\n    remoteNetworkOptions: Pick<NetworkRecordOptions, 'recordHeaders' | 'recordBody' | 'recordPerformance'>\n): NetworkRecordOptions => {\n    const config = instanceConfig.session_recording as NetworkRecordOptions\n    // client can always disable despite remote options\n    const canRecordHeaders = config.recordHeaders === false ? false : remoteNetworkOptions.recordHeaders\n    const canRecordBody = config.recordBody === false ? false : remoteNetworkOptions.recordBody\n    const canRecordPerformance = config.recordPerformance === false ? false : remoteNetworkOptions.recordPerformance\n\n    const payloadLimiter = limitPayloadSize(config)\n\n    const enforcedCleaningFn: NetworkRecordOptions['maskRequestFn'] = (d: CapturedNetworkRequest) =>\n        payloadLimiter(ignorePostHogPaths(removeAuthorizationHeader(d)))\n\n    const hasDeprecatedMaskFunction = _isFunction(instanceConfig.session_recording.maskNetworkRequestFn)\n\n    if (hasDeprecatedMaskFunction && _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)) {\n        logger.warn(\n            'Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored.'\n        )\n    }\n\n    if (hasDeprecatedMaskFunction) {\n        instanceConfig.session_recording.maskCapturedNetworkRequestFn = (data: CapturedNetworkRequest) => {\n            const cleanedURL = instanceConfig.session_recording.maskNetworkRequestFn!({ url: data.name })\n            return {\n                ...data,\n                name: cleanedURL?.url,\n            } as CapturedNetworkRequest\n        }\n    }\n\n    config.maskRequestFn = _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)\n        ? (data) => {\n              const cleanedRequest = enforcedCleaningFn(data)\n              return cleanedRequest\n                  ? instanceConfig.session_recording.maskCapturedNetworkRequestFn?.(cleanedRequest) ?? undefined\n                  : undefined\n          }\n        : undefined\n\n    if (!config.maskRequestFn) {\n        config.maskRequestFn = enforcedCleaningFn\n    }\n\n    return {\n        ...defaultNetworkOptions,\n        ...config,\n        recordHeaders: canRecordHeaders,\n        recordBody: canRecordBody,\n        recordPerformance: canRecordPerformance,\n        recordInitialRequests: canRecordPerformance,\n    }\n}\n","/**\n * GDPR utils\n *\n * The General Data Protection Regulation (GDPR) is a regulation in EU law on data protection\n * and privacy for all individuals within the European Union. It addresses the export of personal\n * data outside the EU. The GDPR aims primarily to give control back to citizens and residents\n * over their personal data and to simplify the regulatory environment for international business\n * by unifying the regulation within the EU.\n *\n * This set of utilities is intended to enable opt in/out functionality in the PostHog JS SDK.\n * These functions are used internally by the SDK and are not intended to be publicly exposed.\n */\n\nimport { _each, _includes } from './utils'\nimport { window } from './utils/globals'\nimport { cookieStore, localStore, localPlusCookieStore } from './storage'\nimport { GDPROptions, PersistentStore } from './types'\nimport { PostHog } from './posthog-core'\n\nimport { _isNumber, _isString } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\n/**\n * A function used to capture a PostHog event (e.g. PostHogLib.capture)\n * @callback captureFunction\n * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n * @param {Function} [callback] If provided, the callback function will be called after capturing the event.\n */\n\n/** Public **/\n\nconst GDPR_DEFAULT_PERSISTENCE_PREFIX = '__ph_opt_in_out_'\n\n/**\n * Opt the user in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function optIn(token: string, options: GDPROptions): void {\n    _optInOut(true, token, options)\n}\n\n/**\n * Opt the user out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-out cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-out cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-out cookie is set as secure or not\n */\nexport function optOut(token: string, options: GDPROptions): void {\n    _optInOut(false, token, options)\n}\n\n/**\n * Check whether the user has opted in to data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {boolean} whether the user has opted in to the given opt type\n */\nexport function hasOptedIn(token: string, options: GDPROptions): boolean {\n    return _getStorageValue(token, options) === '1'\n}\n\n/**\n * Check whether the user has opted out of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the user has opted out of the given opt type\n */\nexport function hasOptedOut(token: string, options: Partial<GDPROptions>): boolean {\n    if (_hasDoNotTrackFlagOn(options)) {\n        return true\n    }\n    return _getStorageValue(token, options) === '0'\n}\n\n/**\n * Clear the user's opt in/out status of data capturing and cookies/localstorage for the given token\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistenceType] Persistence mechanism used - cookie or localStorage\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nexport function clearOptInOut(token: string, options: GDPROptions) {\n    options = options || {}\n    _getStorage(options).remove(_getStorageKey(token, options), !!options.crossSubdomainCookie)\n}\n\n/** Private **/\n\n/**\n * Get storage util\n * @param {Object} [options]\n * @param {string} [options.persistenceType]\n * @returns {object} either cookieStore or localStore\n */\nfunction _getStorage(options: GDPROptions): PersistentStore {\n    options = options || {}\n    if (options.persistenceType === 'localStorage') {\n        return localStore\n    }\n    if (options.persistenceType === 'localStorage+cookie') {\n        return localPlusCookieStore\n    }\n    return cookieStore\n}\n\n/**\n * Get the name of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the name of the cookie for the given opt type\n */\nfunction _getStorageKey(token: string, options: GDPROptions) {\n    options = options || {}\n    return (options.persistencePrefix || GDPR_DEFAULT_PERSISTENCE_PREFIX) + token\n}\n\n/**\n * Get the value of the cookie that is used for the given opt type (capturing, cookie, etc.)\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @returns {string} the value of the cookie for the given opt type\n */\nfunction _getStorageValue(token: string, options: GDPROptions) {\n    return _getStorage(options).get(_getStorageKey(token, options))\n}\n\n/**\n * Check whether the user has set the DNT/doNotTrack setting to true in their browser\n * @param {Object} [options]\n * @param {string} [options.window] - alternate window object to check; used to force various DNT settings in browser tests\n * @param {boolean} [options.respectDnt] - flag to take browser DNT setting into account\n * @returns {boolean} whether the DNT setting is true\n */\nfunction _hasDoNotTrackFlagOn(options: GDPROptions) {\n    if (options && options.respectDnt) {\n        const win = (options && options.window) || window\n        const nav = win?.navigator\n        let hasDntOn = false\n        _each(\n            [\n                nav?.doNotTrack, // standard\n                (nav as any)['msDoNotTrack'],\n                (win as any)['doNotTrack'],\n            ],\n            function (dntValue) {\n                if (_includes([true, 1, '1', 'yes'], dntValue)) {\n                    hasDntOn = true\n                }\n            }\n        )\n        return hasDntOn\n    }\n    return false\n}\n\n/**\n * Set cookie/localstorage for the user indicating that they are opted in or out for the given opt type\n * @param {boolean} optValue - whether to opt the user in or out for the given opt type\n * @param {string} token - PostHog project capturing token\n * @param {Object} [options]\n * @param {captureFunction} [options.capture] - function used for capturing a PostHog event to record the opt-in action\n * @param {string} [options.captureEventName] - event name to be used for capturing the opt-in action\n * @param {Object} [options.captureProperties] - set of properties to be captured along with the opt-in action\n * @param {string} [options.persistencePrefix=__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name\n * @param {Number} [options.cookieExpiration] - number of days until the opt-in cookie expires\n * @param {boolean} [options.crossSubdomainCookie] - whether the opt-in cookie is set as cross-subdomain or not\n * @param {boolean} [options.secureCookie] - whether the opt-in cookie is set as secure or not\n */\nfunction _optInOut(optValue: boolean, token: string, options: GDPROptions) {\n    if (!_isString(token) || !token.length) {\n        logger.error('gdpr.' + (optValue ? 'optIn' : 'optOut') + ' called with an invalid token')\n        return\n    }\n\n    options = options || {}\n\n    _getStorage(options).set(\n        _getStorageKey(token, options),\n        optValue ? 1 : 0,\n        _isNumber(options.cookieExpiration) ? options.cookieExpiration : null,\n        options.crossSubdomainCookie,\n        options.secureCookie\n    )\n\n    if (options.capture && optValue) {\n        // only capture event if opting in (optValue=true)\n        options.capture(options.captureEventName || '$opt_in', options.captureProperties || {}, {\n            send_instantly: true,\n        })\n    }\n}\n\nexport function userOptedOut(posthog: PostHog) {\n    let optedOut = false\n\n    try {\n        const token = posthog.config.token\n        const respectDnt = posthog.config.respect_dnt\n        const persistenceType = posthog.config.opt_out_capturing_persistence_type\n        const persistencePrefix = posthog.config.opt_out_capturing_cookie_prefix || undefined\n        const win = (posthog.config as any).window as Window | undefined // used to override window during browser tests\n\n        if (token) {\n            // if there was an issue getting the token, continue method execution as normal\n            optedOut = hasOptedOut(token, {\n                respectDnt,\n                persistenceType,\n                persistencePrefix,\n                window: win,\n            })\n        }\n    } catch (err) {\n        logger.error('Unexpected error when checking capturing opt-out status: ' + err)\n    }\n    return optedOut\n}\n","import {\n    CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_CANVAS_RECORDING,\n    SESSION_RECORDING_ENABLED_SERVER_SIDE,\n    SESSION_RECORDING_IS_SAMPLED,\n    SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE,\n    SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE,\n} from '../../constants'\nimport {\n    FULL_SNAPSHOT_EVENT_TYPE,\n    INCREMENTAL_SNAPSHOT_EVENT_TYPE,\n    META_EVENT_TYPE,\n    MutationRateLimiter,\n    recordOptions,\n    rrwebRecord,\n    truncateLargeConsoleLogs,\n} from './sessionrecording-utils'\nimport { PostHog } from '../../posthog-core'\nimport { DecideResponse, FlagVariant, NetworkRecordOptions, NetworkRequest, Properties } from '../../types'\nimport { EventType, type eventWithTime, type listenerHandler, RecordPlugin } from '@rrweb/types'\nimport Config from '../../config'\nimport { _timestamp, loadScript } from '../../utils'\n\nimport {\n    _isBoolean,\n    _isFunction,\n    _isNull,\n    _isNullish,\n    _isNumber,\n    _isObject,\n    _isString,\n    _isUndefined,\n} from '../../utils/type-utils'\nimport { logger } from '../../utils/logger'\nimport { assignableWindow, window } from '../../utils/globals'\nimport { buildNetworkRequestOptions } from './config'\nimport { isLocalhost } from '../../utils/request-utils'\nimport { userOptedOut } from '../../gdpr-utils'\n\nconst BASE_ENDPOINT = '/s/'\n\nconst FIVE_MINUTES = 1000 * 60 * 5\nconst TWO_SECONDS = 2000\nexport const RECORDING_IDLE_ACTIVITY_TIMEOUT_MS = FIVE_MINUTES\nexport const RECORDING_MAX_EVENT_SIZE = 1024 * 1024 * 0.9 // ~1mb (with some wiggle room)\nexport const RECORDING_BUFFER_TIMEOUT = 2000 // 2 seconds\nexport const SESSION_RECORDING_BATCH_KEY = 'recordings'\n\n// NOTE: Importing this type is problematic as we can't safely bundle it to a TS definition so, instead we redefine.\n// import type { record } from 'rrweb2/typings'\n// import type { recordOptions } from 'rrweb/typings/types'\n\n// Copied from rrweb typings to avoid import\nenum IncrementalSource {\n    Mutation = 0,\n    MouseMove = 1,\n    MouseInteraction = 2,\n    Scroll = 3,\n    ViewportResize = 4,\n    Input = 5,\n    TouchMove = 6,\n    MediaInteraction = 7,\n    StyleSheetRule = 8,\n    CanvasMutation = 9,\n    Font = 10,\n    Log = 11,\n    Drag = 12,\n    StyleDeclaration = 13,\n    Selection = 14,\n    AdoptedStyleSheet = 15,\n}\n\nconst ACTIVE_SOURCES = [\n    IncrementalSource.MouseMove,\n    IncrementalSource.MouseInteraction,\n    IncrementalSource.Scroll,\n    IncrementalSource.ViewportResize,\n    IncrementalSource.Input,\n    IncrementalSource.TouchMove,\n    IncrementalSource.MediaInteraction,\n    IncrementalSource.Drag,\n]\n\n/**\n * Session recording starts in buffering mode while waiting for decide response\n * Once the response is received it might be disabled, active or sampled\n * When sampled that means a sample rate is set and the last time the session id was rotated\n * the sample rate determined this session should be sent to the server.\n */\ntype SessionRecordingStatus = 'disabled' | 'sampled' | 'active' | 'buffering'\n\ninterface SnapshotBuffer {\n    size: number\n    data: any[]\n    sessionId: string | null\n    windowId: string | null\n}\n\ninterface QueuedRRWebEvent {\n    rrwebMethod: () => void\n    attempt: number\n    // the timestamp this was first put into this queue\n    enqueuedAt: number\n}\n\nconst newQueuedEvent = (rrwebMethod: () => void): QueuedRRWebEvent => ({\n    rrwebMethod,\n    enqueuedAt: Date.now(),\n    attempt: 1,\n})\n\nconst LOGGER_PREFIX = '[SessionRecording]'\n\nexport class SessionRecording {\n    private instance: PostHog\n    private _endpoint: string\n    private flushBufferTimer?: any\n\n    // we have a buffer - that contains PostHog snapshot events ready to be sent to the server\n    private buffer?: SnapshotBuffer\n    // and a queue - that contains rrweb events that we want to send to rrweb, but rrweb wasn't able to accept them yet\n    private queuedRRWebEvents: QueuedRRWebEvent[] = []\n\n    private mutationRateLimiter?: MutationRateLimiter\n    private _captureStarted: boolean\n    private stopRrweb: listenerHandler | undefined\n    private receivedDecide: boolean\n    private rrwebRecord: rrwebRecord | undefined\n    private isIdle = false\n\n    private _linkedFlagSeen: boolean = false\n    private _lastActivityTimestamp: number = Date.now()\n    private windowId: string | null = null\n    private sessionId: string | null = null\n    private _linkedFlag: string | FlagVariant | null = null\n    private _sampleRate: number | null = null\n    private _minimumDuration: number | null = null\n\n    private _fullSnapshotTimer?: number\n\n    // Util to help developers working on this feature manually override\n    _forceAllowLocalhostNetworkCapture = false\n\n    public get started(): boolean {\n        // TODO could we use status instead of _captureStarted?\n        return this._captureStarted\n    }\n\n    private get sessionManager() {\n        if (!this.instance.sessionManager) {\n            logger.error(LOGGER_PREFIX + ' started without valid sessionManager')\n            throw new Error(LOGGER_PREFIX + ' started without valid sessionManager. This is a bug.')\n        }\n\n        return this.instance.sessionManager\n    }\n\n    private get isSampled(): boolean | null {\n        if (_isNumber(this._sampleRate)) {\n            return this.instance.get_property(SESSION_RECORDING_IS_SAMPLED)\n        } else {\n            return null\n        }\n    }\n\n    private get sessionDuration(): number | null {\n        const mostRecentSnapshot = this.buffer?.data[this.buffer?.data.length - 1]\n        const { sessionStartTimestamp } = this.sessionManager.checkAndGetSessionAndWindowId(true)\n        return mostRecentSnapshot ? mostRecentSnapshot.timestamp - sessionStartTimestamp : null\n    }\n\n    private get isRecordingEnabled() {\n        const enabled_server_side = !!this.instance.get_property(SESSION_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = !this.instance.config.disable_session_recording\n        return window && enabled_server_side && enabled_client_side\n    }\n\n    private get isConsoleLogCaptureEnabled() {\n        const enabled_server_side = !!this.instance.get_property(CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE)\n        const enabled_client_side = this.instance.config.enable_recording_console_log\n        return enabled_client_side ?? enabled_server_side\n    }\n\n    private get canvasRecording(): { enabled: boolean; fps: number; quality: number } | undefined {\n        const canvasRecording_server_side = this.instance.get_property(SESSION_RECORDING_CANVAS_RECORDING)\n        return canvasRecording_server_side && canvasRecording_server_side.fps && canvasRecording_server_side.quality\n            ? {\n                  enabled: canvasRecording_server_side.enabled,\n                  fps: canvasRecording_server_side.fps,\n                  quality: canvasRecording_server_side.quality,\n              }\n            : undefined\n    }\n\n    private get recordingVersion() {\n        const recordingVersion_server_side = this.instance.get_property(SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE)\n        const recordingVersion_client_side = this.instance.config.session_recording?.recorderVersion\n        return recordingVersion_client_side || recordingVersion_server_side || 'v1'\n    }\n\n    // network payload capture config has three parts\n    // each can be configured server side or client side\n    private get networkPayloadCapture():\n        | Pick<NetworkRecordOptions, 'recordHeaders' | 'recordBody' | 'recordPerformance'>\n        | undefined {\n        const networkPayloadCapture_server_side = this.instance.get_property(SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE)\n        const networkPayloadCapture_client_side = {\n            recordHeaders: this.instance.config.session_recording?.recordHeaders,\n            recordBody: this.instance.config.session_recording?.recordBody,\n        }\n        const headersEnabled =\n            networkPayloadCapture_client_side?.recordHeaders || networkPayloadCapture_server_side?.recordHeaders\n        const bodyEnabled =\n            networkPayloadCapture_client_side?.recordBody || networkPayloadCapture_server_side?.recordBody\n        const performanceEnabled =\n            this.instance.config.capture_performance || networkPayloadCapture_server_side?.capturePerformance\n\n        return headersEnabled || bodyEnabled || performanceEnabled\n            ? { recordHeaders: headersEnabled, recordBody: bodyEnabled, recordPerformance: performanceEnabled }\n            : undefined\n    }\n\n    /**\n     * defaults to buffering mode until a decide response is received\n     * once a decide response is received status can be disabled, active or sampled\n     */\n    private get status(): SessionRecordingStatus {\n        if (!this.receivedDecide) {\n            return 'buffering'\n        }\n\n        if (!this.isRecordingEnabled) {\n            return 'disabled'\n        }\n\n        if (!_isNullish(this._linkedFlag) && !this._linkedFlagSeen) {\n            return 'buffering'\n        }\n\n        if (_isBoolean(this.isSampled)) {\n            return this.isSampled ? 'sampled' : 'disabled'\n        } else {\n            return 'active'\n        }\n    }\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        this._captureStarted = false\n        this._endpoint = BASE_ENDPOINT\n        this.stopRrweb = undefined\n        this.receivedDecide = false\n\n        window?.addEventListener('beforeunload', () => {\n            this._flushBuffer()\n        })\n\n        window?.addEventListener('offline', () => {\n            this._tryAddCustomEvent('browser offline', {})\n        })\n\n        window?.addEventListener('online', () => {\n            this._tryAddCustomEvent('browser online', {})\n        })\n\n        if (!this.instance.sessionManager) {\n            logger.error(LOGGER_PREFIX + ' started without valid sessionManager')\n            throw new Error(LOGGER_PREFIX + ' started without valid sessionManager. This is a bug.')\n        }\n\n        this.buffer = this.clearBuffer()\n    }\n\n    startRecordingIfEnabled() {\n        if (this.isRecordingEnabled) {\n            this._startCapture()\n            logger.info(LOGGER_PREFIX + ' started')\n        } else {\n            this.stopRecording()\n            this.clearBuffer()\n        }\n    }\n\n    stopRecording() {\n        if (this._captureStarted && this.stopRrweb) {\n            this.stopRrweb()\n            this.stopRrweb = undefined\n            this._captureStarted = false\n            logger.info(LOGGER_PREFIX + ' stopped')\n        }\n    }\n\n    private makeSamplingDecision(sessionId: string): void {\n        const sessionIdChanged = this.sessionId !== sessionId\n\n        if (!_isNumber(this._sampleRate)) {\n            this.instance.persistence?.register({\n                [SESSION_RECORDING_IS_SAMPLED]: null,\n            })\n            return\n        }\n\n        const storedIsSampled = this.isSampled\n\n        /**\n         * if we get this far then we should make a sampling decision.\n         * When the session id changes or there is no stored sampling decision for this session id\n         * then we should make a new decision.\n         *\n         * Otherwise, we should use the stored decision.\n         */\n        let shouldSample: boolean\n        if (sessionIdChanged || !_isBoolean(storedIsSampled)) {\n            const randomNumber = Math.random()\n            shouldSample = randomNumber < this._sampleRate\n        } else {\n            shouldSample = storedIsSampled\n        }\n\n        if (!shouldSample) {\n            logger.warn(\n                LOGGER_PREFIX +\n                    ` Sample rate (${this._sampleRate}) has determined that this sessionId (${sessionId}) will not be sent to the server.`\n            )\n        }\n\n        this.instance.persistence?.register({\n            [SESSION_RECORDING_IS_SAMPLED]: shouldSample,\n        })\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        if (this.instance.persistence) {\n            this.instance.persistence.register({\n                [SESSION_RECORDING_ENABLED_SERVER_SIDE]: !!response['sessionRecording'],\n                [CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE]: response.sessionRecording?.consoleLogRecordingEnabled,\n                [SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE]: response.sessionRecording?.recorderVersion,\n                [SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE]: {\n                    capturePerformance: response.capturePerformance,\n                    ...response.sessionRecording?.networkPayloadCapture,\n                },\n                [SESSION_RECORDING_CANVAS_RECORDING]: {\n                    enabled: response.sessionRecording?.recordCanvas,\n                    fps: response.sessionRecording?.canvasFps,\n                    quality: response.sessionRecording?.canvasQuality,\n                },\n            })\n        }\n\n        const receivedSampleRate = response.sessionRecording?.sampleRate\n        this._sampleRate = _isNullish(receivedSampleRate) ? null : parseFloat(receivedSampleRate)\n\n        const receivedMinimumDuration = response.sessionRecording?.minimumDurationMilliseconds\n        this._minimumDuration = _isUndefined(receivedMinimumDuration) ? null : receivedMinimumDuration\n\n        this._linkedFlag = response.sessionRecording?.linkedFlag || null\n\n        if (response.sessionRecording?.endpoint) {\n            this._endpoint = response.sessionRecording?.endpoint\n        }\n\n        if (_isNumber(this._sampleRate)) {\n            this.sessionManager.onSessionId((sessionId) => {\n                this.makeSamplingDecision(sessionId)\n            })\n        }\n\n        if (!_isNullish(this._linkedFlag)) {\n            const linkedFlag = _isString(this._linkedFlag) ? this._linkedFlag : this._linkedFlag?.flag\n            const linkedVariant = _isString(this._linkedFlag) ? null : this._linkedFlag?.variant\n            this.instance.onFeatureFlags((_flags, variants) => {\n                const flagIsPresent = _isObject(variants) && linkedFlag in variants\n                const linkedFlagMatches = linkedVariant ? variants[linkedFlag] === linkedVariant : flagIsPresent\n                if (linkedFlagMatches) {\n                    logger.info(LOGGER_PREFIX + ' linked flag matched', {\n                        linkedFlag,\n                        linkedVariant,\n                    })\n                }\n                this._linkedFlagSeen = linkedFlagMatches\n            })\n        }\n\n        this.receivedDecide = true\n        this.startRecordingIfEnabled()\n    }\n\n    log(message: string, level: 'log' | 'warn' | 'error' = 'log') {\n        this.instance.sessionRecording?.onRRwebEmit({\n            type: 6,\n            data: {\n                plugin: 'rrweb/console@1',\n                payload: {\n                    level,\n                    trace: [],\n                    // Even though it is a string we stringify it as that's what rrweb expects\n                    payload: [JSON.stringify(message)],\n                },\n            },\n            timestamp: _timestamp(),\n        })\n    }\n    private _startCapture() {\n        if (_isUndefined(Object.assign)) {\n            // According to the rrweb docs, rrweb is not supported on IE11 and below:\n            // \"rrweb does not support IE11 and below because it uses the MutationObserver API which was supported by these browsers.\"\n            // https://github.com/rrweb-io/rrweb/blob/master/guide.md#compatibility-note\n            //\n            // However, MutationObserver does exist on IE11, it just doesn't work well and does not detect all changes.\n            // Instead, when we load \"recorder.js\", the first JS error is about \"Object.assign\" being undefined.\n            // Thus instead of MutationObserver, we look for this function and block recording if it's undefined.\n            return\n        }\n\n        // We do not switch recorder versions midway through a recording.\n        // do not start if explicitly disabled or if the user has opted out\n        if (this._captureStarted || this.instance.config.disable_session_recording || userOptedOut(this.instance)) {\n            return\n        }\n\n        this._captureStarted = true\n        // We want to ensure the sessionManager is reset if necessary on load of the recorder\n        this.sessionManager.checkAndGetSessionAndWindowId()\n\n        const recorderJS = this.recordingVersion === 'v2' ? 'recorder-v2.js' : 'recorder.js'\n\n        // If recorder.js is already loaded (if array.full.js snippet is used or posthog-js/dist/recorder is\n        // imported) or matches the requested recorder version, don't load script. Otherwise, remotely import\n        // recorder.js from cdn since it hasn't been loaded.\n        if (this.instance.__loaded_recorder_version !== this.recordingVersion) {\n            loadScript(\n                this.instance.requestRouter.endpointFor('assets', `/static/${recorderJS}?v=${Config.LIB_VERSION}`),\n                (err) => {\n                    if (err) {\n                        return logger.error(LOGGER_PREFIX + ` could not load ${recorderJS}`, err)\n                    }\n\n                    this._onScriptLoaded()\n                }\n            )\n        } else {\n            this._onScriptLoaded()\n        }\n    }\n\n    private _isInteractiveEvent(event: eventWithTime) {\n        return event.type === INCREMENTAL_SNAPSHOT_EVENT_TYPE && ACTIVE_SOURCES.indexOf(event.data?.source) !== -1\n    }\n\n    private _updateWindowAndSessionIds(event: eventWithTime) {\n        // Some recording events are triggered by non-user events (e.g. \"X minutes ago\" text updating on the screen).\n        // We don't want to extend the session or trigger a new session in these cases. These events are designated by event\n        // type -> incremental update, and source -> mutation.\n\n        const isUserInteraction = this._isInteractiveEvent(event)\n\n        if (!isUserInteraction && !this.isIdle) {\n            // We check if the lastActivityTimestamp is old enough to go idle\n            if (event.timestamp - this._lastActivityTimestamp > RECORDING_IDLE_ACTIVITY_TIMEOUT_MS) {\n                this.isIdle = true\n                this._tryAddCustomEvent('sessionIdle', {\n                    reason: 'user inactivity',\n                    timeSinceLastActive: event.timestamp - this._lastActivityTimestamp,\n                    threshold: RECORDING_IDLE_ACTIVITY_TIMEOUT_MS,\n                })\n            }\n        }\n\n        let returningFromIdle = false\n        if (isUserInteraction) {\n            this._lastActivityTimestamp = event.timestamp\n            if (this.isIdle) {\n                // Remove the idle state if set and trigger a full snapshot as we will have ignored previous mutations\n                this.isIdle = false\n                this._tryAddCustomEvent('sessionNoLongerIdle', {\n                    reason: 'user activity',\n                    type: event.type,\n                })\n                returningFromIdle = true\n            }\n        }\n\n        if (this.isIdle) {\n            return\n        }\n\n        // We only want to extend the session if it is an interactive event.\n        const { windowId, sessionId } = this.sessionManager.checkAndGetSessionAndWindowId(\n            !isUserInteraction,\n            event.timestamp\n        )\n\n        const sessionIdChanged = this.sessionId !== sessionId\n        const windowIdChanged = this.windowId !== windowId\n\n        this.windowId = windowId\n        this.sessionId = sessionId\n\n        if (\n            returningFromIdle ||\n            ([FULL_SNAPSHOT_EVENT_TYPE, META_EVENT_TYPE].indexOf(event.type) === -1 &&\n                (windowIdChanged || sessionIdChanged))\n        ) {\n            this._tryTakeFullSnapshot()\n        }\n    }\n\n    private _tryRRWebMethod(queuedRRWebEvent: QueuedRRWebEvent): boolean {\n        try {\n            queuedRRWebEvent.rrwebMethod()\n            return true\n        } catch (e) {\n            // Sometimes a race can occur where the recorder is not fully started yet\n            logger.warn(LOGGER_PREFIX + ' could not emit queued rrweb event.', e)\n            this.queuedRRWebEvents.length < 10 &&\n                this.queuedRRWebEvents.push({\n                    enqueuedAt: queuedRRWebEvent.enqueuedAt || Date.now(),\n                    attempt: queuedRRWebEvent.attempt++,\n                    rrwebMethod: queuedRRWebEvent.rrwebMethod,\n                })\n            return false\n        }\n    }\n\n    private _tryAddCustomEvent(tag: string, payload: any): boolean {\n        return this._tryRRWebMethod(newQueuedEvent(() => this.rrwebRecord!.addCustomEvent(tag, payload)))\n    }\n\n    private _tryTakeFullSnapshot(): boolean {\n        return this._tryRRWebMethod(newQueuedEvent(() => this.rrwebRecord!.takeFullSnapshot()))\n    }\n\n    private _onScriptLoaded() {\n        // rrweb config info: https://github.com/rrweb-io/rrweb/blob/7d5d0033258d6c29599fb08412202d9a2c7b9413/src/record/index.ts#L28\n        const sessionRecordingOptions: recordOptions<eventWithTime> = {\n            // select set of rrweb config options we expose to our users\n            // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n            blockClass: 'ph-no-capture',\n            blockSelector: undefined,\n            ignoreClass: 'ph-ignore-input',\n            maskTextClass: 'ph-mask',\n            maskTextSelector: undefined,\n            maskTextFn: undefined,\n            maskAllInputs: true,\n            maskInputOptions: {},\n            maskInputFn: undefined,\n            slimDOMOptions: {},\n            collectFonts: false,\n            inlineStylesheet: true,\n            recordCrossOriginIframes: false,\n        }\n        // We switched from loading all of rrweb to just the record part, but\n        // keep backwards compatibility if someone hasn't upgraded PostHog\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        this.rrwebRecord = window.rrweb ? window.rrweb.record : window.rrwebRecord\n\n        // only allows user to set our allow-listed options\n        const userSessionRecordingOptions = this.instance.config.session_recording\n        for (const [key, value] of Object.entries(userSessionRecordingOptions || {})) {\n            if (key in sessionRecordingOptions) {\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                sessionRecordingOptions[key] = value\n            }\n        }\n\n        if (this.canvasRecording && this.canvasRecording.enabled) {\n            sessionRecordingOptions.recordCanvas = true\n            sessionRecordingOptions.sampling = { canvas: this.canvasRecording.fps }\n            sessionRecordingOptions.dataURLOptions = { type: 'image/webp', quality: this.canvasRecording.quality }\n        }\n\n        if (!this.rrwebRecord) {\n            logger.error(\n                LOGGER_PREFIX +\n                    'onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.'\n            )\n            return\n        }\n\n        this.mutationRateLimiter =\n            this.mutationRateLimiter ??\n            new MutationRateLimiter(this.rrwebRecord, {\n                onBlockedNode: (id, node) => {\n                    const message = `Too many mutations on node '${id}'. Rate limiting. This could be due to SVG animations or something similar`\n                    logger.info(message, {\n                        node: node,\n                    })\n\n                    this.log(LOGGER_PREFIX + ' ' + message, 'warn')\n                },\n            })\n\n        // rrweb takes a snapshot on initialization,\n        // we want to take one in five minutes\n        // if nothing else happens to reset the timer\n        this._scheduleFullSnapshot()\n\n        const activePlugins = this._gatherRRWebPlugins()\n        this.stopRrweb = this.rrwebRecord({\n            emit: (event) => {\n                this.onRRwebEmit(event)\n            },\n            plugins: activePlugins,\n            ...sessionRecordingOptions,\n        })\n\n        // :TRICKY: rrweb does not capture navigation within SPA-s, so hook into our $pageview events to get access to all events.\n        //   Dropping the initial event is fine (it's always captured by rrweb).\n        this.instance._addCaptureHook((eventName) => {\n            // If anything could go wrong here it has the potential to block the main loop,\n            // so we catch all errors.\n            try {\n                if (eventName === '$pageview') {\n                    const href = window ? this._maskUrl(window.location.href) : ''\n                    if (!href) {\n                        return\n                    }\n                    this._tryAddCustomEvent('$pageview', { href })\n                    this._tryTakeFullSnapshot()\n                }\n            } catch (e) {\n                logger.error('Could not add $pageview to rrweb session', e)\n            }\n        })\n\n        // We reset the last activity timestamp, resetting the idle timer\n        this._lastActivityTimestamp = Date.now()\n        this.isIdle = false\n\n        this._tryAddCustomEvent('$session_options', {\n            sessionRecordingOptions,\n            activePlugins: activePlugins.map((p) => p?.name),\n        })\n\n        this._tryAddCustomEvent('$posthog_config', {\n            config: this.instance.config,\n        })\n    }\n\n    private _scheduleFullSnapshot(): void {\n        if (this._fullSnapshotTimer) {\n            clearInterval(this._fullSnapshotTimer)\n        }\n\n        this._fullSnapshotTimer = setInterval(() => {\n            this._tryTakeFullSnapshot()\n        }, FIVE_MINUTES) // 5 minutes\n    }\n\n    private _gatherRRWebPlugins() {\n        const plugins: RecordPlugin<unknown>[] = []\n\n        if (assignableWindow.rrwebConsoleRecord && this.isConsoleLogCaptureEnabled) {\n            plugins.push(assignableWindow.rrwebConsoleRecord.getRecordConsolePlugin())\n        }\n\n        if (this.networkPayloadCapture && _isFunction(assignableWindow.getRecordNetworkPlugin)) {\n            const canRecordNetwork = !isLocalhost() || this._forceAllowLocalhostNetworkCapture\n\n            if (canRecordNetwork) {\n                plugins.push(\n                    assignableWindow.getRecordNetworkPlugin(\n                        buildNetworkRequestOptions(this.instance.config, this.networkPayloadCapture)\n                    )\n                )\n            } else {\n                logger.info(LOGGER_PREFIX + ' NetworkCapture not started because we are on localhost.')\n            }\n        }\n\n        return plugins\n    }\n\n    onRRwebEmit(rawEvent: eventWithTime) {\n        this._processQueuedEvents()\n\n        if (!rawEvent || !_isObject(rawEvent)) {\n            return\n        }\n\n        if (rawEvent.type === EventType.Meta) {\n            const href = this._maskUrl(rawEvent.data.href)\n            if (!href) {\n                return\n            }\n            rawEvent.data.href = href\n        }\n\n        if (rawEvent.type === EventType.FullSnapshot) {\n            // we're processing a full snapshot, so we should reset the timer\n            this._scheduleFullSnapshot()\n        }\n\n        const throttledEvent = this.mutationRateLimiter\n            ? this.mutationRateLimiter.throttleMutations(rawEvent)\n            : rawEvent\n\n        if (!throttledEvent) {\n            return\n        }\n\n        // TODO: Re-add ensureMaxMessageSize once we are confident in it\n        const event = truncateLargeConsoleLogs(throttledEvent)\n        const size = JSON.stringify(event).length\n\n        this._updateWindowAndSessionIds(event)\n\n        // allow custom events even when idle\n        if (this.isIdle && event.type !== EventType.Custom) {\n            // When in an idle state we keep recording, but don't capture the events\n            return\n        }\n\n        const properties = {\n            $snapshot_bytes: size,\n            $snapshot_data: event,\n            $session_id: this.sessionId,\n            $window_id: this.windowId,\n        }\n\n        if (this.status !== 'disabled') {\n            this._captureSnapshotBuffered(properties)\n        } else {\n            this.clearBuffer()\n        }\n    }\n\n    private _processQueuedEvents() {\n        if (this.queuedRRWebEvents.length) {\n            // if rrweb isn't ready to accept events earlier then we queued them up\n            // now that emit has been called rrweb should be ready to accept them\n            // so, before we process this event, we try our queued events _once_ each\n            // we don't want to risk queuing more things and never exiting this loop!\n            // if they fail here, they'll be pushed into a new queue,\n            // and tried on the next loop.\n            // there is a risk of this queue growing in an uncontrolled manner,\n            // so its length is limited elsewhere\n            // for now this is to help us ensure we can capture events that happen\n            // and try to identify more about when it is failing\n            const itemsToProcess = [...this.queuedRRWebEvents]\n            this.queuedRRWebEvents = []\n            itemsToProcess.forEach((queuedRRWebEvent) => {\n                if (Date.now() - queuedRRWebEvent.enqueuedAt > TWO_SECONDS) {\n                    this._tryAddCustomEvent('rrwebQueueTimeout', {\n                        enqueuedAt: queuedRRWebEvent.enqueuedAt,\n                        attempt: queuedRRWebEvent.attempt,\n                        queueLength: itemsToProcess.length,\n                    })\n                } else {\n                    if (this._tryRRWebMethod(queuedRRWebEvent)) {\n                        this._tryAddCustomEvent('rrwebQueueSuccess', {\n                            enqueuedAt: queuedRRWebEvent.enqueuedAt,\n                            attempt: queuedRRWebEvent.attempt,\n                            queueLength: itemsToProcess.length,\n                        })\n                    }\n                }\n            })\n        }\n    }\n\n    private _maskUrl(url: string): string | undefined {\n        const userSessionRecordingOptions = this.instance.config.session_recording\n\n        if (userSessionRecordingOptions.maskNetworkRequestFn) {\n            let networkRequest: NetworkRequest | null | undefined = {\n                url,\n            }\n\n            // TODO we should deprecate this and use the same function for this masking and the rrweb/network plugin\n            // TODO or deprecate this and provide a new clearer name so this would be `maskURLPerformanceFn` or similar\n            networkRequest = userSessionRecordingOptions.maskNetworkRequestFn(networkRequest)\n\n            return networkRequest?.url\n        }\n\n        return url\n    }\n\n    private clearBuffer(): SnapshotBuffer {\n        this.buffer = undefined\n\n        return {\n            size: 0,\n            data: [],\n            sessionId: this.sessionId,\n            windowId: this.windowId,\n        }\n    }\n\n    // the intention is a buffer that (currently) is used only after a decide response enables session recording\n    // it is called ever X seconds using the flushBufferTimer so that we don't have to wait for the buffer to fill up\n    // when it is called on a timer it assumes that it can definitely flush\n    // it is flushed when the session id changes or the size of the buffered data gets too great (1mb by default)\n    // first change: if the recording is in buffering mode,\n    //  flush buffer simply resets the timer and returns the existing flush buffer\n    private _flushBuffer() {\n        if (this.flushBufferTimer) {\n            clearTimeout(this.flushBufferTimer)\n            this.flushBufferTimer = undefined\n        }\n\n        const minimumDuration = this._minimumDuration\n        const sessionDuration = this.sessionDuration\n        // if we have old data in the buffer but the session has rotated then the\n        // session duration might be negative, in that case we want to flush the buffer\n        const isPositiveSessionDuration = _isNumber(sessionDuration) && sessionDuration >= 0\n        const isBelowMinimumDuration =\n            _isNumber(minimumDuration) && isPositiveSessionDuration && sessionDuration < minimumDuration\n\n        if (this.status === 'buffering' || isBelowMinimumDuration) {\n            this.flushBufferTimer = setTimeout(() => {\n                this._flushBuffer()\n            }, RECORDING_BUFFER_TIMEOUT)\n            return this.buffer || this.clearBuffer()\n        }\n\n        if (this.buffer && this.buffer.data.length !== 0) {\n            this._captureSnapshot({\n                $snapshot_bytes: this.buffer.size,\n                $snapshot_data: this.buffer.data,\n                $session_id: this.buffer.sessionId,\n                $window_id: this.buffer.windowId,\n            })\n\n            return this.clearBuffer()\n        } else {\n            return this.buffer || this.clearBuffer()\n        }\n    }\n\n    private _captureSnapshotBuffered(properties: Properties) {\n        const additionalBytes = 2 + (this.buffer?.data.length || 0) // 2 bytes for the array brackets and 1 byte for each comma\n        if (\n            !this.buffer ||\n            this.buffer.size + properties.$snapshot_bytes + additionalBytes > RECORDING_MAX_EVENT_SIZE ||\n            (!!this.buffer.sessionId && this.buffer.sessionId !== this.sessionId)\n        ) {\n            this.buffer = this._flushBuffer()\n        }\n\n        if (_isNull(this.buffer.sessionId) && !_isNull(this.sessionId)) {\n            // session id starts null but has now been assigned, update the buffer\n            this.buffer.sessionId = this.sessionId\n            this.buffer.windowId = this.windowId\n        }\n\n        this.buffer.size += properties.$snapshot_bytes\n        this.buffer.data.push(properties.$snapshot_data)\n\n        if (!this.flushBufferTimer) {\n            this.flushBufferTimer = setTimeout(() => {\n                this._flushBuffer()\n            }, RECORDING_BUFFER_TIMEOUT)\n        }\n    }\n\n    private _captureSnapshot(properties: Properties) {\n        // :TRICKY: Make sure we batch these requests, use a custom endpoint and don't truncate the strings.\n        this.instance.capture('$snapshot', properties, {\n            method: 'POST',\n            _url: this.instance.requestRouter.endpointFor('api', this._endpoint),\n            _noTruncate: true,\n            _batchKey: SESSION_RECORDING_BATCH_KEY,\n            _metrics: {\n                rrweb_full_snapshot: properties.$snapshot_data.type === FULL_SNAPSHOT_EVENT_TYPE,\n            },\n        })\n    }\n}\n","import { autocapture } from './autocapture'\nimport { _base64Encode, loadScript } from './utils'\nimport { PostHog } from './posthog-core'\nimport { DecideResponse } from './types'\nimport { STORED_GROUP_PROPERTIES_KEY, STORED_PERSON_PROPERTIES_KEY } from './constants'\n\nimport { _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window, document, assignableWindow } from './utils/globals'\n\nexport class Decide {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n        // don't need to wait for `decide` to return if flags were provided on initialisation\n        this.instance.decideEndpointWasHit = this.instance._hasBootstrappedFeatureFlags()\n    }\n\n    call(): void {\n        /*\n        Calls /decide endpoint to fetch options for autocapture, session recording, feature flags & compression.\n        */\n        const json_data = JSON.stringify({\n            token: this.instance.config.token,\n            distinct_id: this.instance.get_distinct_id(),\n            groups: this.instance.getGroups(),\n            person_properties: this.instance.get_property(STORED_PERSON_PROPERTIES_KEY),\n            group_properties: this.instance.get_property(STORED_GROUP_PROPERTIES_KEY),\n            disable_flags:\n                this.instance.config.advanced_disable_feature_flags ||\n                this.instance.config.advanced_disable_feature_flags_on_first_load ||\n                undefined,\n        })\n\n        const encoded_data = _base64Encode(json_data)\n        this.instance._send_request(\n            this.instance.requestRouter.endpointFor('api', '/decide/?v=3'),\n            { data: encoded_data, verbose: true },\n            { method: 'POST' },\n            (response) => this.parseDecideResponse(response as DecideResponse)\n        )\n    }\n\n    parseDecideResponse(response: DecideResponse): void {\n        this.instance.featureFlags.setReloadingPaused(false)\n        // :TRICKY: Reload - start another request if queued!\n        this.instance.featureFlags._startReloadTimer()\n\n        if (response?.status === 0) {\n            logger.error('Failed to fetch feature flags from PostHog.')\n            return\n        }\n        if (!(document && document.body)) {\n            logger.info('document not ready yet, trying again in 500 milliseconds...')\n            setTimeout(() => {\n                this.parseDecideResponse(response)\n            }, 500)\n            return\n        }\n\n        this.instance.toolbar.afterDecideResponse(response)\n        this.instance.sessionRecording?.afterDecideResponse(response)\n        autocapture.afterDecideResponse(response, this.instance)\n        this.instance._afterDecideResponse(response)\n\n        if (\n            !this.instance.config.advanced_disable_feature_flags_on_first_load &&\n            !this.instance.config.advanced_disable_feature_flags\n        ) {\n            this.instance.featureFlags.receivedFeatureFlags(response)\n        }\n\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        const surveysGenerator = window?.extendPostHogWithSurveys\n\n        if (response['surveys'] && !surveysGenerator) {\n            loadScript(this.instance.requestRouter.endpointFor('assets', '/static/surveys.js'), (err) => {\n                if (err) {\n                    return logger.error(`Could not load surveys script`, err)\n                }\n\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                window.extendPostHogWithSurveys(this.instance)\n            })\n        }\n\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        const exceptionAutoCaptureAddedToWindow = window?.extendPostHogWithExceptionAutoCapture\n        if (\n            response['autocaptureExceptions'] &&\n            !!response['autocaptureExceptions'] &&\n            _isUndefined(exceptionAutoCaptureAddedToWindow)\n        ) {\n            loadScript(this.instance.requestRouter.endpointFor('assets', '/static/exception-autocapture.js'), (err) => {\n                if (err) {\n                    return logger.error(`Could not load exception autocapture script`, err)\n                }\n\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                window.extendPostHogWithExceptionAutocapture(this.instance, response)\n            })\n        }\n\n        if (response['siteApps']) {\n            if (this.instance.config.opt_in_site_apps) {\n                for (const { id, url } of response['siteApps']) {\n                    const scriptUrl = this.instance.requestRouter.endpointFor('api', url)\n\n                    assignableWindow[`__$$ph_site_app_${id}`] = this.instance\n\n                    loadScript(scriptUrl, (err) => {\n                        if (err) {\n                            logger.error(`Error while initializing PostHog app with config id ${id}`, err)\n                        }\n                    })\n                }\n            } else if (response['siteApps'].length > 0) {\n                logger.error('PostHog site apps are disabled. Enable the \"opt_in_site_apps\" config to proceed.')\n            }\n        }\n    }\n}\n","import { _register_event, _try, loadScript } from '../utils'\nimport { PostHog } from '../posthog-core'\nimport { DecideResponse, ToolbarParams } from '../types'\nimport { _getHashParam } from '../utils/request-utils'\nimport { logger } from '../utils/logger'\nimport { window, document, assignableWindow } from '../utils/globals'\n\n// TRICKY: Many web frameworks will modify the route on load, potentially before posthog is initialized.\n// To get ahead of this we grab it as soon as the posthog-js is parsed\nconst STATE_FROM_WINDOW = window?.location\n    ? _getHashParam(window.location.hash, '__posthog') || _getHashParam(location.hash, 'state')\n    : null\n\nexport class Toolbar {\n    instance: PostHog\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    afterDecideResponse(response: DecideResponse) {\n        const toolbarParams: ToolbarParams =\n            response['toolbarParams'] ||\n            response['editorParams'] ||\n            (response['toolbarVersion'] ? { toolbarVersion: response['toolbarVersion'] } : {})\n        if (\n            response['isAuthenticated'] &&\n            toolbarParams['toolbarVersion'] &&\n            toolbarParams['toolbarVersion'].indexOf('toolbar') === 0\n        ) {\n            this.loadToolbar({\n                ...toolbarParams,\n            })\n        }\n    }\n\n    /**\n     * To load the toolbar, we need an access token and other state. That state comes from one of three places:\n     * 1. In the URL hash params\n     * 2. From session storage under the key `toolbarParams` if the toolbar was initialized on a previous page\n     */\n    maybeLoadToolbar(\n        location: Location | undefined = undefined,\n        localStorage: Storage | undefined = undefined,\n        history: History | undefined = undefined\n    ): boolean {\n        if (!window || !document) {\n            return false\n        }\n        location = location ?? window.location\n        history = history ?? window.history\n\n        try {\n            // Before running the code we check if we can access localStorage, if not we opt-out\n            if (!localStorage) {\n                try {\n                    window.localStorage.setItem('test', 'test')\n                    window.localStorage.removeItem('test')\n                } catch (error) {\n                    return false\n                }\n\n                // If localStorage was undefined, and localStorage is supported we set the default value\n                localStorage = window?.localStorage\n            }\n\n            /**\n             * Info about the state\n             * The state is a json object\n             * 1. (Legacy) The state can be `state={}` as a urlencoded object of info. In this case\n             * 2. The state should now be found in `__posthog={}` and can be base64 encoded or urlencoded.\n             * 3. Base64 encoding is preferred and will gradually be rolled out everywhere\n             */\n\n            const stateHash =\n                STATE_FROM_WINDOW || _getHashParam(location.hash, '__posthog') || _getHashParam(location.hash, 'state')\n\n            let toolbarParams: ToolbarParams\n            const state = stateHash\n                ? _try(() => JSON.parse(atob(decodeURIComponent(stateHash)))) ||\n                  _try(() => JSON.parse(decodeURIComponent(stateHash)))\n                : null\n\n            const parseFromUrl = state && state['action'] === 'ph_authorize'\n\n            if (parseFromUrl) {\n                // happens if they are initializing the toolbar using an old snippet\n                toolbarParams = state\n                toolbarParams.source = 'url'\n\n                if (toolbarParams && Object.keys(toolbarParams).length > 0) {\n                    if (state['desiredHash']) {\n                        // hash that was in the url before the redirect\n                        location.hash = state['desiredHash']\n                    } else if (history) {\n                        history.replaceState('', document.title, location.pathname + location.search) // completely remove hash\n                    } else {\n                        location.hash = '' // clear hash (but leaves # unfortunately)\n                    }\n                }\n            } else {\n                // get credentials from localStorage from a previous initialzation\n                toolbarParams = JSON.parse(localStorage.getItem('_postHogToolbarParams') || '{}')\n                toolbarParams.source = 'localstorage'\n\n                // delete \"add-action\" or other intent from toolbarParams, otherwise we'll have the same intent\n                // every time we open the page (e.g. you just visiting your own site an hour later)\n                delete toolbarParams.userIntent\n            }\n\n            if (toolbarParams['token'] && this.instance.config.token === toolbarParams['token']) {\n                this.loadToolbar(toolbarParams)\n                return true\n            } else {\n                return false\n            }\n        } catch (e) {\n            return false\n        }\n    }\n\n    loadToolbar(params?: ToolbarParams): boolean {\n        if (!window || assignableWindow['_postHogToolbarLoaded']) {\n            return false\n        }\n        // only load the toolbar once, even if there are multiple instances of PostHogLib\n        assignableWindow['_postHogToolbarLoaded'] = true\n\n        // toolbar.js is served from the PostHog CDN, this has a TTL of 24 hours.\n        // the toolbar asset includes a rotating \"token\" that is valid for 5 minutes.\n        const fiveMinutesInMillis = 5 * 60 * 1000\n        // this ensures that we bust the cache periodically\n        const timestampToNearestFiveMinutes = Math.floor(Date.now() / fiveMinutesInMillis) * fiveMinutesInMillis\n        const toolbarUrl = this.instance.requestRouter.endpointFor(\n            'assets',\n            `/static/toolbar.js?t=${timestampToNearestFiveMinutes}`\n        )\n        const disableToolbarMetrics =\n            this.instance.requestRouter.region === 'custom' && this.instance.config.advanced_disable_toolbar_metrics\n\n        const toolbarParams = {\n            token: this.instance.config.token,\n            ...params,\n            apiURL: this.instance.requestRouter.endpointFor('ui'),\n            ...(disableToolbarMetrics ? { instrument: false } : {}),\n        }\n\n        const { source: _discard, ...paramsToPersist } = toolbarParams // eslint-disable-line\n        window.localStorage.setItem('_postHogToolbarParams', JSON.stringify(paramsToPersist))\n\n        loadScript(toolbarUrl, (err) => {\n            if (err) {\n                logger.error('Failed to load toolbar', err)\n                return\n            }\n            ;(assignableWindow['ph_load_toolbar'] || assignableWindow['ph_load_editor'])(toolbarParams, this.instance)\n        })\n        // Turbolinks doesn't fire an onload event but does replace the entire body, including the toolbar.\n        // Thus, we ensure the toolbar is only loaded inside the body, and then reloaded on turbolinks:load.\n        _register_event(window, 'turbolinks:load', () => {\n            assignableWindow['_postHogToolbarLoaded'] = false\n            this.loadToolbar(toolbarParams)\n        })\n        return true\n    }\n\n    /** @deprecated Use \"loadToolbar\" instead. */\n    _loadEditor(params: ToolbarParams): boolean {\n        return this.loadToolbar(params)\n    }\n\n    /** @deprecated Use \"maybeLoadToolbar\" instead. */\n    maybeLoadEditor(\n        location: Location | undefined = undefined,\n        localStorage: Storage | undefined = undefined,\n        history: History | undefined = undefined\n    ): boolean {\n        return this.maybeLoadToolbar(location, localStorage, history)\n    }\n}\n","export class RequestQueueScaffold {\n    isPolling: boolean // flag to continue to recursively poll or not\n    _event_queue: any[]\n    _empty_queue_count: number // to track empty polls\n    _poller: number | undefined // to become interval for reference to clear later\n    _pollInterval: number\n\n    constructor(pollInterval = 3000) {\n        this.isPolling = true // flag to continue to recursively poll or not\n        this._event_queue = []\n        this._empty_queue_count = 0 // to track empty polls\n        this._poller = undefined // to become interval for reference to clear later\n        this._pollInterval = pollInterval\n    }\n\n    setPollInterval(interval: number): void {\n        this._pollInterval = interval\n        // Reset interval if running already\n        if (this.isPolling) {\n            this.poll()\n        }\n    }\n\n    // // eslint-disable-next-line no-unused-vars\n    // enqueue(_requestData: Record<string, any>): void {\n    //     return\n    // }\n\n    poll(): void {\n        return\n    }\n\n    unload(): void {\n        return\n    }\n\n    getTime(): number {\n        return new Date().getTime()\n    }\n}\n","import { RequestQueueScaffold } from './base-request-queue'\nimport { _each } from './utils'\nimport { Properties, QueuedRequestData, XHROptions } from './types'\n\nimport { _isUndefined } from './utils/type-utils'\n\nexport class RequestQueue extends RequestQueueScaffold {\n    handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void\n\n    constructor(handlePollRequest: (url: string, data: Properties, options?: XHROptions) => void, pollInterval = 3000) {\n        super(pollInterval)\n        this.handlePollRequest = handlePollRequest\n    }\n\n    enqueue(url: string, data: Properties, options: XHROptions): void {\n        this._event_queue.push({ url, data, options })\n\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this._event_queue.length > 0) {\n                const requests = this.formatQueue()\n                for (const key in requests) {\n                    const { url, data, options } = requests[key]\n                    _each(data, (_, dataKey) => {\n                        data[dataKey]['offset'] = Math.abs(data[dataKey]['timestamp'] - this.getTime())\n                        delete data[dataKey]['timestamp']\n                    })\n                    this.handlePollRequest(url, data, options)\n                }\n                this._event_queue.length = 0 // flush the _event_queue\n                this._empty_queue_count = 0\n            } else {\n                this._empty_queue_count++\n            }\n\n            /**\n             * _empty_queue_count will increment each time the queue is polled\n             *  and it is empty. To avoid empty polling (user went idle, stepped away from comp)\n             *  we can turn it off with the isPolling flag.\n             *\n             * Polling will be re enabled when the next time PostHogLib.capture is called with\n             *  an event that should be added to the event queue.\n             */\n            if (this._empty_queue_count > 4) {\n                this.isPolling = false\n                this._empty_queue_count = 0\n            }\n            if (this.isPolling) {\n                this.poll()\n            }\n        }, this._pollInterval) as any as number\n    }\n\n    unload(): void {\n        clearTimeout(this._poller)\n        const requests = this._event_queue.length > 0 ? this.formatQueue() : {}\n        this._event_queue.length = 0\n        const requestValues = Object.values(requests)\n\n        // Always force events to be sent before recordings, as events are more important, and recordings are bigger and thus less likely to arrive\n        const sortedRequests = [\n            ...requestValues.filter((r) => r.url.indexOf('/e') === 0),\n            ...requestValues.filter((r) => r.url.indexOf('/e') !== 0),\n        ]\n        sortedRequests.map(({ url, data, options }) => {\n            this.handlePollRequest(url, data, { ...options, transport: 'sendBeacon' })\n        })\n    }\n\n    formatQueue(): Record<string, QueuedRequestData> {\n        const requests: Record<string, QueuedRequestData> = {}\n        _each(this._event_queue, (request) => {\n            const { url, data, options } = request\n            const key = (options ? options._batchKey : null) || url\n            if (_isUndefined(requests[key])) {\n                requests[key] = { data: [], url, options }\n            }\n\n            // :TRICKY: Metrics-only code\n            if (\n                options &&\n                requests[key].options &&\n                requests[key].options._metrics &&\n                !(requests[key].options._metrics as any)['rrweb_full_snapshot']\n            ) {\n                ;(requests[key].options._metrics as any)['rrweb_full_snapshot'] =\n                    options._metrics['rrweb_full_snapshot']\n            }\n            requests[key].data.push(data)\n        })\n        return requests\n    }\n}\n","// DEFLATE is a complex format; to read this code, you should probably check the RFC first:\n// https://tools.ietf.org/html/rfc1951\n// You may also wish to take a look at the guide I made about this program:\n// https://gist.github.com/101arrowz/253f31eb5abc3d9275ab943003ffecad\n// Much of the following code is similar to that of UZIP.js:\n// https://github.com/photopea/UZIP.js\n// Many optimizations have been made, so the bundle size is ultimately smaller but performance is similar.\n// Sometimes 0 will appear where -1 would be more appropriate. This is because using a uint\n// is better for memory in most engines (I *think*).\nvar ch2 = {};\nvar wk = (function (c, id, msg, transfer, cb) {\n    var u = ch2[id] || (ch2[id] = URL.createObjectURL(new Blob([c], { type: 'text/javascript' })));\n    var w = new Worker(u);\n    w.onerror = function (e) { return cb(e.error, null); };\n    w.onmessage = function (e) { return cb(null, e.data); };\n    w.postMessage(msg, transfer);\n    return w;\n});\n\n// aliases for shorter compressed code (most minifers don't do this)\nvar u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\n// fixed length extra bits\nvar fleb = new u8([0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, /* unused */ 0, 0, /* impossible */ 0]);\n// fixed distance extra bits\n// see fleb note\nvar fdeb = new u8([0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13, /* unused */ 0, 0]);\n// code length index map\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\n// get base, reverse index map from extra bits\nvar freb = function (eb, start) {\n    var b = new u16(31);\n    for (var i = 0; i < 31; ++i) {\n        b[i] = start += 1 << eb[i - 1];\n    }\n    // numbers here are at max 18 bits\n    var r = new u32(b[30]);\n    for (var i = 1; i < 30; ++i) {\n        for (var j = b[i]; j < b[i + 1]; ++j) {\n            r[j] = ((j - b[i]) << 5) | i;\n        }\n    }\n    return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\n// we can ignore the fact that the other numbers are wrong; they never happen anyway\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\n// map of value to reverse (assuming 16 bits)\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n    // reverse table algorithm from SO\n    var x = ((i & 0xAAAA) >>> 1) | ((i & 0x5555) << 1);\n    x = ((x & 0xCCCC) >>> 2) | ((x & 0x3333) << 2);\n    x = ((x & 0xF0F0) >>> 4) | ((x & 0x0F0F) << 4);\n    rev[i] = (((x & 0xFF00) >>> 8) | ((x & 0x00FF) << 8)) >>> 1;\n}\n// create huffman tree from u8 \"map\": index -> code length for code index\n// mb (max bits) must be at most 15\n// TODO: optimize/split up?\nvar hMap = (function (cd, mb, r) {\n    var s = cd.length;\n    // index\n    var i = 0;\n    // u16 \"map\": index -> # of codes with bit length = index\n    var l = new u16(mb);\n    // length of cd must be 288 (total # of codes)\n    for (; i < s; ++i)\n        ++l[cd[i] - 1];\n    // u16 \"map\": index -> minimum code for bit length = index\n    var le = new u16(mb);\n    for (i = 0; i < mb; ++i) {\n        le[i] = (le[i - 1] + l[i - 1]) << 1;\n    }\n    var co;\n    if (r) {\n        // u16 \"map\": index -> number of actual bits, symbol for code\n        co = new u16(1 << mb);\n        // bits to remove for reverser\n        var rvb = 15 - mb;\n        for (i = 0; i < s; ++i) {\n            // ignore 0 lengths\n            if (cd[i]) {\n                // num encoding both symbol and bits read\n                var sv = (i << 4) | cd[i];\n                // free bits\n                var r_1 = mb - cd[i];\n                // start value\n                var v = le[cd[i] - 1]++ << r_1;\n                // m is end value\n                for (var m = v | ((1 << r_1) - 1); v <= m; ++v) {\n                    // every 16 bit value starting with the code yields the same result\n                    co[rev[v] >>> rvb] = sv;\n                }\n            }\n        }\n    }\n    else {\n        co = new u16(s);\n        for (i = 0; i < s; ++i)\n            co[i] = rev[le[cd[i] - 1]++] >>> (15 - cd[i]);\n    }\n    return co;\n});\n// fixed length tree\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n    flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n    flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n    flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n    flt[i] = 8;\n// fixed distance tree\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n    fdt[i] = 5;\n// fixed length map\nvar flm = /*#__PURE__*/ hMap(flt, 9, 0), flrm = /*#__PURE__*/ hMap(flt, 9, 1);\n// fixed distance map\nvar fdm = /*#__PURE__*/ hMap(fdt, 5, 0), fdrm = /*#__PURE__*/ hMap(fdt, 5, 1);\n// find max of array\nvar max = function (a) {\n    var m = a[0];\n    for (var i = 1; i < a.length; ++i) {\n        if (a[i] > m)\n            m = a[i];\n    }\n    return m;\n};\n// read d, starting at bit p and mask with m\nvar bits = function (d, p, m) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8)) >>> (p & 7)) & m;\n};\n// read d, starting at bit p continuing for at least 16 bits\nvar bits16 = function (d, p) {\n    var o = (p / 8) >> 0;\n    return ((d[o] | (d[o + 1] << 8) | (d[o + 2] << 16)) >>> (p & 7));\n};\n// get end of byte\nvar shft = function (p) { return ((p / 8) >> 0) + (p & 7 && 1); };\n// typed array slice - allows garbage collector to free original reference,\n// while being more compatible than .slice\nvar slc = function (v, s, e) {\n    if (s == null || s < 0)\n        s = 0;\n    if (e == null || e > v.length)\n        e = v.length;\n    // can't use .constructor in case user-supplied\n    var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n    n.set(v.subarray(s, e));\n    return n;\n};\n// expands raw DEFLATE data\nvar inflt = function (dat, buf, st) {\n    // source length\n    var sl = dat.length;\n    // have to estimate size\n    var noBuf = !buf || st;\n    // no state\n    var noSt = !st || st.i;\n    if (!st)\n        st = {};\n    // Assumes roughly 33% compression ratio average\n    if (!buf)\n        buf = new u8(sl * 3);\n    // ensure buffer can fit at least l elements\n    var cbuf = function (l) {\n        var bl = buf.length;\n        // need to increase size to fit\n        if (l > bl) {\n            // Double or set to necessary, whichever is greater\n            var nbuf = new u8(Math.max(bl * 2, l));\n            nbuf.set(buf);\n            buf = nbuf;\n        }\n    };\n    //  last chunk         bitpos           bytes\n    var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n    // total bits\n    var tbts = sl * 8;\n    do {\n        if (!lm) {\n            // BFINAL - this is only 1 when last chunk is next\n            st.f = final = bits(dat, pos, 1);\n            // type: 0 = no compression, 1 = fixed huffman, 2 = dynamic huffman\n            var type = bits(dat, pos + 1, 3);\n            pos += 3;\n            if (!type) {\n                // go to end of byte boundary\n                var s = shft(pos) + 4, l = dat[s - 4] | (dat[s - 3] << 8), t = s + l;\n                if (t > sl) {\n                    if (noSt)\n                        throw 'unexpected EOF';\n                    break;\n                }\n                // ensure size\n                if (noBuf)\n                    cbuf(bt + l);\n                // Copy over uncompressed data\n                buf.set(dat.subarray(s, t), bt);\n                // Get new bitpos, update byte count\n                st.b = bt += l, st.p = pos = t * 8;\n                continue;\n            }\n            else if (type == 1)\n                lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n            else if (type == 2) {\n                //  literal                            lengths\n                var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n                var tl = hLit + bits(dat, pos + 5, 31) + 1;\n                pos += 14;\n                // length+distance tree\n                var ldt = new u8(tl);\n                // code length tree\n                var clt = new u8(19);\n                for (var i = 0; i < hcLen; ++i) {\n                    // use index map to get real code\n                    clt[clim[i]] = bits(dat, pos + i * 3, 7);\n                }\n                pos += hcLen * 3;\n                // code lengths bits\n                var clb = max(clt), clbmsk = (1 << clb) - 1;\n                if (!noSt && pos + tl * (clb + 7) > tbts)\n                    break;\n                // code lengths map\n                var clm = hMap(clt, clb, 1);\n                for (var i = 0; i < tl;) {\n                    var r = clm[bits(dat, pos, clbmsk)];\n                    // bits read\n                    pos += r & 15;\n                    // symbol\n                    var s = r >>> 4;\n                    // code length to copy\n                    if (s < 16) {\n                        ldt[i++] = s;\n                    }\n                    else {\n                        //  copy   count\n                        var c = 0, n = 0;\n                        if (s == 16)\n                            n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n                        else if (s == 17)\n                            n = 3 + bits(dat, pos, 7), pos += 3;\n                        else if (s == 18)\n                            n = 11 + bits(dat, pos, 127), pos += 7;\n                        while (n--)\n                            ldt[i++] = c;\n                    }\n                }\n                //    length tree                 distance tree\n                var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n                // max length bits\n                lbt = max(lt);\n                // max dist bits\n                dbt = max(dt);\n                lm = hMap(lt, lbt, 1);\n                dm = hMap(dt, dbt, 1);\n            }\n            else\n                throw 'invalid block type';\n            if (pos > tbts)\n                throw 'unexpected EOF';\n        }\n        // Make sure the buffer can hold this + the largest possible addition\n        // Maximum chunk size (practically, theoretically infinite) is 2^17;\n        if (noBuf)\n            cbuf(bt + 131072);\n        var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n        var mxa = lbt + dbt + 18;\n        while (noSt || pos + mxa < tbts) {\n            // bits read, code\n            var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n            pos += c & 15;\n            if (pos > tbts)\n                throw 'unexpected EOF';\n            if (!c)\n                throw 'invalid length/literal';\n            if (sym < 256)\n                buf[bt++] = sym;\n            else if (sym == 256) {\n                lm = null;\n                break;\n            }\n            else {\n                var add = sym - 254;\n                // no extra bits needed if less\n                if (sym > 264) {\n                    // index\n                    var i = sym - 257, b = fleb[i];\n                    add = bits(dat, pos, (1 << b) - 1) + fl[i];\n                    pos += b;\n                }\n                // dist\n                var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n                if (!d)\n                    throw 'invalid distance';\n                pos += d & 15;\n                var dt = fd[dsym];\n                if (dsym > 3) {\n                    var b = fdeb[dsym];\n                    dt += bits16(dat, pos) & ((1 << b) - 1), pos += b;\n                }\n                if (pos > tbts)\n                    throw 'unexpected EOF';\n                if (noBuf)\n                    cbuf(bt + 131072);\n                var end = bt + add;\n                for (; bt < end; bt += 4) {\n                    buf[bt] = buf[bt - dt];\n                    buf[bt + 1] = buf[bt + 1 - dt];\n                    buf[bt + 2] = buf[bt + 2 - dt];\n                    buf[bt + 3] = buf[bt + 3 - dt];\n                }\n                bt = end;\n            }\n        }\n        st.l = lm, st.p = pos, st.b = bt;\n        if (lm)\n            final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n    } while (!final);\n    return bt == buf.length ? buf : slc(buf, 0, bt);\n};\n// starting at p, write the minimum number of bits that can hold v to d\nvar wbits = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n};\n// starting at p, write the minimum number of bits (>8) that can hold v to d\nvar wbits16 = function (d, p, v) {\n    v <<= p & 7;\n    var o = (p / 8) >> 0;\n    d[o] |= v;\n    d[o + 1] |= v >>> 8;\n    d[o + 2] |= v >>> 16;\n};\n// creates code lengths from a frequency table\nvar hTree = function (d, mb) {\n    // Need extra info to make a tree\n    var t = [];\n    for (var i = 0; i < d.length; ++i) {\n        if (d[i])\n            t.push({ s: i, f: d[i] });\n    }\n    var s = t.length;\n    var t2 = t.slice();\n    if (!s)\n        return [new u8(0), 0];\n    if (s == 1) {\n        var v = new u8(t[0].s + 1);\n        v[t[0].s] = 1;\n        return [v, 1];\n    }\n    t.sort(function (a, b) { return a.f - b.f; });\n    // after i2 reaches last ind, will be stopped\n    // freq must be greater than largest possible number of symbols\n    t.push({ s: -1, f: 25001 });\n    var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n    t[0] = { s: -1, f: l.f + r.f, l: l, r: r };\n    // efficient algorithm from UZIP.js\n    // i0 is lookbehind, i2 is lookahead - after processing two low-freq\n    // symbols that combined have high freq, will start processing i2 (high-freq,\n    // non-composite) symbols instead\n    // see https://reddit.com/r/photopea/comments/ikekht/uzipjs_questions/\n    while (i1 != s - 1) {\n        l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n        r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n        t[i1++] = { s: -1, f: l.f + r.f, l: l, r: r };\n    }\n    var maxSym = t2[0].s;\n    for (var i = 1; i < s; ++i) {\n        if (t2[i].s > maxSym)\n            maxSym = t2[i].s;\n    }\n    // code lengths\n    var tr = new u16(maxSym + 1);\n    // max bits in tree\n    var mbt = ln(t[i1 - 1], tr, 0);\n    if (mbt > mb) {\n        // more algorithms from UZIP.js\n        // TODO: find out how this code works (debt)\n        //  ind    debt\n        var i = 0, dt = 0;\n        //    left            cost\n        var lft = mbt - mb, cst = 1 << lft;\n        t2.sort(function (a, b) { return tr[b.s] - tr[a.s] || a.f - b.f; });\n        for (; i < s; ++i) {\n            var i2_1 = t2[i].s;\n            if (tr[i2_1] > mb) {\n                dt += cst - (1 << (mbt - tr[i2_1]));\n                tr[i2_1] = mb;\n            }\n            else\n                break;\n        }\n        dt >>>= lft;\n        while (dt > 0) {\n            var i2_2 = t2[i].s;\n            if (tr[i2_2] < mb)\n                dt -= 1 << (mb - tr[i2_2]++ - 1);\n            else\n                ++i;\n        }\n        for (; i >= 0 && dt; --i) {\n            var i2_3 = t2[i].s;\n            if (tr[i2_3] == mb) {\n                --tr[i2_3];\n                ++dt;\n            }\n        }\n        mbt = mb;\n    }\n    return [new u8(tr), mbt];\n};\n// get the max length and assign length codes\nvar ln = function (n, l, d) {\n    return n.s == -1\n        ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1))\n        : (l[n.s] = d);\n};\n// length codes generation\nvar lc = function (c) {\n    var s = c.length;\n    // Note that the semicolon was intentional\n    while (s && !c[--s])\n        ;\n    var cl = new u16(++s);\n    //  ind      num         streak\n    var cli = 0, cln = c[0], cls = 1;\n    var w = function (v) { cl[cli++] = v; };\n    for (var i = 1; i <= s; ++i) {\n        if (c[i] == cln && i != s)\n            ++cls;\n        else {\n            if (!cln && cls > 2) {\n                for (; cls > 138; cls -= 138)\n                    w(32754);\n                if (cls > 2) {\n                    w(cls > 10 ? ((cls - 11) << 5) | 28690 : ((cls - 3) << 5) | 12305);\n                    cls = 0;\n                }\n            }\n            else if (cls > 3) {\n                w(cln), --cls;\n                for (; cls > 6; cls -= 6)\n                    w(8304);\n                if (cls > 2)\n                    w(((cls - 3) << 5) | 8208), cls = 0;\n            }\n            while (cls--)\n                w(cln);\n            cls = 1;\n            cln = c[i];\n        }\n    }\n    return [cl.subarray(0, cli), s];\n};\n// calculate the length of output from tree, code lengths\nvar clen = function (cf, cl) {\n    var l = 0;\n    for (var i = 0; i < cl.length; ++i)\n        l += cf[i] * cl[i];\n    return l;\n};\n// writes a fixed block\n// returns the new bit pos\nvar wfblk = function (out, pos, dat) {\n    // no need to write 00 as type: TypedArray defaults to 0\n    var s = dat.length;\n    var o = shft(pos + 2);\n    out[o] = s & 255;\n    out[o + 1] = s >>> 8;\n    out[o + 2] = out[o] ^ 255;\n    out[o + 3] = out[o + 1] ^ 255;\n    for (var i = 0; i < s; ++i)\n        out[o + i + 4] = dat[i];\n    return (o + 4 + s) * 8;\n};\n// writes a block\nvar wblk = function (dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n    wbits(out, p++, final);\n    ++lf[256];\n    var _a = hTree(lf, 15), dlt = _a[0], mlb = _a[1];\n    var _b = hTree(df, 15), ddt = _b[0], mdb = _b[1];\n    var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n    var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n    var lcfreq = new u16(19);\n    for (var i = 0; i < lclt.length; ++i)\n        lcfreq[lclt[i] & 31]++;\n    for (var i = 0; i < lcdt.length; ++i)\n        lcfreq[lcdt[i] & 31]++;\n    var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n    var nlcc = 19;\n    for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n        ;\n    var flen = (bl + 5) << 3;\n    var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n    var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n    if (flen <= ftlen && flen <= dtlen)\n        return wfblk(out, p, dat.subarray(bs, bs + bl));\n    var lm, ll, dm, dl;\n    wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n    if (dtlen < ftlen) {\n        lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n        var llm = hMap(lct, mlcb, 0);\n        wbits(out, p, nlc - 257);\n        wbits(out, p + 5, ndc - 1);\n        wbits(out, p + 10, nlcc - 4);\n        p += 14;\n        for (var i = 0; i < nlcc; ++i)\n            wbits(out, p + 3 * i, lct[clim[i]]);\n        p += 3 * nlcc;\n        var lcts = [lclt, lcdt];\n        for (var it = 0; it < 2; ++it) {\n            var clct = lcts[it];\n            for (var i = 0; i < clct.length; ++i) {\n                var len = clct[i] & 31;\n                wbits(out, p, llm[len]), p += lct[len];\n                if (len > 15)\n                    wbits(out, p, (clct[i] >>> 5) & 127), p += clct[i] >>> 12;\n            }\n        }\n    }\n    else {\n        lm = flm, ll = flt, dm = fdm, dl = fdt;\n    }\n    for (var i = 0; i < li; ++i) {\n        if (syms[i] > 255) {\n            var len = (syms[i] >>> 18) & 31;\n            wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n            if (len > 7)\n                wbits(out, p, (syms[i] >>> 23) & 31), p += fleb[len];\n            var dst = syms[i] & 31;\n            wbits16(out, p, dm[dst]), p += dl[dst];\n            if (dst > 3)\n                wbits16(out, p, (syms[i] >>> 5) & 8191), p += fdeb[dst];\n        }\n        else {\n            wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n        }\n    }\n    wbits16(out, p, lm[256]);\n    return p + ll[256];\n};\n// deflate options (nice << 13) | chain\nvar deo = /*#__PURE__*/ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\n// empty\nvar et = /*#__PURE__*/ new u8(0);\n// compresses data into a raw DEFLATE buffer\nvar dflt = function (dat, lvl, plvl, pre, post, lst) {\n    var s = dat.length;\n    var o = new u8(pre + s + 5 * (1 + Math.floor(s / 7000)) + post);\n    // writing to this writes to the output buffer\n    var w = o.subarray(pre, o.length - post);\n    var pos = 0;\n    if (!lvl || s < 8) {\n        for (var i = 0; i <= s; i += 65535) {\n            // end\n            var e = i + 65535;\n            if (e < s) {\n                // write full block\n                pos = wfblk(w, pos, dat.subarray(i, e));\n            }\n            else {\n                // write final block\n                w[i] = lst;\n                pos = wfblk(w, pos, dat.subarray(i, s));\n            }\n        }\n    }\n    else {\n        var opt = deo[lvl - 1];\n        var n = opt >>> 13, c = opt & 8191;\n        var msk_1 = (1 << plvl) - 1;\n        //    prev 2-byte val map    curr 2-byte val map\n        var prev = new u16(32768), head = new u16(msk_1 + 1);\n        var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n        var hsh = function (i) { return (dat[i] ^ (dat[i + 1] << bs1_1) ^ (dat[i + 2] << bs2_1)) & msk_1; };\n        // 24576 is an arbitrary number of maximum symbols per block\n        // 424 buffer for last block\n        var syms = new u32(25000);\n        // length/literal freq   distance freq\n        var lf = new u16(288), df = new u16(32);\n        //  l/lcnt  exbits  index  l/lind  waitdx  bitpos\n        var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n        for (; i < s; ++i) {\n            // hash value\n            var hv = hsh(i);\n            // index mod 32768\n            var imod = i & 32767;\n            // previous index with this value\n            var pimod = head[hv];\n            prev[imod] = pimod;\n            head[hv] = imod;\n            // We always should modify head and prev, but only add symbols if\n            // this data is not yet processed (\"wait\" for wait index)\n            if (wi <= i) {\n                // bytes remaining\n                var rem = s - i;\n                if ((lc_1 > 7000 || li > 24576) && rem > 423) {\n                    pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n                    li = lc_1 = eb = 0, bs = i;\n                    for (var j = 0; j < 286; ++j)\n                        lf[j] = 0;\n                    for (var j = 0; j < 30; ++j)\n                        df[j] = 0;\n                }\n                //  len    dist   chain\n                var l = 2, d = 0, ch_1 = c, dif = (imod - pimod) & 32767;\n                if (rem > 2 && hv == hsh(i - dif)) {\n                    var maxn = Math.min(n, rem) - 1;\n                    var maxd = Math.min(32767, i);\n                    // max possible length\n                    // not capped at dif because decompressors implement \"rolling\" index population\n                    var ml = Math.min(258, rem);\n                    while (dif <= maxd && --ch_1 && imod != pimod) {\n                        if (dat[i + l] == dat[i + l - dif]) {\n                            var nl = 0;\n                            for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                                ;\n                            if (nl > l) {\n                                l = nl, d = dif;\n                                // break out early when we reach \"nice\" (we are satisfied enough)\n                                if (nl > maxn)\n                                    break;\n                                // now, find the rarest 2-byte sequence within this\n                                // length of literals and search for that instead.\n                                // Much faster than just using the start\n                                var mmd = Math.min(dif, nl - 2);\n                                var md = 0;\n                                for (var j = 0; j < mmd; ++j) {\n                                    var ti = (i - dif + j + 32768) & 32767;\n                                    var pti = prev[ti];\n                                    var cd = (ti - pti + 32768) & 32767;\n                                    if (cd > md)\n                                        md = cd, pimod = ti;\n                                }\n                            }\n                        }\n                        // check the previous match\n                        imod = pimod, pimod = prev[imod];\n                        dif += (imod - pimod + 32768) & 32767;\n                    }\n                }\n                // d will be nonzero only when a match was found\n                if (d) {\n                    // store both dist and len data in one Uint32\n                    // Make sure this is recognized as a len/dist with 28th bit (2^28)\n                    syms[li++] = 268435456 | (revfl[l] << 18) | revfd[d];\n                    var lin = revfl[l] & 31, din = revfd[d] & 31;\n                    eb += fleb[lin] + fdeb[din];\n                    ++lf[257 + lin];\n                    ++df[din];\n                    wi = i + l;\n                    ++lc_1;\n                }\n                else {\n                    syms[li++] = dat[i];\n                    ++lf[dat[i]];\n                }\n            }\n        }\n        pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n        // this is the easiest way to avoid needing to maintain state\n        if (!lst)\n            pos = wfblk(w, pos, et);\n    }\n    return slc(o, 0, pre + shft(pos) + post);\n};\n// CRC32 table\nvar crct = /*#__PURE__*/ (function () {\n    var t = new u32(256);\n    for (var i = 0; i < 256; ++i) {\n        var c = i, k = 9;\n        while (--k)\n            c = ((c & 1) && 0xEDB88320) ^ (c >>> 1);\n        t[i] = c;\n    }\n    return t;\n})();\n// CRC32\nvar crc = function () {\n    var c = 0xFFFFFFFF;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var cr = c;\n            for (var i = 0; i < d.length; ++i)\n                cr = crct[(cr & 255) ^ d[i]] ^ (cr >>> 8);\n            c = cr;\n        },\n        d: function () { return c ^ 0xFFFFFFFF; }\n    };\n};\n// Alder32\nvar adler = function () {\n    var a = 1, b = 0;\n    return {\n        p: function (d) {\n            // closures have awful performance\n            var n = a, m = b;\n            var l = d.length;\n            for (var i = 0; i != l;) {\n                var e = Math.min(i + 5552, l);\n                for (; i < e; ++i)\n                    n += d[i], m += n;\n                n %= 65521, m %= 65521;\n            }\n            a = n, b = m;\n        },\n        d: function () { return ((a >>> 8) << 16 | (b & 255) << 8 | (b >>> 8)) + ((a & 255) << 23) * 2; }\n    };\n};\n;\n// deflate with opts\nvar dopt = function (dat, opt, pre, post, st) {\n    return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : (12 + opt.mem), pre, post, !st);\n};\n// Walmart object spread\nvar mrg = function (a, b) {\n    var o = {};\n    for (var k in a)\n        o[k] = a[k];\n    for (var k in b)\n        o[k] = b[k];\n    return o;\n};\n// worker clone\n// This is possibly the craziest part of the entire codebase, despite how simple it may seem.\n// The only parameter to this function is a closure that returns an array of variables outside of the function scope.\n// We're going to try to figure out the variable names used in the closure as strings because that is crucial for workerization.\n// We will return an object mapping of true variable name to value (basically, the current scope as a JS object).\n// The reason we can't just use the original variable names is minifiers mangling the toplevel scope.\n// This took me three weeks to figure out how to do.\nvar wcln = function (fn, fnStr, td) {\n    var dt = fn();\n    var st = fn.toString();\n    var ks = st.slice(st.indexOf('[') + 1, st.lastIndexOf(']')).replace(/ /g, '').split(',');\n    for (var i = 0; i < dt.length; ++i) {\n        var v = dt[i], k = ks[i];\n        if (typeof v == 'function') {\n            fnStr += ';' + k + '=';\n            var st_1 = v.toString();\n            if (v.prototype) {\n                // for global objects\n                if (st_1.indexOf('[native code]') != -1) {\n                    var spInd = st_1.indexOf(' ', 8) + 1;\n                    fnStr += st_1.slice(spInd, st_1.indexOf('(', spInd));\n                }\n                else {\n                    fnStr += st_1;\n                    for (var t in v.prototype)\n                        fnStr += ';' + k + '.prototype.' + t + '=' + v.prototype[t].toString();\n                }\n            }\n            else\n                fnStr += st_1;\n        }\n        else\n            td[k] = v;\n    }\n    return [fnStr, td];\n};\nvar ch = [];\n// clone bufs\nvar cbfs = function (v) {\n    var tl = [];\n    for (var k in v) {\n        if (v[k] instanceof u8 || v[k] instanceof u16 || v[k] instanceof u32)\n            tl.push((v[k] = new v[k].constructor(v[k])).buffer);\n    }\n    return tl;\n};\n// use a worker to execute code\nvar wrkr = function (fns, init, id, cb) {\n    var _a;\n    if (!ch[id]) {\n        var fnStr = '', td_1 = {}, m = fns.length - 1;\n        for (var i = 0; i < m; ++i)\n            _a = wcln(fns[i], fnStr, td_1), fnStr = _a[0], td_1 = _a[1];\n        ch[id] = wcln(fns[m], fnStr, td_1);\n    }\n    var td = mrg({}, ch[id][1]);\n    return wk(ch[id][0] + ';onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage=' + init.toString() + '}', id, td, cbfs(td), cb);\n};\n// base async inflate fn\nvar bInflt = function () { return [u8, u16, u32, fleb, fdeb, clim, fl, fd, flrm, fdrm, rev, hMap, max, bits, bits16, shft, slc, inflt, inflateSync, pbf, gu8]; };\nvar bDflt = function () { return [u8, u16, u32, fleb, fdeb, clim, revfl, revfd, flm, flt, fdm, fdt, rev, deo, et, hMap, wbits, wbits16, hTree, ln, lc, clen, wfblk, wblk, shft, slc, dflt, dopt, deflateSync, pbf]; };\n// gzip extra\nvar gze = function () { return [gzh, gzhl, wbytes, crc, crct]; };\n// gunzip extra\nvar guze = function () { return [gzs, gzl]; };\n// zlib extra\nvar zle = function () { return [zlh, wbytes, adler]; };\n// unzlib extra\nvar zule = function () { return [zlv]; };\n// post buf\nvar pbf = function (msg) { return postMessage(msg, [msg.buffer]); };\n// get u8\nvar gu8 = function (o) { return o && o.size && new u8(o.size); };\n// async helper\nvar cbify = function (dat, opts, fns, init, id, cb) {\n    var w = wrkr(fns, init, id, function (err, dat) {\n        w.terminate();\n        cb(err, dat);\n    });\n    if (!opts.consume)\n        dat = new u8(dat);\n    w.postMessage([dat, opts], [dat.buffer]);\n    return function () { w.terminate(); };\n};\n// auto stream\nvar astrm = function (strm) {\n    strm.ondata = function (dat, final) { return postMessage([dat, final], [dat.buffer]); };\n    return function (ev) { return strm.push(ev.data[0], ev.data[1]); };\n};\n// async stream attach\nvar astrmify = function (fns, strm, opts, init, id) {\n    var t;\n    var w = wrkr(fns, init, id, function (err, dat) {\n        if (err)\n            w.terminate(), strm.ondata.call(strm, err);\n        else {\n            if (dat[1])\n                w.terminate();\n            strm.ondata.call(strm, err, dat[0], dat[1]);\n        }\n    });\n    w.postMessage(opts);\n    strm.push = function (d, f) {\n        if (t)\n            throw 'stream finished';\n        if (!strm.ondata)\n            throw 'no stream handler';\n        w.postMessage([d, t = f], [d.buffer]);\n    };\n    strm.terminate = function () { w.terminate(); };\n};\n// read 2 bytes\nvar b2 = function (d, b) { return d[b] | (d[b + 1] << 8); };\n// read 4 bytes\nvar b4 = function (d, b) { return (d[b] | (d[b + 1] << 8) | (d[b + 2] << 16)) + (d[b + 3] << 23) * 2; };\n// write bytes\nvar wbytes = function (d, b, v) {\n    for (; v; ++b)\n        d[b] = v, v >>>= 8;\n};\n// gzip header\nvar gzh = function (c, o) {\n    var fn = o.filename;\n    c[0] = 31, c[1] = 139, c[2] = 8, c[8] = o.level < 2 ? 4 : o.level == 9 ? 2 : 0, c[9] = 3; // assume Unix\n    if (o.mtime != 0)\n        wbytes(c, 4, Math.floor(new Date(o.mtime || Date.now()) / 1000));\n    if (fn) {\n        c[3] = 8;\n        for (var i = 0; i <= fn.length; ++i)\n            c[i + 10] = fn.charCodeAt(i);\n    }\n};\n// gzip footer: -8 to -4 = CRC, -4 to -0 is length\n// gzip start\nvar gzs = function (d) {\n    if (d[0] != 31 || d[1] != 139 || d[2] != 8)\n        throw 'invalid gzip data';\n    var flg = d[3];\n    var st = 10;\n    if (flg & 4)\n        st += d[10] | (d[11] << 8) + 2;\n    for (var zs = (flg >> 3 & 1) + (flg >> 4 & 1); zs > 0; zs -= !d[st++])\n        ;\n    return st + (flg & 2);\n};\n// gzip length\nvar gzl = function (d) {\n    var l = d.length;\n    return (d[l - 4] | d[l - 3] << 8 | d[l - 2] << 16) + (2 * (d[l - 1] << 23));\n};\n// gzip header length\nvar gzhl = function (o) { return 10 + ((o.filename && (o.filename.length + 1)) || 0); };\n// zlib header\nvar zlh = function (c, o) {\n    var lv = o.level, fl = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n    c[0] = 120, c[1] = (fl << 6) | (fl ? (32 - 2 * fl) : 1);\n};\n// zlib valid\nvar zlv = function (d) {\n    if ((d[0] & 15) != 8 || (d[0] >>> 4) > 7 || ((d[0] << 8 | d[1]) % 31))\n        throw 'invalid zlib data';\n    if (d[1] & 32)\n        throw 'invalid zlib data: preset dictionaries not supported';\n};\nfunction AsyncCmpStrm(opts, cb) {\n    if (!cb && typeof opts == 'function')\n        cb = opts, opts = {};\n    this.ondata = cb;\n    return opts;\n}\n// zlib footer: -4 to -0 is Adler32\n/**\n * Streaming DEFLATE compression\n */\nvar Deflate = /*#__PURE__*/ (function () {\n    function Deflate(opts, cb) {\n        if (!cb && typeof opts == 'function')\n            cb = opts, opts = {};\n        this.ondata = cb;\n        this.o = opts || {};\n    }\n    Deflate.prototype.p = function (c, f) {\n        this.ondata(dopt(c, this.o, 0, 0, !f), f);\n    };\n    /**\n     * Pushes a chunk to be deflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Deflate.prototype.push = function (chunk, final) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        this.d = final;\n        this.p(chunk, final || false);\n    };\n    return Deflate;\n}());\nexport { Deflate };\n/**\n * Asynchronous streaming DEFLATE compression\n */\nvar AsyncDeflate = /*#__PURE__*/ (function () {\n    function AsyncDeflate(opts, cb) {\n        astrmify([\n            bDflt,\n            function () { return [astrm, Deflate]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Deflate(ev.data);\n            onmessage = astrm(strm);\n        }, 6);\n    }\n    return AsyncDeflate;\n}());\nexport { AsyncDeflate };\nexport function deflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n    ], function (ev) { return pbf(deflateSync(ev.data[0], ev.data[1])); }, 0, cb);\n}\n/**\n * Compresses data with DEFLATE without any wrapper\n * @param data The data to compress\n * @param opts The compression options\n * @returns The deflated version of the data\n */\nexport function deflateSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    return dopt(data, opts, 0, 0);\n}\n/**\n * Streaming DEFLATE decompression\n */\nvar Inflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an inflation stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Inflate(cb) {\n        this.s = {};\n        this.p = new u8(0);\n        this.ondata = cb;\n    }\n    Inflate.prototype.e = function (c) {\n        if (this.d)\n            throw 'stream finished';\n        if (!this.ondata)\n            throw 'no stream handler';\n        var l = this.p.length;\n        var n = new u8(l + c.length);\n        n.set(this.p), n.set(c, l), this.p = n;\n    };\n    Inflate.prototype.c = function (final) {\n        this.d = this.s.i = final || false;\n        var bts = this.s.b;\n        var dt = inflt(this.p, this.o, this.s);\n        this.ondata(slc(dt, bts, this.s.b), this.d);\n        this.o = slc(dt, this.s.b - 32768), this.s.b = this.o.length;\n        this.p = slc(this.p, (this.s.p / 8) >> 0), this.s.p &= 7;\n    };\n    /**\n     * Pushes a chunk to be inflated\n     * @param chunk The chunk to push\n     * @param final Whether this is the final chunk\n     */\n    Inflate.prototype.push = function (chunk, final) {\n        this.e(chunk), this.c(final);\n    };\n    return Inflate;\n}());\nexport { Inflate };\n/**\n * Asynchronous streaming DEFLATE decompression\n */\nvar AsyncInflate = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous inflation stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncInflate(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            function () { return [astrm, Inflate]; }\n        ], this, 0, function () {\n            var strm = new Inflate();\n            onmessage = astrm(strm);\n        }, 7);\n    }\n    return AsyncInflate;\n}());\nexport { AsyncInflate };\nexport function inflate(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt\n    ], function (ev) { return pbf(inflateSync(ev.data[0], gu8(ev.data[1]))); }, 1, cb);\n}\n/**\n * Expands DEFLATE data with no wrapper\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function inflateSync(data, out) {\n    return inflt(data, out);\n}\n// before you yell at me for not just using extends, my reason is that TS inheritance is hard to workerize.\n/**\n * Streaming GZIP compression\n */\nvar Gzip = /*#__PURE__*/ (function () {\n    function Gzip(opts, cb) {\n        this.c = crc();\n        this.l = 0;\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be GZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gzip.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Gzip.prototype.p = function (c, f) {\n        this.c.p(c);\n        this.l += c.length;\n        var raw = dopt(c, this.o, this.v && gzhl(this.o), f && 8, !f);\n        if (this.v)\n            gzh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 8, this.c.d()), wbytes(raw, raw.length - 4, this.l);\n        this.ondata(raw, f);\n    };\n    return Gzip;\n}());\nexport { Gzip };\n/**\n * Asynchronous streaming GZIP compression\n */\nvar AsyncGzip = /*#__PURE__*/ (function () {\n    function AsyncGzip(opts, cb) {\n        astrmify([\n            bDflt,\n            gze,\n            function () { return [astrm, Deflate, Gzip]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Gzip(ev.data);\n            onmessage = astrm(strm);\n        }, 8);\n    }\n    return AsyncGzip;\n}());\nexport { AsyncGzip };\nexport function gzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        gze,\n        function () { return [gzipSync]; }\n    ], function (ev) { return pbf(gzipSync(ev.data[0], ev.data[1])); }, 2, cb);\n}\n/**\n * Compresses data with GZIP\n * @param data The data to compress\n * @param opts The compression options\n * @returns The gzipped version of the data\n */\nexport function gzipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var c = crc(), l = data.length;\n    c.p(data);\n    var d = dopt(data, opts, gzhl(opts), 8), s = d.length;\n    return gzh(d, opts), wbytes(d, s - 8, c.d()), wbytes(d, s - 4, l), d;\n}\n/**\n * Streaming GZIP decompression\n */\nvar Gunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates a GUNZIP stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Gunzip(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be GUNZIPped\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Gunzip.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            var s = gzs(this.p);\n            if (s >= this.p.length && !final)\n                return;\n            this.p = this.p.subarray(s), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 8)\n                throw 'invalid gzip stream';\n            this.p = this.p.subarray(0, -8);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Gunzip;\n}());\nexport { Gunzip };\n/**\n * Asynchronous streaming GZIP decompression\n */\nvar AsyncGunzip = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous GUNZIP stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncGunzip(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            guze,\n            function () { return [astrm, Inflate, Gunzip]; }\n        ], this, 0, function () {\n            var strm = new Gunzip();\n            onmessage = astrm(strm);\n        }, 9);\n    }\n    return AsyncGunzip;\n}());\nexport { AsyncGunzip };\nexport function gunzip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        guze,\n        function () { return [gunzipSync]; }\n    ], function (ev) { return pbf(gunzipSync(ev.data[0])); }, 3, cb);\n}\n/**\n * Expands GZIP data\n * @param data The data to decompress\n * @param out Where to write the data. GZIP already encodes the output size, so providing this doesn't save memory.\n * @returns The decompressed version of the data\n */\nexport function gunzipSync(data, out) {\n    return inflt(data.subarray(gzs(data), -8), out || new u8(gzl(data)));\n}\n/**\n * Streaming Zlib compression\n */\nvar Zlib = /*#__PURE__*/ (function () {\n    function Zlib(opts, cb) {\n        this.c = adler();\n        this.v = 1;\n        Deflate.call(this, opts, cb);\n    }\n    /**\n     * Pushes a chunk to be zlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Zlib.prototype.push = function (chunk, final) {\n        Deflate.prototype.push.call(this, chunk, final);\n    };\n    Zlib.prototype.p = function (c, f) {\n        this.c.p(c);\n        var raw = dopt(c, this.o, this.v && 2, f && 4, !f);\n        if (this.v)\n            zlh(raw, this.o), this.v = 0;\n        if (f)\n            wbytes(raw, raw.length - 4, this.c.d());\n        this.ondata(raw, f);\n    };\n    return Zlib;\n}());\nexport { Zlib };\n/**\n * Asynchronous streaming Zlib compression\n */\nvar AsyncZlib = /*#__PURE__*/ (function () {\n    function AsyncZlib(opts, cb) {\n        astrmify([\n            bDflt,\n            zle,\n            function () { return [astrm, Deflate, Zlib]; }\n        ], this, AsyncCmpStrm.call(this, opts, cb), function (ev) {\n            var strm = new Zlib(ev.data);\n            onmessage = astrm(strm);\n        }, 10);\n    }\n    return AsyncZlib;\n}());\nexport { AsyncZlib };\nexport function zlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bDflt,\n        zle,\n        function () { return [zlibSync]; }\n    ], function (ev) { return pbf(zlibSync(ev.data[0], ev.data[1])); }, 4, cb);\n}\n/**\n * Compress data with Zlib\n * @param data The data to compress\n * @param opts The compression options\n * @returns The zlib-compressed version of the data\n */\nexport function zlibSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var a = adler();\n    a.p(data);\n    var d = dopt(data, opts, 2, 4);\n    return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\n/**\n * Streaming Zlib decompression\n */\nvar Unzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates a Zlib decompression stream\n     * @param cb The callback to call whenever data is inflated\n     */\n    function Unzlib(cb) {\n        this.v = 1;\n        Inflate.call(this, cb);\n    }\n    /**\n     * Pushes a chunk to be unzlibbed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Unzlib.prototype.push = function (chunk, final) {\n        Inflate.prototype.e.call(this, chunk);\n        if (this.v) {\n            if (this.p.length < 2 && !final)\n                return;\n            this.p = this.p.subarray(2), this.v = 0;\n        }\n        if (final) {\n            if (this.p.length < 4)\n                throw 'invalid zlib stream';\n            this.p = this.p.subarray(0, -4);\n        }\n        // necessary to prevent TS from using the closure value\n        // This allows for workerization to function correctly\n        Inflate.prototype.c.call(this, final);\n    };\n    return Unzlib;\n}());\nexport { Unzlib };\n/**\n * Asynchronous streaming Zlib decompression\n */\nvar AsyncUnzlib = /*#__PURE__*/ (function () {\n    /**\n     * Creates an asynchronous Zlib decompression stream\n     * @param cb The callback to call whenever data is deflated\n     */\n    function AsyncUnzlib(cb) {\n        this.ondata = cb;\n        astrmify([\n            bInflt,\n            zule,\n            function () { return [astrm, Inflate, Unzlib]; }\n        ], this, 0, function () {\n            var strm = new Unzlib();\n            onmessage = astrm(strm);\n        }, 11);\n    }\n    return AsyncUnzlib;\n}());\nexport { AsyncUnzlib };\nexport function unzlib(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return cbify(data, opts, [\n        bInflt,\n        zule,\n        function () { return [unzlibSync]; }\n    ], function (ev) { return pbf(unzlibSync(ev.data[0], gu8(ev.data[1]))); }, 5, cb);\n}\n/**\n * Expands Zlib data\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function unzlibSync(data, out) {\n    return inflt((zlv(data), data.subarray(2, -4)), out);\n}\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzip as compress, AsyncGzip as AsyncCompress };\n// Default algorithm for compression (used because having a known output size allows faster decompression)\nexport { gzipSync as compressSync, Gzip as Compress };\n/**\n * Streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar Decompress = /*#__PURE__*/ (function () {\n    /**\n     * Creates a decompression stream\n     * @param cb The callback to call whenever data is decompressed\n     */\n    function Decompress(cb) {\n        this.G = Gunzip;\n        this.I = Inflate;\n        this.Z = Unzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    Decompress.prototype.push = function (chunk, final) {\n        if (!this.ondata)\n            throw 'no stream handler';\n        if (!this.s) {\n            if (this.p && this.p.length) {\n                var n = new u8(this.p.length + chunk.length);\n                n.set(this.p), n.set(chunk, this.p.length);\n            }\n            else\n                this.p = chunk;\n            if (this.p.length > 2) {\n                var _this_1 = this;\n                var cb = function () { _this_1.ondata.apply(_this_1, arguments); };\n                this.s = (this.p[0] == 31 && this.p[1] == 139 && this.p[2] == 8)\n                    ? new this.G(cb)\n                    : ((this.p[0] & 15) != 8 || (this.p[0] >> 4) > 7 || ((this.p[0] << 8 | this.p[1]) % 31))\n                        ? new this.I(cb)\n                        : new this.Z(cb);\n                this.s.push(this.p, final);\n                this.p = null;\n            }\n        }\n        else\n            this.s.push(chunk, final);\n    };\n    return Decompress;\n}());\nexport { Decompress };\n/**\n * Asynchronous streaming GZIP, Zlib, or raw DEFLATE decompression\n */\nvar AsyncDecompress = /*#__PURE__*/ (function () {\n    /**\n   * Creates an asynchronous decompression stream\n   * @param cb The callback to call whenever data is decompressed\n   */\n    function AsyncDecompress(cb) {\n        this.G = AsyncGunzip;\n        this.I = AsyncInflate;\n        this.Z = AsyncUnzlib;\n        this.ondata = cb;\n    }\n    /**\n     * Pushes a chunk to be decompressed\n     * @param chunk The chunk to push\n     * @param final Whether this is the last chunk\n     */\n    AsyncDecompress.prototype.push = function (chunk, final) {\n        Decompress.prototype.push.call(this, chunk, final);\n    };\n    return AsyncDecompress;\n}());\nexport { AsyncDecompress };\nexport function decompress(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzip(data, opts, cb)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflate(data, opts, cb)\n            : unzlib(data, opts, cb);\n}\n/**\n * Expands compressed GZIP, Zlib, or raw DEFLATE data, automatically detecting the format\n * @param data The data to decompress\n * @param out Where to write the data. Saves memory if you know the decompressed size and provide an output buffer of that length.\n * @returns The decompressed version of the data\n */\nexport function decompressSync(data, out) {\n    return (data[0] == 31 && data[1] == 139 && data[2] == 8)\n        ? gunzipSync(data, out)\n        : ((data[0] & 15) != 8 || (data[0] >> 4) > 7 || ((data[0] << 8 | data[1]) % 31))\n            ? inflateSync(data, out)\n            : unzlibSync(data, out);\n}\n// flatten a directory structure\nvar fltn = function (d, p, t, o) {\n    for (var k in d) {\n        var val = d[k], n = p + k;\n        if (val instanceof u8)\n            t[n] = [val, o];\n        else if (Array.isArray(val))\n            t[n] = [val[0], mrg(o, val[1])];\n        else\n            fltn(val, n + '/', t, o);\n    }\n};\n/**\n * Converts a string into a Uint8Array for use with compression/decompression methods\n * @param str The string to encode\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless decoding a binary string.\n * @returns The string encoded in UTF-8/Latin-1 binary\n */\nexport function strToU8(str, latin1) {\n    var l = str.length;\n    if (!latin1 && typeof TextEncoder != 'undefined')\n        return new TextEncoder().encode(str);\n    var ar = new u8(str.length + (str.length >>> 1));\n    var ai = 0;\n    var w = function (v) { ar[ai++] = v; };\n    for (var i = 0; i < l; ++i) {\n        if (ai + 5 > ar.length) {\n            var n = new u8(ai + 8 + ((l - i) << 1));\n            n.set(ar);\n            ar = n;\n        }\n        var c = str.charCodeAt(i);\n        if (c < 128 || latin1)\n            w(c);\n        else if (c < 2048)\n            w(192 | (c >>> 6)), w(128 | (c & 63));\n        else if (c > 55295 && c < 57344)\n            c = 65536 + (c & 1023 << 10) | (str.charCodeAt(++i) & 1023),\n                w(240 | (c >>> 18)), w(128 | ((c >>> 12) & 63)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n        else\n            w(224 | (c >>> 12)), w(128 | ((c >>> 6) & 63)), w(128 | (c & 63));\n    }\n    return slc(ar, 0, ai);\n}\n/**\n * Converts a Uint8Array to a string\n * @param dat The data to decode to string\n * @param latin1 Whether or not to interpret the data as Latin-1. This should\n *               not need to be true unless encoding to binary string.\n * @returns The original UTF-8/Latin-1 string\n */\nexport function strFromU8(dat, latin1) {\n    var r = '';\n    if (!latin1 && typeof TextDecoder != 'undefined')\n        return new TextDecoder().decode(dat);\n    for (var i = 0; i < dat.length;) {\n        var c = dat[i++];\n        if (c < 128 || latin1)\n            r += String.fromCharCode(c);\n        else if (c < 224)\n            r += String.fromCharCode((c & 31) << 6 | (dat[i++] & 63));\n        else if (c < 240)\n            r += String.fromCharCode((c & 15) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63));\n        else\n            c = ((c & 15) << 18 | (dat[i++] & 63) << 12 | (dat[i++] & 63) << 6 | (dat[i++] & 63)) - 65536,\n                r += String.fromCharCode(55296 | (c >> 10), 56320 | (c & 1023));\n    }\n    return r;\n}\n;\n// skip local zip header\nvar slzh = function (d, b) { return b + 30 + b2(d, b + 26) + b2(d, b + 28); };\n// read zip header\nvar zh = function (d, b, z) {\n    var fnl = b2(d, b + 28), fn = strFromU8(d.subarray(b + 46, b + 46 + fnl), !(b2(d, b + 8) & 2048)), es = b + 46 + fnl;\n    var _a = z ? z64e(d, es) : [b4(d, b + 20), b4(d, b + 24), b4(d, b + 42)], sc = _a[0], su = _a[1], off = _a[2];\n    return [b2(d, b + 10), sc, su, fn, es + b2(d, b + 30) + b2(d, b + 32), off];\n};\n// read zip64 extra field\nvar z64e = function (d, b) {\n    for (; b2(d, b) != 1; b += 4 + b2(d, b + 2))\n        ;\n    return [b4(d, b + 12), b4(d, b + 4), b4(d, b + 20)];\n};\n// write zip header\nvar wzh = function (d, b, c, cmp, su, fn, u, o, ce, t) {\n    var fl = fn.length, l = cmp.length;\n    wbytes(d, b, ce != null ? 0x2014B50 : 0x4034B50), b += 4;\n    if (ce != null)\n        d[b] = 20, b += 2;\n    d[b] = 20, b += 2; // spec compliance? what's that?\n    d[b++] = (t == 8 && (o.level == 1 ? 6 : o.level < 6 ? 4 : o.level == 9 ? 2 : 0)), d[b++] = u && 8;\n    d[b] = t, b += 2;\n    var dt = new Date(o.mtime || Date.now()), y = dt.getFullYear() - 1980;\n    if (y < 0 || y > 119)\n        throw 'date not in range 1980-2099';\n    wbytes(d, b, ((y << 24) * 2) | ((dt.getMonth() + 1) << 21) | (dt.getDate() << 16) | (dt.getHours() << 11) | (dt.getMinutes() << 5) | (dt.getSeconds() >>> 1));\n    b += 4;\n    wbytes(d, b, c);\n    wbytes(d, b + 4, l);\n    wbytes(d, b + 8, su);\n    wbytes(d, b + 12, fl), b += 16; // skip extra field, comment\n    if (ce != null)\n        wbytes(d, b += 10, ce), b += 4;\n    d.set(fn, b);\n    b += fl;\n    if (ce == null)\n        d.set(cmp, b);\n};\n// write zip footer (end of central directory)\nvar wzf = function (o, b, c, d, e) {\n    wbytes(o, b, 0x6054B50); // skip disk\n    wbytes(o, b + 8, c);\n    wbytes(o, b + 10, c);\n    wbytes(o, b + 12, d);\n    wbytes(o, b + 16, e);\n};\nexport function zip(data, opts, cb) {\n    if (!cb)\n        cb = opts, opts = {};\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var r = {};\n    fltn(data, '', r, opts);\n    var k = Object.keys(r);\n    var lft = k.length, o = 0, tot = 0;\n    var slft = lft, files = new Array(lft);\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var cbf = function () {\n        var out = new u8(tot + 22), oe = o, cdl = tot - o;\n        tot = 0;\n        for (var i = 0; i < slft; ++i) {\n            var f = files[i];\n            try {\n                wzh(out, tot, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n                wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, tot, f.t), o += 46 + f.n.length, tot += 30 + f.n.length + f.d.length;\n            }\n            catch (e) {\n                return cb(e, null);\n            }\n        }\n        wzf(out, o, files.length, cdl, oe);\n        cb(null, out);\n    };\n    if (!lft)\n        cbf();\n    var _loop_1 = function (i) {\n        var fn = k[i];\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var c = crc(), m = file.length;\n        c.p(file);\n        var n = strToU8(fn), s = n.length;\n        var t = p.level == 0 ? 0 : 8;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                var l = d.length;\n                files[i] = {\n                    t: t,\n                    d: d,\n                    m: m,\n                    c: c.d(),\n                    u: fn.length != l,\n                    n: n,\n                    p: p\n                };\n                o += 30 + s + l;\n                tot += 76 + 2 * s + l;\n                if (!--lft)\n                    cbf();\n            }\n        };\n        if (n.length > 65535)\n            cbl('filename too long', null);\n        if (!t)\n            cbl(null, file);\n        else if (m < 160000) {\n            try {\n                cbl(null, deflateSync(file, p));\n            }\n            catch (e) {\n                cbl(e, null);\n            }\n        }\n        else\n            term.push(deflate(file, p, cbl));\n    };\n    // Cannot use lft because it can decrease\n    for (var i = 0; i < slft; ++i) {\n        _loop_1(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously creates a ZIP file. Prefer using `zip` for better performance\n * with more than one file.\n * @param data The directory structure for the ZIP archive\n * @param opts The main options, merged with per-file options\n * @returns The generated ZIP archive\n */\nexport function zipSync(data, opts) {\n    if (opts === void 0) { opts = {}; }\n    var r = {};\n    var files = [];\n    fltn(data, '', r, opts);\n    var o = 0;\n    var tot = 0;\n    for (var fn in r) {\n        var _a = r[fn], file = _a[0], p = _a[1];\n        var t = p.level == 0 ? 0 : 8;\n        var n = strToU8(fn), s = n.length;\n        if (n.length > 65535)\n            throw 'filename too long';\n        var d = t ? deflateSync(file, p) : file, l = d.length;\n        var c = crc();\n        c.p(file);\n        files.push({\n            t: t,\n            d: d,\n            m: file.length,\n            c: c.d(),\n            u: fn.length != s,\n            n: n,\n            o: o,\n            p: p\n        });\n        o += 30 + s + l;\n        tot += 76 + 2 * s + l;\n    }\n    var out = new u8(tot + 22), oe = o, cdl = tot - o;\n    for (var i = 0; i < files.length; ++i) {\n        var f = files[i];\n        wzh(out, f.o, f.c, f.d, f.m, f.n, f.u, f.p, null, f.t);\n        wzh(out, o, f.c, f.d, f.m, f.n, f.u, f.p, f.o, f.t), o += 46 + f.n.length;\n    }\n    wzf(out, o, files.length, cdl, oe);\n    return out;\n}\n/**\n * Asynchronously decompresses a ZIP archive\n * @param data The raw compressed ZIP file\n * @param cb The callback to call with the decompressed files\n * @returns A function that can be used to immediately terminate the unzipping\n */\nexport function unzip(data, cb) {\n    if (typeof cb != 'function')\n        throw 'no callback';\n    var term = [];\n    var tAll = function () {\n        for (var i = 0; i < term.length; ++i)\n            term[i]();\n    };\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558) {\n            cb('invalid zip file', null);\n            return;\n        }\n    }\n    ;\n    var lft = b2(data, e + 8);\n    if (!lft)\n        cb(null, {});\n    var c = lft;\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = lft = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    var _loop_2 = function (i) {\n        var _a = zh(data, o, z), c_1 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        var cbl = function (e, d) {\n            if (e) {\n                tAll();\n                cb(e, null);\n            }\n            else {\n                files[fn] = d;\n                if (!--lft)\n                    cb(null, files);\n            }\n        };\n        if (!c_1)\n            cbl(null, slc(data, b, b + sc));\n        else if (c_1 == 8) {\n            var infl = data.subarray(b, b + sc);\n            if (sc < 320000) {\n                try {\n                    cbl(null, inflateSync(infl, new u8(su)));\n                }\n                catch (e) {\n                    cbl(e, null);\n                }\n            }\n            else\n                term.push(inflate(infl, { size: su }, cbl));\n        }\n        else\n            cbl('unknown compression type ' + c_1, null);\n    };\n    for (var i = 0; i < c; ++i) {\n        _loop_2(i);\n    }\n    return tAll;\n}\n/**\n * Synchronously decompresses a ZIP archive. Prefer using `unzip` for better\n * performance with more than one file.\n * @param data The raw compressed ZIP file\n * @returns The decompressed files\n */\nexport function unzipSync(data) {\n    var files = {};\n    var e = data.length - 22;\n    for (; b4(data, e) != 0x6054B50; --e) {\n        if (!e || data.length - e > 65558)\n            throw 'invalid zip file';\n    }\n    ;\n    var c = b2(data, e + 8);\n    if (!c)\n        return {};\n    var o = b4(data, e + 16);\n    var z = o == 4294967295;\n    if (z) {\n        e = b4(data, e - 12);\n        if (b4(data, e) != 0x6064B50)\n            throw 'invalid zip file';\n        c = b4(data, e + 32);\n        o = b4(data, e + 48);\n    }\n    for (var i = 0; i < c; ++i) {\n        var _a = zh(data, o, z), c_2 = _a[0], sc = _a[1], su = _a[2], fn = _a[3], no = _a[4], off = _a[5], b = slzh(data, off);\n        o = no;\n        if (!c_2)\n            files[fn] = slc(data, b, b + sc);\n        else if (c_2 == 8)\n            files[fn] = inflateSync(data.subarray(b, b + sc), new u8(su));\n        else\n            throw 'unknown compression type ' + c_2;\n    }\n    return files;\n}\n","import type { MaskInputOptions, SlimDOMOptions } from 'rrweb-snapshot'\nimport { PostHog } from './posthog-core'\nimport { RetryQueue } from './retry-queue'\n\nexport type Property = any\nexport type Properties = Record<string, Property>\n\nexport interface CaptureResult {\n    uuid: string\n    event: string\n    properties: Properties\n    $set?: Properties\n    $set_once?: Properties\n    timestamp?: Date\n}\nexport type CaptureCallback = (response: any, data: any) => void\n\nexport type AutocaptureCompatibleElement = 'a' | 'button' | 'form' | 'input' | 'select' | 'textarea' | 'label'\nexport type DomAutocaptureEvents = 'click' | 'change' | 'submit'\n\n/**\n * If an array is passed for an allowlist, autocapture events will only be sent for elements matching\n * at least one of the elements in the array. Multiple allowlists can be used\n */\nexport interface AutocaptureConfig {\n    /**\n     * List of URLs to allow autocapture on, can be strings to match\n     * or regexes e.g. ['https://example.com', 'test.com/.*']\n     */\n    url_allowlist?: (string | RegExp)[]\n\n    /**\n     * List of DOM events to allow autocapture on  e.g. ['click', 'change', 'submit']\n     */\n    dom_event_allowlist?: DomAutocaptureEvents[]\n\n    /**\n     * List of DOM elements to allow autocapture on\n     * e.g. ['a', 'button', 'form', 'input', 'select', 'textarea', 'label']\n     * we consider the tree of elements from the root to the target element of the click event\n     * so for the tree div > div > button > svg\n     * if the allowlist has button then we allow the capture when the button or the svg is the click target\n     * but not if either of the divs are detected as the click target\n     */\n    element_allowlist?: AutocaptureCompatibleElement[]\n\n    /**\n     * List of CSS selectors to allow autocapture on\n     * e.g. ['[ph-capture]']\n     * we consider the tree of elements from the root to the target element of the click event\n     * so for the tree div > div > button > svg\n     * and allow list config `['[id]']`\n     * we will capture the click if the click-target or its parents has any id\n     */\n    css_selector_allowlist?: string[]\n\n    /**\n     * Exclude certain element attributes from autocapture\n     * E.g. ['aria-label'] or [data-attr-pii]\n     */\n    element_attribute_ignorelist?: string[]\n\n    capture_copied_text?: boolean\n}\n\nexport interface PostHogConfig {\n    api_host: string\n    api_method: string\n    api_transport?: 'XHR' | 'fetch'\n    ui_host: string | null\n    token: string\n    autocapture: boolean | AutocaptureConfig\n    rageclick: boolean\n    cross_subdomain_cookie: boolean\n    persistence: 'localStorage' | 'cookie' | 'memory' | 'localStorage+cookie' | 'sessionStorage'\n    persistence_name: string\n    cookie_name: string\n    loaded: (posthog_instance: PostHog) => void\n    store_google: boolean\n    custom_campaign_params: string[]\n    // a list of strings to be tested against navigator.userAgent to determine if the source is a bot\n    // this is **added to** the default list of bots that we check\n    // defaults to the empty array\n    custom_blocked_useragents: string[]\n    save_referrer: boolean\n    verbose: boolean\n    capture_pageview: boolean\n    capture_pageleave: boolean\n    debug: boolean\n    cookie_expiration: number\n    upgrade: boolean\n    disable_session_recording: boolean\n    disable_persistence: boolean\n    /** @deprecated - use `disable_persistence` instead  */\n    disable_cookie: boolean\n    enable_recording_console_log?: boolean\n    secure_cookie: boolean\n    ip: boolean\n    opt_out_capturing_by_default: boolean\n    opt_out_persistence_by_default: boolean\n    /** Opt out of user agent filtering such as googlebot or other bots. Defaults to `false` */\n    opt_out_useragent_filter: boolean\n    opt_out_capturing_persistence_type: 'localStorage' | 'cookie'\n    opt_out_capturing_cookie_prefix: string | null\n    opt_in_site_apps: boolean\n    respect_dnt: boolean\n    /** @deprecated - use `property_denylist` instead  */\n    property_blacklist: string[]\n    property_denylist: string[]\n    request_headers: { [header_name: string]: string }\n    on_request_error: (error: MinimalHTTPResponse) => void\n    /** @deprecated - use `request_headers` instead  */\n    xhr_headers?: { [header_name: string]: string }\n    /** @deprecated - use `on_request_error` instead  */\n    on_xhr_error?: (failedRequest: XMLHttpRequest) => void\n    inapp_protocol: string\n    inapp_link_new_window: boolean\n    request_batching: boolean\n    sanitize_properties: ((properties: Properties, event_name: string) => Properties) | null\n    properties_string_max_length: number\n    session_recording: SessionRecordingOptions\n    session_idle_timeout_seconds: number\n    mask_all_element_attributes: boolean\n    mask_all_text: boolean\n    advanced_disable_decide: boolean\n    advanced_disable_feature_flags: boolean\n    advanced_disable_feature_flags_on_first_load: boolean\n    advanced_disable_toolbar_metrics: boolean\n    get_device_id: (uuid: string) => string\n    name: string\n    _onCapture: (eventName: string, eventData: CaptureResult) => void\n    capture_performance?: boolean\n    // Should only be used for testing. Could negatively impact performance.\n    disable_compression: boolean\n    bootstrap: {\n        distinctID?: string\n        isIdentifiedID?: boolean\n        featureFlags?: Record<string, boolean | string>\n        featureFlagPayloads?: Record<string, JsonType>\n    }\n    segment?: any\n    __preview_send_client_session_params?: boolean\n    disable_scroll_properties?: boolean\n    // Let the pageview scroll stats use a custom css selector for the root element, e.g. `main`\n    scroll_root_selector?: string | string[]\n}\n\nexport interface OptInOutCapturingOptions {\n    capture: (event: string, properties: Properties, options: CaptureOptions) => void\n    capture_event_name: string\n    capture_properties: Properties\n    enable_persistence: boolean\n    clear_persistence: boolean\n    persistence_type: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    cookie_prefix: string\n    cookie_expiration: number\n    cross_subdomain_cookie: boolean\n    secure_cookie: boolean\n}\n\nexport interface isFeatureEnabledOptions {\n    send_event: boolean\n}\n\nexport interface SessionRecordingOptions {\n    blockClass?: string | RegExp\n    blockSelector?: string | null\n    ignoreClass?: string\n    maskTextClass?: string | RegExp\n    maskTextSelector?: string | null\n    maskTextFn?: ((text: string) => string) | null\n    maskAllInputs?: boolean\n    maskInputOptions?: MaskInputOptions\n    maskInputFn?: ((text: string, element?: HTMLElement) => string) | null\n    slimDOMOptions?: SlimDOMOptions | 'all' | true\n    collectFonts?: boolean\n    inlineStylesheet?: boolean\n    recorderVersion?: 'v1' | 'v2'\n    recordCrossOriginIframes?: boolean\n    /** @deprecated - use maskCapturedNetworkRequestFn instead  */\n    maskNetworkRequestFn?: ((data: NetworkRequest) => NetworkRequest | null | undefined) | null\n    /** Modify the network request before it is captured. Returning null or undefined stops it being captured */\n    maskCapturedNetworkRequestFn?: ((data: CapturedNetworkRequest) => CapturedNetworkRequest | null | undefined) | null\n    // our settings here only support a subset of those proposed for rrweb's network capture plugin\n    recordHeaders?: boolean\n    recordBody?: boolean\n}\n\nexport type SessionIdChangedCallback = (sessionId: string, windowId: string | null | undefined) => void\n\nexport enum Compression {\n    GZipJS = 'gzip-js',\n    Base64 = 'base64',\n}\n\nexport interface XHROptions {\n    transport?: 'XHR' | 'fetch' | 'sendBeacon'\n    method?: 'POST' | 'GET'\n    urlQueryArgs?: { compression: Compression }\n    verbose?: boolean\n    blob?: boolean\n    sendBeacon?: boolean\n}\n\nexport interface CaptureOptions extends XHROptions {\n    $set?: Properties /** used with $identify */\n    $set_once?: Properties /** used with $identify */\n    _url?: string /** Used to override the desired endpoint for the captured event */\n    _batchKey?: string /** key of queue, e.g. 'sessionRecording' vs 'event' */\n    _metrics?: Properties\n    _noTruncate?: boolean /** if set, overrides and disables config.properties_string_max_length */\n    send_instantly?: boolean /** if set skips the batched queue */\n    timestamp?: Date\n}\n\nexport interface RetryQueueElement {\n    retryAt: Date\n    requestData: QueuedRequestData\n}\nexport interface QueuedRequestData {\n    url: string\n    data: Properties\n    options: CaptureOptions\n    headers?: Properties\n    callback?: RequestCallback\n    retriesPerformedSoFar?: number\n}\n\n// Minimal class to allow interop between different request methods (xhr / fetch)\nexport interface MinimalHTTPResponse {\n    statusCode: number\n    responseText: string\n}\n\nexport interface RequestData extends QueuedRequestData {\n    retryQueue: RetryQueue\n    timeout?: number\n    onError?: (req: MinimalHTTPResponse) => void\n    onResponse?: (req: MinimalHTTPResponse) => void\n}\n\nexport type FlagVariant = { flag: string; variant: string }\n\nexport interface DecideResponse {\n    status: number\n    supportedCompression: Compression[]\n    config: {\n        enable_collect_everything: boolean\n    }\n    custom_properties: AutoCaptureCustomProperty[] // TODO: delete, not sent\n    featureFlags: Record<string, string | boolean>\n    featureFlagPayloads: Record<string, JsonType>\n    errorsWhileComputingFlags: boolean\n    autocapture_opt_out?: boolean\n    capturePerformance?: boolean\n    analytics?: {\n        endpoint?: string\n    }\n    elementsChainAsString?: boolean\n    // this is currently in development and may have breaking changes without a major version bump\n    autocaptureExceptions?:\n        | boolean\n        | {\n              endpoint?: string\n              errors_to_ignore: string[]\n          }\n    sessionRecording?: {\n        endpoint?: string\n        consoleLogRecordingEnabled?: boolean\n        recorderVersion?: 'v1' | 'v2'\n        // the API returns a decimal between 0 and 1 as a string\n        sampleRate?: string | null\n        minimumDurationMilliseconds?: number\n        recordCanvas?: boolean | null\n        canvasFps?: number | null\n        // the API returns a decimal between 0 and 1 as a string\n        canvasQuality?: string | null\n        linkedFlag?: string | FlagVariant | null\n        networkPayloadCapture?: Pick<NetworkRecordOptions, 'recordBody' | 'recordHeaders'>\n    }\n    surveys?: boolean\n    toolbarParams: ToolbarParams\n    editorParams?: ToolbarParams /** @deprecated, renamed to toolbarParams, still present on older API responses */\n    toolbarVersion: 'toolbar' /** @deprecated, moved to toolbarParams */\n    isAuthenticated: boolean\n    siteApps: { id: number; url: string }[]\n}\n\nexport type FeatureFlagsCallback = (flags: string[], variants: Record<string, string | boolean>) => void\n\n// TODO: delete custom_properties after changeless typescript refactor\nexport interface AutoCaptureCustomProperty {\n    name: string\n    css_selector: string\n    event_selectors: string[]\n}\n\nexport interface CompressionData {\n    data: string\n    compression?: Compression\n}\n\nexport interface GDPROptions {\n    capture?: (\n        event: string,\n        properties: Properties,\n        options: CaptureOptions\n    ) => void /** function used for capturing a PostHog event to record the opt-in action */\n    captureEventName?: string /** event name to be used for capturing the opt-in action */\n    captureProperties?: Properties /** set of properties to be captured along with the opt-in action */\n    /** persistence mechanism used */\n    persistenceType?: 'cookie' | 'localStorage' | 'localStorage+cookie'\n    persistencePrefix?: string /** [__ph_opt_in_out] - custom prefix to be used in the cookie/localstorage name */\n    cookieExpiration?: number /** number of days until the opt-in cookie expires */\n    crossSubdomainCookie?: boolean /** whether the opt-in cookie is set as cross-subdomain or not */\n    secureCookie?: boolean /** whether the opt-in cookie is set as secure or not */\n    respectDnt?: boolean\n    window?: Window\n}\n\nexport type RequestCallback = (response: Record<string, any>, data?: Properties) => void\n\nexport interface PersistentStore {\n    is_supported: () => boolean\n    error: (error: any) => void\n    parse: (name: string) => any\n    get: (name: string) => any\n    set: (name: string, value: any, expire_days?: number | null, cross_subdomain?: boolean, secure?: boolean) => void\n    remove: (name: string, cross_subdomain?: boolean) => void\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport type Breaker = {}\nexport type EventHandler = (event: Event) => boolean | void\n\nexport type ToolbarUserIntent = 'add-action' | 'edit-action'\nexport type ToolbarSource = 'url' | 'localstorage'\nexport type ToolbarVersion = 'toolbar'\n\n/* sync with posthog */\nexport interface ToolbarParams {\n    token?: string /** public posthog-js token */\n    temporaryToken?: string /** private temporary user token */\n    actionId?: number\n    userIntent?: ToolbarUserIntent\n    source?: ToolbarSource\n    toolbarVersion?: ToolbarVersion\n    instrument?: boolean\n    distinctId?: string\n    userEmail?: string\n    dataAttributes?: string[]\n    featureFlags?: Record<string, string | boolean>\n}\n\nexport interface PostData {\n    buffer?: BlobPart\n    compression?: Compression\n    data?: string\n}\n\nexport type SnippetArrayItem = [method: string, ...args: any[]]\n\nexport type JsonType = string | number | boolean | null | { [key: string]: JsonType } | Array<JsonType>\n\n/** A feature that isn't publicly available yet.*/\nexport interface EarlyAccessFeature {\n    // Sync this with the backend's EarlyAccessFeatureSerializer!\n    name: string\n    description: string\n    stage: 'concept' | 'alpha' | 'beta'\n    documentationUrl: string | null\n    flagKey: string | null\n}\n\nexport type EarlyAccessFeatureCallback = (earlyAccessFeatures: EarlyAccessFeature[]) => void\n\nexport interface EarlyAccessFeatureResponse {\n    earlyAccessFeatures: EarlyAccessFeature[]\n}\n\nexport type Headers = Record<string, string>\n\n/* for rrweb/network@1\n ** when that is released as part of rrweb this can be removed\n ** don't rely on this type, it may change without notice\n */\nexport type InitiatorType =\n    | 'audio'\n    | 'beacon'\n    | 'body'\n    | 'css'\n    | 'early-hint'\n    | 'embed'\n    | 'fetch'\n    | 'frame'\n    | 'iframe'\n    | 'icon'\n    | 'image'\n    | 'img'\n    | 'input'\n    | 'link'\n    | 'navigation'\n    | 'object'\n    | 'ping'\n    | 'script'\n    | 'track'\n    | 'video'\n    | 'xmlhttprequest'\n\nexport type NetworkRecordOptions = {\n    initiatorTypes?: InitiatorType[]\n    maskRequestFn?: (data: CapturedNetworkRequest) => CapturedNetworkRequest | undefined\n    recordHeaders?: boolean | { request: boolean; response: boolean }\n    recordBody?: boolean | string[] | { request: boolean | string[]; response: boolean | string[] }\n    recordInitialRequests?: boolean\n    // whether to record PerformanceEntry events for network requests\n    recordPerformance?: boolean\n    // the PerformanceObserver will only observe these entry types\n    performanceEntryTypeToObserve: string[]\n    // the maximum size of the request/response body to record\n    // NB this will be at most 1MB even if set larger\n    payloadSizeLimitBytes: number\n}\n\n/** @deprecated - use CapturedNetworkRequest instead  */\nexport type NetworkRequest = {\n    url: string\n}\n\n// In rrweb this is called NetworkRequest, but we already exposed that as having only URL\n// we also want to vary from the rrweb NetworkRequest because we want to include\n// all PerformanceEntry properties too.\n// that has 4 required properties\n//     readonly duration: DOMHighResTimeStamp;\n//     readonly entryType: string;\n//     readonly name: string;\n//     readonly startTime: DOMHighResTimeStamp;\n// NB: properties below here are ALPHA, don't rely on them, they may change without notice\nexport type CapturedNetworkRequest = Omit<PerformanceEntry, 'toJSON'> & {\n    // properties below here are ALPHA, don't rely on them, they may change without notice\n    method?: string\n    initiatorType?: InitiatorType\n    status?: number\n    timeOrigin?: number\n    timestamp?: number\n    startTime?: number\n    endTime?: number\n    requestHeaders?: Headers\n    requestBody?: string | null\n    responseHeaders?: Headers\n    responseBody?: string | null\n    // was this captured before fetch/xhr could have been wrapped\n    isInitial?: boolean\n}\n","import { _each } from './utils'\nimport Config from './config'\nimport { PostData, XHROptions, RequestData, MinimalHTTPResponse } from './types'\nimport { _formDataToQuery } from './utils/request-utils'\n\nimport { _isArray, _isFunction, _isNumber, _isUint8Array, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { fetch } from './utils/globals'\n\nexport const addParamsToURL = (\n    url: string,\n    urlQueryArgs: Record<string, any> | undefined,\n    parameterOptions: { ip?: boolean }\n): string => {\n    const args = urlQueryArgs || {}\n    args['ip'] = parameterOptions['ip'] ? 1 : 0\n    args['_'] = new Date().getTime().toString()\n    args['ver'] = Config.LIB_VERSION\n\n    const halves = url.split('?')\n    if (halves.length > 1) {\n        const params = halves[1].split('&')\n        for (const p of params) {\n            const key = p.split('=')[0]\n            if (!_isUndefined(args[key])) {\n                delete args[key]\n            }\n        }\n    }\n\n    const argSeparator = url.indexOf('?') > -1 ? '&' : '?'\n    return url + argSeparator + _formDataToQuery(args)\n}\n\nexport const encodePostData = (data: PostData | Uint8Array, options: Partial<XHROptions>): string | BlobPart | null => {\n    if (options.blob && data.buffer) {\n        return new Blob([_isUint8Array(data) ? data : data.buffer], { type: 'text/plain' })\n    }\n\n    if (options.sendBeacon || options.blob) {\n        const body = encodePostData(data, { method: 'POST' }) as BlobPart\n        return new Blob([body], { type: 'application/x-www-form-urlencoded' })\n    }\n\n    if (options.method !== 'POST') {\n        return null\n    }\n\n    let body_data\n\n    if (_isArray(data) || _isUint8Array(data)) {\n        // TODO: eh? passing an Array here?\n        body_data = 'data=' + encodeURIComponent(data as any)\n    } else {\n        body_data = 'data=' + encodeURIComponent(data.data as string)\n    }\n\n    if ('compression' in data && data.compression) {\n        body_data += '&compression=' + data.compression\n    }\n\n    return body_data\n}\n\nexport const request = (params: RequestData) => {\n    // NOTE: Until we are confident with it, we only use fetch if explicitly told so\n    if (fetch && params.options.transport === 'fetch') {\n        const body = encodePostData(params.data, params.options)\n\n        const headers = new Headers()\n        _each(headers, function (headerValue, headerName) {\n            headers.append(headerName, headerValue)\n        })\n\n        if (params.options.method === 'POST' && !params.options.blob) {\n            headers.append('Content-Type', 'application/x-www-form-urlencoded')\n        }\n\n        let url = params.url\n\n        if (_isNumber(params.retriesPerformedSoFar) && params.retriesPerformedSoFar > 0) {\n            url = addParamsToURL(url, { retry_count: params.retriesPerformedSoFar }, {})\n        }\n\n        fetch(url, {\n            method: params.options?.method || 'GET',\n            headers,\n            keepalive: params.options.method === 'POST',\n            body,\n        })\n            .then((response) => {\n                const statusCode = response.status\n                // Report to the callback handlers\n                return response.text().then((responseText) => {\n                    params.onResponse?.({\n                        statusCode,\n                        responseText,\n                    })\n\n                    if (statusCode === 200) {\n                        try {\n                            params.callback?.(JSON.parse(responseText))\n                        } catch (e) {\n                            logger.error(e)\n                        }\n                        return\n                    }\n\n                    if (_isFunction(params.onError)) {\n                        params.onError({\n                            statusCode,\n                            responseText,\n                        })\n                    }\n\n                    // don't retry errors between 400 and 500 inclusive\n                    if (statusCode < 400 || statusCode > 500) {\n                        params.retryQueue.enqueue({\n                            ...params,\n                            headers,\n                            retriesPerformedSoFar: (params.retriesPerformedSoFar || 0) + 1,\n                        })\n                    }\n                    params.callback?.({ status: 0 })\n                })\n            })\n            .catch((error) => {\n                logger.error(error)\n                params.callback?.({ status: 0 })\n            })\n\n        return\n    }\n\n    return xhr(params)\n}\n\nconst xhr = ({\n    url,\n    data,\n    headers,\n    options,\n    callback,\n    retriesPerformedSoFar,\n    retryQueue,\n    onError,\n    timeout = 60000,\n    onResponse,\n}: RequestData) => {\n    if (_isNumber(retriesPerformedSoFar) && retriesPerformedSoFar > 0) {\n        url = addParamsToURL(url, { retry_count: retriesPerformedSoFar }, {})\n    }\n\n    const req = new XMLHttpRequest()\n    req.open(options.method || 'GET', url, true)\n\n    const body = encodePostData(data, options)\n\n    _each(headers, function (headerValue, headerName) {\n        req.setRequestHeader(headerName, headerValue)\n    })\n\n    if (options.method === 'POST' && !options.blob) {\n        req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n    }\n\n    req.timeout = timeout\n    // send the ph_optout cookie\n    // withCredentials cannot be modified until after calling .open on Android and Mobile Safari\n    req.withCredentials = true\n    req.onreadystatechange = () => {\n        // XMLHttpRequest.DONE == 4, except in safari 4\n        if (req.readyState === 4) {\n            const minimalResponseSummary: MinimalHTTPResponse = {\n                statusCode: req.status,\n                responseText: req.responseText,\n            }\n            onResponse?.(minimalResponseSummary)\n            if (req.status === 200) {\n                if (callback) {\n                    let response\n                    try {\n                        response = JSON.parse(req.responseText)\n                    } catch (e) {\n                        logger.error(e)\n                        return\n                    }\n                    callback(response)\n                }\n            } else {\n                if (_isFunction(onError)) {\n                    onError(minimalResponseSummary)\n                }\n\n                // don't retry errors between 400 and 500 inclusive\n                if (req.status < 400 || req.status > 500) {\n                    retryQueue.enqueue({\n                        url,\n                        data,\n                        options,\n                        headers,\n                        retriesPerformedSoFar: (retriesPerformedSoFar || 0) + 1,\n                        callback,\n                    })\n                }\n\n                callback?.({ status: 0 })\n            }\n        }\n    }\n    req.send(body)\n}\n","import { RequestQueueScaffold } from './base-request-queue'\nimport { encodePostData, request } from './send-request'\nimport { PostHogConfig, QueuedRequestData, RetryQueueElement } from './types'\nimport { RateLimiter } from './rate-limiter'\n\nimport { _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window } from './utils/globals'\n\nconst thirtyMinutes = 30 * 60 * 1000\n\n/**\n * Generates a jitter-ed exponential backoff delay in milliseconds\n *\n * The base value is 6 seconds, which is doubled with each retry\n * up to the maximum of 30 minutes\n *\n * Each value then has +/- 50% jitter\n *\n * Giving a range of 6 seconds up to 45 minutes\n */\nexport function pickNextRetryDelay(retriesPerformedSoFar: number): number {\n    const rawBackoffTime = 3000 * 2 ** retriesPerformedSoFar\n    const minBackoff = rawBackoffTime / 2\n    const cappedBackoffTime = Math.min(thirtyMinutes, rawBackoffTime)\n    const jitterFraction = Math.random() - 0.5 // A random number between -0.5 and 0.5\n    const jitter = jitterFraction * (cappedBackoffTime - minBackoff)\n    return Math.ceil(cappedBackoffTime + jitter)\n}\n\nexport class RetryQueue extends RequestQueueScaffold {\n    queue: RetryQueueElement[]\n    isPolling: boolean\n    areWeOnline: boolean\n    onRequestError: PostHogConfig['on_request_error']\n    rateLimiter: RateLimiter\n\n    constructor(onRequestError: PostHogConfig['on_request_error'], rateLimiter: RateLimiter) {\n        super()\n        this.isPolling = false\n        this.queue = []\n        this.areWeOnline = true\n        this.onRequestError = onRequestError\n        this.rateLimiter = rateLimiter\n\n        if (!_isUndefined(window) && 'onLine' in window.navigator) {\n            this.areWeOnline = window.navigator.onLine\n            window.addEventListener('online', () => {\n                this._handleWeAreNowOnline()\n            })\n            window.addEventListener('offline', () => {\n                this.areWeOnline = false\n            })\n        }\n    }\n\n    enqueue(requestData: QueuedRequestData): void {\n        const retriesPerformedSoFar = requestData.retriesPerformedSoFar || 0\n        if (retriesPerformedSoFar >= 10) {\n            return\n        }\n        const msToNextRetry = pickNextRetryDelay(retriesPerformedSoFar)\n        const retryAt = new Date(Date.now() + msToNextRetry)\n\n        this.queue.push({ retryAt, requestData })\n\n        let logMessage = `Enqueued failed request for retry in ${msToNextRetry}`\n        if (!navigator.onLine) {\n            logMessage += ' (Browser is offline)'\n        }\n        logger.warn(logMessage)\n\n        if (!this.isPolling) {\n            this.isPolling = true\n            this.poll()\n        }\n    }\n\n    poll(): void {\n        this._poller && clearTimeout(this._poller)\n        this._poller = setTimeout(() => {\n            if (this.areWeOnline && this.queue.length > 0) {\n                this.flush()\n            }\n            this.poll()\n        }, this._pollInterval) as any as number\n    }\n\n    flush(): void {\n        // using Date.now to make tests easier, as recommended here https://codewithhugo.com/mocking-the-current-date-in-jest-tests/\n        const now = new Date(Date.now())\n        const toFlush = this.queue.filter(({ retryAt }) => retryAt < now)\n        if (toFlush.length > 0) {\n            this.queue = this.queue.filter(({ retryAt }) => retryAt >= now)\n            for (const { requestData } of toFlush) {\n                this._executeXhrRequest(requestData)\n            }\n        }\n    }\n\n    unload(): void {\n        if (this._poller) {\n            clearTimeout(this._poller)\n            this._poller = undefined\n        }\n\n        for (const { requestData } of this.queue) {\n            const { url, data, options } = requestData\n\n            if (this.rateLimiter.isRateLimited(options._batchKey)) {\n                logger.warn('[RetryQueue] is quota limited. Dropping request.')\n                continue\n            }\n\n            try {\n                // we've had send beacon in place for at least 2 years\n                // eslint-disable-next-line compat/compat\n                window?.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // Note sendBeacon automatically retries, and after the first retry it will lose reference to contextual `this`.\n                // This means in some cases `this.getConfig` will be undefined.\n                logger.error(e)\n            }\n        }\n        this.queue = []\n    }\n\n    _executeXhrRequest({ url, data, options, headers, callback, retriesPerformedSoFar }: QueuedRequestData): void {\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            return\n        }\n\n        request({\n            url,\n            data: data || {},\n            options: options || {},\n            headers: headers || {},\n            retriesPerformedSoFar: retriesPerformedSoFar || 0,\n            callback,\n            retryQueue: this,\n            onError: this.onRequestError,\n            onResponse: this.rateLimiter.checkForLimiting,\n        })\n    }\n\n    _handleWeAreNowOnline(): void {\n        this.areWeOnline = true\n        this.flush()\n    }\n}\n","import { PostHog } from '../posthog-core'\n\n/**\n * The request router helps simplify the logic to determine which endpoints should be called for which things\n * The basic idea is that for a given region (US or EU), we have a set of endpoints that we should call depending\n * on the type of request (events, replays, decide, etc.) and handle overrides that may come from configs or the decide endpoint\n */\n\nexport enum RequestRouterRegion {\n    US = 'us',\n    EU = 'eu',\n    CUSTOM = 'custom',\n}\n\nexport type RequestRouterTarget = 'api' | 'ui' | 'assets'\n\nexport class RequestRouter {\n    instance: PostHog\n    private _regionCache: Record<string, RequestRouterRegion> = {}\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    get apiHost(): string {\n        return this.instance.config.api_host.trim().replace(/\\/$/, '')\n    }\n    get uiHost(): string | undefined {\n        return this.instance.config.ui_host?.replace(/\\/$/, '')\n    }\n\n    get region(): RequestRouterRegion {\n        // We don't need to compute this every time so we cache the result\n        if (!this._regionCache[this.apiHost]) {\n            if (/https:\\/\\/(app|us|us-assets)(\\.i)?\\.posthog\\.com/i.test(this.apiHost)) {\n                this._regionCache[this.apiHost] = RequestRouterRegion.US\n            } else if (/https:\\/\\/(eu|eu-assets)(\\.i)?\\.posthog\\.com/i.test(this.apiHost)) {\n                this._regionCache[this.apiHost] = RequestRouterRegion.EU\n            } else {\n                this._regionCache[this.apiHost] = RequestRouterRegion.CUSTOM\n            }\n        }\n        return this._regionCache[this.apiHost]\n    }\n\n    endpointFor(target: RequestRouterTarget, path: string = ''): string {\n        if (path) {\n            path = path[0] === '/' ? path : `/${path}`\n        }\n\n        if (target === 'ui') {\n            return (this.uiHost || this.apiHost) + path\n        }\n\n        if (this.region === RequestRouterRegion.CUSTOM) {\n            return this.apiHost + path\n        }\n\n        const suffix = 'i.posthog.com' + path\n\n        switch (target) {\n            case 'assets':\n                return `https://${this.region}-assets.${suffix}`\n            case 'api':\n                return `https://${this.region}.${suffix}`\n        }\n    }\n}\n","import { PostHogPersistence } from './posthog-persistence'\nimport { SESSION_ID } from './constants'\nimport { sessionStore } from './storage'\nimport { PostHogConfig, SessionIdChangedCallback } from './types'\nimport { uuidv7 } from './uuidv7'\nimport { window } from './utils/globals'\n\nimport { _isArray, _isNumber, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\n\nconst MAX_SESSION_IDLE_TIMEOUT = 30 * 60 // 30 minutes\nconst MIN_SESSION_IDLE_TIMEOUT = 60 // 1 minute\nconst SESSION_LENGTH_LIMIT = 24 * 3600 * 1000 // 24 hours\n\nexport class SessionIdManager {\n    private readonly _sessionIdGenerator: () => string\n    private readonly _windowIdGenerator: () => string\n    private config: Partial<PostHogConfig>\n    private persistence: PostHogPersistence\n    private _windowId: string | null | undefined\n    private _sessionId: string | null | undefined\n    private readonly _window_id_storage_key: string\n    private readonly _primary_window_exists_storage_key: string\n    private _sessionStartTimestamp: number | null\n\n    private _sessionActivityTimestamp: number | null\n    private readonly _sessionTimeoutMs: number\n    private _sessionIdChangedHandlers: SessionIdChangedCallback[] = []\n\n    constructor(\n        config: Partial<PostHogConfig>,\n        persistence: PostHogPersistence,\n        sessionIdGenerator?: () => string,\n        windowIdGenerator?: () => string\n    ) {\n        this.config = config\n        this.persistence = persistence\n        this._windowId = undefined\n        this._sessionId = undefined\n        this._sessionStartTimestamp = null\n        this._sessionActivityTimestamp = null\n        this._sessionIdGenerator = sessionIdGenerator || uuidv7\n        this._windowIdGenerator = windowIdGenerator || uuidv7\n\n        const persistenceName = config['persistence_name'] || config['token']\n        let desiredTimeout = config['session_idle_timeout_seconds'] || MAX_SESSION_IDLE_TIMEOUT\n\n        if (!_isNumber(desiredTimeout)) {\n            logger.warn('session_idle_timeout_seconds must be a number. Defaulting to 30 minutes.')\n            desiredTimeout = MAX_SESSION_IDLE_TIMEOUT\n        } else if (desiredTimeout > MAX_SESSION_IDLE_TIMEOUT) {\n            logger.warn('session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead.')\n        } else if (desiredTimeout < MIN_SESSION_IDLE_TIMEOUT) {\n            logger.warn('session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead.')\n        }\n\n        this._sessionTimeoutMs =\n            Math.min(Math.max(desiredTimeout, MIN_SESSION_IDLE_TIMEOUT), MAX_SESSION_IDLE_TIMEOUT) * 1000\n        this._window_id_storage_key = 'ph_' + persistenceName + '_window_id'\n        this._primary_window_exists_storage_key = 'ph_' + persistenceName + '_primary_window_exists'\n\n        // primary_window_exists is set when the DOM has been loaded and is cleared on unload\n        // if it exists here it means there was no unload which suggests this window is opened as a tab duplication, window.open, etc.\n        if (this._canUseSessionStorage()) {\n            const lastWindowId = sessionStore.parse(this._window_id_storage_key)\n\n            const primaryWindowExists = sessionStore.parse(this._primary_window_exists_storage_key)\n            if (lastWindowId && !primaryWindowExists) {\n                // Persist window from previous storage state\n                this._windowId = lastWindowId\n            } else {\n                // Wipe any reference to previous window id\n                sessionStore.remove(this._window_id_storage_key)\n            }\n            // Flag this session as having a primary window\n            sessionStore.set(this._primary_window_exists_storage_key, true)\n        }\n\n        this._listenToReloadWindow()\n    }\n\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        // KLUDGE: when running in tests the handlers array was always undefined\n        // it's yucky but safe to set it here so that it's always definitely available\n        if (_isUndefined(this._sessionIdChangedHandlers)) {\n            this._sessionIdChangedHandlers = []\n        }\n\n        this._sessionIdChangedHandlers.push(callback)\n        if (this._sessionId) {\n            callback(this._sessionId, this._windowId)\n        }\n        return () => {\n            this._sessionIdChangedHandlers = this._sessionIdChangedHandlers.filter((h) => h !== callback)\n        }\n    }\n\n    private _canUseSessionStorage(): boolean {\n        // We only want to use sessionStorage if persistence is enabled and not memory storage\n        return this.config.persistence !== 'memory' && !this.persistence.disabled && sessionStore.is_supported()\n    }\n\n    // Note: this tries to store the windowId in sessionStorage. SessionStorage is unique to the current window/tab,\n    // and persists page loads/reloads. So it's uniquely suited for storing the windowId. This function also respects\n    // when persistence is disabled (by user config) and when sessionStorage is not supported (it *should* be supported on all browsers),\n    // and in that case, it falls back to memory (which sadly, won't persist page loads)\n    private _setWindowId(windowId: string): void {\n        if (windowId !== this._windowId) {\n            this._windowId = windowId\n            if (this._canUseSessionStorage()) {\n                sessionStore.set(this._window_id_storage_key, windowId)\n            }\n        }\n    }\n\n    private _getWindowId(): string | null {\n        if (this._windowId) {\n            return this._windowId\n        }\n        if (this._canUseSessionStorage()) {\n            return sessionStore.parse(this._window_id_storage_key)\n        }\n        // New window id will be generated\n        return null\n    }\n\n    // Note: 'this.persistence.register' can be disabled in the config.\n    // In that case, this works by storing sessionId and the timestamp in memory.\n    private _setSessionId(\n        sessionId: string | null,\n        sessionActivityTimestamp: number | null,\n        sessionStartTimestamp: number | null\n    ): void {\n        if (\n            sessionId !== this._sessionId ||\n            sessionActivityTimestamp !== this._sessionActivityTimestamp ||\n            sessionStartTimestamp !== this._sessionStartTimestamp\n        ) {\n            this._sessionStartTimestamp = sessionStartTimestamp\n            this._sessionActivityTimestamp = sessionActivityTimestamp\n            this._sessionId = sessionId\n\n            this.persistence.register({\n                [SESSION_ID]: [sessionActivityTimestamp, sessionId, sessionStartTimestamp],\n            })\n        }\n    }\n\n    private _getSessionId(): [number, string, number] {\n        if (this._sessionId && this._sessionActivityTimestamp && this._sessionStartTimestamp) {\n            return [this._sessionActivityTimestamp, this._sessionId, this._sessionStartTimestamp]\n        }\n        const sessionId = this.persistence.props[SESSION_ID]\n\n        if (_isArray(sessionId) && sessionId.length === 2) {\n            // Storage does not yet have a session start time. Add the last activity timestamp as the start time\n            sessionId.push(sessionId[0])\n        }\n\n        return sessionId || [0, null, 0]\n    }\n\n    // Resets the session id by setting it to null. On the subsequent call to checkAndGetSessionAndWindowId,\n    // new ids will be generated.\n    resetSessionId(): void {\n        this._setSessionId(null, null, null)\n    }\n\n    /*\n     * Listens to window unloads and removes the primaryWindowExists key from sessionStorage.\n     * Reloaded or fresh tabs created after a DOM unloads (reloading the same tab) WILL NOT have this primaryWindowExists flag in session storage.\n     * Cloned sessions (new tab, tab duplication, window.open(), ...) WILL have this primaryWindowExists flag in their copied session storage.\n     * We conditionally check the primaryWindowExists value in the constructor to decide if the window id in the last session storage should be carried over.\n     */\n    private _listenToReloadWindow(): void {\n        window?.addEventListener('beforeunload', () => {\n            if (this._canUseSessionStorage()) {\n                sessionStore.remove(this._primary_window_exists_storage_key)\n            }\n        })\n    }\n\n    /*\n     * This function returns the current sessionId and windowId. It should be used to\n     * access these values over directly calling `._sessionId` or `._windowId`.\n     * In addition to returning the sessionId and windowId, this function also manages cycling the\n     * sessionId and windowId when appropriate by doing the following:\n     *\n     * 1. If the sessionId or windowId is not set, it will generate a new one and store it.\n     * 2. If the readOnly param is set to false, it will:\n     *    a. Check if it has been > SESSION_CHANGE_THRESHOLD since the last call with this flag set.\n     *       If so, it will generate a new sessionId and store it.\n     *    b. Update the timestamp stored with the sessionId to ensure the current session is extended\n     *       for the appropriate amount of time.\n     *\n     * @param {boolean} readOnly (optional) Defaults to False. Should be set to True when the call to the function should not extend or cycle the session (e.g. being called for non-user generated events)\n     * @param {Number} timestamp (optional) Defaults to the current time. The timestamp to be stored with the sessionId (used when determining if a new sessionId should be generated)\n     */\n    checkAndGetSessionAndWindowId(readOnly = false, _timestamp: number | null = null) {\n        const timestamp = _timestamp || new Date().getTime()\n\n        // eslint-disable-next-line prefer-const\n        let [lastTimestamp, sessionId, startTimestamp] = this._getSessionId()\n        let windowId = this._getWindowId()\n\n        const sessionPastMaximumLength =\n            startTimestamp && startTimestamp > 0 && Math.abs(timestamp - startTimestamp) > SESSION_LENGTH_LIMIT\n\n        let valuesChanged = false\n        const noSessionId = !sessionId\n        const activityTimeout = !readOnly && Math.abs(timestamp - lastTimestamp) > this._sessionTimeoutMs\n        if (noSessionId || activityTimeout || sessionPastMaximumLength) {\n            sessionId = this._sessionIdGenerator()\n            windowId = this._windowIdGenerator()\n            logger.info('[SessionId] new session ID generated', {\n                sessionId,\n                windowId,\n                changeReason: { noSessionId, activityTimeout, sessionPastMaximumLength },\n            })\n            startTimestamp = timestamp\n            valuesChanged = true\n        } else if (!windowId) {\n            windowId = this._windowIdGenerator()\n            valuesChanged = true\n        }\n\n        const newTimestamp = lastTimestamp === 0 || !readOnly || sessionPastMaximumLength ? timestamp : lastTimestamp\n        const sessionStartTimestamp = startTimestamp === 0 ? new Date().getTime() : startTimestamp\n\n        this._setWindowId(windowId)\n        this._setSessionId(sessionId, newTimestamp, sessionStartTimestamp)\n\n        if (valuesChanged) {\n            this._sessionIdChangedHandlers.forEach((handler) => handler(sessionId, windowId))\n        }\n\n        return {\n            sessionId,\n            windowId,\n            sessionStartTimestamp,\n        }\n    }\n}\n","/**\n * Integrate Sentry with PostHog. This will add a direct link to the person in Sentry, and an $exception event in PostHog\n *\n * ### Usage\n *\n *     Sentry.init({\n *          dsn: 'https://example',\n *          integrations: [\n *              new posthog.SentryIntegration(posthog)\n *          ]\n *     })\n *\n * @param {Object} [posthog] The posthog object\n * @param {string} [organization] Optional: The Sentry organization, used to send a direct link from PostHog to Sentry\n * @param {Number} [projectId] Optional: The Sentry project id, used to send a direct link from PostHog to Sentry\n * @param {string} [prefix] Optional: Url of a self-hosted sentry instance (default: https://sentry.io/organizations/)\n */\n\nimport { PostHog } from '../posthog-core'\n\n// NOTE - we can't import from @sentry/types because it changes frequently and causes clashes\n// We only use a small subset of the types, so we can just define the integration overall and use any for the rest\n\n// import {\n//     Event as _SentryEvent,\n//     EventProcessor as _SentryEventProcessor,\n//     Hub as _SentryHub,\n//     Integration as _SentryIntegration,\n// } from '@sentry/types'\n\n// Uncomment the above and comment the below to get type checking for development\n\ntype _SentryEvent = any\ntype _SentryEventProcessor = any\ntype _SentryHub = any\n\ninterface _SentryIntegration {\n    name: string\n    setupOnce(addGlobalEventProcessor: (callback: _SentryEventProcessor) => void, getCurrentHub: () => _SentryHub): void\n}\n\ninterface SentryExceptionProperties {\n    $sentry_event_id: any\n    $sentry_exception: any\n    $sentry_exception_message: any\n    $sentry_exception_type: any\n    $sentry_tags: any\n    $sentry_url?: string\n}\n\nexport class SentryIntegration implements _SentryIntegration {\n    name: string\n\n    setupOnce: (\n        addGlobalEventProcessor: (callback: _SentryEventProcessor) => void,\n        getCurrentHub: () => _SentryHub\n    ) => void\n\n    constructor(_posthog: PostHog, organization?: string, projectId?: number, prefix?: string) {\n        // setupOnce gets called by Sentry when it intializes the plugin\n        this.name = 'posthog-js'\n        this.setupOnce = function (addGlobalEventProcessor: (callback: _SentryEventProcessor) => void) {\n            addGlobalEventProcessor((event: _SentryEvent) => {\n                if (event.level !== 'error' || !_posthog.__loaded) return event\n                if (!event.tags) event.tags = {}\n\n                const personUrl = _posthog.requestRouter.endpointFor('ui', '/person/' + _posthog.get_distinct_id())\n                event.tags['PostHog Person URL'] = personUrl\n                if (_posthog.sessionRecordingStarted()) {\n                    event.tags['PostHog Recording URL'] = _posthog.get_session_replay_url({ withTimestamp: true })\n                }\n\n                const exceptions = event.exception?.values || []\n\n                const data: SentryExceptionProperties & {\n                    // two properties added to match any exception auto-capture\n                    // added manually to avoid any dependency on the lazily loaded content\n                    $exception_message: any\n                    $exception_type: any\n                    $exception_personURL: string\n                } = {\n                    // PostHog Exception Properties,\n                    $exception_message: exceptions[0]?.value,\n                    $exception_type: exceptions[0]?.type,\n                    $exception_personURL: personUrl,\n                    // Sentry Exception Properties\n                    $sentry_event_id: event.event_id,\n                    $sentry_exception: event.exception,\n                    $sentry_exception_message: exceptions[0]?.value,\n                    $sentry_exception_type: exceptions[0]?.type,\n                    $sentry_tags: event.tags,\n                }\n\n                if (organization && projectId)\n                    data['$sentry_url'] =\n                        (prefix || 'https://sentry.io/organizations/') +\n                        organization +\n                        '/issues/?project=' +\n                        projectId +\n                        '&query=' +\n                        event.event_id\n                _posthog.capture('$exception', data)\n                return event\n            })\n        }\n    }\n}\n","import { window } from './utils/globals'\nimport { PostHog } from './posthog-core'\nimport { _isArray } from './utils/type-utils'\n\ninterface PageViewData {\n    pathname: string\n    // scroll is how far down the page the user has scrolled,\n    // content is how far down the page the user can view content\n    // (e.g. if the page is 1000 tall, but the user's screen is only 500 tall,\n    // and they don't scroll at all, then scroll is 0 and content is 500)\n    maxScrollHeight?: number\n    maxScrollY?: number\n    lastScrollY?: number\n    maxContentHeight?: number\n    maxContentY?: number\n    lastContentY?: number\n}\n\ninterface ScrollProperties {\n    $prev_pageview_last_scroll?: number\n    $prev_pageview_last_scroll_percentage?: number\n    $prev_pageview_max_scroll?: number\n    $prev_pageview_max_scroll_percentage?: number\n    $prev_pageview_last_content?: number\n    $prev_pageview_last_content_percentage?: number\n    $prev_pageview_max_content?: number\n    $prev_pageview_max_content_percentage?: number\n}\n\ninterface PageViewEventProperties extends ScrollProperties {\n    $prev_pageview_pathname?: string\n}\n\nexport class PageViewManager {\n    _pageViewData: PageViewData | undefined\n    _hasSeenPageView = false\n    _instance: PostHog\n\n    constructor(instance: PostHog) {\n        this._instance = instance\n    }\n\n    _createPageViewData(): PageViewData {\n        return {\n            pathname: window?.location.pathname ?? '',\n        }\n    }\n\n    doPageView(): PageViewEventProperties {\n        let prevPageViewData: PageViewData | undefined\n        // if there were events created before the first PageView, we would have created a\n        // pageViewData for them. If this happened, we don't want to create a new pageViewData\n        if (!this._hasSeenPageView) {\n            this._hasSeenPageView = true\n            prevPageViewData = undefined\n            if (!this._pageViewData) {\n                this._pageViewData = this._createPageViewData()\n            }\n        } else {\n            prevPageViewData = this._pageViewData\n            this._pageViewData = this._createPageViewData()\n        }\n\n        // update the scroll properties for the new page, but wait until the next tick\n        // of the event loop\n        setTimeout(this._updateScrollData, 0)\n\n        return {\n            $prev_pageview_pathname: prevPageViewData?.pathname,\n            ...this._calculatePrevPageScrollProperties(prevPageViewData),\n        }\n    }\n\n    doPageLeave(): PageViewEventProperties {\n        const prevPageViewData = this._pageViewData\n        return {\n            $prev_pageview_pathname: prevPageViewData?.pathname,\n            ...this._calculatePrevPageScrollProperties(prevPageViewData),\n        }\n    }\n\n    _calculatePrevPageScrollProperties(prevPageViewData: PageViewData | undefined): ScrollProperties {\n        if (\n            !prevPageViewData ||\n            prevPageViewData.maxScrollHeight == null ||\n            prevPageViewData.lastScrollY == null ||\n            prevPageViewData.maxScrollY == null ||\n            prevPageViewData.maxContentHeight == null ||\n            prevPageViewData.lastContentY == null ||\n            prevPageViewData.maxContentY == null\n        ) {\n            return {}\n        }\n\n        let { maxScrollHeight, lastScrollY, maxScrollY, maxContentHeight, lastContentY, maxContentY } = prevPageViewData\n\n        // Use ceil, so that e.g. scrolling 999.5px of a 1000px page is considered 100% scrolled\n        maxScrollHeight = Math.ceil(maxScrollHeight)\n        lastScrollY = Math.ceil(lastScrollY)\n        maxScrollY = Math.ceil(maxScrollY)\n        maxContentHeight = Math.ceil(maxContentHeight)\n        lastContentY = Math.ceil(lastContentY)\n        maxContentY = Math.ceil(maxContentY)\n\n        // if the maximum scroll height is near 0, then the percentage is 1\n        const lastScrollPercentage = maxScrollHeight <= 1 ? 1 : clamp(lastScrollY / maxScrollHeight, 0, 1)\n        const maxScrollPercentage = maxScrollHeight <= 1 ? 1 : clamp(maxScrollY / maxScrollHeight, 0, 1)\n        const lastContentPercentage = maxContentHeight <= 1 ? 1 : clamp(lastContentY / maxContentHeight, 0, 1)\n        const maxContentPercentage = maxContentHeight <= 1 ? 1 : clamp(maxContentY / maxContentHeight, 0, 1)\n\n        return {\n            $prev_pageview_last_scroll: lastScrollY,\n            $prev_pageview_last_scroll_percentage: lastScrollPercentage,\n            $prev_pageview_max_scroll: maxScrollY,\n            $prev_pageview_max_scroll_percentage: maxScrollPercentage,\n            $prev_pageview_last_content: lastContentY,\n            $prev_pageview_last_content_percentage: lastContentPercentage,\n            $prev_pageview_max_content: maxContentY,\n            $prev_pageview_max_content_percentage: maxContentPercentage,\n        }\n    }\n\n    _updateScrollData = () => {\n        if (!this._pageViewData) {\n            this._pageViewData = this._createPageViewData()\n        }\n        const pageViewData = this._pageViewData\n\n        const scrollY = this._scrollY()\n        const scrollHeight = this._scrollHeight()\n        const contentY = this._contentY()\n        const contentHeight = this._contentHeight()\n\n        pageViewData.lastScrollY = scrollY\n        pageViewData.maxScrollY = Math.max(scrollY, pageViewData.maxScrollY ?? 0)\n        pageViewData.maxScrollHeight = Math.max(scrollHeight, pageViewData.maxScrollHeight ?? 0)\n\n        pageViewData.lastContentY = contentY\n        pageViewData.maxContentY = Math.max(contentY, pageViewData.maxContentY ?? 0)\n        pageViewData.maxContentHeight = Math.max(contentHeight, pageViewData.maxContentHeight ?? 0)\n    }\n\n    startMeasuringScrollPosition() {\n        // setting the third argument to `true` means that we will receive scroll events for other scrollable elements\n        // on the page, not just the window\n        // see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#usecapture\n        window?.addEventListener('scroll', this._updateScrollData, true)\n        window?.addEventListener('scrollend', this._updateScrollData, true)\n        window?.addEventListener('resize', this._updateScrollData)\n    }\n\n    stopMeasuringScrollPosition() {\n        window?.removeEventListener('scroll', this._updateScrollData)\n        window?.removeEventListener('scrollend', this._updateScrollData)\n        window?.removeEventListener('resize', this._updateScrollData)\n    }\n\n    _scrollElement(): Element | null | undefined {\n        if (this._instance.config.scroll_root_selector) {\n            const selectors = _isArray(this._instance.config.scroll_root_selector)\n                ? this._instance.config.scroll_root_selector\n                : [this._instance.config.scroll_root_selector]\n            for (const selector of selectors) {\n                const element = window?.document.querySelector(selector)\n                if (element) {\n                    return element\n                }\n            }\n            return undefined\n        } else {\n            return window?.document.documentElement\n        }\n    }\n\n    _scrollHeight(): number {\n        const element = this._scrollElement()\n        return element ? Math.max(0, element.scrollHeight - element.clientHeight) : 0\n    }\n\n    _scrollY(): number {\n        if (this._instance.config.scroll_root_selector) {\n            const element = this._scrollElement()\n            return (element && element.scrollTop) || 0\n        } else {\n            return window ? window.scrollY || window.pageYOffset || window.document.documentElement.scrollTop || 0 : 0\n        }\n    }\n\n    _contentHeight(): number {\n        const element = this._scrollElement()\n        return element?.scrollHeight || 0\n    }\n\n    _contentY(): number {\n        const element = this._scrollElement()\n        const clientHeight = element?.clientHeight || 0\n        return this._scrollY() + clientHeight\n    }\n}\n\nfunction clamp(x: number, min: number, max: number) {\n    return Math.max(min, Math.min(x, max))\n}\n","import { PostHog } from './posthog-core'\nimport { SURVEYS } from './constants'\nimport { SurveyCallback, SurveyUrlMatchType } from './posthog-surveys-types'\nimport { _isUrlMatchingRegex } from './utils/request-utils'\nimport { window, document } from './utils/globals'\n\nexport const surveyUrlValidationMap: Record<SurveyUrlMatchType, (conditionsUrl: string) => boolean> = {\n    icontains: (conditionsUrl) =>\n        !!window && window.location.href.toLowerCase().indexOf(conditionsUrl.toLowerCase()) > -1,\n    regex: (conditionsUrl) => !!window && _isUrlMatchingRegex(window.location.href, conditionsUrl),\n    exact: (conditionsUrl) => window?.location.href === conditionsUrl,\n}\n\nexport class PostHogSurveys {\n    instance: PostHog\n\n    constructor(instance: PostHog) {\n        this.instance = instance\n    }\n\n    getSurveys(callback: SurveyCallback, forceReload = false) {\n        const existingSurveys = this.instance.get_property(SURVEYS)\n        if (!existingSurveys || forceReload) {\n            this.instance._send_request(\n                this.instance.requestRouter.endpointFor('api', `/api/surveys/?token=${this.instance.config.token}`),\n                {},\n                { method: 'GET' },\n                (response) => {\n                    const surveys = response.surveys || []\n                    this.instance.persistence?.register({ [SURVEYS]: surveys })\n                    return callback(surveys)\n                }\n            )\n        } else {\n            return callback(existingSurveys)\n        }\n    }\n\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false) {\n        this.getSurveys((surveys) => {\n            const activeSurveys = surveys.filter((survey) => {\n                return !!(survey.start_date && !survey.end_date)\n            })\n            const conditionMatchedSurveys = activeSurveys.filter((survey) => {\n                if (!survey.conditions) {\n                    return true\n                }\n\n                // use urlMatchType to validate url condition, fallback to contains for backwards compatibility\n                const urlCheck = survey.conditions?.url\n                    ? surveyUrlValidationMap[survey.conditions?.urlMatchType ?? 'icontains'](survey.conditions.url)\n                    : true\n                const selectorCheck = survey.conditions?.selector\n                    ? document?.querySelector(survey.conditions.selector)\n                    : true\n                return urlCheck && selectorCheck\n            })\n            const targetingMatchedSurveys = conditionMatchedSurveys.filter((survey) => {\n                if (!survey.linked_flag_key && !survey.targeting_flag_key) {\n                    return true\n                }\n                const linkedFlagCheck = survey.linked_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.linked_flag_key)\n                    : true\n                const targetingFlagCheck = survey.targeting_flag_key\n                    ? this.instance.featureFlags.isFeatureEnabled(survey.targeting_flag_key)\n                    : true\n                return linkedFlagCheck && targetingFlagCheck\n            })\n\n            return callback(targetingMatchedSurveys)\n        }, forceReload)\n    }\n}\n","import Config from './config'\nimport {\n    _copyAndTruncateStrings,\n    _each,\n    _eachArray,\n    _extend,\n    _register_event,\n    _safewrap_class,\n    isCrossDomainCookie,\n    isDistinctIdStringLike,\n} from './utils'\nimport { assignableWindow, window } from './utils/globals'\nimport { autocapture } from './autocapture'\nimport { PostHogFeatureFlags } from './posthog-featureflags'\nimport { PostHogPersistence } from './posthog-persistence'\nimport { ALIAS_ID_KEY, FLAG_CALL_REPORTED, PEOPLE_DISTINCT_ID_KEY } from './constants'\nimport { SessionRecording } from './extensions/replay/sessionrecording'\nimport { Decide } from './decide'\nimport { Toolbar } from './extensions/toolbar'\nimport { clearOptInOut, hasOptedIn, hasOptedOut, optIn, optOut, userOptedOut } from './gdpr-utils'\nimport { cookieStore, localStore } from './storage'\nimport { RequestQueue } from './request-queue'\nimport { compressData, decideCompression } from './compression'\nimport { addParamsToURL, encodePostData, request } from './send-request'\nimport { RetryQueue } from './retry-queue'\nimport { SessionIdManager } from './sessionid'\nimport { RequestRouter } from './utils/request-router'\nimport {\n    AutocaptureConfig,\n    CaptureOptions,\n    CaptureResult,\n    Compression,\n    DecideResponse,\n    EarlyAccessFeatureCallback,\n    GDPROptions,\n    isFeatureEnabledOptions,\n    JsonType,\n    OptInOutCapturingOptions,\n    PostHogConfig,\n    Properties,\n    Property,\n    RequestCallback,\n    SessionIdChangedCallback,\n    SnippetArrayItem,\n    ToolbarParams,\n    XHROptions,\n} from './types'\nimport { SentryIntegration } from './extensions/sentry-integration'\nimport { createSegmentIntegration } from './extensions/segment-integration'\nimport { PageViewManager } from './page-view'\nimport { PostHogSurveys } from './posthog-surveys'\nimport { RateLimiter } from './rate-limiter'\nimport { uuidv7 } from './uuidv7'\nimport { SurveyCallback } from './posthog-surveys-types'\nimport {\n    _isArray,\n    _isEmptyObject,\n    _isEmptyString,\n    _isFunction,\n    _isNumber,\n    _isObject,\n    _isString,\n    _isUndefined,\n} from './utils/type-utils'\nimport { _info } from './utils/event-utils'\nimport { logger } from './utils/logger'\nimport { document, userAgent } from './utils/globals'\nimport { SessionPropsManager } from './session-props'\nimport { _isBlockedUA } from './utils/blocked-uas'\nimport { SUPPORTS_REQUEST } from './utils/request-utils'\n\n/*\nSIMPLE STYLE GUIDE:\n\nthis.x === public function\nthis._x === internal - only use within this file\nthis.__x === private - only use within the class\n\nGlobals should be all caps\n*/\n\nenum InitType {\n    INIT_MODULE = 0,\n    INIT_SNIPPET = 1,\n}\n\nlet init_type: InitType\n\n// TODO: the type of this is very loose. Sometimes it's also PostHogLib itself\nlet posthog_main: Record<string, PostHog> & {\n    init: (token: string, config: Partial<PostHogConfig>, name: string) => void\n}\n\n// some globals for comparisons\nconst __NOOP = () => {}\nconst __NOOPTIONS = {}\n\nconst PRIMARY_INSTANCE_NAME = 'posthog'\n\n/*\n * Dynamic... constants? Is that an oxymoron?\n */\n// http://hacks.mozilla.org/2009/07/cross-site-xmlhttprequest-with-cors/\n// https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest#withCredentials\n\n// IE<10 does not support cross-origin XHR's but script tags\n// with defer won't block window.onload; ENQUEUE_REQUESTS\n// should only be true for Opera<12\nlet ENQUEUE_REQUESTS = !SUPPORTS_REQUEST && userAgent?.indexOf('MSIE') === -1 && userAgent?.indexOf('Mozilla') === -1\n\nexport const defaultConfig = (): PostHogConfig => ({\n    api_host: 'https://app.posthog.com',\n    api_method: 'POST',\n    api_transport: 'XHR',\n    ui_host: null,\n    token: '',\n    autocapture: true,\n    rageclick: true,\n    cross_subdomain_cookie: isCrossDomainCookie(document?.location),\n    persistence: 'localStorage+cookie', // up to 1.92.0 this was 'cookie'. It's easy to migrate as 'localStorage+cookie' will migrate data from cookie storage\n    persistence_name: '',\n    cookie_name: '',\n    loaded: __NOOP,\n    store_google: true,\n    custom_campaign_params: [],\n    custom_blocked_useragents: [],\n    save_referrer: true,\n    capture_pageview: true,\n    capture_pageleave: true, // We'll only capture pageleave events if capture_pageview is also true\n    debug: false,\n    verbose: false,\n    cookie_expiration: 365,\n    upgrade: false,\n    disable_session_recording: false,\n    disable_persistence: false,\n    disable_cookie: false,\n    enable_recording_console_log: undefined, // When undefined, it falls back to the server-side setting\n    secure_cookie: window?.location?.protocol === 'https:',\n    ip: true,\n    opt_out_capturing_by_default: false,\n    opt_out_persistence_by_default: false,\n    opt_out_useragent_filter: false,\n    opt_out_capturing_persistence_type: 'localStorage',\n    opt_out_capturing_cookie_prefix: null,\n    opt_in_site_apps: false,\n    // Deprecated, use property_denylist instead.\n    property_blacklist: [],\n    property_denylist: [],\n    respect_dnt: false,\n    sanitize_properties: null,\n    request_headers: {}, // { header: value, header2: value }\n    inapp_protocol: '//',\n    inapp_link_new_window: false,\n    request_batching: true,\n    properties_string_max_length: 65535,\n    session_recording: {},\n    mask_all_element_attributes: false,\n    mask_all_text: false,\n    advanced_disable_decide: false,\n    advanced_disable_feature_flags: false,\n    advanced_disable_feature_flags_on_first_load: false,\n    advanced_disable_toolbar_metrics: false,\n    on_request_error: (req) => {\n        const error = 'Bad HTTP status: ' + req.statusCode + ' ' + req.responseText\n        logger.error(error)\n    },\n    get_device_id: (uuid) => uuid,\n    // Used for internal testing\n    _onCapture: __NOOP,\n    capture_performance: undefined,\n    name: 'posthog',\n    bootstrap: {},\n    disable_compression: false,\n    session_idle_timeout_seconds: 30 * 60, // 30 minutes\n})\n\n/**\n * create_phlib(token:string, config:object, name:string)\n *\n * This function is used by the init method of PostHogLib objects\n * as well as the main initializer at the end of the JSLib (that\n * initializes document.posthog as well as any additional instances\n * declared before this file has loaded).\n */\nconst create_phlib = function (\n    token: string,\n    config?: Partial<PostHogConfig>,\n    name?: string,\n    createComplete?: (instance: PostHog) => void\n): PostHog {\n    let instance: PostHog\n    const target =\n        name === PRIMARY_INSTANCE_NAME || !posthog_main ? posthog_main : name ? posthog_main[name] : undefined\n    const callbacksHandled = {\n        initComplete: false,\n        syncCode: false,\n    }\n    const handleCallback = (callbackName: keyof typeof callbacksHandled) => (instance: PostHog) => {\n        if (!callbacksHandled[callbackName]) {\n            callbacksHandled[callbackName] = true\n            if (callbacksHandled.initComplete && callbacksHandled.syncCode) {\n                createComplete?.(instance)\n            }\n        }\n    }\n\n    if (target && init_type === InitType.INIT_MODULE) {\n        instance = target as any\n    } else {\n        if (target && !_isArray(target)) {\n            logger.error('You have already initialized ' + name)\n            // TODO: throw something instead?\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return\n        }\n        instance = new PostHog()\n    }\n\n    instance._init(token, config, name, handleCallback('initComplete'))\n    instance.toolbar.maybeLoadToolbar()\n\n    instance.sessionRecording = new SessionRecording(instance)\n    instance.sessionRecording.startRecordingIfEnabled()\n\n    if (!instance.config.disable_scroll_properties) {\n        instance.pageViewManager.startMeasuringScrollPosition()\n    }\n\n    instance.__autocapture = instance.config.autocapture\n    autocapture._setIsAutocaptureEnabled(instance)\n    if (autocapture._isAutocaptureEnabled) {\n        instance.__autocapture = instance.config.autocapture\n        const num_buckets = 100\n        const num_enabled_buckets = 100\n        if (!autocapture.enabledForProject(instance.config.token, num_buckets, num_enabled_buckets)) {\n            instance.__autocapture = false\n            logger.info('Not in active bucket: disabling Automatic Event Collection.')\n        } else if (!autocapture.isBrowserSupported()) {\n            instance.__autocapture = false\n            logger.info('Disabling Automatic Event Collection because this browser is not supported')\n        } else {\n            autocapture.init(instance)\n        }\n    }\n\n    // if any instance on the page has debug = true, we set the\n    // global debug to be true\n    Config.DEBUG = Config.DEBUG || instance.config.debug\n\n    // if target is not defined, we called init after the lib already\n    // loaded, so there won't be an array of things to execute\n    if (!_isUndefined(target) && _isArray(target)) {\n        // Crunch through the people queue first - we queue this data up &\n        // flush on identify, so it's better to do all these operations first\n        instance._execute_array.call(instance.people, (target as any).people)\n        instance._execute_array(target)\n    }\n\n    handleCallback('syncCode')(instance)\n    return instance\n}\n\nclass DeprecatedWebPerformanceObserver {\n    get _forceAllowLocalhost(): boolean {\n        return this.__forceAllowLocalhost\n    }\n    set _forceAllowLocalhost(value: boolean) {\n        logger.error(\n            'WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`'\n        )\n        this.__forceAllowLocalhost = value\n    }\n    private __forceAllowLocalhost: boolean = false\n}\n\n/**\n * PostHog Library Object\n * @constructor\n */\nexport class PostHog {\n    __loaded: boolean\n    __loaded_recorder_version: 'v1' | 'v2' | undefined // flag that keeps track of which version of recorder is loaded\n    config: PostHogConfig\n\n    rateLimiter: RateLimiter\n    pageViewManager: PageViewManager\n    featureFlags: PostHogFeatureFlags\n    surveys: PostHogSurveys\n    toolbar: Toolbar\n\n    // These are instance-specific state created after initialisation\n    persistence?: PostHogPersistence\n    sessionPersistence?: PostHogPersistence\n    sessionManager?: SessionIdManager\n    sessionPropsManager?: SessionPropsManager\n    requestRouter: RequestRouter\n\n    _requestQueue?: RequestQueue\n    _retryQueue?: RetryQueue\n    sessionRecording?: SessionRecording\n    webPerformance = new DeprecatedWebPerformanceObserver()\n\n    _triggered_notifs: any\n    compression: Partial<Record<Compression, boolean>>\n    __captureHooks: ((eventName: string) => void)[]\n    __request_queue: [url: string, data: Record<string, any>, options: XHROptions, callback?: RequestCallback][]\n    __autocapture: boolean | AutocaptureConfig | undefined\n    decideEndpointWasHit: boolean\n    analyticsDefaultEndpoint: string\n    elementsChainAsString: boolean\n\n    SentryIntegration: typeof SentryIntegration\n    segmentIntegration: () => any\n\n    /** DEPRECATED: We keep this to support existing usage but now one should just call .setPersonProperties */\n    people: {\n        set: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n        set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => void\n    }\n\n    constructor() {\n        this.config = defaultConfig()\n        this.compression = {}\n        this.decideEndpointWasHit = false\n        this.SentryIntegration = SentryIntegration\n        this.segmentIntegration = () => createSegmentIntegration(this)\n        this.__captureHooks = []\n        this.__request_queue = []\n        this.__loaded = false\n        this.__loaded_recorder_version = undefined\n        this.__autocapture = undefined\n        this.analyticsDefaultEndpoint = '/e/'\n        this.elementsChainAsString = false\n\n        this.featureFlags = new PostHogFeatureFlags(this)\n        this.toolbar = new Toolbar(this)\n        this.pageViewManager = new PageViewManager(this)\n        this.surveys = new PostHogSurveys(this)\n        this.rateLimiter = new RateLimiter()\n        this.requestRouter = new RequestRouter(this)\n\n        // NOTE: See the property definition for deprecation notice\n        this.people = {\n            set: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = _isString(prop) ? { [prop]: to } : prop\n                this.setPersonProperties(setProps)\n                callback?.({})\n            },\n            set_once: (prop: string | Properties, to?: string, callback?: RequestCallback) => {\n                const setProps = _isString(prop) ? { [prop]: to } : prop\n                this.setPersonProperties(undefined, setProps)\n                callback?.({})\n            },\n        }\n    }\n\n    // Initialization methods\n\n    /**\n     * This function initializes a new instance of the PostHog capturing object.\n     * All new instances are added to the main posthog object as sub properties (such as\n     * posthog.library_name) and also returned by this function. To define a\n     * second instance on the page, you would call:\n     *\n     *     posthog.init('new token', { your: 'config' }, 'library_name');\n     *\n     * and use it like so:\n     *\n     *     posthog.library_name.capture(...);\n     *\n     * @param {String} token   Your PostHog API token\n     * @param {Object} [config]  A dictionary of config options to override. <a href=\"https://github.com/posthog/posthog-js/blob/6e0e873/src/posthog-core.js#L57-L91\">See a list of default config options</a>.\n     * @param {String} [name]    The name for the new posthog instance that you want created\n     */\n    init(token: string, config?: Partial<PostHogConfig>, name?: string): PostHog | void {\n        if (_isUndefined(name)) {\n            logger.critical('You must name your new library: init(token, config, name)')\n            return\n        }\n\n        if (_isUndefined(token) || _isEmptyString(token)) {\n            logger.critical('You must provide a token to initialize posthog')\n            return\n        }\n\n        if (name === PRIMARY_INSTANCE_NAME) {\n            logger.critical(\n                'You must initialize the main posthog object right after you include the PostHog js snippet'\n            )\n            return\n        }\n\n        const instance: PostHog = create_phlib(token, config, name, (instance: PostHog) => {\n            posthog_main[name] = instance\n            instance._loaded()\n        })\n        posthog_main[name] = instance\n\n        return instance\n    }\n\n    // posthog._init(token:string, config:object, name:string)\n    //\n    // This function sets up the current instance of the posthog\n    // library.  The difference between this method and the init(...)\n    // method is this one initializes the actual instance, whereas the\n    // init(...) method sets up a new library and calls _init on it.\n    //\n    // Note that there are operations that can be asynchronous, so we\n    // accept a callback that is called when all the asynchronous work\n    // is done. Note that we do not use promises because we want to be\n    // IE11 compatible. We could use polyfills, which would make the\n    // code a bit cleaner, but will add some overhead.\n    //\n    _init(\n        token: string,\n        config: Partial<PostHogConfig> = {},\n        name?: string,\n        initComplete?: (instance: PostHog) => void\n    ): void {\n        this.__loaded = true\n        this.config = {} as PostHogConfig // will be set right below\n        this._triggered_notifs = []\n\n        // To avoid using Promises and their helper functions, we instead keep\n        // track of which callbacks have been called, and then call initComplete\n        // when all of them have been called. To add additional async code, add\n        // to `callbacksHandled` and pass updateInitComplete as a callback to\n        // the async code.\n        const callbacksHandled = { segmentRegister: false, syncCode: false }\n        const updateInitComplete = (callbackName: keyof typeof callbacksHandled) => () => {\n            // Update the register of callbacks that have been called, and if\n            // they have all been called, then we are ready to call\n            // initComplete.\n            if (!callbacksHandled[callbackName]) {\n                callbacksHandled[callbackName] = true\n                if (callbacksHandled.segmentRegister && callbacksHandled.syncCode) {\n                    initComplete?.(this)\n                }\n            }\n        }\n\n        // Check for deprecated params that might still be in use\n        config.request_headers = config.request_headers || config.xhr_headers\n\n        this.set_config(\n            _extend({}, defaultConfig(), config, {\n                name: name,\n                token: token,\n            })\n        )\n\n        // Check if recorder.js is already loaded\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        if (window?.rrweb?.record || window?.rrwebRecord) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            this.__loaded_recorder_version = window?.rrweb?.version\n        }\n\n        this.persistence = new PostHogPersistence(this.config)\n        this.sessionPersistence =\n            this.config.persistence === 'sessionStorage'\n                ? this.persistence\n                : new PostHogPersistence({ ...this.config, persistence: 'sessionStorage' })\n\n        this._requestQueue = new RequestQueue(this._handle_queued_event.bind(this))\n        this._retryQueue = new RetryQueue(this.config.on_request_error, this.rateLimiter)\n        this.__captureHooks = []\n        this.__request_queue = []\n\n        this.sessionManager = new SessionIdManager(this.config, this.persistence)\n        this.sessionPropsManager = new SessionPropsManager(this.sessionManager, this.persistence)\n\n        this._gdpr_init()\n\n        if (config.segment) {\n            // Use segments anonymousId instead\n            this.config.get_device_id = () => config.segment.user().anonymousId()\n\n            // If a segment user ID exists, set it as the distinct_id\n            if (config.segment.user().id()) {\n                this.register({\n                    distinct_id: config.segment.user().id(),\n                })\n                this.persistence.set_user_state('identified')\n            }\n\n            config.segment.register(this.segmentIntegration()).then(updateInitComplete('segmentRegister'))\n        } else {\n            updateInitComplete('segmentRegister')()\n        }\n\n        // isUndefined doesn't provide typehint here so wouldn't reduce bundle as we'd need to assign\n        // eslint-disable-next-line posthog-js/no-direct-undefined-check\n        if (config.bootstrap?.distinctID !== undefined) {\n            const uuid = this.config.get_device_id(uuidv7())\n            const deviceID = config.bootstrap?.isIdentifiedID ? uuid : config.bootstrap.distinctID\n            this.persistence.set_user_state(config.bootstrap?.isIdentifiedID ? 'identified' : 'anonymous')\n            this.register({\n                distinct_id: config.bootstrap.distinctID,\n                $device_id: deviceID,\n            })\n        }\n\n        if (this._hasBootstrappedFeatureFlags()) {\n            const activeFlags = Object.keys(config.bootstrap?.featureFlags || {})\n                .filter((flag) => !!config.bootstrap?.featureFlags?.[flag])\n                .reduce(\n                    (res: Record<string, string | boolean>, key) => (\n                        (res[key] = config.bootstrap?.featureFlags?.[key] || false), res\n                    ),\n                    {}\n                )\n            const featureFlagPayloads = Object.keys(config.bootstrap?.featureFlagPayloads || {})\n                .filter((key) => activeFlags[key])\n                .reduce((res: Record<string, JsonType>, key) => {\n                    if (config.bootstrap?.featureFlagPayloads?.[key]) {\n                        res[key] = config.bootstrap?.featureFlagPayloads?.[key]\n                    }\n                    return res\n                }, {})\n\n            this.featureFlags.receivedFeatureFlags({ featureFlags: activeFlags, featureFlagPayloads })\n        }\n\n        if (!this.get_distinct_id()) {\n            // There is no need to set the distinct id\n            // or the device id if something was already stored\n            // in the persitence\n            const uuid = this.config.get_device_id(uuidv7())\n            this.register_once(\n                {\n                    distinct_id: uuid,\n                    $device_id: uuid,\n                },\n                ''\n            )\n            // distinct id == $device_id is a proxy for anonymous user\n            this.persistence.set_user_state('anonymous')\n        }\n        // Set up event handler for pageleave\n        // Use `onpagehide` if available, see https://calendar.perfplanet.com/2020/beaconing-in-practice/#beaconing-reliability-avoiding-abandons\n        window?.addEventListener?.('onpagehide' in self ? 'pagehide' : 'unload', this._handle_unload.bind(this))\n\n        // Make sure that we also call the initComplete callback at the end of\n        // the synchronous code as well.\n        updateInitComplete('syncCode')()\n    }\n\n    // Private methods\n\n    _afterDecideResponse(response: DecideResponse) {\n        this.compression = {}\n        if (response.supportedCompression && !this.config.disable_compression) {\n            const compression: Partial<Record<Compression, boolean>> = {}\n            for (const method of response['supportedCompression']) {\n                compression[method] = true\n            }\n            this.compression = compression\n        }\n\n        if (response.analytics?.endpoint) {\n            this.analyticsDefaultEndpoint = response.analytics.endpoint\n        }\n\n        if (response.elementsChainAsString) {\n            this.elementsChainAsString = response.elementsChainAsString\n        }\n    }\n\n    _loaded(): void {\n        // Pause `reloadFeatureFlags` calls in config.loaded callback.\n        // These feature flags are loaded in the decide call made right\n        // afterwards\n        const disableDecide = this.config.advanced_disable_decide\n        if (!disableDecide) {\n            this.featureFlags.setReloadingPaused(true)\n        }\n\n        try {\n            this.config.loaded(this)\n        } catch (err) {\n            logger.critical('`loaded` function failed', err)\n        }\n\n        this._start_queue_if_opted_in()\n\n        // this happens after so a user can call identify in\n        // the loaded callback\n        if (this.config.capture_pageview && document) {\n            this.capture('$pageview', { title: document.title }, { send_instantly: true })\n        }\n\n        // Call decide to get what features are enabled and other settings.\n        // As a reminder, if the /decide endpoint is disabled, feature flags, toolbar, session recording, autocapture,\n        // and compression will not be available.\n        if (!disableDecide) {\n            new Decide(this).call()\n\n            // TRICKY: Reset any decide reloads queued during config.loaded because they'll be\n            // covered by the decide call right above.\n            this.featureFlags.resetRequestQueue()\n        }\n    }\n\n    _start_queue_if_opted_in(): void {\n        if (!this.has_opted_out_capturing()) {\n            if (this.config.request_batching) {\n                this._requestQueue?.poll()\n            }\n        }\n    }\n\n    _dom_loaded(): void {\n        if (!this.has_opted_out_capturing()) {\n            _eachArray(this.__request_queue, (item) => {\n                this._send_request(...item)\n            })\n        }\n\n        this.__request_queue = []\n\n        this._start_queue_if_opted_in()\n    }\n\n    _handle_unload(): void {\n        if (!this.config.request_batching) {\n            if (this.config.capture_pageview && this.config.capture_pageleave) {\n                this.capture('$pageleave', null, { transport: 'sendBeacon' })\n            }\n            return\n        }\n\n        if (this.config.capture_pageview && this.config.capture_pageleave) {\n            this.capture('$pageleave')\n        }\n\n        this._requestQueue?.unload()\n        this._retryQueue?.unload()\n    }\n\n    _handle_queued_event(url: string, data: Record<string, any>, options?: XHROptions): void {\n        const jsonData = JSON.stringify(data)\n        this.__compress_and_send_json_request(url, jsonData, options || __NOOPTIONS, __NOOP)\n    }\n\n    __compress_and_send_json_request(\n        url: string,\n        jsonData: string,\n        options: XHROptions,\n        callback?: RequestCallback\n    ): void {\n        const [data, _options] = compressData(decideCompression(this.compression), jsonData, options)\n        this._send_request(url, data, _options, callback)\n    }\n\n    _send_request(url: string, data: Record<string, any>, options: CaptureOptions, callback?: RequestCallback): void {\n        if (!this.__loaded || !this._retryQueue) {\n            return\n        }\n        if (this.rateLimiter.isRateLimited(options._batchKey)) {\n            return\n        }\n\n        if (ENQUEUE_REQUESTS) {\n            this.__request_queue.push([url, data, options, callback])\n            return\n        }\n\n        const DEFAULT_OPTIONS = {\n            method: this.config.api_method,\n            transport: this.config.api_transport,\n            verbose: this.config.verbose,\n        }\n\n        options = _extend(DEFAULT_OPTIONS, options || {})\n        if (!SUPPORTS_REQUEST) {\n            options.method = 'GET'\n        }\n\n        const useSendBeacon = window && 'sendBeacon' in window.navigator && options.transport === 'sendBeacon'\n        url = addParamsToURL(url, options.urlQueryArgs || {}, {\n            ip: this.config.ip,\n        })\n\n        if (useSendBeacon) {\n            // beacon documentation https://w3c.github.io/beacon/\n            // beacons format the message and use the type property\n            try {\n                window?.navigator.sendBeacon(url, encodePostData(data, { ...options, sendBeacon: true }))\n            } catch (e) {\n                // send beacon is a best-effort, fire-and-forget mechanism on page unload,\n                // we don't want to throw errors here\n            }\n        } else if (SUPPORTS_REQUEST || !document) {\n            try {\n                request({\n                    url,\n                    data,\n                    headers: this.config.request_headers,\n                    options,\n                    callback,\n                    retriesPerformedSoFar: 0,\n                    retryQueue: this._retryQueue,\n                    onError: this.config.on_request_error,\n                    onResponse: this.rateLimiter.checkForLimiting,\n                })\n            } catch (e) {\n                logger.error(e)\n            }\n        } else {\n            const script = document.createElement('script')\n            script.type = 'text/javascript'\n            script.async = true\n            script.defer = true\n            script.src = url\n            const s = document.getElementsByTagName('script')[0]\n            s.parentNode?.insertBefore(script, s)\n        }\n    }\n\n    /**\n     * _execute_array() deals with processing any posthog function\n     * calls that were called before the PostHog library were loaded\n     * (and are thus stored in an array so they can be called later)\n     *\n     * Note: we fire off all the posthog function calls && user defined\n     * functions BEFORE we fire off posthog capturing calls. This is so\n     * identify/register/set_config calls can properly modify early\n     * capturing calls.\n     *\n     * @param {Array} array\n     */\n    _execute_array(array: SnippetArrayItem[]): void {\n        let fn_name\n        const alias_calls: SnippetArrayItem[] = []\n        const other_calls: SnippetArrayItem[] = []\n        const capturing_calls: SnippetArrayItem[] = []\n        _eachArray(array, (item) => {\n            if (item) {\n                fn_name = item[0]\n                if (_isArray(fn_name)) {\n                    capturing_calls.push(item) // chained call e.g. posthog.get_group().set()\n                } else if (_isFunction(item)) {\n                    ;(item as any).call(this)\n                } else if (_isArray(item) && fn_name === 'alias') {\n                    alias_calls.push(item)\n                } else if (_isArray(item) && fn_name.indexOf('capture') !== -1 && _isFunction((this as any)[fn_name])) {\n                    capturing_calls.push(item)\n                } else {\n                    other_calls.push(item)\n                }\n            }\n        })\n\n        const execute = function (calls: SnippetArrayItem[], thisArg: any) {\n            _eachArray(\n                calls,\n                function (item) {\n                    if (_isArray(item[0])) {\n                        // chained call\n                        let caller = thisArg\n                        _each(item, function (call) {\n                            caller = caller[call[0]].apply(caller, call.slice(1))\n                        })\n                    } else {\n                        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                        // @ts-ignore\n                        this[item[0]].apply(this, item.slice(1))\n                    }\n                },\n                thisArg\n            )\n        }\n\n        execute(alias_calls, this)\n        execute(other_calls, this)\n        execute(capturing_calls, this)\n    }\n\n    _hasBootstrappedFeatureFlags(): boolean {\n        return (\n            (this.config.bootstrap?.featureFlags && Object.keys(this.config.bootstrap?.featureFlags).length > 0) ||\n            false\n        )\n    }\n\n    /**\n     * push() keeps the standard async-array-push\n     * behavior around after the lib is loaded.\n     * This is only useful for external integrations that\n     * do not wish to rely on our convenience methods\n     * (created in the snippet).\n     *\n     * ### Usage:\n     *     posthog.push(['register', { a: 'b' }]);\n     *\n     * @param {Array} item A [function_name, args...] array to be executed\n     */\n    push(item: SnippetArrayItem): void {\n        this._execute_array([item])\n    }\n\n    /**\n     * Capture an event. This is the most important and\n     * frequently used PostHog function.\n     *\n     * ### Usage:\n     *\n     *     // capture an event named 'Registered'\n     *     posthog.capture('Registered', {'Gender': 'Male', 'Age': 21});\n     *\n     *     // capture an event using navigator.sendBeacon\n     *     posthog.capture('Left page', {'duration_seconds': 35}, {transport: 'sendBeacon'});\n     *\n     * @param {String} event_name The name of the event. This can be anything the user does - 'Button Click', 'Sign Up', 'Item Purchased', etc.\n     * @param {Object} [properties] A set of properties to include with the event you're sending. These describe the user who did the event or details about the event itself.\n     * @param {Object} [options] Optional configuration for this capture request.\n     * @param {String} [options.transport] Transport method for network request ('XHR' or 'sendBeacon').\n     * @param {Date} [options.timestamp] Timestamp is a Date object. If not set, it'll automatically be set to the current time.\n     */\n    capture(\n        event_name: string,\n        properties?: Properties | null,\n        options: CaptureOptions = __NOOPTIONS\n    ): CaptureResult | void {\n        // While developing, a developer might purposefully _not_ call init(),\n        // in this case, we would like capture to be a noop.\n        if (!this.__loaded || !this.sessionPersistence || !this._requestQueue) {\n            return logger.uninitializedWarning('posthog.capture')\n        }\n\n        if (userOptedOut(this)) {\n            return\n        }\n\n        options = options || __NOOPTIONS\n        const transport = options['transport'] // external API, don't minify 'transport' prop\n        if (transport) {\n            options.transport = transport // 'transport' prop name can be minified internally\n        }\n\n        // typing doesn't prevent interesting data\n        if (_isUndefined(event_name) || !_isString(event_name)) {\n            logger.error('No event name provided to posthog.capture')\n            return\n        }\n\n        if (\n            userAgent &&\n            !this.config.opt_out_useragent_filter &&\n            _isBlockedUA(userAgent, this.config.custom_blocked_useragents)\n        ) {\n            return\n        }\n\n        // update persistence\n        this.sessionPersistence.update_search_keyword()\n\n        if (this.config.store_google) {\n            this.sessionPersistence.update_campaign_params()\n        }\n        if (this.config.save_referrer) {\n            this.sessionPersistence.update_referrer_info()\n        }\n\n        let data: CaptureResult = {\n            uuid: uuidv7(),\n            event: event_name,\n            properties: this._calculate_event_properties(event_name, properties || {}),\n        }\n\n        if (event_name === '$identify') {\n            data['$set'] = options['$set']\n            data['$set_once'] = options['$set_once']\n        }\n\n        data = _copyAndTruncateStrings(data, options._noTruncate ? null : this.config.properties_string_max_length)\n        data.timestamp = options.timestamp || new Date()\n        if (!_isUndefined(options.timestamp)) {\n            data.properties['$event_time_override_provided'] = true\n            data.properties['$event_time_override_system_time'] = new Date()\n        }\n\n        // Top-level $set overriding values from the one from properties is taken from the plugin-server normalizeEvent\n        // This doesn't handle $set_once, because posthog-people doesn't either\n        const finalSet = { ...data.properties['$set'], ...data['$set'] }\n        if (!_isEmptyObject(finalSet)) {\n            this.setPersonPropertiesForFlags(finalSet)\n        }\n\n        logger.info('send', data)\n        const jsonData = JSON.stringify(data)\n\n        const url = options._url ?? this.requestRouter.endpointFor('api', this.analyticsDefaultEndpoint)\n\n        const has_unique_traits = options !== __NOOPTIONS\n\n        if (this.config.request_batching && (!has_unique_traits || options._batchKey) && !options.send_instantly) {\n            this._requestQueue.enqueue(url, data, options)\n        } else {\n            this.__compress_and_send_json_request(url, jsonData, options)\n        }\n\n        this._invokeCaptureHooks(event_name, data)\n\n        return data\n    }\n\n    _addCaptureHook(callback: (eventName: string) => void): void {\n        this.__captureHooks.push(callback)\n    }\n\n    _invokeCaptureHooks(eventName: string, eventData: CaptureResult): void {\n        this.config._onCapture(eventName, eventData)\n        _each(this.__captureHooks, (callback) => callback(eventName))\n    }\n\n    _calculate_event_properties(event_name: string, event_properties: Properties): Properties {\n        if (!this.persistence || !this.sessionPersistence) {\n            return event_properties\n        }\n\n        // set defaults\n        const start_timestamp = this.persistence.remove_event_timer(event_name)\n        let properties = { ...event_properties }\n        properties['token'] = this.config.token\n\n        if (event_name === '$snapshot') {\n            const persistenceProps = { ...this.persistence.properties(), ...this.sessionPersistence.properties() }\n            properties['distinct_id'] = persistenceProps.distinct_id\n            return properties\n        }\n\n        const infoProperties = _info.properties()\n\n        if (this.sessionManager) {\n            const { sessionId, windowId } = this.sessionManager.checkAndGetSessionAndWindowId()\n            properties['$session_id'] = sessionId\n            properties['$window_id'] = windowId\n        }\n\n        if (\n            this.sessionPropsManager &&\n            this.config.__preview_send_client_session_params &&\n            (event_name === '$pageview' || event_name === '$pageleave' || event_name === '$autocapture')\n        ) {\n            const sessionProps = this.sessionPropsManager.getSessionProps()\n            properties = _extend(properties, sessionProps)\n        }\n\n        if (!this.config.disable_scroll_properties) {\n            let performanceProperties: Record<string, any> = {}\n            if (event_name === '$pageview') {\n                performanceProperties = this.pageViewManager.doPageView()\n            } else if (event_name === '$pageleave') {\n                performanceProperties = this.pageViewManager.doPageLeave()\n            }\n            properties = _extend(properties, performanceProperties)\n        }\n\n        if (event_name === '$pageview' && document) {\n            properties['title'] = document.title\n        }\n\n        if (event_name === '$performance_event') {\n            const persistenceProps = this.persistence.properties()\n            // Early exit for $performance_event as we only need session and $current_url\n            properties['distinct_id'] = persistenceProps.distinct_id\n            properties['$current_url'] = infoProperties.$current_url\n            return properties\n        }\n\n        // set $duration if time_event was previously called for this event\n        if (!_isUndefined(start_timestamp)) {\n            const duration_in_ms = new Date().getTime() - start_timestamp\n            properties['$duration'] = parseFloat((duration_in_ms / 1000).toFixed(3))\n        }\n\n        // this is only added when this.config.opt_out_useragent_filter is true,\n        // or it would always add \"browser\"\n        if (userAgent && this.config.opt_out_useragent_filter) {\n            properties['$browser_type'] = _isBlockedUA(userAgent, this.config.custom_blocked_useragents)\n                ? 'bot'\n                : 'browser'\n        }\n\n        // note: extend writes to the first object, so lets make sure we\n        // don't write to the persistence properties object and info\n        // properties object by passing in a new object\n\n        // update properties with pageview info and super-properties\n        properties = _extend(\n            {},\n            _info.properties(),\n            this.persistence.properties(),\n            this.sessionPersistence.properties(),\n            properties\n        )\n\n        if (_isArray(this.config.property_denylist) && _isArray(this.config.property_blacklist)) {\n            // since property_blacklist is deprecated in favor of property_denylist, we merge both of them here\n            // TODO: merge this only once, requires refactoring tests\n            const property_denylist = [...this.config.property_blacklist, ...this.config.property_denylist]\n            _each(property_denylist, function (denylisted_prop) {\n                delete properties[denylisted_prop]\n            })\n        } else {\n            logger.error(\n                'Invalid value for property_denylist config: ' +\n                    this.config.property_denylist +\n                    ' or property_blacklist config: ' +\n                    this.config.property_blacklist\n            )\n        }\n\n        const sanitize_properties = this.config.sanitize_properties\n        if (sanitize_properties) {\n            properties = sanitize_properties(properties, event_name)\n        }\n\n        return properties\n    }\n\n    /**\n     * Register a set of super properties, which are included with all\n     * events. This will overwrite previous super property values, except\n     * for session properties (see `register_for_session(properties)`).\n     *\n     * ### Usage:\n     *\n     *     // register 'Gender' as a super property\n     *     posthog.register({'Gender': 'Female'});\n     *\n     *     // register several super properties when a user signs up\n     *     posthog.register({\n     *         'Email': 'jdoe@example.com',\n     *         'Account Type': 'Free'\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {Number} [days] How many days since the user's last visit to store the super properties\n     */\n    register(properties: Properties, days?: number): void {\n        this.persistence?.register(properties, days)\n    }\n\n    /**\n     * Register a set of super properties only once. These will not\n     * overwrite previous super property values, unlike register().\n     *\n     * ### Usage:\n     *\n     *     // register a super property for the first time only\n     *     posthog.register_once({\n     *         'First Login Date': new Date().toISOString()\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.persistence.properties())\n     *\n     * ### Notes:\n     *\n     * If default_value is specified, current super properties\n     * with that value will be overwritten.\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     * @param {*} [default_value] Value to override if already set in super properties (ex: 'False') Default: 'None'\n     * @param {Number} [days] How many days since the users last visit to store the super properties\n     */\n    register_once(properties: Properties, default_value?: Property, days?: number): void {\n        this.persistence?.register_once(properties, default_value, days)\n    }\n\n    /**\n     * Register a set of super properties, which are included with all events, but only\n     * for THIS SESSION. These will overwrite all other super property values.\n     *\n     * Unlike regular super properties, which last in LocalStorage for a long time,\n     * session super properties get cleared after a session ends.\n     *\n     * ### Usage:\n     *\n     *     // register on all events this session\n     *     posthog.register_for_session({'referer': customGetReferer()});\n     *\n     *     // register several session super properties when a user signs up\n     *     posthog.register_for_session({\n     *         'selectedPlan': 'pro',\n     *         'completedSteps': 4,\n     *     });\n     *\n     *     // Display the properties\n     *     console.log(posthog.sessionPersistence.properties())\n     *\n     * @param {Object} properties An associative array of properties to store about the user\n     */\n    register_for_session(properties: Properties): void {\n        this.sessionPersistence?.register(properties)\n    }\n\n    /**\n     * Delete a super property stored with the current user.\n     *\n     * @param {String} property The name of the super property to remove\n     */\n    unregister(property: string): void {\n        this.persistence?.unregister(property)\n    }\n\n    /**\n     * Delete a session super property stored with the current user.\n     *\n     * @param {String} property The name of the session super property to remove\n     */\n    unregister_for_session(property: string): void {\n        this.sessionPersistence?.unregister(property)\n    }\n\n    _register_single(prop: string, value: Property) {\n        this.register({ [prop]: value })\n    }\n\n    /*\n     * Get feature flag value for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    getFeatureFlag(key: string, options?: { send_event?: boolean }): boolean | string | undefined {\n        return this.featureFlags.getFeatureFlag(key, options)\n    }\n\n    /*\n     * Get feature flag payload value matching key for user (supports multivariate flags).\n     *\n     * ### Usage:\n     *\n     *     if(posthog.getFeatureFlag('beta-feature') === 'some-value') {\n     *          const someValue = posthog.getFeatureFlagPayload('beta-feature')\n     *          // do something\n     *     }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     */\n    getFeatureFlagPayload(key: string): JsonType {\n        const payload = this.featureFlags.getFeatureFlagPayload(key)\n        try {\n            return JSON.parse(payload as any)\n        } catch {\n            return payload\n        }\n    }\n\n    /*\n     * See if feature flag is enabled for user.\n     *\n     * ### Usage:\n     *\n     *     if(posthog.isFeatureEnabled('beta-feature')) { // do something }\n     *\n     * @param {Object|String} prop Key of the feature flag.\n     * @param {Object|String} options (optional) If {send_event: false}, we won't send an $feature_flag_call event to PostHog.\n     */\n    isFeatureEnabled(key: string, options?: isFeatureEnabledOptions): boolean | undefined {\n        return this.featureFlags.isFeatureEnabled(key, options)\n    }\n\n    reloadFeatureFlags(): void {\n        this.featureFlags.reloadFeatureFlags()\n    }\n\n    /** Opt the user in or out of an early access feature. */\n    updateEarlyAccessFeatureEnrollment(key: string, isEnrolled: boolean): void {\n        this.featureFlags.updateEarlyAccessFeatureEnrollment(key, isEnrolled)\n    }\n\n    /** Get the list of early access features. To check enrollment status, use `isFeatureEnabled`. */\n    getEarlyAccessFeatures(callback: EarlyAccessFeatureCallback, force_reload = false): void {\n        return this.featureFlags.getEarlyAccessFeatures(callback, force_reload)\n    }\n\n    /*\n     * Register an event listener that runs when feature flags become available or when they change.\n     * If there are flags, the listener is called immediately in addition to being called on future changes.\n     *\n     * ### Usage:\n     *\n     *     posthog.onFeatureFlags(function(featureFlags) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once the feature flags are ready or when they are updated.\n     *                              It'll return a list of feature flags enabled for the user.\n     * @returns {Function} A function that can be called to unsubscribe the listener. Used by useEffect when the component unmounts.\n     */\n    onFeatureFlags(callback: (flags: string[], variants: Record<string, string | boolean>) => void): () => void {\n        return this.featureFlags.onFeatureFlags(callback)\n    }\n\n    /*\n     * Register an event listener that runs whenever the session id or window id change.\n     * If there is already a session id, the listener is called immediately in addition to being called on future changes.\n     *\n     * Can be used, for example, to sync the PostHog session id with a backend session.\n     *\n     * ### Usage:\n     *\n     *     posthog.onSessionId(function(sessionId, windowId) { // do something })\n     *\n     * @param {Function} [callback] The callback function will be called once a session id is present or when it or the window id are updated.\n     * @returns {Function} A function that can be called to unsubscribe the listener. E.g. Used by useEffect when the component unmounts.\n     */\n    onSessionId(callback: SessionIdChangedCallback): () => void {\n        return this.sessionManager?.onSessionId(callback) ?? (() => {})\n    }\n\n    /** Get list of all surveys. */\n    getSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getSurveys(callback, forceReload)\n    }\n\n    /** Get surveys that should be enabled for the current user. */\n    getActiveMatchingSurveys(callback: SurveyCallback, forceReload = false): void {\n        this.surveys.getActiveMatchingSurveys(callback, forceReload)\n    }\n\n    /**\n     * Identify a user with a unique ID instead of a PostHog\n     * randomly generated distinct_id. If the method is never called,\n     * then unique visitors will be identified by a UUID that is generated\n     * the first time they visit the site.\n     *\n     * If user properties are passed, they are also sent to posthog.\n     *\n     * ### Usage:\n     *\n     *      posthog.identify('[user unique id]')\n     *      posthog.identify('[user unique id]', { email: 'john@example.com' })\n     *      posthog.identify('[user unique id]', {}, { referral_code: '12345' })\n     *\n     * ### Notes:\n     *\n     * You can call this function to overwrite a previously set\n     * unique ID for the current user.\n     *\n     * If the user has been identified ($user_state in persistence is set to 'identified'),\n     * then capture of $identify is skipped to avoid merging users. For example,\n     * if your system allows an admin user to impersonate another user.\n     *\n     * Then a single browser instance can have:\n     *\n     *  `identify('a') -> capture(1) -> identify('b') -> capture(2)`\n     *\n     * and capture 1 and capture 2 will have the correct distinct_id.\n     * but users a and b will NOT be merged in posthog.\n     *\n     * However, if reset is called then:\n     *\n     *  `identify('a') -> capture(1) -> reset() -> capture(2) -> identify('b') -> capture(3)`\n     *\n     * users a and b are not merged.\n     * Capture 1 is associated with user a.\n     * A new distinct id is generated for capture 2.\n     * which is merged with user b.\n     * So, capture 2 and 3 are associated with user b.\n     *\n     * If you want to merge two identified users, you can call posthog.alias\n     *\n     * @param {String} [new_distinct_id] A string that uniquely identifies a user. If not provided, the distinct_id currently in the persistent store (cookie or localStorage) will be used.\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    identify(new_distinct_id?: string, userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        if (!this.__loaded || !this.persistence) {\n            return logger.uninitializedWarning('posthog.identify')\n        }\n        if (_isNumber(new_distinct_id)) {\n            new_distinct_id = (new_distinct_id as number).toString()\n            logger.warn(\n                'The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.'\n            )\n        }\n\n        //if the new_distinct_id has not been set ignore the identify event\n        if (!new_distinct_id) {\n            logger.error('Unique user id has not been set in posthog.identify')\n            return\n        }\n\n        if (isDistinctIdStringLike(new_distinct_id)) {\n            logger.critical(\n                `The string \"${new_distinct_id}\" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.`\n            )\n            return\n        }\n\n        const previous_distinct_id = this.get_distinct_id()\n        this.register({ $user_id: new_distinct_id })\n\n        if (!this.get_property('$device_id')) {\n            // The persisted distinct id might not actually be a device id at all\n            // it might be a distinct id of the user from before\n            const device_id = previous_distinct_id\n            this.register_once(\n                {\n                    $had_persisted_distinct_id: true,\n                    $device_id: device_id,\n                },\n                ''\n            )\n        }\n\n        // if the previous distinct id had an alias stored, then we clear it\n        if (new_distinct_id !== previous_distinct_id && new_distinct_id !== this.get_property(ALIAS_ID_KEY)) {\n            this.unregister(ALIAS_ID_KEY)\n            this.register({ distinct_id: new_distinct_id })\n        }\n\n        const isKnownAnonymous = this.persistence.get_user_state() === 'anonymous'\n\n        // send an $identify event any time the distinct_id is changing and the old ID is an anoymous ID\n        // - logic on the server will determine whether or not to do anything with it.\n        if (new_distinct_id !== previous_distinct_id && isKnownAnonymous) {\n            this.persistence.set_user_state('identified')\n\n            // Update current user properties\n            this.setPersonPropertiesForFlags(userPropertiesToSet || {}, false)\n\n            this.capture(\n                '$identify',\n                {\n                    distinct_id: new_distinct_id,\n                    $anon_distinct_id: previous_distinct_id,\n                },\n                { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} }\n            )\n            // let the reload feature flag request know to send this previous distinct id\n            // for flag consistency\n            this.featureFlags.setAnonymousDistinctId(previous_distinct_id)\n        } else if (userPropertiesToSet || userPropertiesToSetOnce) {\n            // If the distinct_id is not changing, but we have user properties to set, we can go for a $set event\n            this.setPersonProperties(userPropertiesToSet, userPropertiesToSetOnce)\n        }\n\n        // Reload active feature flags if the user identity changes.\n        // Note we don't reload this on property changes as these get processed async\n        if (new_distinct_id !== previous_distinct_id) {\n            this.reloadFeatureFlags()\n            // also clear any stored flag calls\n            this.unregister(FLAG_CALL_REPORTED)\n        }\n    }\n\n    /**\n     * Sets properties for the Person associated with the current distinct_id.\n     *\n     *\n     * @param {Object} [userPropertiesToSet] Optional: An associative array of properties to store about the user\n     * @param {Object} [userPropertiesToSetOnce] Optional: An associative array of properties to store about the user. If property is previously set, this does not override that value.\n     */\n    setPersonProperties(userPropertiesToSet?: Properties, userPropertiesToSetOnce?: Properties): void {\n        if (!userPropertiesToSet && !userPropertiesToSetOnce) {\n            return\n        }\n\n        // Update current user properties\n        this.setPersonPropertiesForFlags(userPropertiesToSet || {})\n\n        this.capture('$set', { $set: userPropertiesToSet || {}, $set_once: userPropertiesToSetOnce || {} })\n    }\n\n    /**\n     * Alpha feature: don't use unless you know what you're doing!\n     *\n     * Sets group analytics information for subsequent events and reloads feature flags.\n     *\n     * @param {String} groupType Group type (example: 'organization')\n     * @param {String} groupKey Group key (example: 'org::5')\n     * @param {Object} groupPropertiesToSet Optional properties to set for group\n     */\n    group(groupType: string, groupKey: string, groupPropertiesToSet?: Properties): void {\n        if (!groupType || !groupKey) {\n            logger.error('posthog.group requires a group type and group key')\n            return\n        }\n\n        const existingGroups = this.getGroups()\n\n        // if group key changes, remove stored group properties\n        if (existingGroups[groupType] !== groupKey) {\n            this.resetGroupPropertiesForFlags(groupType)\n        }\n\n        this.register({ $groups: { ...existingGroups, [groupType]: groupKey } })\n\n        if (groupPropertiesToSet) {\n            this.capture('$groupidentify', {\n                $group_type: groupType,\n                $group_key: groupKey,\n                $group_set: groupPropertiesToSet,\n            })\n            this.setGroupPropertiesForFlags({ [groupType]: groupPropertiesToSet })\n        }\n\n        // If groups change and no properties change, reload feature flags.\n        // The property change reload case is handled in setGroupPropertiesForFlags.\n        if (existingGroups[groupType] !== groupKey && !groupPropertiesToSet) {\n            this.reloadFeatureFlags()\n        }\n    }\n\n    /**\n     * Resets only the group properties of the user currently logged in.\n     */\n    resetGroups(): void {\n        this.register({ $groups: {} })\n        this.resetGroupPropertiesForFlags()\n\n        // If groups changed, reload feature flags.\n        this.reloadFeatureFlags()\n    }\n\n    /**\n     * Set override person properties for feature flags.\n     * This is used when dealing with new persons / where you don't want to wait for ingestion\n     * to update user properties.\n     */\n    setPersonPropertiesForFlags(properties: Properties, reloadFeatureFlags = true): void {\n        this.featureFlags.setPersonPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetPersonPropertiesForFlags(): void {\n        this.featureFlags.resetPersonPropertiesForFlags()\n    }\n\n    /**\n     * Set override group properties for feature flags.\n     * This is used when dealing with new groups / where you don't want to wait for ingestion\n     * to update properties.\n     * Takes in an object, the key of which is the group type.\n     * For example:\n     *     setGroupPropertiesForFlags({'organization': { name: 'CYZ', employees: '11' } })\n     */\n    setGroupPropertiesForFlags(properties: { [type: string]: Properties }, reloadFeatureFlags = true): void {\n        this.featureFlags.setGroupPropertiesForFlags(properties, reloadFeatureFlags)\n    }\n\n    resetGroupPropertiesForFlags(group_type?: string): void {\n        this.featureFlags.resetGroupPropertiesForFlags(group_type)\n    }\n\n    /**\n     * Clears super properties and generates a new random distinct_id for this instance.\n     * Useful for clearing data when a user logs out.\n     */\n    reset(reset_device_id?: boolean): void {\n        if (!this.__loaded) {\n            return logger.uninitializedWarning('posthog.reset')\n        }\n        const device_id = this.get_property('$device_id')\n        this.persistence?.clear()\n        this.sessionPersistence?.clear()\n        this.persistence?.set_user_state('anonymous')\n        this.sessionManager?.resetSessionId()\n        const uuid = this.config.get_device_id(uuidv7())\n        this.register_once(\n            {\n                distinct_id: uuid,\n                $device_id: reset_device_id ? uuid : device_id,\n            },\n            ''\n        )\n    }\n\n    /**\n     * Returns the current distinct id of the user. This is either the id automatically\n     * generated by the library or the id that has been passed by a call to identify().\n     *\n     * ### Notes:\n     *\n     * get_distinct_id() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // set distinct_id after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             distinct_id = posthog.get_distinct_id();\n     *         }\n     *     });\n     */\n    get_distinct_id(): string {\n        return this.get_property('distinct_id')\n    }\n\n    getGroups(): Record<string, any> {\n        return this.get_property('$groups') || {}\n    }\n\n    /**\n     * Returns the current session_id.\n     *\n     * NOTE: This should only be used for informative purposes.\n     * Any actual internal use case for the session_id should be handled by the sessionManager.\n     */\n\n    get_session_id(): string {\n        return this.sessionManager?.checkAndGetSessionAndWindowId(true).sessionId ?? ''\n    }\n\n    /**\n     * Returns the Replay url for the current session.\n     *\n     * @param options Options for the url\n     * @param options.withTimestamp Whether to include the timestamp in the url (defaults to false)\n     * @param options.timestampLookBack How many seconds to look back for the timestamp (defaults to 10)\n     */\n    get_session_replay_url(options?: { withTimestamp?: boolean; timestampLookBack?: number }): string {\n        if (!this.sessionManager) {\n            return ''\n        }\n        const { sessionId, sessionStartTimestamp } = this.sessionManager.checkAndGetSessionAndWindowId(true)\n        let url = this.requestRouter.endpointFor('ui', '/replay/' + sessionId)\n        if (options?.withTimestamp && sessionStartTimestamp) {\n            const LOOK_BACK = options.timestampLookBack ?? 10\n            if (!sessionStartTimestamp) {\n                return url\n            }\n            const recordingStartTime = Math.max(\n                Math.floor((new Date().getTime() - sessionStartTimestamp) / 1000) - LOOK_BACK,\n                0\n            )\n            url += `?t=${recordingStartTime}`\n        }\n\n        return url\n    }\n\n    /**\n     * Create an alias, which PostHog will use to link two distinct_ids going forward (not retroactively).\n     * Multiple aliases can map to the same original ID, but not vice-versa. Aliases can also be chained - the\n     * following is a valid scenario:\n     *\n     *     posthog.alias('new_id', 'existing_id');\n     *     ...\n     *     posthog.alias('newer_id', 'new_id');\n     *\n     * If the original ID is not passed in, we will use the current distinct_id - probably the auto-generated GUID.\n     *\n     * ### Notes:\n     *\n     * The best practice is to call alias() when a unique ID is first created for a user\n     * (e.g., when a user first registers for an account and provides an email address).\n     * alias() should never be called more than once for a given user, except to\n     * chain a newer ID to a previously new ID, as described above.\n     *\n     * @param {String} alias A unique identifier that you want to use for this user in the future.\n     * @param {String} [original] The current identifier being used for this user.\n     */\n    alias(alias: string, original?: string): CaptureResult | void | number {\n        // If the $people_distinct_id key exists in persistence, there has been a previous\n        // posthog.people.identify() call made for this user. It is VERY BAD to make an alias with\n        // this ID, as it will duplicate users.\n        if (alias === this.get_property(PEOPLE_DISTINCT_ID_KEY)) {\n            logger.critical('Attempting to create alias for existing People user - aborting.')\n            return -2\n        }\n\n        if (_isUndefined(original)) {\n            original = this.get_distinct_id()\n        }\n        if (alias !== original) {\n            this._register_single(ALIAS_ID_KEY, alias)\n            return this.capture('$create_alias', { alias: alias, distinct_id: original })\n        } else {\n            logger.warn('alias matches current distinct_id - skipping api call.')\n            this.identify(alias)\n            return -1\n        }\n    }\n\n    /**\n     * Update the configuration of a posthog library instance.\n     *\n     * The default config is:\n     *\n     *     {\n     *       // PostHog API host\n     *       api_host: 'https://app.posthog.com',\n     *\n     *       // HTTP method for capturing requests\n     *       api_method: 'POST'\n     *\n     *       // PostHog web app host, currently only used by the Sentry integration.\n     *       // This will only be different from api_host when using a reverse-proxied API host  in that case\n     *       // the original web app host needs to be passed here so that links to the web app are still convenient.\n     *       ui_host: 'https://app.posthog.com',\n     *\n     *       // Automatically capture clicks, form submissions and change events\n     *       autocapture: true\n     *\n     *       // Capture rage clicks\n     *       rageclick: true\n     *\n     *       // transport for sending requests ('XHR' or 'sendBeacon')\n     *       // NB: sendBeacon should only be used for scenarios such as\n     *       // page unload where a \"best-effort\" attempt to send is\n     *       // acceptable; the sendBeacon API does not support callbacks\n     *       // or any way to know the result of the request. PostHog\n     *       // capturing via sendBeacon will not support any event-\n     *       // batching or retry mechanisms.\n     *       api_transport: 'XHR'\n     *\n     *       // super properties cookie expiration (in days)\n     *       cookie_expiration: 365\n     *\n     *       // super properties span subdomains\n     *       cross_subdomain_cookie: true\n     *\n     *       // debug mode\n     *       debug: false\n     *\n     *       // if this is true, the posthog cookie or localStorage entry\n     *       // will be deleted, and no user persistence will take place\n     *       disable_persistence: false\n     *\n     *       // if this is true, PostHog will automatically determine\n     *       // City, Region and Country data using the IP address of\n     *       //the client\n     *       ip: true\n     *\n     *       // opt users out of capturing by this PostHog instance by default\n     *       opt_out_capturing_by_default: false\n     *\n     *       // opt users out of browser data storage by this PostHog instance by default\n     *       opt_out_persistence_by_default: false\n     *\n     *       // opt out of user agent filtering such as googlebot or other bots\n     *       opt_out_useragent_filter: false\n     *\n     *       // persistence mechanism used by opt-in/opt-out methods - cookie\n     *       // or localStorage - falls back to cookie if localStorage is unavailable\n     *       opt_out_capturing_persistence_type: 'localStorage'\n     *\n     *       // customize the name of cookie/localStorage set by opt-in/opt-out methods\n     *       opt_out_capturing_cookie_prefix: null\n     *\n     *       // type of persistent store for super properties (cookie/\n     *       // localStorage) if set to 'localStorage', any existing\n     *       // posthog cookie value with the same persistence_name\n     *       // will be transferred to localStorage and deleted\n     *       persistence: 'cookie'\n     *\n     *       // name for super properties persistent store\n     *       persistence_name: ''\n     *\n     *       // deprecated, use property_denylist instead.\n     *       // names of properties/superproperties which should never\n     *       // be sent with capture() calls.\n     *       property_blacklist: []\n     *\n     *       // names of properties/superproperties which should never\n     *       // be sent with capture() calls.\n     *       property_denylist: []\n     *\n     *       // if this is true, posthog cookies will be marked as\n     *       // secure, meaning they will only be transmitted over https\n     *       secure_cookie: false\n     *\n     *       // should we capture a page view on page load\n     *       capture_pageview: true\n     *\n     *       // if you set upgrade to be true, the library will check for\n     *       // a cookie from our old js library and import super\n     *       // properties from it, then the old cookie is deleted\n     *       // The upgrade config option only works in the initialization,\n     *       // so make sure you set it when you create the library.\n     *       upgrade: false\n     *\n     *       // if this is true, session recording is always disabled.\n     *       disable_session_recording: false,\n     *\n     *       // extra HTTP request headers to set for each API request, in\n     *       // the format {'Header-Name': value}\n     *       response_headers: {}\n     *\n     *       // protocol for fetching in-app message resources, e.g.\n     *       // 'https://' or 'http://'; defaults to '//' (which defers to the\n     *       // current page's protocol)\n     *       inapp_protocol: '//'\n     *\n     *       // whether to open in-app message link in new tab/window\n     *       inapp_link_new_window: false\n     *\n     *      // a set of rrweb config options that PostHog users can configure\n     *      // see https://github.com/rrweb-io/rrweb/blob/master/guide.md\n     *      session_recording: {\n     *         blockClass: 'ph-no-capture',\n     *         blockSelector: null,\n     *         ignoreClass: 'ph-ignore-input',\n     *         maskAllInputs: true,\n     *         maskInputOptions: {},\n     *         maskInputFn: null,\n     *         slimDOMOptions: {},\n     *         collectFonts: false\n     *      }\n     *\n     *      // prevent autocapture from capturing any attribute names on elements\n     *      mask_all_element_attributes: false\n     *\n     *      // prevent autocapture from capturing textContent on all elements\n     *      mask_all_text: false\n     *\n     *      // Anonymous users get a random UUID as their device by default.\n     *      // This option allows overriding that option.\n     *      get_device_id: (uuid) => uuid\n     *     }\n     *\n     *\n     * @param {Object} config A dictionary of new configuration values to update\n     */\n\n    set_config(config: Partial<PostHogConfig>): void {\n        const oldConfig = { ...this.config }\n        if (_isObject(config)) {\n            _extend(this.config, config)\n\n            if (!this.config.persistence_name) {\n                this.config.persistence_name = this.config.cookie_name\n            }\n            if (!this.config.disable_persistence) {\n                this.config.disable_persistence = this.config.disable_cookie\n            }\n\n            this.persistence?.update_config(this.config, oldConfig)\n            this.sessionPersistence =\n                this.config.persistence === 'sessionStorage'\n                    ? this.persistence\n                    : new PostHogPersistence({ ...this.config, persistence: 'sessionStorage' })\n\n            if (localStore.is_supported() && localStore.get('ph_debug') === 'true') {\n                this.config.debug = true\n            }\n            if (this.config.debug) {\n                Config.DEBUG = true\n            }\n\n            if (this.sessionRecording && !_isUndefined(config.disable_session_recording)) {\n                const disable_session_recording_has_changed =\n                    oldConfig.disable_session_recording !== config.disable_session_recording\n                // if opting back in, this config might not have changed\n                const try_enable_after_opt_in =\n                    !userOptedOut(this) && !config.disable_session_recording && !this.sessionRecording.started\n\n                if (disable_session_recording_has_changed || try_enable_after_opt_in) {\n                    if (config.disable_session_recording) {\n                        this.sessionRecording.stopRecording()\n                    } else {\n                        this.sessionRecording.startRecordingIfEnabled()\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * turns session recording on, and updates the config option\n     * disable_session_recording to false\n     */\n    startSessionRecording(): void {\n        this.set_config({ disable_session_recording: false })\n    }\n\n    /**\n     * turns session recording off, and updates the config option\n     * disable_session_recording to true\n     */\n    stopSessionRecording(): void {\n        this.set_config({ disable_session_recording: true })\n    }\n\n    /**\n     * returns a boolean indicating whether session recording\n     * is currently running\n     */\n    sessionRecordingStarted(): boolean {\n        return !!this.sessionRecording?.started\n    }\n\n    /**\n     * returns a boolean indicating whether the toolbar loaded\n     * @param toolbarParams\n     */\n\n    loadToolbar(params: ToolbarParams): boolean {\n        return this.toolbar.loadToolbar(params)\n    }\n\n    /**\n     * Returns the value of the super property named property_name. If no such\n     * property is set, get_property() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * get_property() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for '$user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.get_property('$user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the super property you want to retrieve\n     */\n    get_property(property_name: string): Property | undefined {\n        return this.persistence?.['props'][property_name]\n    }\n\n    /**\n     * Returns the value of the session super property named property_name. If no such\n     * property is set, getSessionProperty() will return the undefined value.\n     *\n     * ### Notes:\n     *\n     * This is based on browser-level `sessionStorage`, NOT the PostHog session.\n     * getSessionProperty() can only be called after the PostHog library has finished loading.\n     * init() has a loaded function available to handle this automatically. For example:\n     *\n     *     // grab value for 'user_id' after the posthog library has loaded\n     *     posthog.init('YOUR PROJECT TOKEN', {\n     *         loaded: function(posthog) {\n     *             user_id = posthog.getSessionProperty('user_id');\n     *         }\n     *     });\n     *\n     * @param {String} property_name The name of the session super property you want to retrieve\n     */\n    getSessionProperty(property_name: string): Property | undefined {\n        return this.sessionPersistence?.['props'][property_name]\n    }\n\n    toString(): string {\n        let name = this.config.name ?? PRIMARY_INSTANCE_NAME\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            name = PRIMARY_INSTANCE_NAME + '.' + name\n        }\n        return name\n    }\n\n    // perform some housekeeping around GDPR opt-in/out state\n    _gdpr_init(): void {\n        const is_localStorage_requested = this.config.opt_out_capturing_persistence_type === 'localStorage'\n\n        // try to convert opt-in/out cookies to localStorage if possible\n        if (is_localStorage_requested && localStore.is_supported()) {\n            if (!this.has_opted_in_capturing() && this.has_opted_in_capturing({ persistence_type: 'cookie' })) {\n                this.opt_in_capturing({ enable_persistence: false })\n            }\n            if (!this.has_opted_out_capturing() && this.has_opted_out_capturing({ persistence_type: 'cookie' })) {\n                this.opt_out_capturing({ clear_persistence: false })\n            }\n            this.clear_opt_in_out_capturing({\n                persistence_type: 'cookie',\n                enable_persistence: false,\n            })\n        }\n\n        // check whether the user has already opted out - if so, clear & disable persistence\n        if (this.has_opted_out_capturing()) {\n            this._gdpr_update_persistence({ clear_persistence: true })\n\n            // check whether we should opt out by default\n            // note: we don't clear persistence here by default since opt-out default state is often\n            //       used as an initial state while GDPR information is being collected\n        } else if (\n            !this.has_opted_in_capturing() &&\n            (this.config.opt_out_capturing_by_default || cookieStore.get('ph_optout'))\n        ) {\n            cookieStore.remove('ph_optout')\n            this.opt_out_capturing({\n                clear_persistence: this.config.opt_out_persistence_by_default,\n            })\n        }\n    }\n\n    /**\n     * Enable or disable persistence based on options\n     * only enable/disable if persistence is not already in this state\n     * @param {boolean} [options.clear_persistence] If true, will delete all data stored by the sdk in persistence and disable it\n     * @param {boolean} [options.enable_persistence] If true, will re-enable sdk persistence\n     */\n    _gdpr_update_persistence(options: Partial<OptInOutCapturingOptions>): void {\n        let disabled\n        if (options && options['clear_persistence']) {\n            disabled = true\n        } else if (options && options['enable_persistence']) {\n            disabled = false\n        } else {\n            return\n        }\n\n        if (!this.config.disable_persistence && this.persistence?.disabled !== disabled) {\n            this.persistence?.set_disabled(disabled)\n        }\n        if (!this.config.disable_persistence && this.sessionPersistence?.disabled !== disabled) {\n            this.sessionPersistence?.set_disabled(disabled)\n        }\n    }\n\n    // call a base gdpr function after constructing the appropriate token and options args\n    _gdpr_call_func<R = any>(\n        func: (token: string, options: GDPROptions) => R,\n        options?: Partial<OptInOutCapturingOptions>\n    ): R {\n        options = _extend(\n            {\n                capture: this.capture.bind(this),\n                persistence_type: this.config.opt_out_capturing_persistence_type,\n                cookie_prefix: this.config.opt_out_capturing_cookie_prefix,\n                cookie_expiration: this.config.cookie_expiration,\n                cross_subdomain_cookie: this.config.cross_subdomain_cookie,\n                secure_cookie: this.config.secure_cookie,\n            },\n            options || {}\n        )\n\n        // check if localStorage can be used for recording opt out status, fall back to cookie if not\n        if (!localStore.is_supported() && options['persistence_type'] === 'localStorage') {\n            options['persistence_type'] = 'cookie'\n        }\n\n        return func(this.config.token, {\n            capture: options['capture'],\n            captureEventName: options['capture_event_name'],\n            captureProperties: options['capture_properties'],\n            persistenceType: options['persistence_type'],\n            persistencePrefix: options['cookie_prefix'],\n            cookieExpiration: options['cookie_expiration'],\n            crossSubdomainCookie: options['cross_subdomain_cookie'],\n            secureCookie: options['secure_cookie'],\n        })\n    }\n\n    /**\n     * Opt the user in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user in\n     *     posthog.opt_in_capturing();\n     *\n     *     // opt user in with specific event name, properties, cookie configuration\n     *     posthog.opt_in_capturing({\n     *         capture_event_name: 'User opted in',\n     *         capture_event_properties: {\n     *             'Email': 'jdoe@example.com'\n     *         },\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {function} [options.capture] Function used for capturing a PostHog event to record the opt-in action (default is this PostHog instance's capture method)\n     * @param {string} [options.capture_event_name=$opt_in] Event name to be used for capturing the opt-in action\n     * @param {Object} [options.capture_properties] Set of properties to be captured along with the opt-in action\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_in_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        options = _extend(\n            {\n                enable_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optIn, options)\n        this._gdpr_update_persistence(options)\n    }\n\n    /**\n     * Opt the user out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // opt user out\n     *     posthog.opt_out_capturing();\n     *\n     *     // opt user out with different cookie configuration from PostHog instance\n     *     posthog.opt_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.clear_persistence=true] If true, will delete all data stored by the sdk in persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    opt_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options = _extend(\n            {\n                clear_persistence: true,\n            },\n            options || {}\n        )\n\n        this._gdpr_call_func(optOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    /**\n     * Check whether the user has opted in to data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_in = posthog.has_opted_in_capturing();\n     *     // use has_opted_in value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-in status\n     */\n    has_opted_in_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedIn, options)\n    }\n\n    /**\n     * Check whether the user has opted out of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     const has_opted_out = posthog.has_opted_out_capturing();\n     *     // use has_opted_out value\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @returns {boolean} current opt-out status\n     */\n    has_opted_out_capturing(options?: Partial<OptInOutCapturingOptions>): boolean {\n        return this._gdpr_call_func(hasOptedOut, options)\n    }\n\n    /**\n     * Clear the user's opt in/out status of data capturing and cookies/localstorage for this PostHog instance\n     *\n     * ### Usage\n     *\n     *     // clear user's opt-in/out status\n     *     posthog.clear_opt_in_out_capturing();\n     *\n     *     // clear user's opt-in/out status with specific cookie configuration - should match\n     *     // configuration used when opt_in_capturing/opt_out_capturing methods were called.\n     *     posthog.clear_opt_in_out_capturing({\n     *         cookie_expiration: 30,\n     *         secure_cookie: true\n     *     });\n     *\n     * @param {Object} [options] A dictionary of config options to override\n     * @param {boolean} [options.enable_persistence=true] If true, will re-enable sdk persistence\n     * @param {string} [options.persistence_type=localStorage] Persistence mechanism used - cookie or localStorage - falls back to cookie if localStorage is unavailable\n     * @param {string} [options.cookie_prefix=__ph_opt_in_out] Custom prefix to be used in the cookie/localstorage name\n     * @param {Number} [options.cookie_expiration] Number of days until the opt-in cookie expires (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.cross_subdomain_cookie] Whether the opt-in cookie is set as cross-subdomain or not (overrides value specified in this PostHog instance's config)\n     * @param {boolean} [options.secure_cookie] Whether the opt-in cookie is set as secure or not (overrides value specified in this PostHog instance's config)\n     */\n    clear_opt_in_out_capturing(options?: Partial<OptInOutCapturingOptions>): void {\n        const _options: Partial<OptInOutCapturingOptions> = _extend(\n            {\n                enable_persistence: true,\n            },\n            options ?? {}\n        )\n        this._gdpr_call_func(clearOptInOut, _options)\n        this._gdpr_update_persistence(_options)\n    }\n\n    debug(debug?: boolean): void {\n        if (debug === false) {\n            window?.console.log(\"You've disabled debug mode.\")\n            localStorage && localStorage.removeItem('ph_debug')\n            this.set_config({ debug: false })\n        } else {\n            window?.console.log(\n                \"You're now in debug mode. All calls to PostHog will be logged in your console.\\nYou can disable this with `posthog.debug(false)`.\"\n            )\n            localStorage && localStorage.setItem('ph_debug', 'true')\n            this.set_config({ debug: true })\n        }\n    }\n}\n\n_safewrap_class(PostHog, ['identify'])\n\nconst instances: Record<string, PostHog> = {}\nconst extend_mp = function () {\n    // add all the sub posthog instances\n    _each(instances, function (instance, name) {\n        if (name !== PRIMARY_INSTANCE_NAME) {\n            posthog_main[name] = instance\n        }\n    })\n}\n\nconst override_ph_init_func = function () {\n    // we override the snippets init function to handle the case where a\n    // user initializes the posthog library after the script loads & runs\n    posthog_main['init'] = function (token?: string, config?: Partial<PostHogConfig>, name?: string) {\n        if (name) {\n            // initialize a sub library\n            if (!posthog_main[name]) {\n                posthog_main[name] = instances[name] = create_phlib(\n                    token || '',\n                    config || {},\n                    name,\n                    (instance: PostHog) => {\n                        posthog_main[name] = instances[name] = instance\n                        instance._loaded()\n                    }\n                )\n            }\n            return posthog_main[name]\n        } else {\n            let instance: PostHog = posthog_main as any as PostHog\n\n            if (instances[PRIMARY_INSTANCE_NAME]) {\n                // main posthog lib already initialized\n                instance = instances[PRIMARY_INSTANCE_NAME]\n            } else if (token) {\n                // intialize the main posthog lib\n                instance = create_phlib(token, config || {}, PRIMARY_INSTANCE_NAME, (instance: PostHog) => {\n                    instances[PRIMARY_INSTANCE_NAME] = instance\n                    instance._loaded()\n                })\n                instances[PRIMARY_INSTANCE_NAME] = instance\n            }\n\n            ;(posthog_main as any) = instance\n            if (init_type === InitType.INIT_SNIPPET) {\n                assignableWindow[PRIMARY_INSTANCE_NAME] = posthog_main\n            }\n            extend_mp()\n            return instance\n        }\n    }\n}\n\nconst add_dom_loaded_handler = function () {\n    // Cross browser DOM Loaded support\n    function dom_loaded_handler() {\n        // function flag since we only want to execute this once\n        if ((dom_loaded_handler as any).done) {\n            return\n        }\n        ;(dom_loaded_handler as any).done = true\n\n        ENQUEUE_REQUESTS = false\n\n        _each(instances, function (inst: PostHog) {\n            inst._dom_loaded()\n        })\n    }\n\n    if (document?.addEventListener) {\n        if (document.readyState === 'complete') {\n            // safari 4 can fire the DOMContentLoaded event before loading all\n            // external JS (including this file). you will see some copypasta\n            // on the internet that checks for 'complete' and 'loaded', but\n            // 'loaded' is an IE thing\n            dom_loaded_handler()\n        } else {\n            document.addEventListener('DOMContentLoaded', dom_loaded_handler, false)\n        }\n    }\n\n    // fallback handler, always will work\n    if (window) {\n        _register_event(window, 'load', dom_loaded_handler, true)\n    }\n}\n\nexport function init_from_snippet(): void {\n    init_type = InitType.INIT_SNIPPET\n    if (_isUndefined(assignableWindow.posthog)) {\n        assignableWindow.posthog = []\n    }\n    posthog_main = assignableWindow.posthog\n\n    if (posthog_main['__loaded'] || (posthog_main['config'] && posthog_main['persistence'])) {\n        // lib has already been loaded at least once; we don't want to override the global object this time so bomb early\n        logger.critical('PostHog library has already been downloaded at least once.')\n        return\n    }\n\n    // Load instances of the PostHog Library\n    _each(posthog_main['_i'], function (item: [token: string, config: Partial<PostHogConfig>, name: string]) {\n        if (item && _isArray(item)) {\n            instances[item[2]] = create_phlib(...item)\n        }\n    })\n\n    override_ph_init_func()\n    ;(posthog_main['init'] as any)()\n\n    // Fire loaded events after updating the window's posthog object\n    _each(instances, function (instance) {\n        instance._loaded()\n    })\n\n    add_dom_loaded_handler()\n}\n\nexport function init_as_module(): PostHog {\n    init_type = InitType.INIT_MODULE\n    ;(posthog_main as any) = new PostHog()\n\n    override_ph_init_func()\n    ;(posthog_main['init'] as any)()\n    add_dom_loaded_handler()\n\n    return posthog_main as any\n}\n","import { MinimalHTTPResponse } from './types'\nimport { logger } from './utils/logger'\n\nconst oneMinuteInMilliseconds = 60 * 1000\n\ninterface CaptureResponse {\n    quota_limited?: string[]\n}\n\nexport class RateLimiter {\n    limits: Record<string, number> = {}\n\n    public isRateLimited(batchKey: string | undefined): boolean {\n        const retryAfter = this.limits[batchKey || 'events'] || false\n\n        if (retryAfter === false) {\n            return false\n        }\n        return new Date().getTime() < retryAfter\n    }\n\n    public checkForLimiting = (httpResponse: MinimalHTTPResponse): void => {\n        const text: string | undefined = httpResponse.responseText\n\n        if (!text || !text.length) {\n            return\n        }\n\n        try {\n            const response: CaptureResponse = JSON.parse(text)\n            const quotaLimitedProducts = response.quota_limited || []\n            quotaLimitedProducts.forEach((batchKey) => {\n                logger.info(`[RateLimiter] ${batchKey || 'events'} is quota limited.`)\n                this.limits[batchKey] = new Date().getTime() + oneMinuteInMilliseconds\n            })\n        } catch (e: any) {\n            logger.warn(`[RateLimiter] could not rate limit - continuing. Error: \"${e?.message}\"`, { text })\n            return\n        }\n    }\n}\n","/* Client-side session parameters. These are primarily used by web analytics,\n * which relies on these for session analytics without the plugin server being\n * available for the person level set-once properties. Obviously not consistent\n * between client-side events and server-side events but this is acceptable\n * as web analytics only uses client-side.\n *\n * These have the same lifespan as a session_id\n */\nimport { location } from './utils/globals'\nimport { _info } from './utils/event-utils'\nimport { SessionIdManager } from './sessionid'\nimport { PostHogPersistence } from './posthog-persistence'\nimport { CLIENT_SESSION_PROPS } from './constants'\n\ninterface SessionSourceProps {\n    initialPathName: string\n    referringDomain: string // Is actually host, but named domain for internal consistency. Should contain a port if there is one.\n    utm_medium?: string\n    utm_source?: string\n    utm_campaign?: string\n    utm_content?: string\n    utm_term?: string\n}\n\ninterface StoredSessionSourceProps {\n    sessionId: string\n    props: SessionSourceProps\n}\n\nconst generateSessionSourceParams = (): SessionSourceProps => {\n    return {\n        initialPathName: location?.pathname || '',\n        referringDomain: _info.referringDomain(),\n        ..._info.campaignParams(),\n    }\n}\n\nexport class SessionPropsManager {\n    private readonly _sessionIdManager: SessionIdManager\n    private readonly _persistence: PostHogPersistence\n    private readonly _sessionSourceParamGenerator: () => SessionSourceProps\n\n    constructor(\n        sessionIdManager: SessionIdManager,\n        persistence: PostHogPersistence,\n        sessionSourceParamGenerator?: () => SessionSourceProps\n    ) {\n        this._sessionIdManager = sessionIdManager\n        this._persistence = persistence\n        this._sessionSourceParamGenerator = sessionSourceParamGenerator || generateSessionSourceParams\n\n        this._sessionIdManager.onSessionId(this._onSessionIdCallback)\n    }\n\n    _getStoredProps(): StoredSessionSourceProps | undefined {\n        return this._persistence.props[CLIENT_SESSION_PROPS]\n    }\n\n    _onSessionIdCallback = (sessionId: string) => {\n        const stored = this._getStoredProps()\n        if (stored && stored.sessionId === sessionId) {\n            return\n        }\n\n        const newProps: StoredSessionSourceProps = {\n            sessionId,\n            props: this._sessionSourceParamGenerator(),\n        }\n        this._persistence.register({ [CLIENT_SESSION_PROPS]: newProps })\n    }\n\n    getSessionProps() {\n        const p = this._getStoredProps()?.props\n        if (!p) {\n            return {}\n        }\n\n        return {\n            $client_session_initial_referring_host: p.referringDomain,\n            $client_session_initial_pathname: p.initialPathName,\n            $client_session_initial_utm_source: p.utm_source,\n            $client_session_initial_utm_campaign: p.utm_campaign,\n            $client_session_initial_utm_medium: p.utm_medium,\n            $client_session_initial_utm_content: p.utm_content,\n            $client_session_initial_utm_term: p.utm_term,\n        }\n    }\n}\n","export const DEFAULT_BLOCKED_UA_STRS = [\n    'ahrefsbot',\n    'ahrefssiteaudit',\n    'applebot',\n    'baiduspider',\n    'bingbot',\n    'bingpreview',\n    'bot.htm',\n    'bot.php',\n    'crawler',\n    'duckduckbot',\n    'facebookexternal',\n    'facebookcatalog',\n    'gptbot',\n    'http://yandex.com/bots',\n    'hubspot',\n    'ia_archiver',\n    'linkedinbot',\n    'mj12bot',\n    'msnbot',\n    'nessus',\n    'petalbot',\n    'pinterest',\n    'prerender',\n    'rogerbot',\n    'screaming frog',\n    'semrushbot',\n    'sitebulb',\n    'slurp',\n    'turnitin',\n    'twitterbot',\n    'vercelbot',\n    'yahoo! slurp',\n    'yandexbot',\n\n    // a whole bunch of goog-specific crawlers\n    // https://developers.google.com/search/docs/advanced/crawling/overview-google-crawlers\n    'adsbot-google',\n    'apis-google',\n    'duplexweb-google',\n    'feedfetcher-google',\n    'google favicon',\n    'google web preview',\n    'google-read-aloud',\n    'googlebot',\n    'googleweblight',\n    'mediapartners-google',\n    'storebot-google',\n]\n\n/**\n * Block various web spiders from executing our JS and sending false capturing data\n */\nexport const _isBlockedUA = function (ua: string, customBlockedUserAgents: string[]): boolean {\n    if (!ua) {\n        return false\n    }\n    const uaLower = ua.toLowerCase()\n    return DEFAULT_BLOCKED_UA_STRS.concat(customBlockedUserAgents || []).some((blockedUA) => {\n        const blockedUaLower = blockedUA.toLowerCase()\n        if (uaLower.includes) {\n            return uaLower.includes(blockedUaLower)\n        } else {\n            // IE 11 :/\n            return uaLower.indexOf(blockedUaLower) !== -1\n        }\n    })\n}\n","/**\n * Extend Segment with extra PostHog JS functionality. Required for things like Recordings and feature flags to work correctly.\n *\n * ### Usage\n *\n *  ```js\n *  // After your standard segment anyalytics install\n *  analytics.load(\"GOEDfA21zZTtR7clsBuDvmBKAtAdZ6Np\");\n *\n *  analytics.ready(() => {\n *    posthog.init('<posthog-api-key>', {\n *      capture_pageview: false,\n *      segment: window.analytics, // NOTE: Be sure to use window.analytics here!\n *    });\n *    window.analytics.page();\n *  })\n *  ```\n */\nimport { PostHog } from '../posthog-core'\nimport { logger } from '../utils/logger'\n\n// Loosely based on https://github.com/segmentio/analytics-next/blob/master/packages/core/src/plugins/index.ts\ninterface SegmentPluginContext {\n    event: {\n        event: string\n        userId?: string\n        anonymousId?: string\n        properties: any\n    }\n}\n\ninterface SegmentPlugin {\n    name: string\n    version: string\n    type: 'enrichment'\n    isLoaded: () => boolean\n    load: (ctx: SegmentPluginContext, instance: any, config?: any) => Promise<unknown>\n    unload?: (ctx: SegmentPluginContext, instance: any) => Promise<unknown> | unknown\n    ready?: () => Promise<unknown>\n    track?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    identify?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    page?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    group?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    alias?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n    screen?: (ctx: SegmentPluginContext) => Promise<SegmentPluginContext> | SegmentPluginContext\n}\n\nexport const createSegmentIntegration = (posthog: PostHog): SegmentPlugin => {\n    if (!Promise || !Promise.resolve) {\n        logger.warn('This browser does not have Promise support, and can not use the segment integration')\n    }\n\n    const enrichEvent = (ctx: SegmentPluginContext, eventName: string) => {\n        if (!ctx.event.userId && ctx.event.anonymousId !== posthog.get_distinct_id()) {\n            // This is our only way of detecting that segment's analytics.reset() has been called so we also call it\n            posthog.reset()\n        }\n        if (ctx.event.userId && ctx.event.userId !== posthog.get_distinct_id()) {\n            posthog.register({\n                distinct_id: ctx.event.userId,\n            })\n            posthog.reloadFeatureFlags()\n        }\n\n        const additionalProperties = posthog._calculate_event_properties(eventName, ctx.event.properties)\n        ctx.event.properties = Object.assign({}, additionalProperties, ctx.event.properties)\n        return ctx\n    }\n\n    return {\n        name: 'PostHog JS',\n        type: 'enrichment',\n        version: '1.0.0',\n        isLoaded: () => true,\n        // check and early return above\n        // eslint-disable-next-line compat/compat\n        load: () => Promise.resolve(),\n        track: (ctx) => enrichEvent(ctx, ctx.event.event),\n        page: (ctx) => enrichEvent(ctx, '$pageview'),\n        identify: (ctx) => enrichEvent(ctx, '$identify'),\n        screen: (ctx) => enrichEvent(ctx, '$screen'),\n    }\n}\n","import { gzipSync, strToU8 } from 'fflate'\nimport { _base64Encode } from './utils'\nimport { Compression, CompressionData, XHROptions } from './types'\n\nexport function decideCompression(compressionSupport: Partial<Record<Compression, boolean>>): Compression {\n    if (compressionSupport[Compression.GZipJS]) {\n        return Compression.GZipJS\n    } else {\n        return Compression.Base64\n    }\n}\n\nexport function compressData(\n    compression: Compression,\n    jsonData: string,\n    options: XHROptions\n): [CompressionData | Uint8Array, XHROptions] {\n    if (compression === Compression.GZipJS) {\n        // :TRICKY: This returns an UInt8Array. We don't encode this to a string - returning a blob will do this for us.\n        return [\n            gzipSync(strToU8(jsonData), { mtime: 0 }),\n            { ...options, blob: true, urlQueryArgs: { compression: Compression.GZipJS } },\n        ]\n    } else {\n        return [{ data: _base64Encode(jsonData) }, options]\n    }\n}\n"],"names":["Config","DEBUG","LIB_VERSION","nativeIsArray","Array","isArray","ObjProto","Object","prototype","hasOwnProperty","toString","_isArray","obj","call","_isUint8Array","x","_isFunction","f","_isObject","_isUndefined","_isString","_isNull","_isNullish","_isNumber","_isBoolean","_isFormData","FormData","win","window","undefined","global","globalThis","ArrayProto","nativeForEach","forEach","nativeIndexOf","indexOf","navigator","document","location","fetch","XMLHttpRequest","userAgent","assignableWindow","LOGGER_PREFIX","logger","_log","level","POSTHOG_DEBUG","console","consoleLog","_len","arguments","length","args","_key","apply","concat","info","_len2","_key2","warn","_len3","_key3","error","_len4","_key4","critical","_console","_len5","_key5","uninitializedWarning","methodName","breaker","_trim","str","replace","_eachArray","iterator","thisArg","i","l","_each","_step","_iterator","_createForOfIteratorHelper","entries","s","n","done","pair","value","err","e","key","_extend","source","prop","_includes","needle","_entries","ownProps","keys","resArray","_timestamp","Date","now","_try","fn","_safewrap","this","_strip_empty_properties","p","ret","v","k","_copyAndTruncateStrings","object","maxStringLength","customizer","slice","COPY_IN_PROGRESS_SET","Set","internalDeepCircularCopy","has","add","result","it","push","val","_base64Encode","data","h1","h2","h3","h4","bits","b64","ac","enc","tmp_arr","_utf8Encode","charCodeAt","charAt","join","string","start","end","stringl","utftext","c1","String","fromCharCode","substring","_register_event","fixEvent","event","preventDefault","stopPropagation","returnValue","cancelBubble","element","type","handler","oldSchool","useCapture","addEventListener","ontype","old_handler","new_handler","old_handlers","old_result","new_result","makeHandler","loadScript","scriptUrlToLoad","callback","addScript","scriptTag","createElement","src","onload","onerror","_scripts$0$parentNode","scripts","querySelectorAll","parentNode","insertBefore","body","appendChild","splitClassString","split","getClassNames","el","className","_typeof","baseVal","getAttribute","makeSafeText","filter","shouldCaptureValue","getSafeText","elText","shouldCaptureElement","isSensitiveElement","childNodes","child","_makeSafeText","isTextNode","textContent","isElementNode","nodeType","isTag","tag","tagName","toLowerCase","isDocumentFragment","autocaptureCompatibleElements","getParentElement","curEl","shouldCaptureDomEvent","autocaptureConfig","captureOnAnyElement","allowedEventTypes","url_allowlist","url","href","allowlist","some","regex","match","dom_event_allowlist","eventType","parentIsUsefulElement","targetElementList","host","compStyles","getComputedStyle","getPropertyValue","elements","element_allowlist","_loop","elementType","_ret","checkIfElementTreePassesElementAllowList","css_selector_allowlist","_step2","_iterator2","_loop2","selector","matches","_ret2","checkIfElementTreePassesCSSSelectorAllowList","classes","name","id","test","includes","getDirectAndNestedSpanText","target","text","getNestedSpanText","trim","_child$tagName","spanText","getElementsChainString","map","_element$nth_child","_element$nth_of_type","el_string","tag_name","attr_class","sort","_step3","_iterator3","single_class","attributes","_objectSpread","nth_child","nth_of_type","attr_id","sortedAttributes","_ref","_ref2","a","_slicedToArray","b","localeCompare","_ref5","_ref6","escapeQuotes","_ref7","_ref8","elementsToString","_el$$el_text","_el$attr__href","response","extractAttrClass","_ref9","_ref11","_ref12","extractElements","input","RageClick","enabled","_classCallCheck","clicks","_createClass","y","timestamp","lastClick","Math","abs","PEOPLE_DISTINCT_ID_KEY","ALIAS_ID_KEY","EVENT_TIMERS_KEY","AUTOCAPTURE_DISABLED_SERVER_SIDE","SESSION_RECORDING_ENABLED_SERVER_SIDE","CONSOLE_LOG_RECORDING_ENABLED_SERVER_SIDE","SESSION_RECORDING_RECORDER_VERSION_SERVER_SIDE","SESSION_RECORDING_NETWORK_PAYLOAD_CAPTURE","SESSION_RECORDING_CANVAS_RECORDING","SESSION_ID","SESSION_RECORDING_IS_SAMPLED","ENABLED_FEATURE_FLAGS","PERSISTENCE_EARLY_ACCESS_FEATURES","STORED_PERSON_PROPERTIES_KEY","STORED_GROUP_PROPERTIES_KEY","SURVEYS","FLAG_CALL_REPORTED","USER_STATE","POSTHOG_QUOTA_LIMITED","CLIENT_SESSION_PROPS","PERSISTENCE_RESERVED_PROPERTIES","COPY_AUTOCAPTURE_EVENT","limitText","autocapture","_initializedTokens","_isDisabledServerSide","_isAutocaptureEnabled","_setIsAutocaptureEnabled","instance","_instance$persistence","disabled_server_side","persistence","props","enabled_client_side","config","_previousElementSibling","previousElementSibling","_el","previousSibling","_getAugmentPropertiesFromElement","elem","attr","propertyKey","propertyValue","_getPropertiesFromElement","maskInputs","maskText","_this$config","c","elementAttributeIgnorelist","element_attribute_ignorelist","attributeName","nthChild","nthOfType","currentElem","_getDefaultProperties","$event_type","$ce_version","_extractCustomPropertyValue","customProperty","propValues","matchedElem","_getCustomProperties","_this","_customProperties","eventSelector","eventElement","_getEventTarget","srcElement","_e$target","shadowRoot","composedPath","_captureEvent","_this$rageclicks","_this2","eventName","extraProps","MouseEvent","rageclicks","isRageClick","clientX","clientY","getTime","isCopyAutocapture","_elementsJson$","_elementsJson$2","elementsJson","autocaptureAugmentProperties","explicitNoCapture","shouldCaptureEl","mask_all_element_attributes","mask_all_text","augmentProperties","elementsChainAsString","$elements_chain","$elements","$el_text","_window$getSelection","selectedContent","getSelection","clipType","capture","_navigate","_addDomEventHandlers","_this3","copiedTextHandler","capture_copied_text","init","_this$config2","__autocapture","RegExp","rageclick","afterDecideResponse","token","register","_defineProperty","enabledForProject","numBuckets","numEnabledBuckets","charCodeSum","isBrowserSupported","func","bind","_bind_instance_methods","_safewrap_instance_methods","PERSISTENCE_ACTIVE_FEATURE_FLAGS","PERSISTENCE_OVERRIDE_FEATURE_FLAGS","PERSISTENCE_FEATURE_FLAG_PAYLOADS","filterActiveFeatureFlags","featureFlags","activeFeatureFlags","_step$value","PostHogFeatureFlags","_override_warning","featureFlagEventHandlers","reloadFeatureFlagsQueued","reloadFeatureFlagsInAction","getFlagVariants","enabledFlags","get_property","overriddenFlags","finalFlags","overriddenKeys","_startReloadTimer","anon_distinct_id","$anon_distinct_id","isPaused","setTimeout","_reloadFeatureFlagsRequest","advanced_disable_feature_flags","setReloadingPaused","personProperties","groupProperties","encoded_data","JSON","stringify","distinct_id","get_distinct_id","groups","getGroups","person_properties","group_properties","disable_flags","_send_request","requestRouter","endpointFor","method","receivedFeatureFlags","options","decideEndpointWasHit","getFlags","_this$instance$persis","flagValue","flagReportValue","flagCallReported","send_event","$feature_flag","$feature_flag_response","getFlagPayloads","getFeatureFlag","h","currentFlags","currentFlagPayloads","flags","flagPayloads","_persistence$register","$enabled_feature_flags","_persistence$register2","newFeatureFlags","newFeatureFlagPayloads","errorsWhileComputingFlags","parseFeatureFlagDecideResponse","_fireFeatureFlagsCallbacks","__loaded","unregister","flagsObj","addFeatureFlagsHandler","_this$_prepareFeature","_prepareFeatureFlagsForCallbacks","flagVariants","removeFeatureFlagsHandler","isEnrolled","_this$instance$persis5","_this$instance$persis6","enrollmentPersonProp","$feature_enrollment","$set","setPersonPropertiesForFlags","newFlags","_this4","force_reload","existing_early_access_features","_this4$instance$persi","earlyAccessFeatures","flag","variantKey","reduce","res","_this$_prepareFeature2","properties","reloadFeatureFlags","existingProperties","groupType","group_type","trunc","ceil","floor","Number","isInteger","isFinite","DIGITS","UUID","bytes","TypeError","Error","other","compareTo","diff","sign","unixTsMs","randA","randBHi","randBLo","RangeError","Uint8Array","pow","V7Generator","DefaultRandom","generateOrAbort","valueAfterReset","ts","resetCounter","counter","fromFieldsV7","random","nextUint32","getRandomValues","buffer","UUIDV7_DENY_WEAK_RNG","crypto","defaultGenerator","Uint32Array","Infinity","cursor","uuidv7","uuidv7obj","generate","Y1970","firstNonPublicSubDomain","DOMAIN_MATCH_REGEX","chooseCookieDomain","hostname","cross_subdomain","matchedSubDomain","cookieJar","list","len","min","R","candidate","candidateCookieValue","cookie","seekFirstNonPublicSubDomain","originalMatch","originalCookieDomainFn","cookieStore","is_supported","msg","get","nameEQ","ca","decodeURIComponent","parse","set","days","is_secure","expires","secure","cdomain","date","setTime","toUTCString","new_cookie_val","encodeURIComponent","remove","_localStorage_supported","localStore","supported","localStorage","getItem","setItem","removeItem","COOKIE_PERSISTED_PROPERTIES","localPlusCookieStore","extend","cookiePersistedProperties","memoryStorage","memoryStore","sessionStorageSupported","sessionStore","sessionStorage","localDomains","SUPPORTS_REQUEST","convertToURL","_isUrlMatchingRegex","pattern","_isValidRegex","_formDataToQuery","formdata","use_val","use_key","arg_separator","tph_arr","File","_isFile","_getQueryParam","param","keyValuePair","queryParts","parts","_getHashParam","hash","MOBILE","IOS","ANDROID","TABLET","ANDROID_TABLET","IPAD","APPLE","APPLE_WATCH","SAFARI","BLACKBERRY","SAMSUNG","SAMSUNG_BROWSER","SAMSUNG_INTERNET","CHROME","CHROME_OS","CHROME_IOS","INTERNET_EXPLORER","INTERNET_EXPLORER_MOBILE","OPERA","OPERA_MINI","EDGE","MICROSOFT_EDGE","FIREFOX","FIREFOX_IOS","NINTENDO","PLAYSTATION","XBOX","ANDROID_MOBILE","MOBILE_SAFARI","WINDOWS","WINDOWS_PHONE","NOKIA","OUYA","GENERIC","GENERIC_MOBILE","GENERIC_TABLET","KONQUEROR","BROWSER_VERSION_REGEX_SUFFIX","DEFAULT_BROWSER_VERSION_REGEX","XBOX_REGEX","PLAYSTATION_REGEX","NINTENDO_REGEX","BLACKBERRY_REGEX","windowsVersionMap","safariCheck","ua","vendor","isSafari","detectBrowser","user_agent","opera","FACEBOOK","versionRegexes","_versionRegexes","osMatchers","_","exec","version","osVersion","versionParts","detectDevice","URL_REGEX_PREFIX","_info","campaignParams","customParams","campaign_keywords","params","kwkey","kw","URL","searchEngine","referrer","search","searchInfo","keyword","browser","browserVersion","regexes","parseFloat","browserLanguage","language","userLanguage","os","_osMatchers$i","rgex","resultOrFn","device","deviceType","referringDomain","_convertToURL","_info$os2","os_name","os_version","$os","$os_version","$browser","$device","$device_type","$current_url","$host","$pathname","pathname","$raw_user_agent","$browser_version","$browser_language","$screen_height","screen","height","$screen_width","width","$viewport_height","innerHeight","$viewport_width","innerWidth","$lib","$lib_version","$insert_id","$time","people_properties","_info$os4","CASE_INSENSITIVE_PERSISTENCE_TYPES","PostHogPersistence","campaign_params_saved","parseName","storage","buildStorage","load","update_config","save","storage_type","found","disabled","entry","expire_days","default_value","default_expiry","hasChanges","custom_campaign_params","$referrer","$referring_domain","oldConfig","set_disabled","set_cross_subdomain","set_secure","newStore","clear","event_name","timers","state","FULL_SNAPSHOT_EVENT_TYPE","META_EVENT_TYPE","MutationRateLimiter","rrweb","_this$options$refillR","_this$options$bucketS","mutationBuckets","refillRate","bucketSize","node","mirror","getNode","nodeName","Element","closestSVG","closest","getId","_data$removes$length","_data$removes","_data$attributes$leng","_data$attributes","_data$texts$length","_data$texts","_data$adds$length","_data$adds","removes","texts","adds","initialMutationCount","numberOfChanges","_this$mutationBuckets","_this$options$onBlock","_this$options","_this$getNodeOrReleva2","getNodeOrRelevantParent","nodeId","max","loggedTracker","onBlockedNode","mutationCount","setInterval","refillBuckets","EventType","EventType2","defaultNetworkOptions","initiatorTypes","maskRequestFn","recordHeaders","recordBody","recordInitialRequests","recordPerformance","performanceEntryTypeToObserve","payloadSizeLimitBytes","HEADER_DENYLIST","POSTHOG_PATHS_TO_IGNORE","redactPayload","payload","headers","limit","description","requestContentLength","Blob","size","estimateBytes","parseInt","buildNetworkRequestOptions","instanceConfig","remoteNetworkOptions","_options$payloadSizeL","session_recording","canRecordHeaders","canRecordBody","canRecordPerformance","payloadLimiter","requestBody","requestHeaders","responseBody","responseHeaders","enforcedCleaningFn","d","path","ignorePostHogPaths","_data$requestHeaders","header","_data$requestHeaders2","hasDeprecatedMaskFunction","maskNetworkRequestFn","maskCapturedNetworkRequestFn","cleanedURL","_instanceConfig$sessi","_instanceConfig$sessi2","_instanceConfig$sessi3","cleanedRequest","GDPR_DEFAULT_PERSISTENCE_PREFIX","optIn","_optInOut","optOut","hasOptedIn","_getStorageValue","hasOptedOut","respectDnt","nav","hasDntOn","doNotTrack","dntValue","_hasDoNotTrackFlagOn","clearOptInOut","_getStorage","_getStorageKey","crossSubdomainCookie","persistenceType","persistencePrefix","optValue","cookieExpiration","secureCookie","captureEventName","captureProperties","send_instantly","userOptedOut","posthog","optedOut","respect_dnt","opt_out_capturing_persistence_type","opt_out_capturing_cookie_prefix","IncrementalSource","FIVE_MINUTES","RECORDING_IDLE_ACTIVITY_TIMEOUT_MS","ACTIVE_SOURCES","MouseMove","MouseInteraction","Scroll","ViewportResize","Input","TouchMove","MediaInteraction","Drag","newQueuedEvent","rrwebMethod","enqueuedAt","attempt","SessionRecording","_captureStarted","_endpoint","stopRrweb","receivedDecide","_flushBuffer","_tryAddCustomEvent","sessionManager","clearBuffer","_sampleRate","_this$buffer","_this$buffer2","mostRecentSnapshot","sessionStartTimestamp","checkAndGetSessionAndWindowId","enabled_server_side","disable_session_recording","enable_recording_console_log","canvasRecording_server_side","fps","quality","_this$instance$config","recordingVersion_server_side","recorderVersion","_this$instance$config2","_this$instance$config3","networkPayloadCapture_server_side","networkPayloadCapture_client_side","headersEnabled","bodyEnabled","performanceEnabled","capture_performance","capturePerformance","isRecordingEnabled","_linkedFlag","_linkedFlagSeen","isSampled","_startCapture","stopRecording","sessionId","_this$instance$persis3","sessionIdChanged","shouldSample","storedIsSampled","_response$sessionReco7","_response$sessionReco8","_response$sessionReco9","_response$sessionReco10","_response$sessionReco","_response$sessionReco2","_response$sessionReco3","_response$sessionReco4","_response$sessionReco5","_response$sessionReco6","sessionRecording","consoleLogRecordingEnabled","networkPayloadCapture","recordCanvas","canvasFps","canvasQuality","receivedSampleRate","sampleRate","_response$sessionReco11","receivedMinimumDuration","minimumDurationMilliseconds","_minimumDuration","linkedFlag","endpoint","onSessionId","makeSamplingDecision","_this$_linkedFlag","_this$_linkedFlag2","linkedVariant","variant","onFeatureFlags","_flags","variants","flagIsPresent","linkedFlagMatches","startRecordingIfEnabled","message","_this$instance$sessio","onRRwebEmit","plugin","trace","assign","recorderJS","recordingVersion","__loaded_recorder_version","_onScriptLoaded","_event$data","isUserInteraction","_isInteractiveEvent","isIdle","_lastActivityTimestamp","reason","timeSinceLastActive","threshold","returningFromIdle","_this$sessionManager$2","windowId","windowIdChanged","_tryTakeFullSnapshot","queuedRRWebEvent","queuedRRWebEvents","_tryRRWebMethod","rrwebRecord","addCustomEvent","_this5","takeFullSnapshot","_this$mutationRateLim","_this6","sessionRecordingOptions","blockClass","blockSelector","ignoreClass","maskTextClass","maskTextSelector","maskTextFn","maskAllInputs","maskInputOptions","maskInputFn","slimDOMOptions","collectFonts","inlineStylesheet","recordCrossOriginIframes","record","userSessionRecordingOptions","_i","_Object$entries","_Object$entries$_i","canvasRecording","sampling","canvas","dataURLOptions","mutationRateLimiter","log","_scheduleFullSnapshot","activePlugins","_gatherRRWebPlugins","emit","plugins","_addCaptureHook","_maskUrl","_this7","_fullSnapshotTimer","clearInterval","rrwebConsoleRecord","isConsoleLogCaptureEnabled","getRecordConsolePlugin","getRecordNetworkPlugin","_forceAllowLocalhostNetworkCapture","rawEvent","_processQueuedEvents","Meta","FullSnapshot","throttledEvent","throttleMutations","_event","updatedPayload","truncateLargeConsoleLogs","_updateWindowAndSessionIds","Custom","$snapshot_bytes","$snapshot_data","$session_id","$window_id","status","_captureSnapshotBuffered","_this8","itemsToProcess","_toConsumableArray","queueLength","_networkRequest","networkRequest","_this9","flushBufferTimer","clearTimeout","minimumDuration","sessionDuration","isPositiveSessionDuration","isBelowMinimumDuration","_captureSnapshot","_this$buffer3","_this10","additionalBytes","_url","_noTruncate","_batchKey","_metrics","rrweb_full_snapshot","Decide","_hasBootstrappedFeatureFlags","advanced_disable_feature_flags_on_first_load","verbose","parseDecideResponse","toolbar","_afterDecideResponse","surveysGenerator","extendPostHogWithSurveys","exceptionAutoCaptureAddedToWindow","extendPostHogWithExceptionAutoCapture","extendPostHogWithExceptionAutocapture","opt_in_site_apps","scriptUrl","STATE_FROM_WINDOW","Toolbar","toolbarParams","toolbarVersion","loadToolbar","_location","_history","history","stateHash","atob","replaceState","title","userIntent","fiveMinutesInMillis","timestampToNearestFiveMinutes","toolbarUrl","disableToolbarMetrics","region","advanced_disable_toolbar_metrics","apiURL","instrument","paramsToPersist","_objectWithoutProperties","_excluded","maybeLoadToolbar","RequestQueueScaffold","pollInterval","isPolling","_event_queue","_empty_queue_count","_poller","_pollInterval","interval","poll","RequestQueue","_RequestQueueScaffold","_inherits","_super","_createSuper","handlePollRequest","requests","formatQueue","_requests$key","dataKey","requestValues","values","r","transport","request","u8","u16","Uint16Array","u32","fleb","fdeb","clim","freb","eb","j","_a","fl","revfl","_b","revfd","rev","hMap","cd","mb","co","le","rvb","sv","r_1","m","flt","fdt","flm","Compression","fdm","shft","slc","subarray","wbits","o","wbits16","hTree","t","t2","i0","i1","i2","maxSym","tr","mbt","ln","dt","lft","cst","i2_1","i2_2","i2_3","lc","cl","cli","cln","cls","w","clen","cf","wfblk","out","pos","dat","wblk","final","syms","lf","df","li","bs","bl","dlt","mlb","ddt","mdb","_c","lclt","nlc","_d","lcdt","ndc","lcfreq","_e","lct","mlcb","nlcc","lm","ll","dm","dl","flen","ftlen","dtlen","llm","lcts","clct","dst","deo","et","crct","crc","cr","dopt","opt","pre","post","st","lvl","plvl","lst","msk_1","prev","head","bs1_1","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","maxd","ml","nl","mmd","md","ti","lin","din","dflt","mem","wbytes","gzh","filename","mtime","gzhl","gzipSync","opts","strToU8","latin1","TextEncoder","encode","ar","ai","addParamsToURL","urlQueryArgs","parameterOptions","halves","argSeparator","encodePostData","blob","sendBeacon","body_data","compression","_params$options","Headers","headerValue","headerName","append","retriesPerformedSoFar","retry_count","keepalive","then","statusCode","responseText","_params$onResponse","_params$callback2","onResponse","onError","retryQueue","enqueue","_params$callback","catch","_params$callback3","xhr","_ref$timeout","timeout","req","open","setRequestHeader","withCredentials","onreadystatechange","readyState","minimalResponseSummary","send","RetryQueue","RequestRouterRegion","onRequestError","rateLimiter","queue","areWeOnline","onLine","_handleWeAreNowOnline","requestData","msToNextRetry","rawBackoffTime","minBackoff","cappedBackoffTime","jitter","pickNextRetryDelay","retryAt","logMessage","flush","toFlush","_executeXhrRequest","isRateLimited","_ref3","checkForLimiting","MAX_SESSION_IDLE_TIMEOUT","SessionIdManager","sessionIdGenerator","windowIdGenerator","_windowId","_sessionId","_sessionStartTimestamp","_sessionActivityTimestamp","_sessionIdGenerator","_windowIdGenerator","persistenceName","desiredTimeout","_sessionTimeoutMs","_window_id_storage_key","_primary_window_exists_storage_key","_canUseSessionStorage","lastWindowId","primaryWindowExists","_listenToReloadWindow","_sessionIdChangedHandlers","sessionActivityTimestamp","_setSessionId","readOnly","_this$_getSessionId2","_getSessionId","lastTimestamp","startTimestamp","_getWindowId","sessionPastMaximumLength","valuesChanged","noSessionId","activityTimeout","changeReason","newTimestamp","_setWindowId","RequestRouter","api_host","ui_host","_regionCache","apiHost","US","EU","CUSTOM","uiHost","suffix","SentryIntegration","_posthog","organization","projectId","prefix","setupOnce","addGlobalEventProcessor","_event$exception","_exceptions$","_exceptions$2","_exceptions$3","_exceptions$4","tags","personUrl","sessionRecordingStarted","get_session_replay_url","withTimestamp","exceptions","exception","$exception_message","$exception_type","$exception_personURL","$sentry_event_id","event_id","$sentry_exception","$sentry_exception_message","$sentry_exception_type","$sentry_tags","PageViewManager","_pageViewData$maxScro","_pageViewData$maxScro2","_pageViewData$maxCont","_pageViewData$maxCont2","_pageViewData","_createPageViewData","pageViewData","scrollY","_scrollY","scrollHeight","_scrollHeight","contentY","_contentY","contentHeight","_contentHeight","lastScrollY","maxScrollY","maxScrollHeight","lastContentY","maxContentY","maxContentHeight","_instance","_window$location$path","_prevPageViewData","prevPageViewData","_hasSeenPageView","_updateScrollData","$prev_pageview_pathname","_calculatePrevPageScrollProperties","$prev_pageview_last_scroll","$prev_pageview_last_scroll_percentage","clamp","$prev_pageview_max_scroll","$prev_pageview_max_scroll_percentage","$prev_pageview_last_content","$prev_pageview_last_content_percentage","$prev_pageview_max_content","$prev_pageview_max_content_percentage","removeEventListener","scroll_root_selector","documentElement","querySelector","_scrollElement","clientHeight","scrollTop","pageYOffset","InitType","init_type","posthog_main","surveyUrlValidationMap","icontains","conditionsUrl","exact","PostHogSurveys","forceReload","existingSurveys","surveys","getSurveys","targetingMatchedSurveys","survey","start_date","end_date","_survey$conditions","_survey$conditions$ur","_survey$conditions2","_survey$conditions3","conditions","urlCheck","urlMatchType","selectorCheck","linked_flag_key","targeting_flag_key","linkedFlagCheck","isFeatureEnabled","targetingFlagCheck","RateLimiter","httpResponse","quota_limited","batchKey","limits","retryAfter","generateSessionSourceParams","initialPathName","SessionPropsManager","sessionIdManager","sessionSourceParamGenerator","stored","_getStoredProps","newProps","_sessionSourceParamGenerator","_persistence","_sessionIdManager","_onSessionIdCallback","_this$_getStoredProps","$client_session_initial_referring_host","$client_session_initial_pathname","$client_session_initial_utm_source","utm_source","$client_session_initial_utm_campaign","utm_campaign","$client_session_initial_utm_medium","utm_medium","$client_session_initial_utm_content","utm_content","$client_session_initial_utm_term","utm_term","DEFAULT_BLOCKED_UA_STRS","_isBlockedUA","customBlockedUserAgents","uaLower","blockedUA","blockedUaLower","__NOOP","__NOOPTIONS","PRIMARY_INSTANCE_NAME","ENQUEUE_REQUESTS","defaultConfig","_window$location","documentLocation","api_method","api_transport","cross_subdomain_cookie","persistence_name","cookie_name","loaded","store_google","custom_blocked_useragents","save_referrer","capture_pageview","capture_pageleave","debug","cookie_expiration","upgrade","disable_persistence","disable_cookie","secure_cookie","protocol","ip","opt_out_capturing_by_default","opt_out_persistence_by_default","opt_out_useragent_filter","property_blacklist","property_denylist","sanitize_properties","request_headers","inapp_protocol","inapp_link_new_window","request_batching","properties_string_max_length","advanced_disable_decide","on_request_error","get_device_id","uuid","_onCapture","bootstrap","disable_compression","session_idle_timeout_seconds","create_phlib","createComplete","callbacksHandled","initComplete","syncCode","handleCallback","callbackName","INIT_MODULE","PostHog","_init","disable_scroll_properties","pageViewManager","startMeasuringScrollPosition","_execute_array","people","DeprecatedWebPerformanceObserver","__forceAllowLocalhost","segmentIntegration","Promise","resolve","enrichEvent","ctx","userId","anonymousId","reset","additionalProperties","_calculate_event_properties","isLoaded","track","page","identify","createSegmentIntegration","__captureHooks","__request_queue","analyticsDefaultEndpoint","to","setProps","setPersonProperties","set_once","_isEmptyString","_loaded","_window$rrweb","_config$bootstrap","_window$addEventListe","_triggered_notifs","_window$rrweb2","segmentRegister","updateInitComplete","xhr_headers","set_config","sessionPersistence","_requestQueue","_handle_queued_event","_retryQueue","sessionPropsManager","_gdpr_init","segment","user","set_user_state","distinctID","_config$bootstrap2","_config$bootstrap3","deviceID","isIdentifiedID","$device_id","_config$bootstrap4","_config$bootstrap7","activeFlags","_config$bootstrap5","_config$bootstrap5$fe","_config$bootstrap6","_config$bootstrap6$fe","featureFlagPayloads","_config$bootstrap8","_config$bootstrap8$fe","_config$bootstrap9","_config$bootstrap9$fe","register_once","self","_handle_unload","_response$analytics","supportedCompression","analytics","disableDecide","_start_queue_if_opted_in","resetRequestQueue","_this$_requestQueue","has_opted_out_capturing","item","_this$_requestQueue2","_this$_retryQueue","unload","jsonData","__compress_and_send_json_request","_compressData","GZipJS","compressData","Base64","_compressData2","_options","DEFAULT_OPTIONS","useSendBeacon","_s$parentNode","script","async","defer","getElementsByTagName","array","fn_name","alias_calls","other_calls","capturing_calls","execute","calls","caller","_this$config$bootstra","_this$config$bootstra2","_options$_url","update_search_keyword","update_campaign_params","update_referrer_info","finalSet","_isEmptyObject","has_unique_traits","_invokeCaptureHooks","eventData","event_properties","start_timestamp","remove_event_timer","persistenceProps","infoProperties","_this$sessionManager$","__preview_send_client_session_params","sessionProps","getSessionProps","performanceProperties","doPageView","doPageLeave","duration_in_ms","toFixed","denylisted_prop","_this$persistence","_this$persistence2","_this$sessionPersiste","property","_this$persistence3","_this$sessionPersiste2","getFeatureFlagPayload","_unused","updateEarlyAccessFeatureEnrollment","getEarlyAccessFeatures","_this$sessionManager","getActiveMatchingSurveys","new_distinct_id","userPropertiesToSet","userPropertiesToSetOnce","previous_distinct_id","$user_id","device_id","$had_persisted_distinct_id","isKnownAnonymous","get_user_state","$set_once","setAnonymousDistinctId","groupKey","groupPropertiesToSet","existingGroups","resetGroupPropertiesForFlags","$groups","$group_type","$group_key","$group_set","setGroupPropertiesForFlags","resetPersonPropertiesForFlags","reset_device_id","_this$persistence4","_this$sessionPersiste3","_this$persistence5","_this$sessionManager2","resetSessionId","_this$sessionManager$3","_this$sessionManager3","_this$sessionManager$4","_options$timestampLoo","LOOK_BACK","timestampLookBack","recordingStartTime","alias","original","_register_single","_this$persistence6","disable_session_recording_has_changed","try_enable_after_opt_in","started","_this$sessionRecordin","property_name","_this$persistence7","_this$sessionPersiste4","_this$config$name","has_opted_in_capturing","persistence_type","opt_in_capturing","enable_persistence","opt_out_capturing","clear_persistence","clear_opt_in_out_capturing","_gdpr_update_persistence","_this$persistence8","_this$sessionPersiste5","_this$persistence9","_this$sessionPersiste6","cookie_prefix","_gdpr_call_func","klass","functions","_safewrap_class","instances","override_ph_init_func","INIT_SNIPPET","dom_loaded_handler","inst","_dom_loaded","add_dom_loaded_handler"],"mappings":"6zJAIMA,EAAS,CACXC,OAAO,EACPC,uBCLEC,EAAgBC,MAAMC,QACtBC,EAAWC,OAAOC,UACXC,EAAiBH,EAASG,eACjCC,EAAWJ,EAASI,SAEbC,EACTR,GACA,SAAUS,GACN,MAA8B,mBAAvBF,EAASG,KAAKD,EACzB,EACSE,EAAgB,SAAUC,GACnC,MAA4B,wBAArBL,EAASG,KAAKE,EACzB,EAIaC,EAAc,SAAUC,GAEjC,MAAoB,mBAANA,CAClB,EAEaC,EAAY,SAAUH,GAE/B,OAAOA,IAAMR,OAAOQ,KAAOJ,EAASI,EACxC,EAYaI,EAAe,SAAUJ,GAClC,YAAa,IAANA,CACX,EAEaK,EAAY,SAAUL,GAE/B,MAA2B,mBAApBL,EAASG,KAAKE,EACzB,EAMaM,EAAU,SAAUN,GAE7B,OAAa,OAANA,CACX,EAMaO,EAAa,SAAUP,GAChC,OAAOI,EAAaJ,IAAMM,EAAQN,EACtC,EAMaQ,EAAY,SAAUR,GAE/B,MAA2B,mBAApBL,EAASG,KAAKE,EACzB,EACaS,EAAa,SAAUT,GAEhC,MAA4B,qBAArBL,EAASG,KAAKE,EACzB,EAOaU,EAAc,SAACV,GAExB,OAAOA,aAAaW,QACxB,ECzEMC,EAAkE,oBAAXC,OAAyBA,YAASC,EAEzFC,EAA8D,oBAAfC,WAA6BA,WAAaJ,EAElFK,EAAa5B,MAAMI,UACnByB,EAAgBD,EAAWE,QAC3BC,EAAgBH,EAAWI,QAElCC,EAAYP,aAAAA,EAAAA,EAAQO,UACbC,EAAWR,aAAM,EAANA,EAAQQ,SACnBC,EAAWT,aAAM,EAANA,EAAQS,SACnBC,EAAQV,aAAM,EAANA,EAAQU,MAChBC,EAAiBX,aAAM,EAANA,EAAQW,eACzBC,EAAYL,aAAS,EAATA,EAAWK,UACvBC,EAAqEhB,QAAAA,EAAQ,CAAU,ECrB9FiB,EAAgB,eACTC,EAAS,CAClBC,KAAM,SAACC,GACH,GACInB,IACC5B,EAAOC,OAAS0C,EAAiBK,iBACjC7B,EAAaS,EAAOqB,UACrBrB,EAAOqB,QACT,CAME,IALA,IAAMC,GACF,uBAAwBtB,EAAOqB,QAAQF,GAChCnB,EAAOqB,QAAQF,GAAmC,mBACnDnB,EAAOqB,QAAQF,IAEzBI,EAAAC,UAAAC,OAZmCC,MAAIlD,MAAA+C,EAAAA,EAAAA,OAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAJD,EAAIC,EAAAH,GAAAA,UAAAG,GAavCL,EAAUM,WAACZ,EAAAA,CAAAA,GAAaa,OAAKH,GACjC,CACH,EAEDI,KAAM,WAAoB,IAAA,IAAAC,EAAAP,UAAAC,OAAhBC,EAAIlD,IAAAA,MAAAuD,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJN,EAAIM,GAAAR,UAAAQ,GACVf,EAAOC,KAAIU,MAAXX,EAAY,CAAA,OAAKY,OAAKH,GACzB,EAEDO,KAAM,WAAoB,IAAA,IAAAC,EAAAV,UAAAC,OAAhBC,EAAIlD,IAAAA,MAAA0D,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJT,EAAIS,GAAAX,UAAAW,GACVlB,EAAOC,KAAIU,MAAXX,EAAY,CAAA,QAAMY,OAAKH,GAC1B,EAEDU,MAAO,WAAoB,IAAA,IAAAC,EAAAb,UAAAC,OAAhBC,EAAIlD,IAAAA,MAAA6D,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJZ,EAAIY,GAAAd,UAAAc,GACXrB,EAAOC,KAAIU,MAAXX,EAAY,CAAA,SAAOY,OAAKH,GAC3B,EAEDa,SAAU,WAAoB,IAAA,IAAAC,EAAAC,EAAAjB,UAAAC,OAAhBC,EAAIlD,IAAAA,MAAAiE,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJhB,EAAIgB,GAAAlB,UAAAkB,IAGdF,EAAAnB,SAAQe,MAAKR,MAAAY,GAACxB,GAAaa,OAAKH,GACnC,EAEDiB,qBAAsB,SAACC,GACnB3B,EAAOmB,MAAK,8CAAAP,OAA+Ce,GAC/D,GC5BEC,EAAmB,CAAA,EAIZC,EAAQ,SAAUC,GAC3B,OAAOA,EAAIC,QAAQ,qCAAsC,GAC7D,EAUO,SAASC,EACZjE,EACAkE,EACAC,GAEA,GAAIpE,EAASC,GACT,GAAIqB,GAAiBrB,EAAIsB,UAAYD,EACjCrB,EAAIsB,QAAQ4C,EAAUC,QACnB,GAAI,WAAYnE,GAAOA,EAAIyC,UAAYzC,EAAIyC,OAC9C,IAAK,IAAI2B,EAAI,EAAGC,EAAIrE,EAAIyC,OAAQ2B,EAAIC,EAAGD,IACnC,GAAIA,KAAKpE,GAAOkE,EAASjE,KAAKkE,EAASnE,EAAIoE,GAAIA,KAAOP,EAClD,MAKpB,CAOO,SAASS,EAAMtE,EAAUkE,EAAoDC,GAChF,IAAIzD,EAAWV,GAAf,CAGA,GAAID,EAASC,GACT,OAAOiE,EAAWjE,EAAKkE,EAAUC,GAErC,GAAItD,EAAYb,GAAhB,CAAsB,IACcuE,EADdC,EAAAC,EACCzE,EAAI0E,WAAS,IAAhC,IAAAF,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAkC,CAAA,IAAvBC,EAAIP,EAAAQ,MACX,GAAIb,EAASjE,KAAKkE,EAASW,EAAK,GAAIA,EAAK,MAAQjB,EAC7C,MAER,CAAC,CAAA,MAAAmB,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CAEL,MACA,IAAK,IAAM6E,KAAOlF,EACd,GAAIH,EAAeI,KAAKD,EAAKkF,IACrBhB,EAASjE,KAAKkE,EAASnE,EAAIkF,GAAMA,KAASrB,EAC1C,MAfZ,CAmBJ,CAEO,IAAMsB,EAAU,SAAUnF,GAA+E,IAAAuC,IAAAA,EAAAC,UAAAC,OAAlDC,MAAIlD,MAAA+C,EAAAA,EAAAA,OAAAS,EAAA,EAAAA,EAAAT,EAAAS,IAAJN,EAAIM,EAAAR,GAAAA,UAAAQ,GAQ9D,OAPAiB,EAAWvB,GAAM,SAAU0C,GACvB,IAAK,IAAMC,KAAQD,OACM,IAAjBA,EAAOC,KACPrF,EAAIqF,GAAQD,EAAOC,GAG/B,IACOrF,CACX,EAsBO,SAASsF,EAAmBvB,EAAmBwB,GAClD,OAAyC,IAAjCxB,EAAYvC,QAAQ+D,EAChC,CAMO,SAASC,GAAkBxF,GAK9B,IAJA,IAAMyF,EAAW9F,OAAO+F,KAAK1F,GACzBoE,EAAIqB,EAAShD,OACXkD,EAAW,IAAInG,MAAM4E,GAEpBA,KACHuB,EAASvB,GAAK,CAACqB,EAASrB,GAAIpE,EAAIyF,EAASrB,KAE7C,OAAOuB,CACX,CAEO,IAoBMC,GAAa,WAMtB,OALAC,KAAKC,IACDD,KAAKC,KACL,WACI,OAAQ,IAAID,MAEbA,KAAKC,KAChB,EAsBaC,GAAO,SAAaC,GAC7B,IACI,OAAOA,GACV,CAAC,MAAOf,GACL,MACJ,CACJ,EAEagB,GAAY,SAAuE5F,GAC5F,OAAO,WACH,IAAI,IAAA,IAAA0C,EAAAP,UAAAC,OADYC,EAAIlD,IAAAA,MAAAuD,GAAAI,EAAA,EAAAA,EAAAJ,EAAAI,IAAJT,EAAIS,GAAAX,UAAAW,GAIhB,OAAO9C,EAAEuC,MAAMsD,KAAMxD,EACxB,CAAC,MAAOuC,GACLhD,EAAOsB,SACH,iIAEJtB,EAAOsB,SAAS0B,EACpB,EAER,EAiBakB,GAA0B,SAAUC,GAC7C,IAAMC,EAAkB,CAAA,EAMxB,OALA/B,EAAM8B,GAAG,SAAUE,EAAGC,GACd/F,EAAU8F,IAAMA,EAAE7D,OAAS,IAC3B4D,EAAIE,GAAKD,EAEjB,IACOD,CACX,EA0CO,SAASG,GACZC,EACAC,GAEA,OAlCA3B,EAkCwB0B,EAjCxBE,EAiCgC,SAAC5B,GAC7B,OAAIvE,EAAUuE,KAAWtE,EAAQiG,GACrB3B,EAAiB6B,MAAM,EAAGF,GAE/B3B,CACX,EApCM8B,EAAuB,IAAIC,IAEjC,SAASC,EAAyBhC,EAAUG,GACxC,OAAIH,IAAUpF,OAAOoF,GAAe4B,EAAaA,EAAW5B,EAAcG,GAAOH,EAE7E8B,EAAqBG,IAAIjC,QAA7B,GACA8B,EAAqBI,IAAIlC,GAGrBhF,EAASgF,IACTmC,EAAS,GACTjD,EAAWc,GAAO,SAACoC,GACfD,EAAOE,KAAKL,EAAyBI,GACzC,MAEAD,EAAS,CAAA,EACT5C,EAAMS,GAAO,SAACsC,EAAKnC,GACV2B,EAAqBG,IAAIK,KACxBH,EAAehC,GAAO6B,EAAyBM,EAAKnC,GAE9D,KAEGgC,GAfP,IAAIA,CAgBR,CACOH,CAAyBhC,GA5BpC,IACIA,EACA4B,EAEME,CAqCV,CAKO,SAASS,GAAcC,GAC1B,IAIIC,EACAC,EACAC,EACAC,EACAC,EAREC,EAAM,oEASRzD,EAAI,EACJ0D,EAAK,EACLC,EAAM,GACJC,EAAoB,GAE1B,IAAKT,EACD,OAAOA,EAGXA,EAAOU,GAAYV,GAEnB,GAQIC,GAFAI,EAJKL,EAAKW,WAAW9D,MAIP,GAHTmD,EAAKW,WAAW9D,MAGM,EAFtBmD,EAAKW,WAAW9D,OAIP,GAAM,GACpBqD,EAAMG,GAAQ,GAAM,GACpBF,EAAME,GAAQ,EAAK,GACnBD,EAAY,GAAPC,EAGLI,EAAQF,KAAQD,EAAIM,OAAOX,GAAMK,EAAIM,OAAOV,GAAMI,EAAIM,OAAOT,GAAMG,EAAIM,OAAOR,SACzEvD,EAAImD,EAAK9E,QAIlB,OAFAsF,EAAMC,EAAQI,KAAK,IAEXb,EAAK9E,OAAS,GAClB,KAAK,EACDsF,EAAMA,EAAInB,MAAM,GAAI,GAAK,KACzB,MACJ,KAAK,EACDmB,EAAMA,EAAInB,MAAM,GAAI,GAAK,IAIjC,OAAOmB,CACX,CAEO,IAAME,GAAc,SAAUI,GAGjC,IACIC,EACAC,EACAC,EACA5D,EAJA6D,EAAU,GASd,IAHAH,EAAQC,EAAM,EACdC,GATAH,GAAUA,EAAS,IAAIrE,QAAQ,QAAS,MAAMA,QAAQ,MAAO,OAS5CvB,OAEZmC,EAAI,EAAGA,EAAI4D,EAAS5D,IAAK,CAC1B,IAAM8D,EAAKL,EAAOH,WAAWtD,GACzBmD,EAAM,KAENW,EAAK,IACLH,IAEAR,EADOW,EAAK,KAAOA,EAAK,KAClBC,OAAOC,aAAcF,GAAM,EAAK,IAAW,GAALA,EAAW,KAEjDC,OAAOC,aAAcF,GAAM,GAAM,IAAOA,GAAM,EAAK,GAAM,IAAW,GAALA,EAAW,KAE/EjI,EAAQsH,KACLQ,EAAMD,IACNG,GAAWJ,EAAOQ,UAAUP,EAAOC,IAEvCE,GAAWV,EACXO,EAAQC,EAAM3D,EAAI,EAE1B,CAMA,OAJI2D,EAAMD,IACNG,GAAWJ,EAAOQ,UAAUP,EAAOD,EAAO5F,SAGvCgG,CACX,EAEaK,GAAmB,WAqE5B,SAASC,EAASC,GAKd,OAJIA,IACAA,EAAMC,eAAiBF,EAASE,eAChCD,EAAME,gBAAkBH,EAASG,iBAE9BF,CACX,CAQA,OAPAD,EAASE,eAAiB,WACpB/C,KAAsBiD,aAAc,GAE1CJ,EAASG,gBAAkB,WACrBhD,KAAsBkD,cAAe,GAjEpB,SACnBC,EACAC,EACAC,EACAC,EACAC,GAEA,GAAKJ,EAKL,GAAIA,EAAQK,mBAAqBF,EAC7BH,EAAQK,iBAAiBJ,EAAMC,IAAWE,OACvC,CACH,IAAME,EAAS,KAAOL,EAChBM,EAAeP,EAAgBM,GACnCN,EAAgBM,GAI1B,SACIN,EACAQ,EACAC,GAEA,OAAO,SAAUd,GAQb,GAPAA,EAAQA,GAASD,EAAS/H,aAAAA,EAAAA,EAAQgI,OAOlC,CAIA,IACIe,EADA1D,GAAM,EAGNjG,EAAY0J,KACZC,EAAaD,EAAad,IAE9B,IAAMgB,EAAaH,EAAY5J,KAAKoJ,EAASL,GAM7C,OAJI,IAAUe,IAAc,IAAUC,IAClC3D,GAAM,GAGHA,CAdP,EAgBR,CAnCoC4D,CAAYZ,EAASE,EAASK,EAC9D,MAVI3H,EAAOmB,MAAM,+CA6DzB,CApFgC,GAsFzB,SAAS8G,GAAWC,EAAyBC,GAChD,IAAMC,EAAY,WACd,IAAK3I,EACD,OAAO0I,EAAS,sBAEpB,IAAME,EAAY5I,EAAS6I,cAAc,UACzCD,EAAUhB,KAAO,kBACjBgB,EAAUE,IAAML,EAChBG,EAAUG,OAAS,SAACzB,GAAK,OAAKoB,OAASnJ,EAAW+H,EAAM,EACxDsB,EAAUI,QAAU,SAACtH,GAAK,OAAKgH,EAAShH,EAAM,EAE9C,IACwBuH,EADlBC,EAAUlJ,EAASmJ,iBAAiB,iBACtCD,EAAQnI,OAAS,EACIkI,QAArBA,EAAAC,EAAQ,GAAGE,sBAAUH,GAArBA,EAAuBI,aAAaT,EAAWM,EAAQ,IAGvDlJ,EAASsJ,KAAKC,YAAYX,IAI9B5I,SAAAA,EAAUsJ,KACVX,IAEA3I,SAAAA,EAAUgI,iBAAiB,mBAAoBW,EAEvD,CC3dO,SAASa,GAAiBvG,GAC7B,OAAOA,EAAIb,EAAMa,GAAGwG,MAAM,OAAS,EACvC,CAQO,SAASC,GAAcC,GAC1B,IAAIC,EAAY,GAChB,OAAAC,EAAeF,EAAGC,YACd,IAAK,SACDA,EAAYD,EAAGC,UACf,MAEJ,IAAK,SACDA,GACK,YAAaD,EAAGC,UAAaD,EAAGC,UAAkBE,QAAU,OAASH,EAAGI,aAAa,UAAY,GACtG,MACJ,QACIH,EAAY,GAGpB,OAAOJ,GAAiBI,EAC5B,CAEO,SAASI,GAAa/G,GACzB,OAAIjE,EAAWiE,GACJ,KAIPb,EAAMa,GAEDwG,MAAM,SACNQ,OAAOC,IACPxD,KAAK,IAELpE,QAAQ,UAAW,KACnBA,QAAQ,QAAS,KAEjB6E,UAAU,EAAG,IAE1B,CAWO,SAASgD,GAAYR,GACxB,IAAIS,EAAS,GAUb,OARIC,GAAqBV,KAAQW,GAAmBX,IAAOA,EAAGY,YAAcZ,EAAGY,WAAWxJ,QACtF6B,EAAM+G,EAAGY,YAAY,SAAUC,GACiB,IAAAC,EAAxCC,GAAWF,IAAUA,EAAMG,cAC3BP,GAAyCK,QAAnCA,EAAIT,GAAaQ,EAAMG,oBAAYF,IAAAA,EAAAA,EAAI,GAErD,IAGGrI,EAAMgI,EACjB,CAOO,SAASQ,GAAcjB,GAC1B,QAASA,GAAsB,IAAhBA,EAAGkB,QACtB,CAYO,SAASC,GAAMnB,EAAgCoB,GAClD,QAASpB,KAAQA,EAAGqB,SAAWrB,EAAGqB,QAAQC,gBAAkBF,EAAIE,aACpE,CAOO,SAASP,GAAWf,GACvB,QAASA,GAAsB,IAAhBA,EAAGkB,QACtB,CAOO,SAASK,GAAmBvB,GAC/B,QAASA,GAAsB,KAAhBA,EAAGkB,QACtB,CAEO,IAAMM,GAAgC,CAAC,IAAK,SAAU,OAAQ,QAAS,SAAU,WAAY,SAyDpG,SAASC,GAAiBC,GACtB,IAAMjC,EAAaiC,EAAMjC,WACzB,SAAKA,IAAewB,GAAcxB,KAC3BA,CACX,CAYO,SAASkC,GACZ3B,EACArC,GAIO,IAHPiE,EAAgDzK,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EACnDiM,EAA6B1K,UAAAC,OAAAD,EAAAA,kBAAAvB,EAC7BkM,EAA4B3K,UAAAC,OAAAD,EAAAA,kBAAAvB,EAE5B,IAAKD,IAAWqK,GAAMmB,GAAMnB,EAAI,UAAYiB,GAAcjB,GACtD,OAAO,EAGX,GAAI4B,SAAAA,EAAmBG,cAAe,CAClC,IAAMC,EAAMrM,EAAOW,SAAS2L,KACtBC,EAAYN,EAAkBG,cACpC,GAAIG,IAAcA,EAAUC,MAAK,SAACC,GAAK,OAAKJ,EAAIK,MAAMD,EAAM,IACxD,OAAO,CAEf,CAEA,GAAIR,SAAAA,EAAmBU,oBAAqB,CACxC,IAAMJ,EAAYN,EAAkBU,oBACpC,GAAIJ,IAAcA,EAAUC,MAAK,SAACI,GAAS,OAAK5E,EAAMM,OAASsE,CAAS,IACpE,OAAO,CAEf,CAMA,IAJA,IAAIC,GAAwB,EACtBC,EAA+B,CAACzC,GAClCP,GAAgC,EAChCiC,EAAiB1B,EACd0B,EAAMjC,aAAe0B,GAAMO,EAAO,SAErC,GAAIH,GAAmBG,EAAMjC,YACzBgD,EAAkB1G,KAAM2F,EAAMjC,WAAmBiD,MACjDhB,EAASA,EAAMjC,WAAmBiD,SAFtC,CAMA,KADAjD,EAAagC,GAAiBC,IACb,MACjB,GAAIG,GAAuBL,GAA8BrL,QAAQsJ,EAAW4B,QAAQC,gBAAkB,EAClGkB,GAAwB,MACrB,CACH,IAAMG,EAAahN,EAAOiN,iBAAiBnD,GACvCkD,GAAwD,YAA1CA,EAAWE,iBAAiB,YAC1CL,GAAwB,EAEhC,CAEAC,EAAkB1G,KAAK0D,GACvBiC,EAAQjC,CAbR,CAgBJ,IAtHJ,SACIqD,EACAlB,GAEA,IAAMM,EAAYN,aAAAA,EAAAA,EAAmBmB,kBACrC,GAAI7N,EAAagN,GAEb,OAAO,EAIX,IACyBhJ,EADzBC,EAAAC,EACiB0J,GAAQ,IAAA,IAAAE,aAAA,IAAdhD,EAAE9G,EAAAQ,MACT,GAAIwI,EAAUC,MAAK,SAACc,GAAW,OAAKjD,EAAGqB,QAAQC,gBAAkB2B,CAAW,IACxE,MAAA,CAAAhI,GAAO,EACV,EAHL,IAAA9B,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAA2B,CAAA,IAAA0J,EAAAF,IAAA,GAAAE,WAAAhD,EAAAgD,GAAAA,OAAAA,EAAAjI,CAI3B,CAEA,CAAA,MAAAtB,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACA,OAAO,CACX,CAkGSmO,CAAyCV,EAAmBb,GAC7D,OAAO,EAGX,IA9FJ,SACIkB,EACAlB,GAEA,IAAMM,EAAYN,aAAAA,EAAAA,EAAmBwB,uBACrC,GAAIlO,EAAagN,GAEb,OAAO,EAIX,IACyBmB,EADzBC,EAAAlK,EACiB0J,GAAQ,IAAA,IAAAS,aAAA,IAAdvD,EAAEqD,EAAA3J,MACT,GAAIwI,EAAUC,MAAK,SAACqB,GAAQ,OAAKxD,EAAGyD,QAAQD,EAAS,IACjD,MAAA,CAAAvI,GAAO,EACV,EAHL,IAAAqI,EAAAhK,MAAA+J,EAAAC,EAAA/J,KAAAC,MAA2B,CAAA,IAAAkK,EAAAH,IAAA,GAAAG,WAAAxD,EAAAwD,GAAAA,OAAAA,EAAAzI,CAI3B,CAEA,CAAA,MAAAtB,GAAA2J,EAAA1J,EAAAD,EAAA,CAAA,QAAA2J,EAAAtO,GAAA,CACA,OAAO,CACX,CA0ES2O,CAA6ClB,EAAmBb,GACjE,OAAO,EAGX,IAAMe,EAAahN,EAAOiN,iBAAiB5C,GAC3C,GAAI2C,GAAwD,YAA1CA,EAAWE,iBAAiB,WAA0C,UAAflF,EAAMM,KAC3E,OAAO,EAGX,IAAMmD,EAAMpB,EAAGqB,QAAQC,cACvB,OAAQF,GACJ,IAAK,OACD,OAAO,EACX,IAAK,OACD,OAAQU,GAAqB,CAAC,WAAW3L,QAAQwH,EAAMM,OAAS,EACpE,IAAK,QACL,IAAK,SACL,IAAK,WACD,OAAQ6D,GAAqB,CAAC,SAAU,UAAU3L,QAAQwH,EAAMM,OAAS,EAC7E,QACI,OAAIuE,GAA+BV,GAAqB,CAAC,UAAU3L,QAAQwH,EAAMM,OAAS,GAErF6D,GAAqB,CAAC,UAAU3L,QAAQwH,EAAMM,OAAS,IACvDuD,GAA8BrL,QAAQiL,IAAQ,GAA4C,SAAvCpB,EAAGI,aAAa,oBAGpF,CAQO,SAASM,GAAqBV,GACjC,IAAK,IAAI0B,EAAQ1B,EAAI0B,EAAMjC,aAAe0B,GAAMO,EAAO,QAASA,EAAQA,EAAMjC,WAAuB,CACjG,IAAMmE,EAAU7D,GAAc2B,GAC9B,GAAIzH,EAAU2J,EAAS,iBAAmB3J,EAAU2J,EAAS,iBACzD,OAAO,CAEf,CAEA,GAAI3J,EAAU8F,GAAcC,GAAK,cAC7B,OAAO,EAIX,IAAM/B,EAAQ+B,EAAwB/B,MAAQ,GAC9C,GAAI9I,EAAU8I,GAEV,OAAQA,EAAKqD,eACT,IAAK,SAEL,IAAK,WACD,OAAO,EAKnB,IAAMuC,EAAQ7D,EAAwB6D,MAAQ7D,EAAG8D,IAAM,GAIvD,GAAI3O,EAAU0O,GAAO,CAIjB,GADI,uHACmBE,KAAKF,EAAKlL,QAAQ,gBAAiB,KACtD,OAAO,CAEf,CAEA,OAAO,CACX,CAOO,SAASgI,GAAmBX,GAI/B,SACKmB,GAAMnB,EAAI,WAFW,CAAC,SAAU,WAAY,SAAU,SAEbgE,SAAUhE,EAAwB/B,OAC5EkD,GAAMnB,EAAI,WACVmB,GAAMnB,EAAI,aAC6B,SAAvCA,EAAGI,aAAa,mBAKxB,CAQO,SAASG,GAAmB7G,GAC/B,GAAIrE,EAAWqE,GACX,OAAO,EAGX,GAAIvE,EAAUuE,GAAQ,CAClBA,EAAQjB,EAAMiB,GAMd,GADI,wKACQqK,MAAMrK,GAAS,IAAIf,QAAQ,QAAS,KAC5C,OAAO,EAKX,GADiB,0BACJoL,KAAKrK,GACd,OAAO,CAEf,CAEA,OAAO,CACX,CAuBO,SAASuK,GAA2BC,GACvC,IAAIC,EAAO3D,GAAY0D,GAEvB,OAAO3D,GADP4D,EAAO,GAAA3M,OAAG2M,EAAI3M,KAAAA,OAAI4M,GAAkBF,IAAUG,QACZF,EAAO,EAC7C,CAQO,SAASC,GAAkBF,GAC9B,IAAIC,EAAO,GAiBX,OAhBID,GAAUA,EAAOtD,YAAcsD,EAAOtD,WAAWxJ,QACjD6B,EAAMiL,EAAOtD,YAAY,SAAUC,GAAO,IAAAyD,EACtC,GAAIzD,GAA0C,UAApB,QAAbyD,EAAAzD,EAAMQ,eAAO,IAAAiD,OAAA,EAAbA,EAAehD,eACxB,IACI,IAAMiD,EAAW/D,GAAYK,GAC7BsD,EAAO,GAAA3M,OAAG2M,EAAI,KAAA3M,OAAI+M,GAAWF,OAEzBxD,EAAMD,YAAcC,EAAMD,WAAWxJ,SACrC+M,EAAO,GAAA3M,OAAG2M,EAAI3M,KAAAA,OAAI4M,GAAkBvD,IAASwD,OAEpD,CAAC,MAAOzK,GACLhD,EAAOmB,MAAM6B,EACjB,CAER,IAEGuK,CACX,CAQO,SAASK,GAAuB1B,GACnC,OAuBJ,SAA0BA,GACtB,IAAM9H,EAAM8H,EAAS2B,KAAI,SAACzG,GAAY,IAAA0G,EAAAC,EAC9BC,EAAY,GAIhB,GAHI5G,EAAQ6G,WACRD,GAAa5G,EAAQ6G,UAErB7G,EAAQ8G,WAAY,CACpB9G,EAAQ8G,WAAWC,OAAM,IACoBC,EADpBC,EAAA7L,EACE4E,EAAQ8G,YAAU,IAA7C,IAAAG,EAAA3L,MAAA0L,EAAAC,EAAA1L,KAAAC,MAA+C,CAAA,IAApC0L,EAAYF,EAAAtL,MACnBkL,GAAS,IAAApN,OAAQ0N,EAAavM,QAAQ,KAAM,IAChD,CAAC,CAAA,MAAAgB,GAAAsL,EAAArL,EAAAD,EAAA,CAAA,QAAAsL,EAAAjQ,GAAA,CACL,CACA,IAAMmQ,EAA+BC,EAAAA,EAAAA,EAAAA,EAAA,CAAA,EAC7BpH,EAAQmG,KAAO,CAAEA,KAAMnG,EAAQmG,MAAS,CAAA,GAAE,GAAA,CAC9C,YAA8B,QAAnBO,EAAE1G,EAAQqH,iBAAS,IAAAX,EAAAA,EAAI,EAClC,cAAkCC,QAArBA,EAAE3G,EAAQsH,mBAAWX,IAAAA,EAAAA,EAAI,GAClC3G,EAAQiE,KAAO,CAAEA,KAAMjE,EAAQiE,MAAS,CAAE,GAC1CjE,EAAQuH,QAAU,CAAEA,QAASvH,EAAQuH,SAAY,IAClDvH,EAAQmH,YAETK,EAAwC,CAAA,EAU9C,OATArL,GAASgL,GACJJ,MAAK,SAAAU,EAAAC,GAAA,IAAEC,EAAFC,EAAAH,EAAA,GAAG,GAAII,EAAJD,EAAAF,EAAA,GAAK,GAAA,OAAMC,EAAEG,cAAcD,EAAE,IACrC5P,SACG,SAAA8P,GAAA,IAAAC,EAAAJ,EAAAG,EAAA,GAAElM,EAAGmM,EAAA,GAAEtM,EAAKsM,EAAA,GAAA,OAAOR,EAAiBS,GAAapM,EAAIpF,aAAewR,GAAavM,EAAMjF,WAAW,IAE1GmQ,GAAa,IACbA,GAAazK,GAASgL,GACjBV,KAAI,SAAAyB,GAAA,IAAAC,EAAAP,EAAAM,EAAA,GAAErM,EAAGsM,EAAA,GAAEzM,EAAKyM,EAAA,GAAA,MAAA,GAAA3O,OAASqC,EAAGrC,MAAAA,OAAKkC,EAAK,IAAA,IACtCqD,KAAK,GAEd,IACA,OAAO/B,EAAI+B,KAAK,IACpB,CAxDWqJ,CA0DX,SAAyBtD,GACrB,OAAOA,EAAS2B,KAAI,SAACzE,GAAO,IAAAqG,EAAAC,EAClBC,EAAW,CACbpC,KAAoB,QAAhBkC,EAAErG,EAAa,gBAAC,IAAAqG,OAAA,EAAdA,EAAgB9K,MAAM,EAAG,KAC/BsJ,SAAU7E,EAAa,SACvBiC,KAAsB,QAAlBqE,EAAEtG,EAAe,kBAAC,IAAAsG,OAAA,EAAhBA,EAAkB/K,MAAM,EAAG,MACjCuJ,WAAY0B,GAAiBxG,GAC7BuF,QAASvF,EAAa,SACtBqF,UAAWrF,EAAc,UACzBsF,YAAatF,EAAgB,YAC7BmF,WAAY,CAAC,GAKjB,OAHAhL,GAAS6F,GACJM,QAAO,SAAAmG,GAAK,OAAgC,IAArCb,EAAAa,EAAA,GAAK,GAAUtQ,QAAQ,SAAe,IAC7CF,SAAQ,SAAAyQ,GAAA,IAAAC,EAAAf,EAAAc,EAAA,GAAE7M,EAAG8M,EAAA,GAAEjN,EAAKiN,EAAA,GAAA,OAAOJ,EAASpB,WAAWtL,GAAOH,CAAK,IACzD6M,CACX,GACJ,CA3E4BK,CAAgB9D,GAC5C,CAkBA,SAASmD,GAAaY,GAClB,OAAOA,EAAMlO,QAAQ,SAAU,MACnC,CAwDA,SAAS6N,GAAiBxG,GACtB,IAAM8E,EAAa9E,EAAgB,YACnC,OAAK8E,EAEMpQ,EAASoQ,GACTA,EAEAjF,GAAiBiF,QAJxB,CAMR,CCrgBA,IAIqBgC,GAAS,WAI1B,SAAAA,EAAYC,GAAkBC,OAAAF,GAC1BjM,KAAKoM,OAAS,GACdpM,KAAKkM,QAAUA,CACnB,CAuBC,OAvBAG,EAAAJ,EAAA,CAAA,CAAAjN,IAAA,cAAAH,MAED,SAAY5E,EAAWqS,EAAWC,GAC9B,IAAKvM,KAAKkM,QACN,OAAO,EAGX,IAAMM,EAAYxM,KAAKoM,OAAOpM,KAAKoM,OAAO7P,OAAS,GACnD,GACIiQ,GACAC,KAAKC,IAAIzS,EAAIuS,EAAUvS,GAAKwS,KAAKC,IAAIJ,EAAIE,EAAUF,GArB/B,IAsBpBC,EAAYC,EAAUD,UArBJ,KAyBlB,GAFAvM,KAAKoM,OAAOlL,KAAK,CAAEjH,EAAAA,EAAGqS,EAAAA,EAAGC,UAAAA,IAtBN,IAwBfvM,KAAKoM,OAAO7P,OACZ,OAAO,OAGXyD,KAAKoM,OAAS,CAAC,CAAEnS,EAAAA,EAAGqS,EAAAA,EAAGC,UAAAA,IAG3B,OAAO,CACX,KAACN,CAAA,CA9ByB,GCDjBU,GAAyB,sBAEzBC,GAAe,UAEfC,GAAmB,WACnBC,GAAmC,oCACnCC,GAAwC,yCACxCC,GAA4C,6CAC5CC,GAAiD,kDACjDC,GAA4C,6CAC5CC,GAAqC,sCACrCC,GAAa,SACbC,GAA+B,sBAC/BC,GAAwB,yBACxBC,GAAoC,yBACpCC,GAA+B,4BAC/BC,GAA8B,2BAC9BC,GAAU,WACVC,GAAqB,sBACrBC,GAAa,cACbC,GAAwB,yBACxBC,GAAuB,wBAGvBC,GAAkC,CAC3CpB,GACAC,GAvB4B,UAyB5BC,GACAE,GACAK,GACAE,GACAM,GACAC,GACAN,GACAE,GACAD,GACAE,GACAC,GACAG,IClBEE,GAAyB,oBAE/B,SAASC,GAAU1R,EAAgB+M,GAC/B,OAAIA,EAAK/M,OAASA,EACP+M,EAAK5I,MAAM,EAAGnE,GAAU,MAE5B+M,CACX,CAEA,IAAM4E,GAAc,CAChBC,mBAAoB,GACpBC,sBAAuB,KACvBC,uBAAuB,EAEvBC,yBAA0B,SAAUC,GAAyB,IAAAC,EACnDC,EAAuBlU,EAAQyF,KAAKoO,yBACdI,QAArBA,EAACD,EAASG,mBAATF,IAAoBA,IAApBA,EAAsBG,MAAM7B,KAC9B9M,KAAKoO,sBACLQ,IAAwBL,EAASM,OAAOX,YAC9ClO,KAAKqO,sBAAwBO,IAAwBH,CACxD,EAEDK,wBAAyB,SAAU3J,GAC/B,GAAIA,EAAG4J,uBACH,OAAO5J,EAAG4J,uBAEV,IAAIC,EAAsB7J,EAC1B,GACI6J,EAAMA,EAAIC,sBACLD,IAAQ5I,GAAc4I,IAC/B,OAAOA,CAEd,EAEDE,iCAAkC,SAAUC,GAExC,IADwBtJ,GAAqBsJ,GAEzC,MAAO,GAGX,IAAMR,EAAoB,CAAA,EAW1B,OATAvQ,EAAM+Q,EAAK7E,YAAY,SAAU8E,GAC7B,GAAuD,IAAnDA,EAAKpG,KAAK1N,QAAQ,6BAAoC,CACtD,IAAM+T,EAAcD,EAAKpG,KAAKlL,QAAQ,6BAA8B,IAC9DwR,EAAgBF,EAAKvQ,MACvBwQ,GAAeC,GAAiB5J,GAAmB4J,KACnDX,EAAMU,GAAeC,EAE7B,CACJ,IACOX,CACV,EAEDY,0BAA2B,SAAUJ,EAAeK,EAAqBC,GAA+B,IAAAC,EAC9F1F,EAAWmF,EAAK3I,QAAQC,cACxBkI,EAAoB,CACtB3E,SAAUA,GAEVrD,GAA8BrL,QAAQ0O,IAAa,IAAMyF,IAC1B,MAA3BzF,EAASvD,eAAoD,WAA3BuD,EAASvD,cAC3CkI,EAAgB,SAAIV,GAAU,KAAM7E,GAA2B+F,IAE/DR,EAAgB,SAAIV,GAAU,KAAMtI,GAAYwJ,KAIxD,IAAMpG,EAAU7D,GAAciK,GAC1BpG,EAAQxM,OAAS,IACjBoS,EAAe,QAAI5F,EAAQtD,QAAO,SAAUkK,GACxC,MAAa,KAANA,CACX,KAGJ,IAAMC,EAAwC,QAAdF,EAAG1P,KAAK6O,cAAM,IAAAa,OAAA,EAAXA,EAAaG,6BAChDzR,EAAM+Q,EAAK7E,YAAY,SAAU8E,GHsRlC,IAA4BU,EGpRvB,KAAIhK,GAAmBqJ,KAAyD,IAAhD,CAAC,OAAQ,KAAM,SAAS7T,QAAQ8T,EAAKpG,UAEjE4G,UAAAA,EAA4BzG,SAASiG,EAAKpG,SAEzCwG,GAAc9J,GAAmB0J,EAAKvQ,SHgRpBiR,EGhRkDV,EAAKpG,MHiRlF1O,EAAUwV,IACgC,eAAnCA,EAAcnN,UAAU,EAAG,KAA0D,YAAlCmN,EAAcnN,UAAU,EAAG,KGlRI,CACjF,IAAI9D,EAAQuQ,EAAKvQ,MACC,UAAduQ,EAAKpG,OAILnK,EAAQmG,GAAiBnG,GAAOqD,KAAK,MAEzCyM,EAAM,SAAWS,EAAKpG,MAAQiF,GAAU,KAAMpP,EAClD,CACJ,IAKA,IAHA,IAAIkR,EAAW,EACXC,EAAY,EACZC,EAA8Bd,EAC1Bc,EAAcjQ,KAAK8O,wBAAwBmB,IAE/CF,IACIE,EAAYzJ,UAAY2I,EAAK3I,SAC7BwJ,IAMR,OAHArB,EAAiB,UAAIoB,EACrBpB,EAAmB,YAAIqB,EAEhBrB,CACV,EAEDuB,sBAAuB,SAAUxI,GAC7B,MAAO,CACHyI,YAAazI,EACb0I,YAAa,EAEpB,EAEDC,4BAA6B,SAAUC,GACnC,IAAMC,EAAuB,GAc7B,OAbAnS,EAAM5C,aAAQ,EAARA,EAAUmJ,iBAAiB2L,EAA6B,eAAI,SAAUE,GACxE,IAAI3R,EAEA,CAAC,QAAS,UAAUvD,QAAQkV,EAAYhK,QAAQC,gBAAkB,EAClE5H,EAAQ2R,EAAmB,MACpBA,EAAyB,cAChC3R,EAAQ2R,EAAyB,aAGjC9K,GAAmB7G,IACnB0R,EAAWrP,KAAKrC,EAExB,IACO0R,EAAWrO,KAAK,KAC1B,EAGDuO,qBAAsB,SAAU7I,GAA0C,IAAA8I,EAAA1Q,KAChE2O,EAAoB,CAAA,EAW1B,OAVAvQ,EAAM4B,KAAK2Q,mBAAmB,SAACL,GAC3BlS,EAAMkS,EAAgC,iBAAG,SAACM,GAEtCxS,EADsB5C,aAAAA,EAAAA,EAAUmJ,iBAAiBiM,IAC5B,SAACC,GACdzR,EAAUwI,EAAmBiJ,IAAiBhL,GAAqBgL,KACnElC,EAAM2B,EAAqB,MAAKI,EAAKL,4BAA4BC,GAEzE,GACJ,GACJ,IACO3B,CACV,EAEDmC,gBAAiB,SAAU/R,GAEvB,OAAI1E,EAAa0E,EAAEsK,QACPtK,EAAEgS,YAA0B,KAEvBC,QAAbA,EAAKjS,EAAEsK,cAAH2H,IAASA,GAATA,EAA2BC,WACnBlS,EAAEmS,eAAe,IAAkB,KAEvCnS,EAAEsK,QAAsB,KAJ7B,IAAA2H,CAMV,EAEDG,cAAe,SACXpS,EACAwP,GAGc,IAQqE6C,EARrEC,EAAArR,KAFdsR,EAAShV,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,eACZiV,EAAuBjV,UAAAC,OAAAD,EAAAA,kBAAAvB,EAGnBsO,EAASrJ,KAAK8Q,gBAAgB/R,IAC9BmH,GAAWmD,KAEXA,EAAUA,EAAOzE,YAAc,MAGjB,iBAAd0M,GAA2C,UAAXvS,EAAEqE,MAAoBrE,aAAayS,cAChD,QAAnBJ,EAAIpR,KAAKyR,kBAAU,IAAAL,GAAfA,EAAiBM,YAAY3S,EAAE4S,QAAS5S,EAAE6S,SAAS,IAAIjS,MAAOkS,YAC9D7R,KAAKmR,cAAcpS,EAAGwP,EAAU,eAIxC,IAAMuD,EAAoBR,IAActD,GACxC,GACI3E,GACAvC,GACIuC,EACAtK,EACAiB,KAAK6O,OAGLiD,EAGAA,EAAoB,CAAC,OAAQ,YAAS/W,GAE5C,CAGE,IAHF,IAAAgX,EAAAC,EACQpK,EAAoB,CAACyB,GACvBxC,EAAQwC,EACLxC,EAAMjC,aAAe0B,GAAMO,EAAO,SACjCH,GAAmBG,EAAMjC,aACzBgD,EAAkB1G,KAAM2F,EAAMjC,WAAmBiD,MACjDhB,EAASA,EAAMjC,WAAmBiD,OAGtCD,EAAkB1G,KAAK2F,EAAMjC,YAC7BiC,EAAQA,EAAMjC,YAGlB,IAEIwC,EAFE6K,EAA6B,GAC7BC,EAA2C,CAAA,EAE7CC,GAAoB,EA2CxB,GA1CA/T,EAAMwJ,GAAmB,SAACzC,GACtB,IAAMiN,EAAkBvM,GAAqBV,GAIZ,MAA7BA,EAAGqB,QAAQC,gBACXW,EAAOjC,EAAGI,aAAa,QACvB6B,EAAOgL,GAAmB1M,GAAmB0B,IAASA,GAKtDhI,EADY8F,GAAcC,GACP,mBACnBgN,GAAoB,GAGxBF,EAAa/Q,KACTmQ,EAAK9B,0BACDpK,EACAoJ,EAASM,OAAOwD,4BAChB9D,EAASM,OAAOyD,gBAIxB,IAAMC,EAAoBlB,EAAKnC,iCAAiC/J,GAChElG,EAAQiT,EAA8BK,EAC1C,IAEKhE,EAASM,OAAOyD,gBAGoB,MAAjCjJ,EAAO7C,QAAQC,eAA0D,WAAjC4C,EAAO7C,QAAQC,cACvDwL,EAAa,GAAa,SAAI7I,GAA2BC,GAEzD4I,EAAa,GAAa,SAAItM,GAAY0D,IAI9CjC,IACA6K,EAAa,GAAe,WAAI7K,GAGhC+K,EACA,OAAO,EAGX,IAAMxD,EAAQ1P,EACVe,KAAKkQ,sBAAsBnR,EAAEqE,MAC7BmL,EAASiE,sBACH,CACIC,gBAAiB9I,GAAuBsI,IAE5C,CACIS,UAAWT,GAEN,QAAfF,EAAAE,EAAa,UAAbF,IAAeA,GAAfA,EAA4B,SAAI,CAAEY,SAAyB,QAAjBX,EAAEC,EAAa,UAAE,IAAAD,OAAA,EAAfA,EAA4B,UAAM,CAAE,EAChFhS,KAAKyQ,qBAAqB7I,GAC1BsK,EACAX,GAAc,CAAA,GAGlB,GAAID,IAActD,GAAwB,CAAA,IAAA4E,EAGhCC,EAAkBrN,GAAa1K,SAAsB,QAAhB8X,EAAN9X,EAAQgY,sBAAc,IAAAF,OAAhBA,EAANA,EAAwBhZ,YACvDmZ,EAAYhU,EAAqBqE,MAAQ,YAC/C,IAAKyP,EACD,OAAO,EAEXlE,EAAyB,kBAAIkE,EAC7BlE,EAAkB,WAAIoE,CAC1B,CAGA,OADAxE,EAASyE,QAAQ1B,EAAW3C,IACrB,CACX,CACH,EAIDsE,UAAW,SAAU7L,GACZtM,IAGLA,EAAOW,SAAS2L,KAAOA,EAC1B,EAED8L,qBAAsB,SAAU3E,GAAyB,IAAA4E,EAAAnT,KACrD,GAAKlF,GAAWU,EAAhB,CAGA,IAAM6H,EAAU,SAACtE,GACbA,EAAIA,IAAKjE,aAAM,EAANA,EAAQgI,OACjBqQ,EAAKhC,cAAcpS,EAAGwP,IAGpB6E,EAAoB,SAACrU,GACvBA,EAAIA,IAAKjE,aAAM,EAANA,EAAQgI,OACjBqQ,EAAKhC,cAAcpS,EAAGwP,EAAUP,KAGpCpL,GAAgBpH,EAAU,SAAU6H,GAAS,GAAO,GACpDT,GAAgBpH,EAAU,SAAU6H,GAAS,GAAO,GACpDT,GAAgBpH,EAAU,QAAS6H,GAAS,GAAO,GAE/CjJ,EAAUmU,EAASM,OAAOX,cAAgBK,EAASM,OAAOX,YAAYmF,sBACtEzQ,GAAgBpH,EAAU,OAAQ4X,GAAmB,GAAO,GAC5DxQ,GAAgBpH,EAAU,MAAO4X,GAAmB,GAAO,GAjB/D,CAmBH,EAEDzC,kBAAmB,GACnBc,WAAY,KACZ5C,YAAQ9T,EAERuY,KAAM,SAAU/E,GAAyB,IAAAgF,EAChC7Y,EAAW6T,EAASiF,iBACrBxT,KAAK6O,OAASN,EAASiF,eAIZD,QAAfA,EAAIvT,KAAK6O,cAAL0E,IAAWA,GAAXA,EAAarM,gBACblH,KAAK6O,OAAO3H,cAAgBlH,KAAK6O,OAAO3H,cAAc0C,KAAI,SAACzC,GAAG,OAAK,IAAIsM,OAAOtM,OAGlFnH,KAAKyR,WAAa,IAAIxF,GAAUsC,EAASM,OAAO6E,UACnD,EAEDC,oBAAqB,SAAUjI,EAA0B6C,GACrD,IAAMqF,EAAQrF,EAASM,OAAO+E,MAC1B5T,KAAKmO,mBAAmB7S,QAAQsY,IAAU,EAC1C7X,EAAOa,KAAK,8CAAgDgX,EAAQ,MAIpErF,EAASG,aACTH,EAASG,YAAYmF,SAAQC,EACxBhH,CAAAA,EAAAA,KAAqCpB,EAA8B,sBAI5E1L,KAAKoO,wBAA0B1C,EAA8B,oBAE7D1L,KAAKsO,yBAAyBC,GAE9BvO,KAAKmO,mBAAmBjN,KAAK0S,GAGzBlI,GACAA,EAAiB,QACjBA,EAAiB,OAA6B,2BAC9C1L,KAAKqO,uBAGD3C,EAA4B,oBAC5B1L,KAAK2Q,kBAAoBjF,EAA4B,mBAEzD1L,KAAKkT,qBAAqB3E,IAE1BA,EAAwB,eAAI,EAEnC,EAODwF,kBAAmB,SACfH,EACAI,EACAC,GAEA,IAAKL,EACD,OAAO,EAEXI,EAAc3Z,EAAa2Z,GAA2B,GAAbA,EACzCC,EAAqB5Z,EAAa4Z,GAAyC,GAApBA,EAEvD,IADA,IAAIC,EAAc,EACThW,EAAI,EAAGA,EAAI0V,EAAMrX,OAAQ2B,IAC9BgW,GAAeN,EAAM5R,WAAW9D,GAEpC,OAAOgW,EAAcF,EAAaC,CACrC,EAEDE,mBAAoB,WAChB,OAAOja,EAAYsB,aAAAA,EAAAA,EAAUmJ,iBACjC,IJpZkC,SAAU7K,GAC5C,IAAK,IAAMsa,KAAQta,EACXI,EAAYJ,EAAIsa,MAChBta,EAAIsa,GAAQta,EAAIsa,GAAMC,KAAKva,GAGvC,CIiZAwa,CAAuBpG,IJ/NmB,SAAUpU,GAChD,IAAK,IAAMsa,KAAQta,EACXI,EAAYJ,EAAIsa,MAChBta,EAAIsa,GAAQrU,GAAUjG,EAAIsa,IAGtC,CI0NAG,CAA2BrG,ICxZ3B,IAAMsG,GAAmC,wBACnCC,GAAqC,0BACrCC,GAAoC,yBAE7BC,GAA2B,SAACC,GACrC,IACuDvW,EADjDwW,EAAuD,CAAA,EAAEvW,EAAAC,EACpCe,GAASsV,GAAgB,CAAE,IAAC,IAAvD,IAAAtW,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAyD,CAAA,IAAAmW,EAAA/J,EAAA1M,EAAAQ,MAAA,GAA7CG,EAAG8V,EAAA,GAAEjW,EAAKiW,EAAA,GACdjW,IACAgW,EAAmB7V,GAAOH,EAElC,CAAC,CAAA,MAAAC,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACD,OAAO0a,CACX,EA2CaE,GAAmB,WAQ5B,SAAAA,EAAYxG,GAAmBpC,OAAA4I,GAC3B/U,KAAKuO,SAAWA,EAChBvO,KAAKgV,mBAAoB,EACzBhV,KAAKiV,yBAA2B,GAEhCjV,KAAKkV,0BAA2B,EAChClV,KAAKmV,4BAA6B,CACtC,CAsXC,OAtXA9I,EAAA0I,EAAA,CAAA,CAAA/V,IAAA,WAAAH,MAED,WACI,OAAOpF,OAAO+F,KAAKQ,KAAKoV,kBAC5B,GAAC,CAAApW,IAAA,kBAAAH,MAED,WACI,IAAMwW,EAAerV,KAAKuO,SAAS+G,aAAahI,IAC1CiI,EAAkBvV,KAAKuO,SAAS+G,aAAab,IACnD,IAAKc,EACD,OAAOF,GAAgB,CAAA,EAK3B,IAFA,IAAMG,EAAavW,EAAQ,CAAE,EAAEoW,GACzBI,EAAiBhc,OAAO+F,KAAK+V,GAC1BrX,EAAI,EAAGA,EAAIuX,EAAelZ,OAAQ2B,KACI,IAAvCqX,EAAgBE,EAAevX,WACxBsX,EAAWC,EAAevX,IAEjCsX,EAAWC,EAAevX,IAAMqX,EAAgBE,EAAevX,IAWvE,OARK8B,KAAKgV,oBACNjZ,EAAOgB,KAAK,6BAA8B,CACtCsY,aAAAA,EACAE,gBAAAA,EACAC,WAAAA,IAEJxV,KAAKgV,mBAAoB,GAEtBQ,CACX,GAAC,CAAAxW,IAAA,kBAAAH,MAED,WAEI,OADqBmB,KAAKuO,SAAS+G,aAAaZ,KACzB,CAAA,CAC3B,GAEA,CAAA1V,IAAA,qBAAAH,MASA,WACSmB,KAAKkV,2BACNlV,KAAKkV,0BAA2B,EAChClV,KAAK0V,oBAEb,GAAC,CAAA1W,IAAA,yBAAAH,MAED,SAAuB8W,GACnB3V,KAAK4V,kBAAoBD,CAC7B,GAAC,CAAA3W,IAAA,qBAAAH,MAED,SAAmBgX,GACf7V,KAAKmV,2BAA6BU,CACtC,GAAC,CAAA7W,IAAA,oBAAAH,MAED,WACImB,KAAKkV,0BAA2B,CACpC,GAAC,CAAAlW,IAAA,oBAAAH,MAED,WAA0B,IAAA6R,EAAA1Q,KAClBA,KAAKkV,2BAA6BlV,KAAKmV,4BACvCW,YAAW,YACFpF,EAAKyE,4BAA8BzE,EAAKwE,2BACzCxE,EAAKwE,0BAA2B,EAChCxE,EAAKqF,6BAEZ,GAAE,EAEX,GAAC,CAAA/W,IAAA,6BAAAH,MAED,WAAmC,IAAAwS,EAAArR,KAC/B,IAAIA,KAAKuO,SAASM,OAAOmH,+BAAzB,CAIAhW,KAAKiW,oBAAmB,GACxB,IAAMrC,EAAQ5T,KAAKuO,SAASM,OAAO+E,MAC7BsC,EAAmBlW,KAAKuO,SAAS+G,aAAa9H,IAC9C2I,EAAkBnW,KAAKuO,SAAS+G,aAAa7H,IAW7C2I,EAAehV,GAVHiV,KAAKC,UAAU,CAC7B1C,MAAOA,EACP2C,YAAavW,KAAKuO,SAASiI,kBAC3BC,OAAQzW,KAAKuO,SAASmI,YACtBd,kBAAmB5V,KAAK4V,kBACxBe,kBAAmBT,EACnBU,iBAAkBT,EAClBU,cAAe7W,KAAKuO,SAASM,OAAOmH,qCAAkCjb,KAI1EiF,KAAKuO,SAASuI,cACV9W,KAAKuO,SAASwI,cAAcC,YAAY,MAAO,gBAC/C,CAAE3V,KAAM+U,GACR,CAAEa,OAAQ,SACV,SAACvL,GAGG2F,EAAKuE,uBAAoB7a,EACzBsW,EAAK6F,qBAAqBxL,GAG1B2F,EAAK4E,oBAAmB,GACxB5E,EAAKqE,mBACT,GA9BJ,CAgCJ,GAEA,CAAA1W,IAAA,iBAAAH,MAUA,SAAeG,GAAmF,IAAtEmY,EAAiC7a,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EAC5D,GAAK0D,KAAKuO,SAAS6I,sBAA0BpX,KAAKqX,YAAcrX,KAAKqX,WAAW9a,OAAS,EAAzF,CAIA,IAKwF+a,EALlFC,EAAYvX,KAAKoV,kBAAkBpW,GACnCwY,EAAe,GAAA7a,OAAM4a,GACrBE,EAA6CzX,KAAKuO,SAAS+G,aAAa3H,KAAuB,GAErG,GAAIwJ,EAAQO,cAAgB,eAAgBP,GACxC,KAAMnY,KAAOyY,KAAsBA,EAAiBzY,GAAKmK,SAASqO,GAC1D3d,EAAS4d,EAAiBzY,IAC1ByY,EAAiBzY,GAAKkC,KAAKsW,GAE3BC,EAAiBzY,GAAO,CAACwY,WAE7BF,EAAItX,KAACuO,SAASG,mBAAW,IAAA4I,GAAzBA,EAA2BzD,SAAQC,EAAA,CAAA,EAAInG,GAAqB8J,IAE5DzX,KAAKuO,SAASyE,QAAQ,uBAAwB,CAAE2E,cAAe3Y,EAAK4Y,uBAAwBL,IAGpG,OAAOA,CAjBP,CAFIxb,EAAOgB,KAAK,2BAA6BiC,EAAM,gDAoBvD,GAAC,CAAAA,IAAA,wBAAAH,MAED,SAAsBG,GAElB,OADiBgB,KAAK6X,kBACN7Y,EACpB,GAEA,CAAAA,IAAA,mBAAAH,MAUA,SAAiBG,GAA0E,IAA7DmY,EAAiC7a,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EAC9D,GAAK0D,KAAKuO,SAAS6I,sBAA0BpX,KAAKqX,YAAcrX,KAAKqX,WAAW9a,OAAS,EAIzF,QAASyD,KAAK8X,eAAe9Y,EAAKmY,GAH9Bpb,EAAOgB,KAAK,6BAA+BiC,EAAM,gDAIzD,GAAC,CAAAA,IAAA,yBAAAH,MAED,SAAuBwE,GACnBrD,KAAKiV,yBAAyB/T,KAAKmC,EACvC,GAAC,CAAArE,IAAA,4BAAAH,MAED,SAA0BwE,GACtBrD,KAAKiV,yBAA2BjV,KAAKiV,yBAAyBxP,QAAO,SAACsS,GAAC,OAAKA,IAAM1U,IACtF,GAAC,CAAArE,IAAA,uBAAAH,MAED,SAAqB6M,GACjB,GAAK1L,KAAKuO,SAASG,YAAnB,CAGA1O,KAAKuO,SAAS6I,sBAAuB,EACrC,IAAMY,EAAehY,KAAKoV,kBACpB6C,EAAsBjY,KAAK6X,mBAjPK,SAC1CnM,EACAgD,GAGC,IAFDsJ,EAA8C1b,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EACjD2b,EAA6C3b,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EAE1C4b,EAAQxM,EAAuB,aAC/ByM,EAAezM,EAA8B,oBACnD,GAAIwM,EAEA,GAAIre,EAASqe,GAAQ,CAAA,IAAAE,EACXC,EAAkD,CAAA,EACxD,GAAIH,EACA,IAAK,IAAIha,EAAI,EAAGA,EAAIga,EAAM3b,OAAQ2B,IAC9Bma,EAAuBH,EAAMha,KAAM,EAG3CwQ,GACIA,EAAYmF,UAAQC,EAAAsE,EAAAtE,CAAAA,EACfU,GAAmC0D,GAAKpE,EAAAsE,EACxC9K,GAAwB+K,GAAsBD,GAE3D,KAAO,CAAA,IAAAE,EAECC,EAAkBL,EAClBM,EAAyBL,EACzBzM,EAAS+M,4BAETF,EAAehO,EAAAA,KAAQyN,GAAiBO,GACxCC,EAAsBjO,EAAAA,KAAQ0N,GAAwBO,IAE1D9J,GACIA,EAAYmF,UAAQC,EAAAwE,EAAA,CAAA,EACf9D,GAAmC/a,OAAO+F,KAAKmV,GAAyB4D,KAAiBzE,EAAAwE,EACzFhL,GAAwBiL,GAAmB,CAAE,GAAAzE,EAAAwE,EAC7C5D,GAAoC8D,GAA0B,IAAEF,GAE7E,CAER,CA2MQI,CAA+BhN,EAAU1L,KAAKuO,SAASG,YAAasJ,EAAcC,GAClFjY,KAAK2Y,4BALL,CAMJ,GAEA,CAAA3Z,IAAA,WAAAH,MAWA,SAASqZ,GACL,IAAKlY,KAAKuO,SAASqK,WAAa5Y,KAAKuO,SAASG,YAC1C,OAAO3S,EAAO0B,qBAAqB,kCAKvC,GAFAuC,KAAKgV,mBAAoB,GAEX,IAAVkD,EACAlY,KAAKuO,SAASG,YAAYmK,WAAWpE,SAClC,GAAI5a,EAASqe,GAAQ,CAExB,IADA,IAAMY,EAA6C,CAAA,EAC1C5a,EAAI,EAAGA,EAAIga,EAAM3b,OAAQ2B,IAC9B4a,EAASZ,EAAMha,KAAM,EAEzB8B,KAAKuO,SAASG,YAAYmF,SAAQC,EAAIW,GAAAA,GAAqCqE,GAC/E,MACI9Y,KAAKuO,SAASG,YAAYmF,SAAQC,EAAIW,GAAAA,GAAqCyD,GAEnF,GACA,CAAAlZ,IAAA,iBAAAH,MAYA,SAAeqF,GAA4C,IAAAiP,EAAAnT,KAEvD,GADAA,KAAK+Y,uBAAuB7U,GACxBlE,KAAKuO,SAAS6I,qBAAsB,CACpC,IAAA4B,EAAgChZ,KAAKiZ,mCAA7Bf,EAAKc,EAALd,MAAOgB,EAAYF,EAAZE,aACfhV,EAASgU,EAAOgB,EACpB,CACA,OAAO,WAAA,OAAM/F,EAAKgG,0BAA0BjV,EAAS,CACzD,GAAC,CAAAlF,IAAA,qCAAAH,MAED,SAAmCG,EAAaoa,GAA2B,IAAAC,EAAAC,EACjEC,EAAoBzF,EAAA,GAAA,uBAAAnX,OACEqC,GAAQoa,GAEpCpZ,KAAKuO,SAASyE,QAAQ,6BAA8B,CAChD2E,cAAe3Y,EACfwa,oBAAqBJ,EACrBK,KAAMF,IAEVvZ,KAAK0Z,4BAA4BH,GAAsB,GAEvD,IAAMI,EAAQpP,EAAAA,KAAQvK,KAAKoV,mBAAiBtB,CAAAA,EAAAA,KAAG9U,EAAMoa,YACrDC,EAAIrZ,KAACuO,SAASG,mBAAW,IAAA2K,GAAzBA,EAA2BxF,UAAQC,EAAAwF,KAC9B9E,GAAmC/a,OAAO+F,KAAKmV,GAAyBgF,KAAU7F,EAAAwF,EAClFhM,GAAwBqM,GAAQL,IAErCtZ,KAAK2Y,4BACT,GAAC,CAAA3Z,IAAA,yBAAAH,MAED,SAAuBqF,GAAkE,IAAA0V,EAAA5Z,KAA5B6Z,EAAYvd,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GAC/Dwd,EAAiC9Z,KAAKuO,SAAS+G,aAAa/H,IAElE,GAAKuM,IAAkCD,EAenC,OAAO3V,EAAS4V,GAdhB9Z,KAAKuO,SAASuI,cACV9W,KAAKuO,SAASwI,cAAcC,YACxB,MAAKra,qCAAAA,OACgCqD,KAAKuO,SAASM,OAAO+E,QAE9D,GACA,CAAEqD,OAAQ,QACV,SAACvL,GAAa,IAAAqO,EACJC,EAAuBtO,EAAwCsO,oBAErE,eADAD,EAAAH,EAAKrL,SAASG,mBAAW,IAAAqL,GAAzBA,EAA2BlG,SAAQC,EAAA,CAAA,EAAIvG,GAAoCyM,IACpE9V,EAAS8V,EACpB,GAKZ,GAAC,CAAAhb,IAAA,mCAAAH,MAED,WACI,IAAMqZ,EAAQlY,KAAKqX,WACb6B,EAAelZ,KAAKoV,kBAW1B,MAAO,CACH8C,MATgBA,EAAMzS,QAAO,SAACwU,GAAI,OAAKf,EAAae,MAUpDf,aATuBzf,OAAO+F,KAAK0Z,GAClCzT,QAAO,SAACyU,GAAU,OAAKhB,EAAagB,EAAW,IAC/CC,QAAO,SAACC,EAAuCpb,GAE5C,OADAob,EAAIpb,GAAOka,EAAala,GACjBob,CACV,GAAE,CAAE,GAMb,GAAC,CAAApb,IAAA,6BAAAH,MAED,WACI,IAAAwb,EAAgCra,KAAKiZ,mCAA7Bf,EAAKmC,EAALnC,MAAOgB,EAAYmB,EAAZnB,aACflZ,KAAKiV,yBAAyB7Z,SAAQ,SAACiI,GAAO,OAAKA,EAAQ6U,EAAOgB,KACtE,GAEA,CAAAla,IAAA,8BAAAH,MAKA,SAA4Byb,GAAyD,IAAjCC,IAAkBje,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,KAAAA,UAAA,GAE5Dke,EAAqBxa,KAAKuO,SAAS+G,aAAa9H,KAAiC,GAEvFxN,KAAKuO,SAASsF,SAAQC,EACjBtG,CAAAA,EAAAA,GAA4BjD,EAAAA,EAAA,CAAA,EACtBiQ,GACAF,KAIPC,GACAva,KAAKuO,SAASgM,oBAEtB,GAAC,CAAAvb,IAAA,gCAAAH,MAED,WACImB,KAAKuO,SAASsK,WAAWrL,GAC7B,GAEA,CAAAxO,IAAA,6BAAAH,MAQA,SAA2Byb,GAA6E,IAAjCC,IAAkBje,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,KAAAA,UAAA,GAE/Eke,EAAqBxa,KAAKuO,SAAS+G,aAAa7H,KAAgC,GAEvC,IAA3ChU,OAAO+F,KAAKgb,GAAoBje,QAChC9C,OAAO+F,KAAKgb,GAAoBpf,SAAQ,SAACqf,GACrCD,EAAmBC,GAAUlQ,EAAAA,EAAA,CAAA,EACtBiQ,EAAmBC,IACnBH,EAAWG,WAEXH,EAAWG,EACtB,IAGJza,KAAKuO,SAASsF,SAAQC,EACjBrG,CAAAA,EAAAA,GAA2BlD,EAAAA,EAAA,CAAA,EACrBiQ,GACAF,KAIPC,GACAva,KAAKuO,SAASgM,oBAEtB,GAAC,CAAAvb,IAAA,+BAAAH,MAED,SAA6B6b,GACzB,GAAIA,EAAY,CACZ,IAAMF,EAAqBxa,KAAKuO,SAAS+G,aAAa7H,KAAgC,GACtFzN,KAAKuO,SAASsF,SAAQC,EAAA,CAAA,EACjBrG,GAA2BlD,EAAAA,EAAQiQ,CAAAA,EAAAA,MAAkB1G,EAAA,CAAA,EAAG4G,EAAa,CAAE,KAEhF,MACI1a,KAAKuO,SAASsK,WAAWpL,GAEjC,KAACsH,CAAA,CArY2B,GC/D3BtI,KAAKkO,QACNlO,KAAKkO,MAAQ,SAAUva,GACnB,OAAOA,EAAI,EAAIqM,KAAKmO,KAAKxa,GAAKqM,KAAKoO,MAAMza,KAK5C0a,OAAOC,YACRD,OAAOC,UAAY,SAAUlc,GACzB,OAAOpE,EAAUoE,IAAUmc,SAASnc,IAAU4N,KAAKoO,MAAMhc,KAAWA,IAI5E,IAAMoc,GAAS,mBAGFC,GAAI,WAEb,SAAAA,EAAqBC,GACjB,GAD8ChP,OAAA+O,GAAAlb,KAA7Bmb,MAAAA,EACI,KAAjBA,EAAM5e,OACN,MAAM,IAAI6e,UAAU,qBAE5B,CA8CC,OA5CD/O,EAAA6O,EAAA,CAAA,CAAAlc,IAAA,WAAAH,MA+CA,WAEI,IADA,IAAIyK,EAAO,GACFpL,EAAI,EAAGA,EAAI8B,KAAKmb,MAAM5e,OAAQ2B,IACnCoL,EAAOA,EAAO2R,GAAOhZ,OAAOjC,KAAKmb,MAAMjd,KAAO,GAAK+c,GAAOhZ,OAAuB,GAAhBjC,KAAKmb,MAAMjd,IAClE,IAANA,GAAiB,IAANA,GAAiB,IAANA,GAAiB,IAANA,IACjCoL,GAAQ,KAIhB,GAAoB,KAAhBA,EAAK/M,OAGL,MAAM,IAAI8e,MAAM,gCAEpB,OAAO/R,CACX,GAEA,CAAAtK,IAAA,QAAAH,MACA,WACI,OAAO,IAAIqc,EAAKlb,KAAKmb,MAAMza,MAAM,GACrC,GAEA,CAAA1B,IAAA,SAAAH,MACA,SAAOyc,GACH,OAAiC,IAA1Btb,KAAKub,UAAUD,EAC1B,GAEA,CAAAtc,IAAA,YAAAH,MAIA,SAAUyc,GACN,IAAK,IAAIpd,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,IAAMsd,EAAOxb,KAAKmb,MAAMjd,GAAKod,EAAMH,MAAMjd,GACzC,GAAa,IAATsd,EACA,OAAO/O,KAAKgP,KAAKD,EAEzB,CACA,OAAO,CACX,IAAC,CAAA,CAAAxc,IAAA,eAAAH,MA9ED,SAAoB6c,EAAkBC,EAAeC,EAAiBC,GAClE,IACKf,OAAOC,UAAUW,KACjBZ,OAAOC,UAAUY,KACjBb,OAAOC,UAAUa,KACjBd,OAAOC,UAAUc,IAClBH,EAAW,GACXC,EAAQ,GACRC,EAAU,GACVC,EAAU,GACVH,EAAW,gBACXC,EAAQ,MACRC,EAAU,YACVC,EAAU,WAEV,MAAM,IAAIC,WAAW,uBAGzB,IAAMX,EAAQ,IAAIY,WAAW,IAiB7B,OAhBAZ,EAAM,GAAKO,EAAQjP,KAAAuP,IAAG,EAAK,IAC3Bb,EAAM,GAAKO,EAAQjP,KAAAuP,IAAG,EAAK,IAC3Bb,EAAM,GAAKO,EAAQjP,KAAAuP,IAAG,EAAK,IAC3Bb,EAAM,GAAKO,EAAQjP,KAAAuP,IAAG,EAAK,IAC3Bb,EAAM,GAAKO,EAAQjP,KAAAuP,IAAG,EAAK,GAC3Bb,EAAM,GAAKO,EACXP,EAAM,GAAK,IAAQQ,IAAU,EAC7BR,EAAM,GAAKQ,EACXR,EAAM,GAAK,IAAQS,IAAY,GAC/BT,EAAM,GAAKS,IAAY,GACvBT,EAAM,IAAMS,IAAY,EACxBT,EAAM,IAAMS,EACZT,EAAM,IAAMU,IAAY,GACxBV,EAAM,IAAMU,IAAY,GACxBV,EAAM,IAAMU,IAAY,EACxBV,EAAM,IAAMU,EACL,IAAIX,EAAKC,EACpB,KAACD,CAAA,CApDY,GAkGXe,GAAW,WAAA,SAAAA,IAAA9P,OAAA8P,GAAAnI,mBACO,GAACA,iBACH,GAACA,EACO9T,KAAA,SAAA,IAAIkc,GAAe,CAoE5C,OApE4C7P,EAAA4P,EAAA,CAAA,CAAAjd,IAAA,WAAAH,MAY7C,WACI,IAAMA,EAAQmB,KAAKmc,kBACnB,GAAK9hB,EAAawE,GAEX,CAEHmB,KAAKuM,UAAY,EACjB,IAAM6P,EAAkBpc,KAAKmc,kBAC7B,GAAI9hB,EAAa+hB,GACb,MAAM,IAAIf,MAAM,iDAEpB,OAAOe,CACX,CATI,OAAOvd,CAUf,GAEA,CAAAG,IAAA,kBAAAH,MASA,WACI,IAGMwd,EAAK1c,KAAKC,MAChB,GAAIyc,EAAKrc,KAAKuM,UACVvM,KAAKuM,UAAY8P,EACjBrc,KAAKsc,mBACF,MAAID,EANgB,IAMUrc,KAAKuM,WAUtC,OARAvM,KAAKuc,UACDvc,KAAKuc,QAVO,gBAYZvc,KAAKuM,YACLvM,KAAKsc,eAKb,CAEA,OAAOpB,GAAKsB,aACRxc,KAAKuM,UACLE,KAAKkO,MAAM3a,KAAKuc,QAAO9P,KAAAuP,IAAG,EAAK,KAC/Bhc,KAAKuc,QAAW9P,KAAAuP,IAAC,EAAI,IAAK,EAC1Bhc,KAAKyc,OAAOC,aAEpB,GAEA,CAAA1d,IAAA,eAAAH,MACA,WACImB,KAAKuc,QAAqC,KAA3Bvc,KAAKyc,OAAOC,cAAmD,KAA3B1c,KAAKyc,OAAOC,aACnE,KAACT,CAAA,CAvEY,GA8EbU,GAAwE,SAACC,GAGzE,GAAoC,oBAAzBC,sBAAwCA,qBAC/C,MAAM,IAAIxB,MAAM,6CAGpB,IAAK,IAAInd,EAAI,EAAGA,EAAI0e,EAAOrgB,OAAQ2B,IAC/B0e,EAAO1e,GAA4C,MAAvCuO,KAAKkO,MAAsB,MAAhBlO,KAAKgQ,UAAkChQ,KAAKkO,MAAsB,MAAhBlO,KAAKgQ,UAElF,OAAOG,CACX,EAGI9hB,IAAWT,EAAaS,EAAOgiB,SAAWA,OAAOH,kBACjDA,GAAkB,SAACC,GAAM,OAAKE,OAAOH,gBAAgBC,EAAO,GAGhE,IAiBIG,GAZEb,GAAa,WAAA,SAAAA,IAAA/P,OAAA+P,GAAApI,EACW9T,KAAA,SAAA,IAAIgd,YAAY,IAAElJ,gBAC3BmJ,IAAQ,CAOxB,OAPwB5Q,EAAA6P,EAAA,CAAA,CAAAld,IAAA,aAAAH,MACzB,WAKI,OAJImB,KAAKkd,QAAUld,KAAK4c,OAAOrgB,SAC3BogB,GAAgB3c,KAAK4c,QACrB5c,KAAKkd,OAAS,GAEXld,KAAK4c,OAAO5c,KAAKkd,SAC5B,KAAChB,CAAA,CATc,GAoBNiB,GAAS,WAAH,OAAiBC,KAAYxjB,UAAU,EAGpDwjB,GAAY,WAAH,OAAgBL,KAAqBA,GAAmB,IAAId,KAAgBoB,UAAU,ECpP/FC,GAAQ,gCAEVC,GAA0B,GAoD9B,IAAMC,GAAqB,kCAMpB,SAASC,GAAmBC,EAAkBC,GACjD,GAAIA,EAAiB,CAEjB,IAAIC,EAzCL,SAAqCF,GAAgD,IAA9BG,EAASvhB,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAGd,EACtE,GAAI+hB,GACA,OAAOA,GAGX,IAAKM,EACD,MAAO,GAEX,GAAI,CAAC,YAAa,aAAa1U,SAASuU,GAAW,MAAO,GAO1D,IALA,IAAMI,EAAOJ,EAASzY,MAAM,KACxB8Y,EAAMtR,KAAKuR,IAAIF,EAAKvhB,OAAQ,GAC1ByC,EAAM,WAAame,KACnBc,EAAI,IAAIxK,OAAO,YAAczU,EAAM,OAEjCue,IAA2BQ,KAAO,CACtC,IAAMG,EAAYJ,EAAKpd,MAAMqd,GAAK7b,KAAK,KACjCic,EAAuBnf,EAAM,cAAgBkf,EAGnDL,EAAUO,OAASD,EAEfF,EAAE/U,KAAK2U,EAAUO,UAEjBP,EAAUO,OAASD,EAAuB,YAAcb,GACxDC,GAA0BW,EAElC,CAEA,OAAOX,EACX,CAW+Bc,CAA4BX,GAEnD,IAAKE,EAAkB,CACnB,IAAMU,EAXa,SAACZ,GAC5B,IAAM9U,EAAU8U,EAASlW,MAAMgW,IAC/B,OAAO5U,EAAUA,EAAQ,GAAK,EAClC,CAQkC2V,CAAuBb,GACzCY,IAAkBV,GAClB7hB,EAAOa,KAAK,+CAAgD0hB,EAAeV,GAE/EA,EAAmBU,CACvB,CAEA,OAAOV,EAAmB,aAAeA,EAAmB,EAChE,CACA,MAAO,EACX,CAGO,OAAMY,GAA+B,CACxCC,aAAc,WAAA,QAAQjjB,CAAQ,EAE9B0B,MAAO,SAAUwhB,GACb3iB,EAAOmB,MAAM,sBAAwBwhB,EACxC,EAEDC,IAAK,SAAU3V,GACX,GAAKxN,EAAL,CAIA,IAGI,IAFA,IAAMojB,EAAS5V,EAAO,IAChB6V,EAAKrjB,EAAS4iB,OAAOnZ,MAAM,KAAKQ,QAAO,SAACxL,GAAC,OAAKA,EAAEsC,UAC7C2B,EAAI,EAAGA,EAAI2gB,EAAGtiB,OAAQ2B,IAAK,CAEhC,IADA,IAAIyR,EAAIkP,EAAG3gB,GACW,KAAfyR,EAAE1N,OAAO,IACZ0N,EAAIA,EAAEhN,UAAU,EAAGgN,EAAEpT,QAEzB,GAA0B,IAAtBoT,EAAErU,QAAQsjB,GACV,OAAOE,mBAAmBnP,EAAEhN,UAAUic,EAAOriB,OAAQoT,EAAEpT,QAE/D,CACJ,CAAE,MAAOuC,GAAM,CACf,OAAO,IAfP,CAgBH,EAEDigB,MAAO,SAAU/V,GACb,IAAIoV,EACJ,IACIA,EAAS/H,KAAK0I,MAAMP,GAAYG,IAAI3V,KAAU,EACjD,CAAC,MAAOlK,GACL,CAEJ,OAAOsf,CACV,EAEDY,IAAK,SAAUhW,EAAMnK,EAAOogB,EAAMtB,EAAiBuB,GAC/C,GAAK1jB,EAGL,IACI,IAAI2jB,EAAU,GACVC,EAAS,GAEPC,EAAU5B,GAAmBjiB,EAASC,SAASiiB,SAAUC,GAE/D,GAAIsB,EAAM,CACN,IAAMK,EAAO,IAAI3f,KACjB2f,EAAKC,QAAQD,EAAKzN,UAAmB,GAAPoN,EAAY,GAAK,GAAK,KACpDE,EAAU,aAAeG,EAAKE,aAClC,CAEIN,IACAE,EAAS,YAGb,IAAMK,EACFzW,EACA,IACA0W,mBAAmBrJ,KAAKC,UAAUzX,IAClCsgB,EACA,yBACAE,EACAD,EAQJ,OALIK,EAAeljB,OAAS,QACxBR,EAAOgB,KAAK,0CAA4C0iB,EAAeljB,QAG3Ef,EAAS4iB,OAASqB,EACXA,CACV,CAAC,MAAO3gB,GACL,MACJ,CACH,EAED6gB,OAAQ,SAAU3W,EAAM2U,GACpB,IACIa,GAAYQ,IAAIhW,EAAM,IAAK,EAAG2U,EACjC,CAAC,MAAO7e,GACL,MACJ,CACJ,GAGA8gB,GAA0C,KAEjCC,GAA8B,CACvCpB,aAAc,WACV,IAAKlkB,EAAQqlB,IACT,OAAOA,GAGX,IAAIE,GAAY,EAChB,GAAKzlB,EAAaS,GAadglB,GAAY,OAZZ,IACI,IAAM9gB,EAAM,kBAEZ6gB,GAAWb,IAAIhgB,EADL,OAEkB,UAAxB6gB,GAAWlB,IAAI3f,KACf8gB,GAAY,GAEhBD,GAAWF,OAAO3gB,EACrB,CAAC,MAAOF,GACLghB,GAAY,CAChB,CASJ,OALKA,GACD/jB,EAAOmB,MAAM,0DAGjB0iB,GAA0BE,EACnBA,CACV,EAED5iB,MAAO,SAAUwhB,GACb3iB,EAAOmB,MAAM,uBAAyBwhB,EACzC,EAEDC,IAAK,SAAU3V,GACX,IACI,OAAOlO,aAAAA,EAAAA,EAAQilB,aAAaC,QAAQhX,EACvC,CAAC,MAAOlK,GACL+gB,GAAW3iB,MAAM4B,EACrB,CACA,OAAO,IACV,EAEDigB,MAAO,SAAU/V,GACb,IACI,OAAOqN,KAAK0I,MAAMc,GAAWlB,IAAI3V,KAAU,EAC9C,CAAC,MAAOlK,GACL,CAEJ,OAAO,IACV,EAEDkgB,IAAK,SAAUhW,EAAMnK,GACjB,IACI/D,SAAAA,EAAQilB,aAAaE,QAAQjX,EAAMqN,KAAKC,UAAUzX,GACrD,CAAC,MAAOC,GACL+gB,GAAW3iB,MAAM4B,EACrB,CACH,EAED6gB,OAAQ,SAAU3W,GACd,IACIlO,SAAAA,EAAQilB,aAAaG,WAAWlX,EACnC,CAAC,MAAOlK,GACL+gB,GAAW3iB,MAAM4B,EACrB,CACJ,GAMEqhB,GAA8B,CJlPT,cIkPuB/S,GAAYC,IAEjD+S,GAAqC7V,EAAAA,KAC3CsV,IAAU,CAAA,EAAA,CACbd,MAAO,SAAU/V,GACb,IACI,IAAIqX,EAAqB,CAAA,EACzB,IAEIA,EAAS7B,GAAYO,MAAM/V,IAAS,CAAA,CACxC,CAAE,MAAOlK,GAAM,CACf,IAAMD,EAAQI,EAAQohB,EAAQhK,KAAK0I,MAAMc,GAAWlB,IAAI3V,IAAS,OAEjE,OADA6W,GAAWb,IAAIhW,EAAMnK,GACdA,CACV,CAAC,MAAOC,GACL,CAEJ,OAAO,IACV,EAEDkgB,IAAK,SAAUhW,EAAMnK,EAAOogB,EAAMtB,EAAiBuB,GAC/C,IACIW,GAAWb,IAAIhW,EAAMnK,GACrB,IAAMyhB,EAAiD,CAAA,EACvDH,GAA4B/kB,SAAQ,SAAC4D,GAC7BH,EAAMG,KACNshB,EAA0BthB,GAAOH,EAAMG,GAE/C,IAEIvF,OAAO+F,KAAK8gB,GAA2B/jB,QACvCiiB,GAAYQ,IAAIhW,EAAMsX,EAA2BrB,EAAMtB,EAAiBuB,EAE/E,CAAC,MAAOpgB,GACL+gB,GAAW3iB,MAAM4B,EACrB,CACH,EAED6gB,OAAQ,SAAU3W,EAAM2U,GACpB,IACI7iB,SAAAA,EAAQilB,aAAaG,WAAWlX,GAChCwV,GAAYmB,OAAO3W,EAAM2U,EAC5B,CAAC,MAAO7e,GACL+gB,GAAW3iB,MAAM4B,EACrB,CACJ,IAGEyhB,GAA4B,CAAA,EAGrBC,GAA+B,CACxC/B,aAAc,WACV,OAAO,CACV,EAEDvhB,MAAO,SAAUwhB,GACb3iB,EAAOmB,MAAM,wBAA0BwhB,EAC1C,EAEDC,IAAK,SAAU3V,GACX,OAAOuX,GAAcvX,IAAS,IACjC,EAED+V,MAAO,SAAU/V,GACb,OAAOuX,GAAcvX,IAAS,IACjC,EAEDgW,IAAK,SAAUhW,EAAMnK,GACjB0hB,GAAcvX,GAAQnK,CACzB,EAED8gB,OAAQ,SAAU3W,UACPuX,GAAcvX,EACzB,GAGAyX,GAA0C,KAKjCC,GAAgC,CACzCjC,aAAc,WACV,IAAKlkB,EAAQkmB,IACT,OAAOA,GAGX,GADAA,IAA0B,EACrBpmB,EAAaS,GAad2lB,IAA0B,OAZ1B,IACI,IAAMzhB,EAAM,cAEZ0hB,GAAa1B,IAAIhgB,EADP,OAEoB,UAA1B0hB,GAAa/B,IAAI3f,KACjByhB,IAA0B,GAE9BC,GAAaf,OAAO3gB,EACvB,CAAC,MAAOF,GACL2hB,IAA0B,CAC9B,CAIJ,OAAOA,EACV,EAEDvjB,MAAO,SAAUwhB,GACb3iB,EAAOmB,MAAM,yBAA0BwhB,EAC1C,EAEDC,IAAK,SAAU3V,GACX,IACI,OAAOlO,aAAAA,EAAAA,EAAQ6lB,eAAeX,QAAQhX,EACzC,CAAC,MAAOlK,GACL4hB,GAAaxjB,MAAM4B,EACvB,CACA,OAAO,IACV,EAEDigB,MAAO,SAAU/V,GACb,IACI,OAAOqN,KAAK0I,MAAM2B,GAAa/B,IAAI3V,KAAU,IAChD,CAAC,MAAOlK,GACL,CAEJ,OAAO,IACV,EAEDkgB,IAAK,SAAUhW,EAAMnK,GACjB,IACI/D,SAAAA,EAAQ6lB,eAAeV,QAAQjX,EAAMqN,KAAKC,UAAUzX,GACvD,CAAC,MAAOC,GACL4hB,GAAaxjB,MAAM4B,EACvB,CACH,EAED6gB,OAAQ,SAAU3W,GACd,IACIlO,SAAAA,EAAQ6lB,eAAeT,WAAWlX,EACrC,CAAC,MAAOlK,GACL4hB,GAAaxjB,MAAM4B,EACvB,CACJ,GClYE8hB,GAAe,CAAC,YAAa,aAItBC,MAFkBllB,KAAkB,oBAAqB,IAAIA,OAExBD,EAQrColB,GAAe,SAAC3Z,GACzB,IAAM1L,EAAWD,aAAAA,EAAAA,EAAU6I,cAAc,KACzC,OAAIhK,EAAaoB,GACN,MAGXA,EAAS2L,KAAOD,EACT1L,EACX,EAEaslB,GAAsB,SAAU5Z,EAAa6Z,GACtD,QRmGyB,SAAUnjB,GACnC,IACI,IAAI4V,OAAO5V,EACd,CAAC,MAAOX,GACL,OAAO,CACX,CACA,OAAO,CACX,CQ1GS+jB,CAAcD,IACZ,IAAIvN,OAAOuN,GAAS9X,KAAK/B,EACpC,EAEa+Z,GAAmB,SAAUC,GAAuE,IACzGC,EACAC,EAF4EC,EAAahlB,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,IAG1FilB,EAAoB,GAa1B,OAXAnjB,EAAM+iB,GAAU,SAAUhgB,EAAgCnC,GAElD3E,EAAa8G,IAAQ9G,EAAa2E,IAAgB,cAARA,IAI9CoiB,EAAU1B,mBX0CK,SAACzlB,GAEpB,OAAOA,aAAaunB,IACxB,CW7CqCC,CAAQtgB,GAAOA,EAAI6H,KAAO7H,EAAIvH,YAC3DynB,EAAU3B,mBAAmB1gB,GAC7BuiB,EAAQA,EAAQhlB,QAAU8kB,EAAU,IAAMD,EAC9C,IAEOG,EAAQrf,KAAKof,EACxB,EAEaI,GAAiB,SAAUva,EAAawa,GAOjD,IANA,IAIIC,EADEC,IAHsB1a,EAAIlC,MAAM,KAAK,IAAM,IACTA,MAAM,KAAK,IAAM,IAE1BA,MAAM,KAG5B/G,EAAI,EAAGA,EAAI2jB,EAAWtlB,OAAQ2B,IAAK,CACxC,IAAM4jB,EAAQD,EAAW3jB,GAAG+G,MAAM,KAClC,GAAI6c,EAAM,KAAOH,EAAO,CACpBC,EAAeE,EACf,KACJ,CACJ,CAEA,IAAKjoB,EAAS+nB,IAAiBA,EAAarlB,OAAS,EACjD,MAAO,GAEP,IAAIyE,EAAS4gB,EAAa,GAC1B,IACI5gB,EAAS8d,mBAAmB9d,EAC/B,CAAC,MAAOlC,GACL/C,EAAOmB,MAAM,gDAAkD8D,EACnE,CACA,OAAOA,EAAOlD,QAAQ,MAAO,IAErC,EAEaikB,GAAgB,SAAUC,EAAcL,GACjD,IAAM/Y,EAAUoZ,EAAKxa,MAAM,IAAIiM,OAAOkO,EAAQ,aAC9C,OAAO/Y,EAAUA,EAAQ,GAAK,IAClC,ECrEMqZ,GAAS,SACTC,GAAM,MACNC,GAAU,UACVC,GAAS,SACTC,GAAiBF,GAAU,IAAMC,GACjCE,GAAO,OACPC,GAAQ,QACRC,GAAcD,GAAQ,SACtBE,GAAS,SACTC,GAAa,aACbC,GAAU,UACVC,GAAkBD,GAAU,UAC5BE,GAAmBF,GAAU,YAC7BG,GAAS,SACTC,GAAYD,GAAS,MACrBE,GAAaF,GAAS,IAAMZ,GAC5Be,GAAoB,oBACpBC,GAA2BD,GAAoB,IAAMhB,GACrDkB,GAAQ,QACRC,GAAaD,GAAQ,QACrBE,GAAO,OACPC,GAAiB,aAAeD,GAChCE,GAAU,UACVC,GAAcD,GAAU,IAAMrB,GAC9BuB,GAAW,WACXC,GAAc,cACdC,GAAO,OACPC,GAAiBzB,GAAU,IAAMF,GACjC4B,GAAgB5B,GAAS,IAAMQ,GAC/BqB,GAAU,UACVC,GAAgBD,GAAU,SAC1BE,GAAQ,QACRC,GAAO,OACPC,GAAU,UACVC,GAAiBD,GAAU,IAAMjC,GAAOxb,cACxC2d,GAAiBF,GAAU,IAAM9B,GAAO3b,cACxC4d,GAAY,YAEZC,GAA+B,mBAC/BC,GAAgC,IAAI9Q,OAAO,WAAa6Q,IAExDE,GAAa,IAAI/Q,OAAOkQ,GAAM,KAC9Bc,GAAoB,IAAIhR,OAAOiQ,GAAc,QAAS,KACtDgB,GAAiB,IAAIjR,OAAOgQ,GAAW,QAAS,KAChDkB,GAAmB,IAAIlR,OAAOiP,GAAa,iBAAkB,KAE7DkC,GAA4C,CAC9C,SAAU,UACV,QAAS,SACT,MAAO,OACP,IAAO,KACP,IAAO,KACP,MAAO,QACP,IAAO,IACP,IAAO,IACP,IAAO,MACP,IAAO,KACP,OAAQ,MAYZ,IAAMC,GAAc,SAACC,EAAYC,GAAe,OAAMA,GAAU3lB,EAAU2lB,EAAQxC,KAJlF,SAAkB3mB,GACd,OAAOwD,EAAUxD,EAAW6mB,MAAYrjB,EAAUxD,EAAWknB,MAAY1jB,EAAUxD,EAAWumB,GAClG,CAE6F6C,CAASF,EAAG,EAO5FG,GAAgB,SAAUC,EAAoBH,EAA4BI,GACnF,OAAIA,EACOhC,IAEX4B,EAASA,GAAU,GAEf3lB,EAAU8lB,EAAY,UAAY9lB,EAAU8lB,EAAY,QACjD9B,GACAhkB,EAAU8lB,EAAY,SACtB/B,GACAwB,GAAiBzb,KAAKgc,GACtBxC,GACAtjB,EAAU8lB,EAAY,KAAOjD,KAAW7iB,EAAU8lB,EAAY,aAC9DhC,GAGF9jB,EAAU8lB,EAAYtC,IACpBC,GACAzjB,EAAU8lB,EAAY7B,KAASjkB,EAAU8lB,EAAY,QACrD5B,GACAlkB,EAAU8lB,EAAY,SACtBE,YAAiBnD,GACjB7iB,EAAU8lB,EAAYpC,IACtBA,GACA1jB,EAAU8lB,EAAY,SACtBlC,GACA5jB,EAAU8lB,EAAY,UAAY9lB,EAAU8lB,EAAY,aACxD,aACA9lB,EAAU8lB,EAAY,SACtB1B,GACApkB,EAAU8lB,EAAY/C,IACtByB,GACAxkB,EAAU8lB,EAAWze,cAAe4d,GAAU5d,eAC9C4d,GACAQ,GAAYK,EAAYH,GACxB3lB,EAAU8lB,EAAYjD,IAAU4B,GAAgBpB,GAChDrjB,EAAU8lB,EAAY3B,IACtBA,GACAnkB,EAAU8lB,EAAY,SAAW9lB,EAAU8lB,EAAY,YACvDjC,GACA7jB,EAAU8lB,EAAY,SACtB3B,GAGJ,GACX,EAEM8B,IAAwCvR,EAAAwR,GAAA,GACzCpC,GAA2B,CAAC,IAAIzP,OAAO,MAAQ6Q,MAA8BxQ,EAAAwR,GAC7EhC,GAAiB,CAAC,IAAI7P,OAAO4P,GAAO,OAASiB,MAA8BxQ,EAAAwR,GAC3ExC,GAAS,CAAC,IAAIrP,OAAOqP,GAAS,IAAMwB,MAA8BxQ,EAAAwR,GAClEtC,GAAa,CAAC,IAAIvP,OAAO,WAAa6Q,MAA8BxQ,EAAAwR,GACrE,aAAc,CAAC,IAAI7R,OAAO,uBAAyB6Q,MAA8BxQ,EAAAwR,GAChF7C,GAAS,CAAC8B,KAA8BzQ,EAAAwR,GACxCzB,GAAgB,CAACU,KAA8BzQ,EAAAwR,GAC/CnC,GAAQ,CAAC,IAAI1P,OAAO,iBAA2B6Q,MAA8BxQ,EAAAwR,GAC7E/B,GAAU,CAAC,IAAI9P,OAAO8P,GAAU,MAAQe,MAA8BxQ,EAAAwR,GACtE9B,GAAc,CAAC,IAAI/P,OAAO,WAAa6Q,MAA8BxQ,EAAAwR,GACrEjB,GAAY,CAAC,IAAI5Q,OAAO,iBAAmB6Q,GAA8B,OAAKxQ,EAAAwR,GAE9E5C,GAAa,CAAC,IAAIjP,OAAOiP,GAAa,IAAM4B,IAA+BC,KAA8BzQ,EAAAwR,GACzG1B,GAAiB,CAAC,IAAInQ,OAAO,aAAe6Q,MAA8BxQ,EAAAwR,GAC1EzC,GAAmB,CAAC,IAAIpP,OAAOmP,GAAkB,MAAQ0B,MAA8BxQ,EAAAwR,GACvFrC,GAAoB,CAAC,IAAIxP,OAAO,cAAgB6Q,MAA8BxQ,EAAAwR,GAAA,UACtE,CAAC,IAAI7R,OAAO,MAAQ6Q,MAA8BgB,IAkCzDC,GAGA,CACF,CACI,IAAI9R,OAAOkQ,GAAO,KAAOA,GAAO,aAAc,KAC9C,SAACnc,GACG,MAAO,CAACmc,GAAOnc,GAASA,EAAM,IAAO,GACzC,GAEJ,CAAC,IAAIiM,OAAOgQ,GAAU,KAAM,CAACA,GAAU,KACvC,CAAC,IAAIhQ,OAAOiQ,GAAa,KAAM,CAACA,GAAa,KAC7C,CAACiB,GAAkB,CAACjC,GAAY,KAChC,CACI,IAAIjP,OAAOqQ,GAAS,KACpB,SAAC0B,EAAGN,GACA,GAAI,QAAQhc,KAAKgc,IAAe,YAAYhc,KAAKgc,GAC7C,MAAO,CAACnB,GAAe,IAG3B,GAAI,IAAItQ,OAAOwO,IAAQ/Y,KAAKgc,KAAgB,aAAahc,KAAKgc,GAC1D,MAAO,CAACpB,GAAU,IAAM7B,GAAQ,IAEpC,IAAMza,EAAQ,wBAAwBie,KAAKP,GAC3C,GAAI1d,GAASA,EAAM,GAAI,CACnB,IAAMke,EAAUle,EAAM,GAClBme,EAAYf,GAAkBc,IAAY,GAI9C,MAHI,OAAOxc,KAAKgc,KACZS,EAAY,MAET,CAAC7B,GAAS6B,EACrB,CACA,MAAO,CAAC7B,GAAS,GACrB,GAEJ,CACI,uDACA,SAACtc,GACG,GAAIA,GAASA,EAAM,GAAI,CACnB,IAAMoe,EAAe,CAACpe,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAAM,KACtD,MAAO,CAAC0a,GAAK0D,EAAa1jB,KAAK,KACnC,CACA,MAAO,CAACggB,GAAK,GACjB,GAEJ,CACI,mDACA,SAAC1a,GAEG,IAAIke,EAAU,GAId,OAHIle,GAASA,EAAMjL,QAAU,IACzBmpB,EAAUrrB,EAAamN,EAAM,IAAMA,EAAM,GAAKA,EAAM,IAEjD,CAAC,UAAWke,EACvB,GAEJ,CACI,IAAIjS,OAAO,IAAM0O,GAAU,+BAAiCA,GAAU,IAAK,KAC3E,SAAC3a,GACG,GAAIA,GAASA,EAAM,GAAI,CACnB,IAAMoe,EAAe,CAACpe,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAAM,KACtD,MAAO,CAAC2a,GAASyD,EAAa1jB,KAAK,KACvC,CACA,MAAO,CAACigB,GAAS,GACrB,GAEJ,CACI,sCACA,SAAC3a,GACG,IAAMxG,EAA2B,CAAC,WAAY,IAC9C,GAAIwG,GAASA,EAAM,GAAI,CACnB,IAAMoe,EAAe,CAACpe,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAAM,KACtDxG,EAAO,GAAK4kB,EAAa1jB,KAAK,IAClC,CACA,OAAOlB,CACX,GAEJ,CACI,OAEA,CAAC,WAAY,KAEjB,CAAC,OAAQ,CAAC+hB,GAAW,KACrB,CAAC,gBAAiB,CAAC,QAAS,MAenB8C,GAAe,SAAUX,GAClC,OAAIR,GAAexb,KAAKgc,GACbzB,GACAgB,GAAkBvb,KAAKgc,GACvBxB,GACAc,GAAWtb,KAAKgc,GAChBvB,GACA,IAAIlQ,OAAOwQ,GAAM,KAAK/a,KAAKgc,GAC3BjB,GACA,IAAIxQ,OAAO,IAAMsQ,GAAgB,cAAe,KAAK7a,KAAKgc,GAC1DnB,GACA,OAAO7a,KAAKgc,GACZ5C,GACA,OAAOpZ,KAAKgc,GACZ,aACA,SAAShc,KAAKgc,GACd,SACA,qCAAqChc,KAAKgc,GAC1C1C,GACAmC,GAAiBzb,KAAKgc,GACtBxC,GACA,2BAA2BxZ,KAAKgc,GAChC,OACA,IAAIzR,OAAOuQ,GAAO,KAAK9a,KAAKgc,GAC5BlB,GAGP,uCAAuC9a,KAAKgc,IAE5C,+BAA+Bhc,KAAKgc,GAE7B,cACA,iBAAiBhc,KAAKgc,IAExB,IAAIzR,OAAOwO,IAAQ/Y,KAAKgc,IACzB,4EAA4Ehc,KAAKgc,GAG5E,sBAAsBhc,KAAKgc,KAAgB,WAAWhc,KAAKgc,IAC5D,oDAAoDhc,KAAKgc,IACxD,UAAUhc,KAAKgc,KAAgB,UAAUhc,KAAKgc,GAExC/C,GAEJE,GAEAF,GAEJ,IAAI1O,OAAO,QAAUwO,GAAS,IAAK,KAAK/Y,KAAKgc,GAC7Cf,GACA,IAAI1Q,OAAO2O,GAAQ,KAAKlZ,KAAKgc,KAAgB,IAAIzR,OAAO2O,GAAS,MAAO,KAAKlZ,KAAKgc,GAClFd,GAEA,EAEf,EC7UM0B,GAAmB,gBAEZC,GAAQ,CACjBC,eAAgB,SAAUC,GAEtB,IAAMC,EAAoB,CACtB,aACA,aACA,eACA,cACA,WACA,QACA,aACA,SACA,SACA,SACA,WACFvpB,OAAOspB,GAAgB,IAEnBE,EAA8B,CAAA,EAQpC,OAPA/nB,EAAM8nB,GAAmB,SAAUE,GAC/B,IAAMC,EAAK7qB,EAAWkmB,GAAelmB,EAAS8qB,IAAKF,GAAS,GACxDC,EAAG9pB,SACH4pB,EAAOC,GAASC,EAExB,IAEOF,CACV,EAEDI,aAAc,WACV,IAAMC,EAAWhrB,aAAAA,EAAAA,EAAUgrB,SAC3B,OAAKA,EAG6D,IAA1DA,EAASC,OAAOX,GAAmB,mBAC5B,SACmD,IAAnDU,EAASC,OAAOX,GAAmB,YACnC,OACoD,IAApDU,EAASC,OAAOX,GAAmB,aACnC,QACyD,IAAzDU,EAASC,OAAOX,GAAmB,kBACnC,aAEA,KAXJ,IAcd,EAEDY,WAAY,WACR,IAAMD,EAASV,GAAMQ,eACjB5E,EAAkB,SAAV8E,EAAoB,IAAM,IAClCtmB,EAA2B,CAAA,EAE/B,IAAK5F,EAAQksB,GAAS,CAClBtmB,EAAoB,eAAIsmB,EAExB,IAAME,EAAUnrB,EAAWkmB,GAAelmB,EAASgrB,SAAU7E,GAAS,GAClEgF,EAAQpqB,SACR4D,EAAgB,WAAIwmB,EAE5B,CAEA,OAAOxmB,CACV,EAODymB,QAAS3B,GAUT4B,eD4EgC,SAChCjrB,EACAmpB,EACAI,GAEA,IAAMyB,EAAU3B,GAAcrpB,EAAWmpB,EAAQI,GAC3C2B,EAAgCzB,GAAeuB,GACrD,GAAIvsB,EAAaysB,GACb,OAAO,KAGX,IAAK,IAAI5oB,EAAI,EAAGA,EAAI4oB,EAAQvqB,OAAQ2B,IAAK,CACrC,IAAMqJ,EAAQuf,EAAQ5oB,GAChB0K,EAAUhN,EAAU4L,MAAMD,GAChC,GAAIqB,EACA,OAAOme,WAAWne,EAAQA,EAAQrM,OAAS,GAEnD,CACA,OAAO,IACX,EC7FIyqB,gBAAiB,WACb,OACIzrB,UAAU0rB,UACT1rB,UAAkC2rB,YAE1C,EAEDC,GDgLoB,SAAUjC,GAC9B,IAAK,IAAIhnB,EAAI,EAAGA,EAAIqnB,GAAWhpB,OAAQ2B,IAAK,CACxC,IAAAkpB,EAAArc,EAA2Bwa,GAAWrnB,GAAE,GAAjCmpB,EAAID,EAAA,GAAEE,EAAUF,EAAA,GACjB5f,EAAQ6f,EAAK5B,KAAKP,GAClBlkB,EAASwG,IAAUtN,EAAYotB,GAAcA,EAAW9f,EAAO0d,GAAcoC,GACnF,GAAItmB,EACA,OAAOA,CAEf,CACA,MAAO,CAAC,GAAI,GAChB,ECxLIumB,OAAQ1B,GAER2B,WDiP4B,SAAUtC,GACtC,IAAMqC,EAAS1B,GAAaX,GAC5B,OACIqC,IAAWjF,IACXiF,IAAWlF,IACA,SAAXkF,GACW,gBAAXA,GACAA,IAAWnD,GAEJhC,GACAmF,IAAW9D,IAAY8D,IAAW5D,IAAQ4D,IAAW7D,IAAe6D,IAAWtD,GAC/E,UACAsD,IAAW/E,GACX,WACA+E,EACAtF,GAEA,SAEf,EClQIuE,SAAU,WACN,OAAOhrB,eAAAA,EAAUgrB,WAAY,SAChC,EAEDiB,gBAAiB,WAAoB,IAAAC,EACjC,OAAKlsB,SAAAA,EAAUgrB,WAGuB,QAA/BkB,EAAA5G,GAAatlB,EAASgrB,iBAAtBkB,IAA+BA,OAA/BA,EAAAA,EAAiC7f,OAF7B,SAGd,EAEDyS,WAAY,WACR,IAAK1e,EACD,MAAO,GAEX,IAAiD+rB,EAAA5c,EAAnBgb,GAAMoB,GAAGvrB,GAAU,GAA1CgsB,EAAOD,EAAA,GAAEE,EAAUF,EAAA,GAC1B,OAAO1oB,EACHgB,GAAwB,CACpB6nB,IAAKF,EACLG,YAAaF,EACbG,SAAUjC,GAAMa,QAAQhrB,EAAWL,UAAUwpB,OAAQlpB,EAAiBspB,OACtE8C,QAASlC,GAAMwB,OAAO3rB,GACtBssB,aAAcnC,GAAMyB,WAAW5rB,KAEnC,CACIusB,aAAc1sB,aAAAA,EAAAA,EAAU2L,KACxBghB,MAAO3sB,aAAAA,EAAAA,EAAUoM,KACjBwgB,UAAW5sB,aAAAA,EAAAA,EAAU6sB,SACrBC,gBAAiB3sB,EAAUW,OAAS,IAAOX,EAAU+G,UAAU,EAAG,KAAO,MAAQ/G,EACjF4sB,iBAAkBzC,GAAMc,eAAejrB,EAAWL,UAAUwpB,OAAQlpB,EAAiBspB,OACrFsD,kBAAmB1C,GAAMiB,kBACzB0B,eAAgB5tB,eAAAA,EAAQ6tB,OAAOC,OAC/BC,cAAe/tB,eAAAA,EAAQ6tB,OAAOG,MAC9BC,iBAAkBjuB,aAAAA,EAAAA,EAAQkuB,YAC1BC,gBAAiBnuB,aAAAA,EAAAA,EAAQouB,WACzBC,KAAM,MACNC,aAAclwB,EAAOE,YACrBiwB,WAAY5c,KAAKgQ,SAAS7iB,SAAS,IAAI+I,UAAU,EAAG,IAAM8J,KAAKgQ,SAAS7iB,SAAS,IAAI+I,UAAU,EAAG,IAClG2mB,MAAO5pB,KAAe,KAGjC,EAED6pB,kBAAmB,WACf,IAAK3tB,EACD,MAAO,GAGX,IAAiD4tB,EAAAze,EAAnBgb,GAAMoB,GAAGvrB,GAAU,GAA1CgsB,EAAO4B,EAAA,GAAE3B,EAAU2B,EAAA,GAC1B,OAAOvqB,EACHgB,GAAwB,CACpB6nB,IAAKF,EACLG,YAAaF,EACbG,SAAUjC,GAAMa,QAAQhrB,EAAWL,UAAUwpB,OAAQlpB,EAAiBspB,SAE1E,CACIqD,iBAAkBzC,GAAMc,eAAejrB,EAAWL,UAAUwpB,OAAQlpB,EAAiBspB,QAGjG,GClJEsE,GAAyF,CAC3F,SACA,eACA,sBACA,iBACA,UAoBSC,GAAkB,WAY3B,SAAAA,EAAY7a,GAAuB1C,OAAAud,GAC/B1pB,KAAK6O,OAASA,EACd7O,KAAK2O,MAAQ,GACb3O,KAAK2pB,uBAAwB,EAC7B3pB,KAAKgJ,KAjCK,SAAC6F,GACf,IAAI+E,EAAQ,GAKZ,OAJI/E,EAAc,QACd+E,EAAQ/E,EAAc,MAAE/Q,QAAQ,MAAO,MAAMA,QAAQ,MAAO,MAAMA,QAAQ,KAAM,OAGhF+Q,EAAyB,iBAClB,MAAQA,EAAyB,iBAEjC,MAAQ+E,EAAQ,UAE/B,CAsBoBgW,CAAU/a,GACtB7O,KAAK6pB,QAAU7pB,KAAK8pB,aAAajb,GACjC7O,KAAK+pB,OACL/pB,KAAKgqB,cAAcnb,EAAQA,GAC3B7O,KAAKiqB,MACT,CAmRC,OAnRA5d,EAAAqd,EAAA,CAAA,CAAA1qB,IAAA,eAAAH,MAED,SAAqBgQ,IAIN,IAFP4a,GAAmCnuB,QAC/BuT,EAAoB,YAAEpI,iBAG1B1K,EAAOsB,SACH,4BAA8BwR,EAAoB,YAAI,yCAE1DA,EAAoB,YAAI,uBAK5B,IAAMqb,EAAerb,EAAoB,YAAEpI,cAkB3C,MAjBqB,iBAAjByjB,GAAmCrK,GAAWpB,eACtCoB,GACgB,wBAAjBqK,GAA0C9J,GAAqB3B,eAC9D2B,GACgB,mBAAjB8J,GAAqCxJ,GAAajC,eACjDiC,GACgB,WAAjBwJ,EACC1J,GACgB,WAAjB0J,EACC1L,GACD4B,GAAqB3B,eAEpB2B,GAEA5B,EAIhB,GAAC,CAAAxf,IAAA,aAAAH,MAED,WACI,IAAMqB,EAAgB,CAAA,EAYtB,OAVA9B,EAAM4B,KAAK2O,OAAO,SAAUvO,EAAGC,GAC3B,GAAIA,IAAMiN,IAAyBlT,EAAUgG,GAEzC,IADA,IAAMZ,EAAO/F,OAAO+F,KAAKY,GAChBlC,EAAI,EAAGA,EAAIsB,EAAKjD,OAAQ2B,IAC7BgC,EAACvD,YAAAA,OAAa6C,EAAKtB,KAAQkC,EAAEZ,EAAKtB,SXhBlDmL,EWkB8DhJ,EXhB1D8pB,GAAQ,GACR5vB,EAJJT,EWmB6BiU,IXdlBoc,EAEP9uB,GAAiBvB,EAAIwB,UAAYD,GACF,GAAxBvB,EAAIwB,QAAQ+N,IAEvBjL,EAAMtE,GAAK,SAAU+E,GACjB,GAAIsrB,IAAUA,EAAQtrB,IAAUwK,GAC5B,OAAO1L,CAGf,IACOwsB,MWIKjqB,EAAEG,GAAKD,GXrBC,IACpBtG,EACAuP,EAEI8gB,CWmBA,IACOjqB,CACX,GAAC,CAAAlB,IAAA,OAAAH,MAED,WACI,IAAImB,KAAKoqB,SAAT,CAIA,IAAMC,EAAQrqB,KAAK6pB,QAAQ9K,MAAM/e,KAAKgJ,MAElCqhB,IACArqB,KAAK2O,MAAQ1P,EAAQ,CAAE,EAAEorB,GAL7B,CAOJ,GAEA,CAAArrB,IAAA,OAAAH,MAKA,WACQmB,KAAKoqB,UAGTpqB,KAAK6pB,QAAQ7K,IAAIhf,KAAKgJ,KAAMhJ,KAAK2O,MAAO3O,KAAKsqB,YAAatqB,KAAK2d,gBAAiB3d,KAAKof,OACzF,GAAC,CAAApgB,IAAA,SAAAH,MAED,WAEImB,KAAK6pB,QAAQlK,OAAO3f,KAAKgJ,MAAM,GAC/BhJ,KAAK6pB,QAAQlK,OAAO3f,KAAKgJ,MAAM,EACnC,GAGA,CAAAhK,IAAA,QAAAH,MAEA,WACImB,KAAK2f,SACL3f,KAAK2O,MAAQ,EACjB,GAEA,CAAA3P,IAAA,gBAAAH,MAMA,SAAc8P,EAAmB4b,EAAoBtL,GAAwB,IAAAvO,EAAA1Q,KACzE,GAAI5F,EAAUuU,GAAQ,CACdtU,EAAakwB,KACbA,EAAgB,QAEpBvqB,KAAKsqB,YAAcjwB,EAAa4kB,GAAQjf,KAAKwqB,eAAiBvL,EAE9D,IAAIwL,GAAa,EASjB,GAPArsB,EAAMuQ,GAAO,SAACxN,EAAKhC,GACVuR,EAAK/B,MAAMhV,eAAewF,IAASuR,EAAK/B,MAAMxP,KAAUorB,IACzD7Z,EAAK/B,MAAMxP,GAAQgC,EACnBspB,GAAa,EAErB,IAEIA,EAEA,OADAzqB,KAAKiqB,QACE,CAEf,CACA,OAAO,CACX,GAEA,CAAAjrB,IAAA,WAAAH,MAKA,SAAS8P,EAAmBsQ,GAAwB,IAAA5N,EAAArR,KAChD,GAAI5F,EAAUuU,GAAQ,CAClB3O,KAAKsqB,YAAcjwB,EAAa4kB,GAAQjf,KAAKwqB,eAAiBvL,EAE9D,IAAIwL,GAAa,EASjB,GAPArsB,EAAMuQ,GAAO,SAACxN,EAAKhC,GACXwP,EAAMhV,eAAewF,IAASkS,EAAK1C,MAAMxP,KAAUgC,IACnDkQ,EAAK1C,MAAMxP,GAAQgC,EACnBspB,GAAa,EAErB,IAEIA,EAEA,OADAzqB,KAAKiqB,QACE,CAEf,CACA,OAAO,CACX,GAAC,CAAAjrB,IAAA,aAAAH,MAED,SAAWM,GACHA,KAAQa,KAAK2O,eACN3O,KAAK2O,MAAMxP,GAClBa,KAAKiqB,OAEb,GAAC,CAAAjrB,IAAA,yBAAAH,MAED,WACSmB,KAAK2pB,wBACN3pB,KAAK6T,SAASkS,GAAMC,eAAehmB,KAAK6O,OAAO6b,yBAC/C1qB,KAAK2pB,uBAAwB,EAErC,GAAC,CAAA3qB,IAAA,wBAAAH,MAED,WACImB,KAAK6T,SAASkS,GAAMW,aACxB,GAAC,CAAA1nB,IAAA,uBAAAH,MAED,WACImB,KAAK6T,SAAS,CACV8W,UAAW3qB,KAAK2O,MAAiB,WAAKoX,GAAMS,WAC5CoE,kBAAmB5qB,KAAK2O,MAAyB,mBAAKoX,GAAM0B,mBAEpE,GAAC,CAAAzoB,IAAA,oBAAAH,MAED,WACI,OAAOoB,GAAwB,CAC3B0qB,UAAW3qB,KAAY,MAAa,UACpC4qB,kBAAmB5qB,KAAY,MAAqB,mBAE5D,GAIA,CAAAhB,IAAA,aAAAH,MAEA,SAAW8P,GAOP,OANAvQ,EAAM4B,KAAK2O,OAAO,SAAUxN,EAAKhC,GACvBA,KAAQwP,IACVA,EAAMxP,GAAQgC,EAEtB,IAEOwN,CACX,GAAC,CAAA3P,IAAA,gBAAAH,MAED,SAAcgQ,EAAuBgc,GAMjC,GALA7qB,KAAKwqB,eAAiBxqB,KAAKsqB,YAAczb,EAA0B,kBACnE7O,KAAK8qB,aAAajc,EAA4B,qBAC9C7O,KAAK+qB,oBAAoBlc,EAA+B,wBACxD7O,KAAKgrB,WAAWnc,EAAsB,eAElCA,EAAOH,cAAgBmc,EAAUnc,YAAa,CAE9C,IAAMuc,EAAWjrB,KAAK8pB,aAAajb,GAC7BF,EAAQ3O,KAAK2O,MAGnB3O,KAAKkrB,QACLlrB,KAAK6pB,QAAUoB,EACfjrB,KAAK2O,MAAQA,EAEb3O,KAAKiqB,MACT,CACJ,GAAC,CAAAjrB,IAAA,eAAAH,MAED,SAAaurB,GACTpqB,KAAKoqB,SAAWA,EACZpqB,KAAKoqB,SACLpqB,KAAK2f,SAEL3f,KAAKiqB,MAEb,GAAC,CAAAjrB,IAAA,sBAAAH,MAED,SAAoB8e,GACZA,IAAoB3d,KAAK2d,kBACzB3d,KAAK2d,gBAAkBA,EACvB3d,KAAK2f,SACL3f,KAAKiqB,OAEb,GAAC,CAAAjrB,IAAA,sBAAAH,MAED,WACI,QAASmB,KAAK2d,eAClB,GAAC,CAAA3e,IAAA,aAAAH,MAED,SAAWugB,GACHA,IAAWpf,KAAKof,SAChBpf,KAAKof,OAASA,EACdpf,KAAK2f,SACL3f,KAAKiqB,OAEb,GAAC,CAAAjrB,IAAA,kBAAAH,MAED,SAAgBssB,EAAoB5e,GAChC,IAAM6e,EAASprB,KAAK2O,MAAM9B,KAAqB,CAAA,EAC/Cue,EAAOD,GAAc5e,EACrBvM,KAAK2O,MAAM9B,IAAoBue,EAC/BprB,KAAKiqB,MACT,GAAC,CAAAjrB,IAAA,qBAAAH,MAED,SAAmBssB,GACf,IACM5e,GADSvM,KAAK2O,MAAM9B,KAAqB,CAAA,GACtBse,GAKzB,OAJK9wB,EAAakS,YACPvM,KAAK2O,MAAM9B,IAAkBse,GACpCnrB,KAAKiqB,QAEF1d,CACX,GAAC,CAAAvN,IAAA,iBAAAH,MAED,WACI,OAAOmB,KAAK2O,MAAMf,KAAe,WACrC,GAAC,CAAA5O,IAAA,iBAAAH,MAED,SAAewsB,GACXrrB,KAAK2O,MAAMf,IAAcyd,EACzBrrB,KAAKiqB,MACT,GAAC,CAAAjrB,IAAA,mBAAAH,MAED,WACI,OAAOmB,KAAK2O,MAAMd,KAA0B,CAAA,CAChD,GAAC,CAAA7O,IAAA,mBAAAH,MAED,SAAiBwsB,GACbrrB,KAAK2O,MAAMd,IAAyBwd,EACpCrrB,KAAKiqB,MACT,KAACP,CAAA,CAxS0B,GCvBlB4B,GAA2B,EAC3BC,GAAkB,EAuH/B,IAAaC,GAAmBnf,GAM5B,SAAAmf,EACqBC,GAMnB,IAAAC,EAAAC,EAAAjb,EAAA1Q,KALmBmX,EAIhB7a,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EAAE6P,OAAAqf,GAAA1X,oBAXW,KAAGA,oBACH,IAAEA,EAAA9T,KAAA,kBAC2B,CAAA,GAAE8T,EAAA9T,KAAA,gBACH,CAAA,GAAE8T,wBAiB3B,WACpBra,OAAO+F,KAAKkR,EAAKkb,iBAAiBxwB,SAAQ,SAAC4D,GACvC0R,EAAKkb,gBAAgB5sB,GAAO0R,EAAKkb,gBAAgB5sB,GAAO0R,EAAKmb,WAEzDnb,EAAKkb,gBAAgB5sB,IAAQ0R,EAAKob,mBAC3Bpb,EAAKkb,gBAAgB5sB,EAEpC,OACH8U,EAAA9T,KAAA,2BAEiC,SAACiJ,GAI/B,IAAM8iB,EAAOrb,EAAK+a,MAAMO,OAAOC,QAAQhjB,GAGvC,GAAuB,SAAnB8iB,eAAAA,EAAMG,WAAsBH,aAAgBI,QAAS,CACrD,IAAMC,EAAaL,EAAKM,QAAQ,OAEhC,GAAID,EACA,MAAO,CAAC1b,EAAK+a,MAAMO,OAAOM,MAAMF,GAAaA,EAErD,CAEA,MAAO,CAACnjB,EAAI8iB,MACfjY,EAAA9T,KAAA,mBAEyB,SAACqB,GAAyC,IAAAkrB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAChE,OACyBP,QAArBA,EAAaC,QAAbA,EAACnrB,EAAK0rB,mBAAOP,SAAZA,EAAcjwB,kBAAMgwB,EAAAA,EAAI,IACD,QADEE,EACVC,QADUA,EACzBrrB,EAAKiJ,kBAALoiB,IAAeA,OAAfA,EAAAA,EAAiBnwB,cAAMkwB,IAAAA,EAAAA,EAAI,IACT,QADWE,EACnBC,QADmBA,EAC7BvrB,EAAK2rB,aAALJ,IAAUA,OAAVA,EAAAA,EAAYrwB,cAAMowB,IAAAA,EAAAA,EAAI,IACLE,QADOA,UAAAC,EACxBzrB,EAAK4rB,YAAI,IAAAH,OAAA,EAATA,EAAWvwB,kBAAMswB,EAAAA,EAAI,MAE7B/Y,EAAA9T,KAAA,qBAE0B,SAAC8C,GACxB,GAjLuC,IAiLnCA,EAAMM,MA/KkB,IA+K0BN,EAAMzB,KAAKnC,OAC7D,OAAO4D,EAGX,IAAMzB,EAAOyB,EAAMzB,KACb6rB,EAAuBxc,EAAKyc,gBAAgB9rB,GAE9CA,EAAKiJ,aAELjJ,EAAKiJ,WAAajJ,EAAKiJ,WAAW7E,QAAO,SAAC2J,GAAS,IAAAge,EAWVC,EAAAC,EAVuBC,EAAAxiB,EAArC2F,EAAK8c,wBAAwBpe,EAAKnG,IAAG,GAArDwkB,EAAMF,EAAA,GAAExB,EAAIwB,EAAA,GAEnB,GAAqC,IAAjC7c,EAAKkb,gBAAgB6B,GACrB,OAAO,GAGX/c,EAAKkb,gBAAgB6B,GAAsCL,QAA/BA,EAAG1c,EAAKkb,gBAAgB6B,cAAOL,EAAAA,EAAI1c,EAAKob,WACpEpb,EAAKkb,gBAAgB6B,GAAUhhB,KAAKihB,IAAIhd,EAAKkb,gBAAgB6B,GAAU,EAAG,GAErC,IAAjC/c,EAAKkb,gBAAgB6B,MAChB/c,EAAKid,cAAcF,KACpB/c,EAAKid,cAAcF,IAAU,EACH,QAA1BJ,GAAAC,EAAA5c,EAAKyG,SAAQyW,qBAAbP,IAA0BA,GAA1BA,EAAAtzB,KAAAuzB,EAA6BG,EAAQ1B,KAI7C,OAAO3c,CACX,KAIJ,IAAMye,EAAgBnd,EAAKyc,gBAAgB9rB,GAE3C,OAAsB,IAAlBwsB,GAAuBX,IAAyBW,EAI7C/qB,OAJP,KAKH9C,KA1FoByrB,MAAAA,EAAkBzrB,KAClBmX,QAAAA,EAMjBnX,KAAK6rB,mBAAUH,EAAG1rB,KAAKmX,QAAQ0U,kBAAU,IAAAH,EAAAA,EAAI1rB,KAAK6rB,WAClD7rB,KAAK8rB,mBAAUH,EAAG3rB,KAAKmX,QAAQ2U,kBAAU,IAAAH,EAAAA,EAAI3rB,KAAK8rB,WAClDgC,aAAY,WACRpd,EAAKqd,eACR,GAAE,IACP,ICvJGC,GAAA,SAAAC,GAAKD,OACVA,EAAAA,EAAAA,iBAAAA,GAAAA,mBACAA,EAAAA,EAAAA,KAAAA,GAAAA,OACAA,EAAAA,EAAAA,aAAAA,GAAAA,eACAA,EAAAA,EAAAA,oBAAAA,GAAAA,sBACAA,EAAAA,EAAAA,KAAAA,GAAAA,OACAA,EAAAA,EAAAA,OAAAA,GAAAA,SACAA,EAAAA,EAAAA,OAAAA,GAAAA,SAPUA,CAAA,CAAL,CAAKA,IAAA,CAAA,GCFCE,GAA8C,CACvDC,eAAgB,CACZ,QACA,SACA,OACA,MACA,aACA,QACA,QACA,QACA,SACA,OACA,QACA,MACA,QACA,OACA,aACA,SACA,OACA,SACA,QACA,QACA,kBAEJC,cAAe,SAAC/sB,GAA4B,OAAKA,CAAI,EACrDgtB,eAAe,EACfC,YAAY,EACZC,uBAAuB,EACvBC,mBAAmB,EACnBC,8BAA+B,CAE3B,cAGA,aACA,QACA,YAEJC,sBAAuB,KAGrBC,GAAkB,CACpB,gBACA,kBACA,gBACA,SACA,aACA,YACA,YACA,cACA,YACA,sBACA,eACA,cACA,gBAWEC,GAA0B,CAAC,MAAO,MAAO,OAe/C,SAASC,GACLC,EACAC,EACAC,EACAC,GAEA,GAAIz0B,EAAWs0B,GACX,OAAOA,EAGX,IAAII,GAAwCH,aAAO,EAAPA,EAAU,oBAd1D,SAAuBD,GACnB,OAAO,IAAIK,KAAK,CAACL,IAAUM,IAC/B,CAY+EC,CAAcP,GAKzF,OAJIx0B,EAAU40B,KACVA,EAAuBI,SAASJ,IAGhCA,EAAuBF,EACvB,mBAAAryB,OAA0BsyB,EAAWtyB,+BAAAA,OAA8BuyB,EAAoB,WAGpFJ,CACX,CAGA,IAyBaS,GAA6B,SACtCC,EACAC,GAEA,IA5BAtY,EACqFuY,EAE/EV,EAyBAngB,EAAS2gB,EAAeG,kBAExBC,GAA4C,IAAzB/gB,EAAOwf,eAAkCoB,EAAqBpB,cACjFwB,GAAsC,IAAtBhhB,EAAOyf,YAA+BmB,EAAqBnB,WAC3EwB,GAAoD,IAA7BjhB,EAAO2f,mBAAsCiB,EAAqBjB,kBAEzFuB,GAlCN5Y,EAkCwCtI,EA/BlCmgB,EAAQviB,KAAKuR,IAAI,IAAsC0R,QAA/BA,EAAEvY,EAAQuX,iCAAqBgB,EAAAA,EAAI,KAE1D,SAACruB,GASJ,OARIA,SAAAA,EAAM2uB,cACN3uB,EAAK2uB,YAAcnB,GAAcxtB,EAAK2uB,YAAa3uB,EAAK4uB,eAAgBjB,EAAO,YAG/E3tB,SAAAA,EAAM6uB,eACN7uB,EAAK6uB,aAAerB,GAAcxtB,EAAK6uB,aAAc7uB,EAAK8uB,gBAAiBnB,EAAO,aAG/E3tB,IAsBL+uB,EAA4D,SAACC,GAAyB,OACxFN,EAzEmB,SAAC1uB,GACxB,IAAM8F,EAAM2Z,GAAazf,EAAK2H,MAC9B,KAAI7B,GAAOA,EAAImhB,UAAYsG,GAAwBtnB,MAAK,SAACgpB,GAAI,OAAoC,IAA/BnpB,EAAImhB,SAAShtB,QAAQg1B,EAAW,KAGlG,OAAOjvB,CACX,CAmEuBkvB,EAnFYlvB,EAmFiCgvB,EAlFhE52B,OAAO+F,KAAwBgxB,QAApBA,EAACnvB,EAAK4uB,0BAAcO,EAAAA,EAAI,CAAA,GAAIp1B,SAAQ,SAACq1B,GAAW,IAAAC,EACnD/B,GAAgBxlB,SAASsnB,EAAOhqB,iBAA0CiqB,QAA1BA,EAAOrvB,EAAK4uB,0BAAcS,UAAnBA,EAAsBD,GACrF,IACOpvB,KAJuB,IAACA,EAAyDmvB,CAmFpB,EAE9DG,EAA4Bz2B,EAAYs1B,EAAeG,kBAAkBiB,sBA+B/E,OA7BID,GAA6Bz2B,EAAYs1B,EAAeG,kBAAkBkB,+BAC1E90B,EAAOgB,KACH,uHAIJ4zB,IACAnB,EAAeG,kBAAkBkB,6BAA+B,SAACxvB,GAC7D,IAAMyvB,EAAatB,EAAeG,kBAAkBiB,qBAAsB,CAAEzpB,IAAK9F,EAAK2H,OACtF,OAAAuB,EAAAA,EAAA,CAAA,EACOlJ,GAAI,CAAA,EAAA,CACP2H,KAAM8nB,aAAU,EAAVA,EAAY3pB,QAK9B0H,EAAOuf,cAAgBl0B,EAAYs1B,EAAeG,kBAAkBkB,8BAC9D,SAACxvB,GAAS,IAAA0vB,EAAAC,EAAAC,EACAC,EAAiBd,EAAmB/uB,GAC1C,OAAO6vB,GAC8EH,QADhEA,EAC8CC,QAD9CA,GACfC,EAAAzB,EAAeG,mBAAkBkB,oCAAjCG,IAA6DA,OAA7DA,EAAAA,EAAAj3B,KAAAk3B,EAAgEC,UAAeH,IAAAA,EAAAA,OAC/Eh2B,CACT,OACDA,EAED8T,EAAOuf,gBACRvf,EAAOuf,cAAgBgC,GAG3B7lB,EAAAA,EAAAA,EACO2jB,CAAAA,EAAAA,IACArf,GAAM,GAAA,CACTwf,cAAeuB,EACftB,WAAYuB,EACZrB,kBAAmBsB,EACnBvB,sBAAuBuB,GAE/B,EC3JMqB,GAAkC,mBAejC,SAASC,GAAMxd,EAAeuD,GACjCka,IAAU,EAAMzd,EAAOuD,EAC3B,CAYO,SAASma,GAAO1d,EAAeuD,GAClCka,IAAU,EAAOzd,EAAOuD,EAC5B,CAUO,SAASoa,GAAW3d,EAAeuD,GACtC,MAA4C,MAArCqa,GAAiB5d,EAAOuD,EACnC,CAWO,SAASsa,GAAY7d,EAAeuD,GACvC,QAsEJ,SAA8BA,GAC1B,GAAIA,GAAWA,EAAQua,WAAY,CAC/B,IAAM72B,EAAOsc,GAAWA,EAAQrc,QAAWA,EACrC62B,EAAM92B,aAAAA,EAAAA,EAAKU,UACbq2B,GAAW,EAaf,OAZAxzB,EACI,CACIuzB,aAAAA,EAAAA,EAAKE,WACJF,EAA0B,aAC1B92B,EAAwB,aAE7B,SAAUi3B,GACF1yB,EAAU,EAAC,EAAM,EAAG,IAAK,OAAQ0yB,KACjCF,GAAW,EAEnB,IAEGA,CACX,CACA,OAAO,CACX,CA1FQG,CAAqB5a,IAGmB,MAArCqa,GAAiB5d,EAAOuD,EACnC,CAYO,SAAS6a,GAAcpe,EAAeuD,GAEzC8a,GADA9a,EAAUA,GAAW,IACAwI,OAAOuS,GAAete,EAAOuD,KAAYA,EAAQgb,qBAC1E,CAUA,SAASF,GAAY9a,GAEjB,MAAgC,kBADhCA,EAAUA,GAAW,IACTib,gBACDvS,GAEqB,wBAA5B1I,EAAQib,gBACDhS,GAEJ5B,EACX,CASA,SAAS0T,GAAete,EAAeuD,GAEnC,QADAA,EAAUA,GAAW,IACLkb,mBAAqBlB,IAAmCvd,CAC5E,CASA,SAAS4d,GAAiB5d,EAAeuD,GACrC,OAAO8a,GAAY9a,GAASwH,IAAIuT,GAAete,EAAOuD,GAC1D,CA4CA,SAASka,GAAUiB,EAAmB1e,EAAeuD,GAC5C7c,EAAUsZ,IAAWA,EAAMrX,QAOhC01B,GAFA9a,EAAUA,GAAW,IAEA6H,IACjBkT,GAAete,EAAOuD,GACtBmb,EAAW,EAAI,EACf73B,EAAU0c,EAAQob,kBAAoBpb,EAAQob,iBAAmB,KACjEpb,EAAQgb,qBACRhb,EAAQqb,cAGRrb,EAAQnE,SAAWsf,GAEnBnb,EAAQnE,QAAQmE,EAAQsb,kBAAoB,UAAWtb,EAAQub,mBAAqB,GAAI,CACpFC,gBAAgB,KAjBpB52B,EAAOmB,MAAM,SAAWo1B,EAAW,QAAU,UAAY,gCAoBjE,CAEO,SAASM,GAAaC,GACzB,IAAIC,GAAW,EAEf,IACI,IAAMlf,EAAQif,EAAQhkB,OAAO+E,MACvB8d,EAAamB,EAAQhkB,OAAOkkB,YAC5BX,EAAkBS,EAAQhkB,OAAOmkB,mCACjCX,EAAoBQ,EAAQhkB,OAAOokB,sCAAmCl4B,EACtEF,EAAOg4B,EAAQhkB,OAAe/T,OAEhC8Y,IAEAkf,EAAWrB,GAAY7d,EAAO,CAC1B8d,WAAAA,EACAU,gBAAAA,EACAC,kBAAAA,EACAv3B,OAAQD,IAGnB,CAAC,MAAOiE,GACL/C,EAAOmB,MAAM,4DAA8D4B,EAC/E,CACA,OAAOg0B,CACX,CCxMA,IAcKI,GAZCC,GAAe,IAERC,GAAqCD,IAU5B,SAAjBD,GAAAA,EAAAA,EAAiB,SAAA,GAAA,WAAjBA,EAAAA,EAAiB,UAAA,GAAA,YAAjBA,EAAAA,EAAiB,iBAAA,GAAA,mBAAjBA,EAAAA,EAAiB,OAAA,GAAA,SAAjBA,EAAAA,EAAiB,eAAA,GAAA,iBAAjBA,EAAAA,EAAiB,MAAA,GAAA,QAAjBA,EAAAA,EAAiB,UAAA,GAAA,YAAjBA,EAAAA,EAAiB,iBAAA,GAAA,mBAAjBA,EAAAA,EAAiB,eAAA,GAAA,iBAAjBA,EAAAA,EAAiB,eAAA,GAAA,iBAAjBA,EAAAA,EAAiB,KAAA,IAAA,OAAjBA,EAAAA,EAAiB,IAAA,IAAA,MAAjBA,EAAAA,EAAiB,KAAA,IAAA,OAAjBA,EAAAA,EAAiB,iBAAA,IAAA,mBAAjBA,EAAAA,EAAiB,UAAA,IAAA,YAAjBA,EAAAA,EAAiB,kBAAA,IAAA,mBAAjBA,CAAiB,CAAjBA,KAAAA,GAAiB,CAAA,IAmBtB,IAAMG,GAAiB,CACnBH,GAAkBI,UAClBJ,GAAkBK,iBAClBL,GAAkBM,OAClBN,GAAkBO,eAClBP,GAAkBQ,MAClBR,GAAkBS,UAClBT,GAAkBU,iBAClBV,GAAkBW,MAyBhBC,GAAiB,SAACC,GAAuB,MAAwB,CACnEA,YAAAA,EACAC,WAAYr0B,KAAKC,MACjBq0B,QAAS,EACZ,EAEKn4B,GAAgB,qBAETo4B,GAAgB,WAqIzB,SAAAA,EAAY3lB,GAAmB,IAAAmC,EAAA1Q,KAmB3B,GAnB2BmM,OAAA+nB,GAAApgB,2BA7HiB,IAAEA,iBAOjC,GAAKA,0BAEa,GAAKA,EACCnU,KAAAA,yBAAAA,KAAKC,OAAKkU,kBACjB,MAAIA,mBACH,MAAIA,qBACY,MAAIA,qBAClB,MAAIA,0BACC,MAAIA,6CAKT,GA0GjC9T,KAAKuO,SAAWA,EAChBvO,KAAKm0B,iBAAkB,EACvBn0B,KAAKo0B,UAlNS,MAmNdp0B,KAAKq0B,eAAYt5B,EACjBiF,KAAKs0B,gBAAiB,EAEtBx5B,SAAAA,EAAQ0I,iBAAiB,gBAAgB,WACrCkN,EAAK6jB,cACT,IAEAz5B,SAAAA,EAAQ0I,iBAAiB,WAAW,WAChCkN,EAAK8jB,mBAAmB,kBAAmB,CAAA,EAC/C,IAEA15B,SAAAA,EAAQ0I,iBAAiB,UAAU,WAC/BkN,EAAK8jB,mBAAmB,iBAAkB,CAAA,EAC9C,KAEKx0B,KAAKuO,SAASkmB,eAEf,MADA14B,EAAOmB,MAAMpB,GAAgB,yCACvB,IAAIuf,MAAMvf,GAAgB,yDAGpCkE,KAAK4c,OAAS5c,KAAK00B,aACvB,CAulBC,OAvlBAroB,EAAA6nB,EAAA,CAAA,CAAAl1B,IAAA,UAAA2f,IAhID,WAEI,OAAO3e,KAAKm0B,eAChB,GAAC,CAAAn1B,IAAA,iBAAA2f,IAED,WACI,IAAK3e,KAAKuO,SAASkmB,eAEf,MADA14B,EAAOmB,MAAMpB,GAAgB,yCACvB,IAAIuf,MAAMvf,GAAgB,yDAGpC,OAAOkE,KAAKuO,SAASkmB,cACzB,GAAC,CAAAz1B,IAAA,YAAA2f,IAED,WACI,OAAIlkB,EAAUuF,KAAK20B,aACR30B,KAAKuO,SAAS+G,aAAajI,IAE3B,IAEf,GAAC,CAAArO,IAAA,kBAAA2f,IAED,WAA6C,IAAAiW,EAAAC,EACnCC,EAAgC,QAAdF,EAAG50B,KAAK4c,cAAM,IAAAgY,OAAA,EAAXA,EAAavzB,MAAgB,QAAXwzB,EAAI70B,KAAC4c,cAAM,IAAAiY,OAAA,EAAXA,EAAaxzB,KAAK9E,QAAS,GAChEw4B,EAA0B/0B,KAAKy0B,eAAeO,+BAA8B,GAA5ED,sBACR,OAAOD,EAAqBA,EAAmBvoB,UAAYwoB,EAAwB,IACvF,GAAC,CAAA/1B,IAAA,qBAAA2f,IAED,WACI,IAAMsW,IAAwBj1B,KAAKuO,SAAS+G,aAAavI,IACnD6B,GAAuB5O,KAAKuO,SAASM,OAAOqmB,0BAClD,OAAOp6B,GAAUm6B,GAAuBrmB,CAC5C,GAAC,CAAA5P,IAAA,6BAAA2f,IAED,WACI,IAAMsW,IAAwBj1B,KAAKuO,SAAS+G,aAAatI,IACnD4B,EAAsB5O,KAAKuO,SAASM,OAAOsmB,6BACjD,OAAOvmB,QAAAA,EAAuBqmB,CAClC,GAAC,CAAAj2B,IAAA,kBAAA2f,IAED,WACI,IAAMyW,EAA8Bp1B,KAAKuO,SAAS+G,aAAanI,IAC/D,OAAOioB,GAA+BA,EAA4BC,KAAOD,EAA4BE,QAC/F,CACIppB,QAASkpB,EAA4BlpB,QACrCmpB,IAAKD,EAA4BC,IACjCC,QAASF,EAA4BE,cAEzCv6B,CACV,GAAC,CAAAiE,IAAA,mBAAA2f,IAED,WAA+B,IAAA4W,EACrBC,EAA+Bx1B,KAAKuO,SAAS+G,aAAarI,IAEhE,OAD2EsoB,QAAzCA,EAAGv1B,KAAKuO,SAASM,OAAO8gB,yBAArB4F,IAAsCA,OAAtCA,EAAAA,EAAwCE,kBACtCD,GAAgC,IAC3E,GAGA,CAAAx2B,IAAA,wBAAA2f,IACA,WAEgB,IAAA+W,EAAAC,EACNC,EAAoC51B,KAAKuO,SAAS+G,aAAapI,IAC/D2oB,EAAoC,CACtCxH,cAAqDqH,QAAxCA,EAAE11B,KAAKuO,SAASM,OAAO8gB,yBAArB+F,IAAsCA,OAAtCA,EAAAA,EAAwCrH,cACvDC,WAAkD,QAAxCqH,EAAE31B,KAAKuO,SAASM,OAAO8gB,yBAAiB,IAAAgG,OAAA,EAAtCA,EAAwCrH,YAElDwH,GACFD,aAAAA,EAAAA,EAAmCxH,iBAAiBuH,aAAAA,EAAAA,EAAmCvH,eACrF0H,GACFF,aAAAA,EAAAA,EAAmCvH,cAAcsH,aAAAA,EAAAA,EAAmCtH,YAClF0H,EACFh2B,KAAKuO,SAASM,OAAOonB,sBAAuBL,aAAAA,EAAAA,EAAmCM,oBAEnF,OAAOJ,GAAkBC,GAAeC,EAClC,CAAE3H,cAAeyH,EAAgBxH,WAAYyH,EAAavH,kBAAmBwH,QAC7Ej7B,CACV,GAEA,CAAAiE,IAAA,SAAA2f,IAIA,WACI,OAAK3e,KAAKs0B,eAILt0B,KAAKm2B,mBAIL37B,EAAWwF,KAAKo2B,cAAiBp2B,KAAKq2B,gBAIvC37B,EAAWsF,KAAKs2B,WACTt2B,KAAKs2B,UAAY,UAAY,WAE7B,SANA,YAJA,WAJA,WAgBf,GAAC,CAAAt3B,IAAA,0BAAAH,MA6BD,WACQmB,KAAKm2B,oBACLn2B,KAAKu2B,gBACLx6B,EAAOa,KAAKd,GAAgB,cAE5BkE,KAAKw2B,gBACLx2B,KAAK00B,cAEb,GAAC,CAAA11B,IAAA,gBAAAH,MAED,WACQmB,KAAKm0B,iBAAmBn0B,KAAKq0B,YAC7Br0B,KAAKq0B,YACLr0B,KAAKq0B,eAAYt5B,EACjBiF,KAAKm0B,iBAAkB,EACvBp4B,EAAOa,KAAKd,GAAgB,YAEpC,GAAC,CAAAkD,IAAA,uBAAAH,MAED,SAA6B43B,GAAyB,IAAAC,EAC5CC,EAAmB32B,KAAKy2B,YAAcA,EAE5C,GAAKh8B,EAAUuF,KAAK20B,aAApB,CAOA,IASIiC,EATEC,EAAkB72B,KAAKs2B,UAU7B,GAAIK,IAAqBj8B,EAAWm8B,GAEhCD,EADqBnqB,KAAKgQ,SACIzc,KAAK20B,iBAEnCiC,EAAeC,EAGdD,GACD76B,EAAOgB,KACHjB,oBAAaa,OACQqD,KAAK20B,YAAWh4B,0CAAAA,OAAyC85B,gDAItFC,EAAI12B,KAACuO,SAASG,mBAAW,IAAAgoB,GAAzBA,EAA2B7iB,SAAQC,EAAA,CAAA,EAC9BzG,GAA+BupB,GA3BpC,KALA,CAAkC,IAAAtf,UAC9BA,EAAItX,KAACuO,SAASG,mBAAW,IAAA4I,GAAzBA,EAA2BzD,SAAQC,EAAA,CAAA,EAC9BzG,GAA+B,MAGxC,CA6BJ,GAAC,CAAArO,IAAA,sBAAAH,MAED,SAAoB6M,GAA0B,IAAAorB,EAAAC,EAAAC,EAAAC,EACXC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAle,EADWhI,EAAArR,KACtCA,KAAKuO,SAASG,aACd1O,KAAKuO,SAASG,YAAYmF,UAAQC,EAAAuF,EAAAvF,CAAAA,EAC7B/G,KAA0CrB,EAA2B,kBAACoI,EAAAuF,EACtErM,GAAqE,QAA5BkqB,EAAGxrB,EAAS8rB,wBAAgB,IAAAN,OAAA,EAAzBA,EAA2BO,4BAA0B3jB,EAAAuF,EACjGpM,GAA0EkqB,QAA5BA,EAAGzrB,EAAS8rB,wBAATL,IAAyBA,OAAzBA,EAAAA,EAA2B1B,iBAAe3hB,EAAAuF,EAC3FnM,GAAyC3C,EAAA,CACtC2rB,mBAAoBxqB,EAASwqB,4BAAkBkB,EAC5C1rB,EAAS8rB,wBAAgB,IAAAJ,OAAA,EAAzBA,EAA2BM,wBAAqB5jB,EAAAuF,EAEtDlM,GAAqC,CAClCjB,QAAkC,QAA3BmrB,EAAE3rB,EAAS8rB,wBAAgB,IAAAH,OAAA,EAAzBA,EAA2BM,aACpCtC,IAA8B,QAA3BiC,EAAE5rB,EAAS8rB,wBAAgB,IAAAF,OAAA,EAAzBA,EAA2BM,UAChCtC,QAAkCiC,QAA3BA,EAAE7rB,EAAS8rB,wBAATD,IAAyBA,OAAzBA,EAAAA,EAA2BM,gBACvCxe,IAIT,IAAMye,EAA8C,QAA5BhB,EAAGprB,EAAS8rB,wBAAgB,IAAAV,OAAA,EAAzBA,EAA2BiB,WACtD/3B,KAAK20B,YAAcn6B,EAAWs9B,GAAsB,KAAO/Q,WAAW+Q,GAEtE,IAKyCE,EALnCC,EAAmD,QAA5BlB,EAAGrrB,EAAS8rB,wBAAgB,IAAAT,OAAA,EAAzBA,EAA2BmB,6BAC3Dl4B,KAAKm4B,iBAAmB99B,EAAa49B,GAA2B,KAAOA,EAEvEj4B,KAAKo2B,aAAuC,QAAzBY,EAAAtrB,EAAS8rB,wBAATR,IAAyBA,OAAzBA,EAAAA,EAA2BoB,aAAc,KAE/BnB,QAA7BA,EAAIvrB,EAAS8rB,wBAATP,IAAyBA,GAAzBA,EAA2BoB,YAC3Br4B,KAAKo0B,UAAqC4D,QAA5BA,EAAGtsB,EAAS8rB,wBAATQ,IAAyBA,OAAzBA,EAAAA,EAA2BK,UAShD,GANI59B,EAAUuF,KAAK20B,cACf30B,KAAKy0B,eAAe6D,aAAY,SAAC7B,GAC7BplB,EAAKknB,qBAAqB9B,EAC9B,KAGCj8B,EAAWwF,KAAKo2B,aAAc,CAAA,IAAAoC,EAAAC,EACzBL,EAAa99B,EAAU0F,KAAKo2B,aAAep2B,KAAKo2B,oBAAWoC,EAAGx4B,KAAKo2B,mBAAW,IAAAoC,OAAA,EAAhBA,EAAkBve,KAChFye,EAAgBp+B,EAAU0F,KAAKo2B,aAAe,aAAIqC,EAAGz4B,KAAKo2B,mBAAW,IAAAqC,OAAA,EAAhBA,EAAkBE,QAC7E34B,KAAKuO,SAASqqB,gBAAe,SAACC,EAAQC,GAClC,IAAMC,EAAgB3+B,EAAU0+B,IAAaV,KAAcU,EACrDE,EAAoBN,EAAgBI,EAASV,KAAgBM,EAAgBK,EAC/EC,GACAj9B,EAAOa,KAAKd,GAAgB,uBAAwB,CAChDs8B,WAAAA,EACAM,cAAAA,IAGRrnB,EAAKglB,gBAAkB2C,CAC3B,GACJ,CAEAh5B,KAAKs0B,gBAAiB,EACtBt0B,KAAKi5B,yBACT,GAAC,CAAAj6B,IAAA,MAAAH,MAED,SAAIq6B,GAA0D,IAAAC,EAAzCl9B,EAA+BK,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,MACrB68B,QAA9BA,EAAAn5B,KAAKuO,SAASipB,wBAAd2B,IAA8BA,GAA9BA,EAAgCC,YAAY,CACxCh2B,KAAM,EACN/B,KAAM,CACFg4B,OAAQ,kBACRvK,QAAS,CACL7yB,MAAAA,EACAq9B,MAAO,GAEPxK,QAAS,CAACzY,KAAKC,UAAU4iB,MAGjC3sB,UAAW7M,MAEnB,GAAC,CAAAV,IAAA,gBAAAH,MACD,WAAwB,IAAAsU,EAAAnT,KACpB,IAAI3F,EAAaZ,OAAO8/B,WAapBv5B,KAAKm0B,iBAAmBn0B,KAAKuO,SAASM,OAAOqmB,2BAA6BtC,GAAa5yB,KAAKuO,WAAhG,CAIAvO,KAAKm0B,iBAAkB,EAEvBn0B,KAAKy0B,eAAeO,gCAEpB,IAAMwE,EAAuC,OAA1Bx5B,KAAKy5B,iBAA4B,iBAAmB,cAKnEz5B,KAAKuO,SAASmrB,4BAA8B15B,KAAKy5B,iBACjDz1B,GACIhE,KAAKuO,SAASwI,cAAcC,YAAY,SAAQra,WAAAA,OAAa68B,EAAU,OAAA78B,OAAMzD,EAAOE,eACpF,SAAC0F,GACG,GAAIA,EACA,OAAO/C,EAAOmB,MAAMpB,GAAa,mBAAAa,OAAsB68B,GAAc16B,GAGzEqU,EAAKwmB,iBACT,IAGJ35B,KAAK25B,iBAvBT,CAyBJ,GAAC,CAAA36B,IAAA,sBAAAH,MAED,SAA4BiE,GAAsB,IAAA82B,EAC9C,OJzauC,IIyahC92B,EAAMM,OAA4F,IAAhDiwB,GAAe/3B,QAAkBs+B,QAAXA,EAAC92B,EAAMzB,YAANu4B,IAAUA,OAAVA,EAAAA,EAAY16B,OAChG,GAAC,CAAAF,IAAA,6BAAAH,MAED,SAAmCiE,GAK/B,IAAM+2B,EAAoB75B,KAAK85B,oBAAoBh3B,GAE9C+2B,GAAsB75B,KAAK+5B,QAExBj3B,EAAMyJ,UAAYvM,KAAKg6B,uBAAyB5G,KAChDpzB,KAAK+5B,QAAS,EACd/5B,KAAKw0B,mBAAmB,cAAe,CACnCyF,OAAQ,kBACRC,oBAAqBp3B,EAAMyJ,UAAYvM,KAAKg6B,uBAC5CG,UAAW/G,MAKvB,IAAIgH,GAAoB,EAcxB,GAbIP,IACA75B,KAAKg6B,uBAAyBl3B,EAAMyJ,UAChCvM,KAAK+5B,SAEL/5B,KAAK+5B,QAAS,EACd/5B,KAAKw0B,mBAAmB,sBAAuB,CAC3CyF,OAAQ,gBACR72B,KAAMN,EAAMM,OAEhBg3B,GAAoB,KAIxBp6B,KAAK+5B,OAAT,CAKA,IAAAM,EAAgCr6B,KAAKy0B,eAAeO,+BAC/C6E,EACD/2B,EAAMyJ,WAFF+tB,EAAQD,EAARC,SAAU7D,EAAS4D,EAAT5D,UAKZE,EAAmB32B,KAAKy2B,YAAcA,EACtC8D,EAAkBv6B,KAAKs6B,WAAaA,EAE1Ct6B,KAAKs6B,SAAWA,EAChBt6B,KAAKy2B,UAAYA,GAGb2D,IACsE,IAArE,CAAC9O,GAA0BC,IAAiBjwB,QAAQwH,EAAMM,QACtDm3B,GAAmB5D,KAExB32B,KAAKw6B,sBAnBT,CAqBJ,GAAC,CAAAx7B,IAAA,kBAAAH,MAED,SAAwB47B,GACpB,IAEI,OADAA,EAAiB1G,eACV,CACV,CAAC,MAAOh1B,GASL,OAPAhD,EAAOgB,KAAKjB,GAAgB,sCAAuCiD,GACnEiB,KAAK06B,kBAAkBn+B,OAAS,IAC5ByD,KAAK06B,kBAAkBx5B,KAAK,CACxB8yB,WAAYyG,EAAiBzG,YAAcr0B,KAAKC,MAChDq0B,QAASwG,EAAiBxG,UAC1BF,YAAa0G,EAAiB1G,eAE/B,CACX,CACJ,GAAC,CAAA/0B,IAAA,qBAAAH,MAED,SAA2B0H,EAAauoB,GAAuB,IAAAlV,EAAA5Z,KAC3D,OAAOA,KAAK26B,gBAAgB7G,IAAe,WAAA,OAAMla,EAAKghB,YAAaC,eAAet0B,EAAKuoB,EAAQ,IACnG,GAAC,CAAA9vB,IAAA,uBAAAH,MAED,WAAwC,IAAAi8B,EAAA96B,KACpC,OAAOA,KAAK26B,gBAAgB7G,IAAe,WAAA,OAAMgH,EAAKF,YAAaG,kBAAkB,IACzF,GAAC,CAAA/7B,IAAA,kBAAAH,MAED,WAA0B,IAAAm8B,EAAAC,EAAAj7B,KAEhBk7B,EAAwD,CAG1DC,WAAY,gBACZC,mBAAergC,EACfsgC,YAAa,kBACbC,cAAe,UACfC,sBAAkBxgC,EAClBygC,gBAAYzgC,EACZ0gC,eAAe,EACfC,iBAAkB,CAAE,EACpBC,iBAAa5gC,EACb6gC,eAAgB,CAAE,EAClBC,cAAc,EACdC,kBAAkB,EAClBC,0BAA0B,GAM9B/7B,KAAK46B,YAAc9/B,EAAO2wB,MAAQ3wB,EAAO2wB,MAAMuQ,OAASlhC,EAAO8/B,YAI/D,IADA,IAAMqB,EAA8Bj8B,KAAKuO,SAASM,OAAO8gB,kBACzDuM,IAAAC,EAA2B1iC,OAAO+E,QAAQy9B,GAA+B,CAAA,GAAGC,EAAAC,EAAA5/B,OAAA2/B,IAAE,CAAzE,IAAAE,EAAArxB,EAAAoxB,EAAAD,GAAA,GAAOl9B,EAAGo9B,EAAA,GAAEv9B,EAAKu9B,EAAA,GACdp9B,KAAOk8B,IAGPA,EAAwBl8B,GAAOH,EAEvC,CAQA,GANImB,KAAKq8B,iBAAmBr8B,KAAKq8B,gBAAgBnwB,UAC7CgvB,EAAwBvD,cAAe,EACvCuD,EAAwBoB,SAAW,CAAEC,OAAQv8B,KAAKq8B,gBAAgBhH,KAClE6F,EAAwBsB,eAAiB,CAAEp5B,KAAM,aAAckyB,QAASt1B,KAAKq8B,gBAAgB/G,UAG5Ft1B,KAAK46B,YAAV,CAQA56B,KAAKy8B,oBACuB,QADJzB,EACpBh7B,KAAKy8B,2BAAmBzB,IAAAA,EAAAA,EACxB,IAAIxP,GAAoBxrB,KAAK46B,YAAa,CACtChN,cAAe,SAAC3kB,EAAI8iB,GAChB,IAAMmN,EAAO,+BAAAv8B,OAAkCsM,EAA8E,8EAC7HlN,EAAOa,KAAKs8B,EAAS,CACjBnN,KAAMA,IAGVkP,EAAKyB,IAAI5gC,GAAgB,IAAMo9B,EAAS,OAC5C,IAMRl5B,KAAK28B,wBAEL,IAAMC,EAAgB58B,KAAK68B,sBAC3B78B,KAAKq0B,UAAYr0B,KAAK46B,YAAWrwB,EAAA,CAC7BuyB,KAAM,SAACh6B,GACHm4B,EAAK7B,YAAYt2B,EACpB,EACDi6B,QAASH,GACN1B,IAKPl7B,KAAKuO,SAASyuB,iBAAgB,SAAC1rB,GAG3B,IACI,GAAkB,cAAdA,EAA2B,CAC3B,IAAMlK,EAAOtM,EAASmgC,EAAKgC,SAASniC,EAAOW,SAAS2L,MAAQ,GAC5D,IAAKA,EACD,OAEJ6zB,EAAKzG,mBAAmB,YAAa,CAAEptB,KAAAA,IACvC6zB,EAAKT,sBACT,CACH,CAAC,MAAOz7B,GACLhD,EAAOmB,MAAM,2CAA4C6B,EAC7D,CACJ,IAGAiB,KAAKg6B,uBAAyBr6B,KAAKC,MACnCI,KAAK+5B,QAAS,EAEd/5B,KAAKw0B,mBAAmB,mBAAoB,CACxC0G,wBAAAA,EACA0B,cAAeA,EAAchzB,KAAI,SAAC1J,GAAC,OAAKA,aAAAA,EAAAA,EAAG8I,IAAI,MAGnDhJ,KAAKw0B,mBAAmB,kBAAmB,CACvC3lB,OAAQ7O,KAAKuO,SAASM,QA1D1B,MALI9S,EAAOmB,MACHpB,GACI,uGA+DhB,GAAC,CAAAkD,IAAA,wBAAAH,MAED,WAAsC,IAAAq+B,EAAAl9B,KAC9BA,KAAKm9B,oBACLC,cAAcp9B,KAAKm9B,oBAGvBn9B,KAAKm9B,mBAAqBrP,aAAY,WAClCoP,EAAK1C,sBACR,GAAErH,GACP,GAAC,CAAAn0B,IAAA,sBAAAH,MAED,WACI,IAAMk+B,EAAmC,IAErClhC,EAAiBwhC,oBAAsBr9B,KAAKs9B,4BAC5CP,EAAQ77B,KAAKrF,EAAiBwhC,mBAAmBE,0BAGjDv9B,KAAK03B,uBAAyBx9B,EAAY2B,EAAiB2hC,4BR5jB5D5c,GAAazX,SAAS1N,SAASiiB,WQ6jBa1d,KAAKy9B,mCAG5CV,EAAQ77B,KACJrF,EAAiB2hC,uBACbjO,GAA2BvvB,KAAKuO,SAASM,OAAQ7O,KAAK03B,yBAI9D37B,EAAOa,KAAKd,GAAgB,6DAIpC,OAAOihC,CACX,GAAC,CAAA/9B,IAAA,cAAAH,MAED,SAAY6+B,GAGR,GAFA19B,KAAK29B,uBAEAD,GAAatjC,EAAUsjC,GAA5B,CAIA,GAAIA,EAASt6B,OAAS4qB,GAAU4P,KAAM,CAClC,IAAMx2B,EAAOpH,KAAKi9B,SAASS,EAASr8B,KAAK+F,MACzC,IAAKA,EACD,OAEJs2B,EAASr8B,KAAK+F,KAAOA,CACzB,CAEIs2B,EAASt6B,OAAS4qB,GAAU6P,cAE5B79B,KAAK28B,wBAGT,IAAMmB,EAAiB99B,KAAKy8B,oBACtBz8B,KAAKy8B,oBAAoBsB,kBAAkBL,GAC3CA,EAEN,GAAKI,EAAL,CAKA,IAAMh7B,EJzlBP,SAAkCk7B,GACrC,IAAMl7B,EAAQk7B,EAKd,GACIl7B,GACA1I,EAAU0I,IAzFe,IA0FzBA,EAAMM,MACNhJ,EAAU0I,EAAMzB,OAhBe,oBAiB/ByB,EAAMzB,KAAKg4B,OACb,CAEMv2B,EAAMzB,KAAKytB,QAAQA,QAAQvyB,OAVP,KAWpBuG,EAAMzB,KAAKytB,QAAQA,QAAUhsB,EAAMzB,KAAKytB,QAAQA,QAAQpuB,MAAM,EAX1C,IAYpBoC,EAAMzB,KAAKytB,QAAQA,QAAQ5tB,KAAK,mBAGpC,IADA,IAAM+8B,EAAiB,GACd//B,EAAI,EAAGA,EAAI4E,EAAMzB,KAAKytB,QAAQA,QAAQvyB,OAAQ2B,IAE/C4E,EAAMzB,KAAKytB,QAAQA,QAAQ5wB,IAC3B4E,EAAMzB,KAAKytB,QAAQA,QAAQ5wB,GAAG3B,OAnBlB,IAqBZ0hC,EAAe/8B,KAAK4B,EAAMzB,KAAKytB,QAAQA,QAAQ5wB,GAAGwC,MAAM,EArB5C,KAqBkE,kBAE9Eu9B,EAAe/8B,KAAK4B,EAAMzB,KAAKytB,QAAQA,QAAQ5wB,IAKvD,OAFA4E,EAAMzB,KAAKytB,QAAQA,QAAUmP,EAEtBD,CACX,CACA,OAAOA,CACX,CIujBsBE,CAAyBJ,GACjC1O,EAAO/Y,KAAKC,UAAUxT,GAAOvG,OAKnC,GAHAyD,KAAKm+B,2BAA2Br7B,IAG5B9C,KAAK+5B,QAAUj3B,EAAMM,OAAS4qB,GAAUoQ,OAA5C,CAKA,IAAM9jB,EAAa,CACf+jB,gBAAiBjP,EACjBkP,eAAgBx7B,EAChBy7B,YAAav+B,KAAKy2B,UAClB+H,WAAYx+B,KAAKs6B,UAGD,aAAhBt6B,KAAKy+B,OACLz+B,KAAK0+B,yBAAyBpkB,GAE9Bta,KAAK00B,aAZT,CAZA,CArBA,CA+CJ,GAAC,CAAA11B,IAAA,uBAAAH,MAED,WAA+B,IAAA8/B,EAAA3+B,KAC3B,GAAIA,KAAK06B,kBAAkBn+B,OAAQ,CAW/B,IAAMqiC,EAAcC,EAAO7+B,KAAK06B,mBAChC16B,KAAK06B,kBAAoB,GACzBkE,EAAexjC,SAAQ,SAACq/B,GAChB96B,KAAKC,MAAQ66B,EAAiBzG,WA9rB9B,IA+rBA2K,EAAKnK,mBAAmB,oBAAqB,CACzCR,WAAYyG,EAAiBzG,WAC7BC,QAASwG,EAAiBxG,QAC1B6K,YAAaF,EAAeriC,SAG5BoiC,EAAKhE,gBAAgBF,IACrBkE,EAAKnK,mBAAmB,oBAAqB,CACzCR,WAAYyG,EAAiBzG,WAC7BC,QAASwG,EAAiBxG,QAC1B6K,YAAaF,EAAeriC,QAI5C,GACJ,CACJ,GAAC,CAAAyC,IAAA,WAAAH,MAED,SAAiBsI,GACb,IAAM80B,EAA8Bj8B,KAAKuO,SAASM,OAAO8gB,kBAEzD,GAAIsM,EAA4BrL,qBAAsB,CAAA,IAAAmO,EAC9CC,EAAoD,CACpD73B,IAAAA,GAOJ,OAAqB,QAArB43B,EAFAC,EAAiB/C,EAA4BrL,qBAAqBoO,UAE3DD,IAAcA,OAAdA,EAAAA,EAAgB53B,GAC3B,CAEA,OAAOA,CACX,GAAC,CAAAnI,IAAA,cAAAH,MAED,WAGI,OAFAmB,KAAK4c,YAAS7hB,EAEP,CACHq0B,KAAM,EACN/tB,KAAM,GACNo1B,UAAWz2B,KAAKy2B,UAChB6D,SAAUt6B,KAAKs6B,SAEvB,GAOA,CAAAt7B,IAAA,eAAAH,MACA,WAAuB,IAAAogC,EAAAj/B,KACfA,KAAKk/B,mBACLC,aAAan/B,KAAKk/B,kBAClBl/B,KAAKk/B,sBAAmBnkC,GAG5B,IAAMqkC,EAAkBp/B,KAAKm4B,iBACvBkH,EAAkBr/B,KAAKq/B,gBAGvBC,EAA4B7kC,EAAU4kC,IAAoBA,GAAmB,EAC7EE,EACF9kC,EAAU2kC,IAAoBE,GAA6BD,EAAkBD,EAEjF,MAAoB,cAAhBp/B,KAAKy+B,QAA0Bc,GAC/Bv/B,KAAKk/B,iBAAmBppB,YAAW,WAC/BmpB,EAAK1K,cACR,GAlwB2B,KAmwBrBv0B,KAAK4c,QAAU5c,KAAK00B,eAG3B10B,KAAK4c,QAAsC,IAA5B5c,KAAK4c,OAAOvb,KAAK9E,QAChCyD,KAAKw/B,iBAAiB,CAClBnB,gBAAiBr+B,KAAK4c,OAAOwS,KAC7BkP,eAAgBt+B,KAAK4c,OAAOvb,KAC5Bk9B,YAAav+B,KAAK4c,OAAO6Z,UACzB+H,WAAYx+B,KAAK4c,OAAO0d,WAGrBt6B,KAAK00B,eAEL10B,KAAK4c,QAAU5c,KAAK00B,aAEnC,GAAC,CAAA11B,IAAA,2BAAAH,MAED,SAAiCyb,GAAwB,IAAAmlB,EAAAC,EAAA1/B,KAC/C2/B,EAAkB,IAAgB,QAAXF,EAAAz/B,KAAK4c,cAAL6iB,IAAWA,OAAXA,EAAAA,EAAap+B,KAAK9E,SAAU,KAEpDyD,KAAK4c,QACN5c,KAAK4c,OAAOwS,KAAO9U,EAAW+jB,gBAAkBsB,EAzxBpB,UA0xBzB3/B,KAAK4c,OAAO6Z,WAAaz2B,KAAK4c,OAAO6Z,YAAcz2B,KAAKy2B,aAE3Dz2B,KAAK4c,OAAS5c,KAAKu0B,gBAGnBh6B,EAAQyF,KAAK4c,OAAO6Z,aAAel8B,EAAQyF,KAAKy2B,aAEhDz2B,KAAK4c,OAAO6Z,UAAYz2B,KAAKy2B,UAC7Bz2B,KAAK4c,OAAO0d,SAAWt6B,KAAKs6B,UAGhCt6B,KAAK4c,OAAOwS,MAAQ9U,EAAW+jB,gBAC/Br+B,KAAK4c,OAAOvb,KAAKH,KAAKoZ,EAAWgkB,gBAE5Bt+B,KAAKk/B,mBACNl/B,KAAKk/B,iBAAmBppB,YAAW,WAC/B4pB,EAAKnL,cACR,GA1yB2B,KA4yBpC,GAAC,CAAAv1B,IAAA,mBAAAH,MAED,SAAyByb,GAErBta,KAAKuO,SAASyE,QAAQ,YAAasH,EAAY,CAC3CrD,OAAQ,OACR2oB,KAAM5/B,KAAKuO,SAASwI,cAAcC,YAAY,MAAOhX,KAAKo0B,WAC1DyL,aAAa,EACbC,UAnzB+B,aAozB/BC,SAAU,CACNC,oBAAqB1lB,EAAWgkB,eAAel7B,OAASkoB,KAGpE,KAAC4I,CAAA,CArvBwB,GCvGhB+L,GAAM,WAGf,SAAAA,EAAY1xB,GAAmBpC,OAAA8zB,GAC3BjgC,KAAKuO,SAAWA,EAEhBvO,KAAKuO,SAAS6I,qBAAuBpX,KAAKuO,SAAS2xB,8BACvD,CA4GC,OA5GA7zB,EAAA4zB,EAAA,CAAA,CAAAjhC,IAAA,OAAAH,MAED,WAAa,IAAA6R,EAAA1Q,KAgBHoW,EAAehV,GAZHiV,KAAKC,UAAU,CAC7B1C,MAAO5T,KAAKuO,SAASM,OAAO+E,MAC5B2C,YAAavW,KAAKuO,SAASiI,kBAC3BC,OAAQzW,KAAKuO,SAASmI,YACtBC,kBAAmB3W,KAAKuO,SAAS+G,aAAa9H,IAC9CoJ,iBAAkB5W,KAAKuO,SAAS+G,aAAa7H,IAC7CoJ,cACI7W,KAAKuO,SAASM,OAAOmH,gCACrBhW,KAAKuO,SAASM,OAAOsxB,mDACrBplC,KAIRiF,KAAKuO,SAASuI,cACV9W,KAAKuO,SAASwI,cAAcC,YAAY,MAAO,gBAC/C,CAAE3V,KAAM+U,EAAcgqB,SAAS,GAC/B,CAAEnpB,OAAQ,SACV,SAACvL,GAAQ,OAAKgF,EAAK2vB,oBAAoB30B,EAA2B,GAE1E,GAAC,CAAA1M,IAAA,sBAAAH,MAED,SAAoB6M,GAAgC,IAAAytB,EAAA9nB,EAAArR,KAKhD,GAJAA,KAAKuO,SAASqG,aAAaqB,oBAAmB,GAE9CjW,KAAKuO,SAASqG,aAAac,oBAEF,KAArBhK,aAAQ,EAARA,EAAU+yB,QAAd,CAIA,IAAMjjC,IAAYA,EAASsJ,KAKvB,OAJA/I,EAAOa,KAAK,oEACZkZ,YAAW,WACPzE,EAAKgvB,oBAAoB30B,EAC5B,GAAE,KAIP1L,KAAKuO,SAAS+xB,QAAQ3sB,oBAAoBjI,GACZ,QAA9BytB,EAAAn5B,KAAKuO,SAASipB,wBAAgB,IAAA2B,GAA9BA,EAAgCxlB,oBAAoBjI,GACpDwC,GAAYyF,oBAAoBjI,EAAU1L,KAAKuO,UAC/CvO,KAAKuO,SAASgyB,qBAAqB70B,GAG9B1L,KAAKuO,SAASM,OAAOsxB,8CACrBngC,KAAKuO,SAASM,OAAOmH,gCAEtBhW,KAAKuO,SAASqG,aAAasC,qBAAqBxL,GAKpD,IAAM80B,EAAmB1lC,aAAAA,EAAAA,EAAQ2lC,yBAE7B/0B,EAAkB,UAAM80B,GACxBx8B,GAAWhE,KAAKuO,SAASwI,cAAcC,YAAY,SAAU,uBAAuB,SAAClY,GACjF,GAAIA,EACA,OAAO/C,EAAOmB,MAAK,gCAAkC4B,GAKzDhE,EAAO2lC,yBAAyBpvB,EAAK9C,SACzC,IAKJ,IAAMmyB,EAAoC5lC,aAAAA,EAAAA,EAAQ6lC,sCAiBlD,GAfIj1B,EAAgC,uBAC9BA,EAAgC,uBAClCrR,EAAaqmC,IAEb18B,GAAWhE,KAAKuO,SAASwI,cAAcC,YAAY,SAAU,qCAAqC,SAAClY,GAC/F,GAAIA,EACA,OAAO/C,EAAOmB,MAAK,8CAAgD4B,GAKvEhE,EAAO8lC,sCAAsCvvB,EAAK9C,SAAU7C,EAChE,IAGAA,EAAmB,SACnB,GAAI1L,KAAKuO,SAASM,OAAOgyB,iBAAkB,CAAA,IACOxiC,EADPC,EAAAC,EACbmN,EAAmB,UAAC,IAAA,IAAAvD,aAAA,IAAA2M,EAAAzW,EAAAQ,MAAjCoK,EAAE6L,EAAF7L,GAAI9B,EAAG2N,EAAH3N,IACP25B,EAAYzvB,EAAK9C,SAASwI,cAAcC,YAAY,MAAO7P,GAEjEtL,EAAgB,mBAAAc,OAAoBsM,IAAQoI,EAAK9C,SAEjDvK,GAAW88B,GAAW,SAAChiC,GACfA,GACA/C,EAAOmB,MAAKP,uDAAAA,OAAwDsM,GAAMnK,EAElF,GAAE,EATN,IAAAR,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAgDwJ,GAU/C,CAAA,MAAArJ,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACJ,MAAUuR,EAAmB,SAAEnP,OAAS,GACrCR,EAAOmB,MAAM,mFAtErB,MAFInB,EAAOmB,MAAM,8CA2ErB,KAAC+iC,CAAA,CAnHc,iBCDbc,GAAoBjmC,SAAAA,EAAQW,SAC5BsmB,GAAcjnB,EAAOW,SAASumB,KAAM,cAAgBD,GAActmB,SAASumB,KAAM,SACjF,KAEOgf,GAAO,WAEhB,SAAAA,EAAYzyB,GAAmBpC,OAAA60B,GAC3BhhC,KAAKuO,SAAWA,CACpB,CAgKC,OAhKAlC,EAAA20B,EAAA,CAAA,CAAAhiC,IAAA,sBAAAH,MAED,SAAoB6M,GAChB,IAAMu1B,EACFv1B,EAAwB,eACxBA,EAAuB,eACtBA,EAAyB,eAAI,CAAEw1B,eAAgBx1B,EAAyB,gBAAM,CAAE,GAEjFA,EAA0B,iBAC1Bu1B,EAA8B,gBACyB,IAAvDA,EAA8B,eAAE3lC,QAAQ,YAExC0E,KAAKmhC,YAAW52B,EACT02B,CAAAA,EAAAA,GAGf,GAEA,CAAAjiC,IAAA,mBAAAH,MAKA,WAIW,IAAAuiC,EAAAC,EAHP5lC,EAA8Ba,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EACjCglB,EAAiCzjB,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EACpCumC,EAA4BhlC,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EAE/B,IAAKD,IAAWU,EACZ,OAAO,EAEXC,EAAmB,QAAX2lC,EAAG3lC,SAAQ,IAAA2lC,EAAAA,EAAItmC,EAAOW,SAC9B6lC,EAAiB,QAAVD,EAAGC,SAAO,IAAAD,EAAAA,EAAIvmC,EAAOwmC,QAE5B,IAEI,IAAKvhB,EAAc,CACf,IACIjlB,EAAOilB,aAAaE,QAAQ,OAAQ,QACpCnlB,EAAOilB,aAAaG,WAAW,OAClC,CAAC,MAAOhjB,GACL,OAAO,CACX,CAGA6iB,EAAejlB,aAAAA,EAAAA,EAAQilB,YAC3B,CAUA,IAGIkhB,EAHEM,EACFR,IAAqBhf,GAActmB,EAASumB,KAAM,cAAgBD,GAActmB,EAASumB,KAAM,SAG7FqJ,EAAQkW,EACR1hC,IAAK,WAAA,OAAMwW,KAAK0I,MAAMyiB,KAAK1iB,mBAAmByiB,SAC9C1hC,IAAK,WAAA,OAAMwW,KAAK0I,MAAMD,mBAAmByiB,GAAW,IACpD,KA6BN,OA3BqBlW,GAA6B,iBAApBA,EAAc,SAIxC4V,EAAgB5V,GACFnsB,OAAS,MAEnB+hC,GAAiBxnC,OAAO+F,KAAKyhC,GAAe1kC,OAAS,IACjD8uB,EAAmB,YAEnB5vB,EAASumB,KAAOqJ,EAAmB,YAC5BiW,EACPA,EAAQG,aAAa,GAAIjmC,EAASkmC,MAAOjmC,EAAS6sB,SAAW7sB,EAASgrB,QAEtEhrB,EAASumB,KAAO,OAKxBif,EAAgB5qB,KAAK0I,MAAMgB,EAAaC,QAAQ,0BAA4B,OAC9D9gB,OAAS,sBAIhB+hC,EAAcU,eAGrBV,EAAqB,OAAKjhC,KAAKuO,SAASM,OAAO+E,QAAUqtB,EAAqB,SAC9EjhC,KAAKmhC,YAAYF,IACV,EAId,CAAC,MAAOliC,GACL,OAAO,CACX,CACJ,GAAC,CAAAC,IAAA,cAAAH,MAED,SAAYsnB,GAAiC,IAAAzV,EAAA1Q,KACzC,IAAKlF,GAAUe,EAAwC,sBACnD,OAAO,EAGXA,EAAwC,uBAAI,EAI5C,IAAM+lC,EAAsB,IAEtBC,EAAgCp1B,KAAKoO,MAAMlb,KAAKC,MAAQgiC,GAAuBA,EAC/EE,EAAa9hC,KAAKuO,SAASwI,cAAcC,YAC3C,SAAQra,wBAAAA,OACgBklC,IAEtBE,EACqC,WAAvC/hC,KAAKuO,SAASwI,cAAcirB,QAAuBhiC,KAAKuO,SAASM,OAAOozB,iCAEtEhB,EAAa12B,EAAAA,EAAA,CACfqJ,MAAO5T,KAAKuO,SAASM,OAAO+E,OACzBuS,GAAM,GAAA,CACT+b,OAAQliC,KAAKuO,SAASwI,cAAcC,YAAY,OAC5C+qB,EAAwB,CAAEI,YAAY,GAAU,CAAE,GAGTlB,EAAzC/hC,OAAqBkjC,IAAAA,EAAeC,EAAKpB,EAAaqB,IAgB9D,OAfAxnC,EAAOilB,aAAaE,QAAQ,wBAAyB5J,KAAKC,UAAU8rB,IAEpEp+B,GAAW89B,GAAY,SAAChjC,GAChBA,EACA/C,EAAOmB,MAAM,yBAA0B4B,IAGzCjD,EAAkC,iBAAKA,EAAiC,gBAAGolC,EAAevwB,EAAKnC,SACrG,IAGA3L,GAAgB9H,EAAQ,mBAAmB,WACvCe,EAAwC,uBAAI,EAC5C6U,EAAKywB,YAAYF,EACrB,KACO,CACX,GAEA,CAAAjiC,IAAA,cAAAH,MACA,SAAYsnB,GACR,OAAOnmB,KAAKmhC,YAAYhb,EAC5B,GAEA,CAAAnnB,IAAA,kBAAAH,MACA,WAIW,IAHPpD,EAA8Ba,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EACjCglB,EAAiCzjB,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EACpCumC,EAA4BhlC,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,QAAGvB,EAE/B,OAAOiF,KAAKuiC,iBAAiB9mC,EAAUskB,EAAcuhB,EACzD,KAACN,CAAA,CApKe,GCbPwB,GAAoB,WAO7B,SAAAA,IAAiC,IAArBC,EAAYnmC,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,IAAI6P,OAAAq2B,GAC3BxiC,KAAK0iC,WAAY,EACjB1iC,KAAK2iC,aAAe,GACpB3iC,KAAK4iC,mBAAqB,EAC1B5iC,KAAK6iC,aAAU9nC,EACfiF,KAAK8iC,cAAgBL,CACzB,CAyBC,OAzBAp2B,EAAAm2B,EAAA,CAAA,CAAAxjC,IAAA,kBAAAH,MAED,SAAgBkkC,GACZ/iC,KAAK8iC,cAAgBC,EAEjB/iC,KAAK0iC,WACL1iC,KAAKgjC,MAEb,GAKA,CAAAhkC,IAAA,OAAAH,MAEA,WAEA,GAAC,CAAAG,IAAA,SAAAH,MAED,WAEA,GAAC,CAAAG,IAAA,UAAAH,MAED,WACI,OAAO,IAAIc,MAAOkS,SACtB,KAAC2wB,CAAA,CAtC4B,GCMpBS,YAAYC,GAAAC,EAAAF,EAAAC,GAAA,IAAAE,EAAAC,EAAAJ,GAGrB,SAAAA,EAAYK,GAAuG,IAAA5yB,EAArB+xB,EAAYnmC,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,IAE/D,OAFmE6P,OAAA82B,IAC7GvyB,EAAA0yB,EAAArpC,UAAM0oC,IACDa,kBAAoBA,EAAiB5yB,CAC9C,CAsFC,OAtFArE,EAAA42B,EAAA,CAAA,CAAAjkC,IAAA,UAAAH,MAED,SAAQsI,EAAa9F,EAAkB8V,GACnCnX,KAAK2iC,aAAazhC,KAAK,CAAEiG,IAAAA,EAAK9F,KAAAA,EAAM8V,QAAAA,IAE/BnX,KAAK0iC,YACN1iC,KAAK0iC,WAAY,EACjB1iC,KAAKgjC,OAEb,GAAC,CAAAhkC,IAAA,OAAAH,MAED,WAAa,IAAAwS,EAAArR,KACTm/B,aAAan/B,KAAK6iC,SAClB7iC,KAAK6iC,QAAU/sB,YAAW,WACtB,GAAIzE,EAAKsxB,aAAapmC,OAAS,EAAG,CAC9B,IAAMgnC,EAAWlyB,EAAKmyB,cAAar7B,EAAAA,SACxBnJ,GACP,IAAAykC,EAA+BF,EAASvkC,GAAhCmI,EAAGs8B,EAAHt8B,IAAK9F,EAAIoiC,EAAJpiC,KAAM8V,EAAOssB,EAAPtsB,QACnB/Y,EAAMiD,GAAM,SAACmkB,EAAGke,GACZriC,EAAKqiC,GAAiB,OAAIj3B,KAAKC,IAAIrL,EAAKqiC,GAAoB,UAAIryB,EAAKQ,kBAC9DxQ,EAAKqiC,GAAoB,SACpC,IACAryB,EAAKiyB,kBAAkBn8B,EAAK9F,EAAM8V,EAAQ,EAN9C,IAAK,IAAMnY,KAAOukC,EAAUp7B,EAAjBnJ,GAQXqS,EAAKsxB,aAAapmC,OAAS,EAC3B8U,EAAKuxB,mBAAqB,CAC9B,MACIvxB,EAAKuxB,qBAWLvxB,EAAKuxB,mBAAqB,IAC1BvxB,EAAKqxB,WAAY,EACjBrxB,EAAKuxB,mBAAqB,GAE1BvxB,EAAKqxB,WACLrxB,EAAK2xB,MAEb,GAAGhjC,KAAK8iC,cACZ,GAAC,CAAA9jC,IAAA,SAAAH,MAED,WAAe,IAAAsU,EAAAnT,KACXm/B,aAAan/B,KAAK6iC,SAClB,IAAMU,EAAWvjC,KAAK2iC,aAAapmC,OAAS,EAAIyD,KAAKwjC,cAAgB,GACrExjC,KAAK2iC,aAAapmC,OAAS,EAC3B,IAAMonC,EAAgBlqC,OAAOmqC,OAAOL,GAGhB5mC,GAAAA,OAAAkiC,EACb8E,EAAcl+B,QAAO,SAACo+B,GAAC,OAA6B,IAAxBA,EAAE18B,IAAI7L,QAAQ,KAAY,KAAAujC,EACtD8E,EAAcl+B,QAAO,SAACo+B,GAAC,OAA6B,IAAxBA,EAAE18B,IAAI7L,QAAQ,KAAW,MAE7CsO,KAAI,SAAAgB,GAA4B,IAAzBzD,EAAGyD,EAAHzD,IAAK9F,EAAIuJ,EAAJvJ,KAAM8V,EAAOvM,EAAPuM,QAC7BhE,EAAKmwB,kBAAkBn8B,EAAK9F,EAAIkJ,EAAAA,EAAA,CAAA,EAAO4M,GAAO,GAAA,CAAE2sB,UAAW,eAC/D,GACJ,GAAC,CAAA9kC,IAAA,cAAAH,MAED,WACI,IAAM0kC,EAA8C,CAAA,EAoBpD,OAnBAnlC,EAAM4B,KAAK2iC,cAAc,SAACoB,GACtB,IAAQ58B,EAAuB48B,EAAvB58B,IAAK9F,EAAkB0iC,EAAlB1iC,KAAM8V,EAAY4sB,EAAZ5sB,QACbnY,GAAOmY,EAAUA,EAAQ2oB,UAAY,OAAS34B,EAChD9M,EAAakpC,EAASvkC,MACtBukC,EAASvkC,GAAO,CAAEqC,KAAM,GAAI8F,IAAAA,EAAKgQ,QAAAA,IAKjCA,GACAosB,EAASvkC,GAAKmY,SACdosB,EAASvkC,GAAKmY,QAAQ4oB,WACpBwD,EAASvkC,GAAKmY,QAAQ4oB,SAAsC,sBAE5DwD,EAASvkC,GAAKmY,QAAQ4oB,SAAsC,oBAC1D5oB,EAAQ4oB,SAA8B,qBAE9CwD,EAASvkC,GAAKqC,KAAKH,KAAKG,EAC5B,IACOkiC,CACX,KAACN,CAAA,EA5F6BT,ICc9BwB,GAAKjoB,WAAYkoB,GAAMC,YAAaC,GAAMnnB,YAE1ConB,GAAO,IAAIJ,GAAG,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAgB,EAAG,EAAoB,IAG1IK,GAAO,IAAIL,GAAG,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAiB,EAAG,IAEjIM,GAAO,IAAIN,GAAG,CAAC,GAAI,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,KAE7EO,GAAO,SAAUC,EAAIpiC,GAErB,IADA,IAAI4I,EAAI,IAAIi5B,GAAI,IACP/lC,EAAI,EAAGA,EAAI,KAAMA,EACtB8M,EAAE9M,GAAKkE,GAAS,GAAKoiC,EAAGtmC,EAAI,GAGhC,IAAI2lC,EAAI,IAAIM,GAAIn5B,EAAE,KAClB,IAAS9M,EAAI,EAAGA,EAAI,KAAMA,EACtB,IAAK,IAAIumC,EAAIz5B,EAAE9M,GAAIumC,EAAIz5B,EAAE9M,EAAI,KAAMumC,EAC/BZ,EAAEY,GAAOA,EAAIz5B,EAAE9M,IAAO,EAAKA,EAGnC,MAAO,CAAC8M,EAAG64B,EACf,EACIa,GAAKH,GAAKH,GAAM,GAAIO,GAAKD,GAAG,GAAIE,GAAQF,GAAG,GAE/CC,GAAG,IAAM,IAAKC,GAAM,KAAO,GAI3B,IAHIC,IAAgCC,GAA3BP,GAAKF,GAAM,GAA2B,GAE3CU,GAAM,IAAId,GAAI,OACT/lC,GAAI,EAAGA,GAAI,QAASA,GAAG,CAE5B,IAAIjE,IAAU,MAAJiE,MAAgB,GAAW,MAAJA,KAAe,EAEhDjE,IAAU,OADVA,IAAU,MAAJA,MAAgB,GAAW,MAAJA,KAAe,MACtB,GAAW,KAAJA,KAAe,EAC5C8qC,GAAI7mC,MAAY,MAAJjE,MAAgB,GAAW,IAAJA,KAAe,KAAQ,CAC9D,CAIA,IAAI+qC,GAAQ,SAAUC,EAAIC,EAAIrB,GAO1B,IANA,IAAIplC,EAAIwmC,EAAG1oC,OAEP2B,EAAI,EAEJC,EAAI,IAAI8lC,GAAIiB,GAEThnC,EAAIO,IAAKP,IACVC,EAAE8mC,EAAG/mC,GAAK,GAEhB,IAIIinC,EAJAC,EAAK,IAAInB,GAAIiB,GACjB,IAAKhnC,EAAI,EAAGA,EAAIgnC,IAAMhnC,EAClBknC,EAAGlnC,GAAMknC,EAAGlnC,EAAI,GAAKC,EAAED,EAAI,IAAO,EAGtC,GAAI2lC,EAAG,CAEHsB,EAAK,IAAIlB,GAAI,GAAKiB,GAElB,IAAIG,EAAM,GAAKH,EACf,IAAKhnC,EAAI,EAAGA,EAAIO,IAAKP,EAEjB,GAAI+mC,EAAG/mC,GAQH,IANA,IAAIonC,EAAMpnC,GAAK,EAAK+mC,EAAG/mC,GAEnBqnC,EAAML,EAAKD,EAAG/mC,GAEdkC,EAAIglC,EAAGH,EAAG/mC,GAAK,MAAQqnC,EAElBC,EAAIplC,GAAM,GAAKmlC,GAAO,EAAInlC,GAAKolC,IAAKplC,EAEzC+kC,EAAGJ,GAAI3kC,KAAOilC,GAAOC,CAIrC,MAGI,IADAH,EAAK,IAAIlB,GAAIxlC,GACRP,EAAI,EAAGA,EAAIO,IAAKP,EACjBinC,EAAGjnC,GAAK6mC,GAAIK,EAAGH,EAAG/mC,GAAK,QAAW,GAAK+mC,EAAG/mC,GAElD,OAAOinC,CACX,EAEIM,GAAM,IAAIzB,GAAG,KACjB,IAAS9lC,GAAI,EAAGA,GAAI,MAAOA,GACvBunC,GAAIvnC,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBunC,GAAIvnC,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBunC,GAAIvnC,IAAK,EACb,IAASA,GAAI,IAAKA,GAAI,MAAOA,GACzBunC,GAAIvnC,IAAK,EAEb,IAAIwnC,GAAM,IAAI1B,GAAG,IACjB,IAAS9lC,GAAI,EAAGA,GAAI,KAAMA,GACtBwnC,GAAIxnC,IAAK,EAETynC,ICwEQC,GDxERD,GAAoBX,GAAKS,GAAK,EAAG,GAEjCI,GAAoBb,GAAKU,GAAK,EAAG,GAqBjCI,GAAO,SAAU5lC,GAAK,OAASA,EAAI,GAAM,IAAU,EAAJA,GAAS,EAAI,EAG5D6lC,GAAM,SAAU3lC,EAAG3B,EAAGM,IACb,MAALN,GAAaA,EAAI,KACjBA,EAAI,IACC,MAALM,GAAaA,EAAIqB,EAAE7D,UACnBwC,EAAIqB,EAAE7D,QAEV,IAAImC,EAAI,IAAK0B,aAAa6jC,GAAMA,GAAM7jC,aAAa+jC,GAAMA,GAAMH,IAAIjlC,EAAIN,GAEvE,OADAC,EAAEsgB,IAAI5e,EAAE4lC,SAASvnC,EAAGM,IACbL,CACX,EA4KIunC,GAAQ,SAAU5V,EAAGnwB,EAAGE,GACxBA,IAAU,EAAJF,EACN,IAAIgmC,EAAKhmC,EAAI,GAAM,EACnBmwB,EAAE6V,IAAM9lC,EACRiwB,EAAE6V,EAAI,IAAM9lC,IAAM,CACtB,EAEI+lC,GAAU,SAAU9V,EAAGnwB,EAAGE,GAC1BA,IAAU,EAAJF,EACN,IAAIgmC,EAAKhmC,EAAI,GAAM,EACnBmwB,EAAE6V,IAAM9lC,EACRiwB,EAAE6V,EAAI,IAAM9lC,IAAM,EAClBiwB,EAAE6V,EAAI,IAAM9lC,IAAM,EACtB,EAEIgmC,GAAQ,SAAU/V,EAAG6U,GAGrB,IADA,IAAImB,EAAI,GACCnoC,EAAI,EAAGA,EAAImyB,EAAE9zB,SAAU2B,EACxBmyB,EAAEnyB,IACFmoC,EAAEnlC,KAAK,CAAEzC,EAAGP,EAAG/D,EAAGk2B,EAAEnyB,KAE5B,IAAIO,EAAI4nC,EAAE9pC,OACN+pC,EAAKD,EAAE3lC,QACX,IAAKjC,EACD,MAAO,CAAC,IAAIulC,GAAG,GAAI,GACvB,GAAS,GAALvlC,EAAQ,CACR,IAAI2B,EAAI,IAAI4jC,GAAGqC,EAAE,GAAG5nC,EAAI,GAExB,OADA2B,EAAEimC,EAAE,GAAG5nC,GAAK,EACL,CAAC2B,EAAG,EACf,CACAimC,EAAEn8B,MAAK,SAAUY,EAAGE,GAAK,OAAOF,EAAE3Q,EAAI6Q,EAAE7Q,CAAG,IAG3CksC,EAAEnlC,KAAK,CAAEzC,GAAI,EAAGtE,EAAG,QACnB,IAAIgE,EAAIkoC,EAAE,GAAIxC,EAAIwC,EAAE,GAAIE,EAAK,EAAGC,EAAK,EAAGC,EAAK,EAO7C,IANAJ,EAAE,GAAK,CAAE5nC,GAAI,EAAGtE,EAAGgE,EAAEhE,EAAI0pC,EAAE1pC,EAAGgE,EAAGA,EAAG0lC,EAAGA,GAMhC2C,GAAM/nC,EAAI,GACbN,EAAIkoC,EAAEA,EAAEE,GAAIpsC,EAAIksC,EAAEI,GAAItsC,EAAIosC,IAAOE,KACjC5C,EAAIwC,EAAEE,GAAMC,GAAMH,EAAEE,GAAIpsC,EAAIksC,EAAEI,GAAItsC,EAAIosC,IAAOE,KAC7CJ,EAAEG,KAAQ,CAAE/nC,GAAI,EAAGtE,EAAGgE,EAAEhE,EAAI0pC,EAAE1pC,EAAGgE,EAAGA,EAAG0lC,EAAGA,GAE9C,IAAI6C,EAASJ,EAAG,GAAG7nC,EACnB,IAASP,EAAI,EAAGA,EAAIO,IAAKP,EACjBooC,EAAGpoC,GAAGO,EAAIioC,IACVA,EAASJ,EAAGpoC,GAAGO,GAGvB,IAAIkoC,EAAK,IAAI1C,GAAIyC,EAAS,GAEtBE,EAAMC,GAAGR,EAAEG,EAAK,GAAIG,EAAI,GAC5B,GAAIC,EAAM1B,EAAI,CAINhnC,EAAI,EAAR,IAAW4oC,EAAK,EAEZC,EAAMH,EAAM1B,EAAI8B,EAAM,GAAKD,EAE/B,IADAT,EAAGp8B,MAAK,SAAUY,EAAGE,GAAK,OAAO27B,EAAG37B,EAAEvM,GAAKkoC,EAAG77B,EAAErM,IAAMqM,EAAE3Q,EAAI6Q,EAAE7Q,CAAG,IAC1D+D,EAAIO,IAAKP,EAAG,CACf,IAAI+oC,EAAOX,EAAGpoC,GAAGO,EACjB,KAAIkoC,EAAGM,GAAQ/B,GAKX,MAJA4B,GAAME,GAAO,GAAMJ,EAAMD,EAAGM,IAC5BN,EAAGM,GAAQ/B,CAInB,CAEA,IADA4B,KAAQC,EACDD,EAAK,GAAG,CACX,IAAII,EAAOZ,EAAGpoC,GAAGO,EACbkoC,EAAGO,GAAQhC,EACX4B,GAAM,GAAM5B,EAAKyB,EAAGO,KAAU,IAE5BhpC,CACV,CACA,KAAOA,GAAK,GAAK4oC,IAAM5oC,EAAG,CACtB,IAAIipC,EAAOb,EAAGpoC,GAAGO,EACbkoC,EAAGQ,IAASjC,MACVyB,EAAGQ,KACHL,EAEV,CACAF,EAAM1B,CACV,CACA,MAAO,CAAC,IAAIlB,GAAG2C,GAAKC,EACxB,EAEIC,GAAK,SAALA,EAAenoC,EAAGP,EAAGkyB,GACrB,OAAe,GAAR3xB,EAAED,EACHgO,KAAKihB,IAAImZ,EAAGnoC,EAAEP,EAAGA,EAAGkyB,EAAI,GAAIwW,EAAGnoC,EAAEmlC,EAAG1lC,EAAGkyB,EAAI,IAC1ClyB,EAAEO,EAAED,GAAK4xB,CACpB,EAEI+W,GAAK,SAAUz3B,GAGf,IAFA,IAAIlR,EAAIkR,EAAEpT,OAEHkC,IAAMkR,IAAIlR,KAMjB,IAJA,IAAI4oC,EAAK,IAAIpD,KAAMxlC,GAEf6oC,EAAM,EAAGC,EAAM53B,EAAE,GAAI63B,EAAM,EAC3BC,EAAI,SAAUrnC,GAAKinC,EAAGC,KAASlnC,GAC1BlC,EAAI,EAAGA,GAAKO,IAAKP,EACtB,GAAIyR,EAAEzR,IAAMqpC,GAAOrpC,GAAKO,IAClB+oC,MACD,CACD,IAAKD,GAAOC,EAAM,EAAG,CACjB,KAAOA,EAAM,IAAKA,GAAO,IACrBC,EAAE,OACFD,EAAM,IACNC,EAAED,EAAM,GAAOA,EAAM,IAAO,EAAK,MAAUA,EAAM,GAAM,EAAK,OAC5DA,EAAM,EAEd,MACK,GAAIA,EAAM,EAAG,CAEd,IADAC,EAAEF,KAAQC,EACHA,EAAM,EAAGA,GAAO,EACnBC,EAAE,MACFD,EAAM,IACNC,EAAID,EAAM,GAAM,EAAK,MAAOA,EAAM,EAC1C,CACA,KAAOA,KACHC,EAAEF,GACNC,EAAM,EACND,EAAM53B,EAAEzR,EACZ,CAEJ,MAAO,CAACmpC,EAAGrB,SAAS,EAAGsB,GAAM7oC,EACjC,EAEIipC,GAAO,SAAUC,EAAIN,GAErB,IADA,IAAIlpC,EAAI,EACCD,EAAI,EAAGA,EAAImpC,EAAG9qC,SAAU2B,EAC7BC,GAAKwpC,EAAGzpC,GAAKmpC,EAAGnpC,GACpB,OAAOC,CACX,EAGIypC,GAAQ,SAAUC,EAAKC,EAAKC,GAE5B,IAAItpC,EAAIspC,EAAIxrC,OACR2pC,EAAIJ,GAAKgC,EAAM,GACnBD,EAAI3B,GAAS,IAAJznC,EACTopC,EAAI3B,EAAI,GAAKznC,IAAM,EACnBopC,EAAI3B,EAAI,GAAc,IAAT2B,EAAI3B,GACjB2B,EAAI3B,EAAI,GAAkB,IAAb2B,EAAI3B,EAAI,GACrB,IAAK,IAAIhoC,EAAI,EAAGA,EAAIO,IAAKP,EACrB2pC,EAAI3B,EAAIhoC,EAAI,GAAK6pC,EAAI7pC,GACzB,OAAqB,GAAbgoC,EAAI,EAAIznC,EACpB,EAEIupC,GAAO,SAAUD,EAAKF,EAAKI,EAAOC,EAAMC,EAAIC,EAAI5D,EAAI6D,EAAIC,EAAIC,EAAIroC,GAChE+lC,GAAM4B,EAAK3nC,IAAK+nC,KACdE,EAAG,KAML,IALA,IAAIzD,EAAK0B,GAAM+B,EAAI,IAAKK,EAAM9D,EAAG,GAAI+D,EAAM/D,EAAG,GAC1CG,EAAKuB,GAAMgC,EAAI,IAAKM,EAAM7D,EAAG,GAAI8D,EAAM9D,EAAG,GAC1C+D,EAAKxB,GAAGoB,GAAMK,EAAOD,EAAG,GAAIE,EAAMF,EAAG,GACrCG,EAAK3B,GAAGsB,GAAMM,EAAOD,EAAG,GAAIE,EAAMF,EAAG,GACrCG,EAAS,IAAIjF,GAAI,IACZ/lC,EAAI,EAAGA,EAAI2qC,EAAKtsC,SAAU2B,EAC/BgrC,EAAiB,GAAVL,EAAK3qC,MAChB,IAASA,EAAI,EAAGA,EAAI8qC,EAAKzsC,SAAU2B,EAC/BgrC,EAAiB,GAAVF,EAAK9qC,MAGhB,IAFA,IAAIirC,EAAK/C,GAAM8C,EAAQ,GAAIE,EAAMD,EAAG,GAAIE,EAAOF,EAAG,GAC9CG,EAAO,GACJA,EAAO,IAAMF,EAAI9E,GAAKgF,EAAO,MAAOA,GAE3C,IAKIC,EAAIC,EAAIC,EAAIC,EALZC,EAAQpB,EAAK,GAAM,EACnBqB,EAAQlC,GAAKS,EAAI1C,IAAOiC,GAAKU,EAAI1C,IAAOlB,EACxCqF,EAAQnC,GAAKS,EAAIK,GAAOd,GAAKU,EAAIM,GAAOlE,EAAK,GAAK,EAAI8E,EAAO5B,GAAKwB,EAAQE,IAAQ,EAAIF,EAAO,IAAM,EAAIA,EAAO,IAAM,EAAIA,EAAO,KACnI,GAAIS,GAAQC,GAASD,GAAQE,EACzB,OAAOjC,GAAMC,EAAK3nC,EAAG6nC,EAAI/B,SAASsC,EAAIA,EAAKC,IAG/C,GADAtC,GAAM4B,EAAK3nC,EAAG,GAAK2pC,EAAQD,IAAS1pC,GAAK,EACrC2pC,EAAQD,EAAO,CACfL,EAAKvE,GAAKwD,EAAKC,EAAK,GAAIe,EAAKhB,EAAKiB,EAAKzE,GAAK0D,EAAKC,EAAK,GAAIe,EAAKhB,EAC/D,IAAIoB,EAAM9E,GAAKoE,EAAKC,EAAM,GAC1BpD,GAAM4B,EAAK3nC,EAAG4oC,EAAM,KACpB7C,GAAM4B,EAAK3nC,EAAI,EAAG+oC,EAAM,GACxBhD,GAAM4B,EAAK3nC,EAAI,GAAIopC,EAAO,GAC1BppC,GAAK,GACL,IAAShC,EAAI,EAAGA,EAAIorC,IAAQprC,EACxB+nC,GAAM4B,EAAK3nC,EAAI,EAAIhC,EAAGkrC,EAAI9E,GAAKpmC,KACnCgC,GAAK,EAAIopC,EAET,IADA,IAAIS,EAAO,CAAClB,EAAMG,GACT/nC,EAAK,EAAGA,EAAK,IAAKA,EACvB,KAAI+oC,EAAOD,EAAK9oC,GAChB,IAAS/C,EAAI,EAAGA,EAAI8rC,EAAKztC,SAAU2B,EAAG,CAClC,IAAI6f,EAAgB,GAAVisB,EAAK9rC,GACf+nC,GAAM4B,EAAK3nC,EAAG4pC,EAAI/rB,IAAO7d,GAAKkpC,EAAIrrB,GAC9BA,EAAM,KACNkoB,GAAM4B,EAAK3nC,EAAI8pC,EAAK9rC,KAAO,EAAK,KAAMgC,GAAK8pC,EAAK9rC,KAAO,GAC/D,CANmB,CAQ3B,MAEIqrC,EAAK5D,GAAK6D,EAAK/D,GAAKgE,EAAK5D,GAAK6D,EAAKhE,GAEvC,IAASxnC,EAAI,EAAGA,EAAImqC,IAAMnqC,EACtB,GAAIgqC,EAAKhqC,GAAK,IAAK,CACX6f,EAAOmqB,EAAKhqC,KAAO,GAAM,GAC7BioC,GAAQ0B,EAAK3nC,EAAGqpC,EAAGxrB,EAAM,MAAO7d,GAAKspC,EAAGzrB,EAAM,KAC1CA,EAAM,IACNkoB,GAAM4B,EAAK3nC,EAAIgoC,EAAKhqC,KAAO,GAAM,IAAKgC,GAAKkkC,GAAKrmB,IACpD,IAAIksB,EAAgB,GAAV/B,EAAKhqC,GACfioC,GAAQ0B,EAAK3nC,EAAGupC,EAAGQ,IAAO/pC,GAAKwpC,EAAGO,GAC9BA,EAAM,IACN9D,GAAQ0B,EAAK3nC,EAAIgoC,EAAKhqC,KAAO,EAAK,MAAOgC,GAAKmkC,GAAK4F,GAC3D,MAEI9D,GAAQ0B,EAAK3nC,EAAGqpC,EAAGrB,EAAKhqC,KAAMgC,GAAKspC,EAAGtB,EAAKhqC,IAInD,OADAioC,GAAQ0B,EAAK3nC,EAAGqpC,EAAG,MACZrpC,EAAIspC,EAAG,IAClB,EAEIU,GAAoB,IAAI/F,GAAI,CAAC,MAAO,OAAQ,OAAQ,OAAQ,OAAQ,QAAS,QAAS,QAAS,UAE/FgG,GAAmB,IAAInG,GAAG,GA2H1BoG,GAAsB,WAEtB,IADA,IAAI/D,EAAI,IAAIlC,GAAI,KACPjmC,EAAI,EAAGA,EAAI,MAAOA,EAAG,CAE1B,IADA,IAAIyR,EAAIzR,EAAGmC,EAAI,IACNA,GACLsP,GAAU,EAAJA,GAAU,YAAeA,IAAM,EACzC02B,EAAEnoC,GAAKyR,CACX,CACA,OAAO02B,CACX,CAT0B,GAWtBgE,GAAM,WACN,IAAI16B,EAAI,WACR,MAAO,CACHzP,EAAG,SAAUmwB,GAGT,IADA,IAAIia,EAAK36B,EACAzR,EAAI,EAAGA,EAAImyB,EAAE9zB,SAAU2B,EAC5BosC,EAAKF,GAAW,IAALE,EAAYja,EAAEnyB,IAAOosC,IAAO,EAC3C36B,EAAI26B,CACP,EACDja,EAAG,WAAc,OAAW,WAAJ1gB,CAAgB,EAEhD,EAsBI46B,GAAO,SAAUxC,EAAKyC,EAAKC,EAAKC,EAAMC,GACtC,OAvKO,SAAU5C,EAAK6C,EAAKC,EAAMJ,EAAKC,EAAMI,GAC5C,IAAIrsC,EAAIspC,EAAIxrC,OACR2pC,EAAI,IAAIlC,GAAGyG,EAAMhsC,EAAI,GAAK,EAAIgO,KAAKoO,MAAMpc,EAAI,MAASisC,GAEtDjD,EAAIvB,EAAEF,SAASyE,EAAKvE,EAAE3pC,OAASmuC,GAC/B5C,EAAM,EACV,IAAK8C,GAAOnsC,EAAI,EACZ,IAAK,IAAIP,EAAI,EAAGA,GAAKO,EAAGP,GAAK,MAAO,CAEhC,IAAIa,EAAIb,EAAI,MACRa,EAAIN,EAEJqpC,EAAMF,GAAMH,EAAGK,EAAKC,EAAI/B,SAAS9nC,EAAGa,KAIpC0oC,EAAEvpC,GAAK4sC,EACPhD,EAAMF,GAAMH,EAAGK,EAAKC,EAAI/B,SAAS9nC,EAAGO,IAE5C,KAEC,CAeD,IAdA,IAAI+rC,EAAMN,GAAIU,EAAM,GAChBlsC,EAAI8rC,IAAQ,GAAI76B,EAAU,KAAN66B,EACpBO,GAAS,GAAKF,GAAQ,EAEtBG,EAAO,IAAI/G,GAAI,OAAQgH,EAAO,IAAIhH,GAAI8G,EAAQ,GAC9CG,EAAQz+B,KAAKmO,KAAKiwB,EAAO,GAAIM,EAAQ,EAAID,EACzCE,EAAM,SAAUltC,GAAK,OAAQ6pC,EAAI7pC,GAAM6pC,EAAI7pC,EAAI,IAAMgtC,EAAUnD,EAAI7pC,EAAI,IAAMitC,GAAUJ,GAGvF7C,EAAO,IAAI/D,GAAI,MAEfgE,EAAK,IAAIlE,GAAI,KAAMmE,EAAK,IAAInE,GAAI,IAEhCoH,EAAO,EAAG7G,EAAK,EAAU6D,GAAPnqC,EAAI,EAAQ,GAAGotC,EAAK,EAAGhD,EAAK,EAC3CpqC,EAAIO,IAAKP,EAAG,CAEf,IAAIqtC,EAAKH,EAAIltC,GAETstC,EAAW,MAAJttC,EAEPutC,EAAQR,EAAKM,GAKjB,GAJAP,EAAKQ,GAAQC,EACbR,EAAKM,GAAMC,EAGPF,GAAMptC,EAAG,CAET,IAAIwtC,EAAMjtC,EAAIP,EACd,IAAKmtC,EAAO,KAAQhD,EAAK,QAAUqD,EAAM,IAAK,CAC1C5D,EAAME,GAAKD,EAAKN,EAAG,EAAGS,EAAMC,EAAIC,EAAI5D,EAAI6D,EAAIC,EAAIpqC,EAAIoqC,EAAIR,GACxDO,EAAKgD,EAAO7G,EAAK,EAAG8D,EAAKpqC,EACzB,IAAK,IAAIumC,EAAI,EAAGA,EAAI,MAAOA,EACvB0D,EAAG1D,GAAK,EACZ,IAASA,EAAI,EAAGA,EAAI,KAAMA,EACtB2D,EAAG3D,GAAK,CAChB,CAEA,IAAItmC,EAAI,EAAGkyB,EAAI,EAAGsb,EAAOh8B,EAAGi8B,EAAOJ,EAAOC,EAAS,MACnD,GAAIC,EAAM,GAAKH,GAAMH,EAAIltC,EAAI0tC,GAMzB,IALA,IAAIC,EAAOp/B,KAAKuR,IAAItf,EAAGgtC,GAAO,EAC1BI,EAAOr/B,KAAKuR,IAAI,MAAO9f,GAGvB6tC,EAAKt/B,KAAKuR,IAAI,IAAK0tB,GAChBE,GAAOE,KAAUH,GAAQH,GAAQC,GAAO,CAC3C,GAAI1D,EAAI7pC,EAAIC,IAAM4pC,EAAI7pC,EAAIC,EAAIytC,GAAM,CAEhC,IADA,IAAII,EAAK,EACFA,EAAKD,GAAMhE,EAAI7pC,EAAI8tC,IAAOjE,EAAI7pC,EAAI8tC,EAAKJ,KAAQI,GAEtD,GAAIA,EAAK7tC,EAAG,CAGR,GAFAA,EAAI6tC,EAAI3b,EAAIub,EAERI,EAAKH,EACL,MAIJ,IAAII,EAAMx/B,KAAKuR,IAAI4tB,EAAKI,EAAK,GACzBE,EAAK,EACT,IAASzH,EAAI,EAAGA,EAAIwH,IAAOxH,EAAG,CAC1B,IAAI0H,EAAMjuC,EAAI0tC,EAAMnH,EAAI,MAAS,MAE7BQ,EAAMkH,EADAnB,EAAKmB,GACM,MAAS,MAC1BlH,EAAKiH,IACLA,EAAKjH,EAAIwG,EAAQU,EACzB,CACJ,CACJ,CAGAP,IADAJ,EAAOC,IAAOA,EAAQT,EAAKQ,IACJ,MAAS,KACpC,CAGJ,GAAInb,EAAG,CAGH6X,EAAKG,KAAQ,UAAazD,GAAMzmC,IAAM,GAAM2mC,GAAMzU,GAClD,IAAI+b,EAAiB,GAAXxH,GAAMzmC,GAASkuC,EAAiB,GAAXvH,GAAMzU,GACrCmU,GAAMJ,GAAKgI,GAAO/H,GAAKgI,KACrBlE,EAAG,IAAMiE,KACThE,EAAGiE,GACLf,EAAKptC,EAAIC,IACPktC,CACN,MAEInD,EAAKG,KAAQN,EAAI7pC,KACfiqC,EAAGJ,EAAI7pC,GAEjB,CACJ,CACA4pC,EAAME,GAAKD,EAAKN,EAAGqD,EAAK5C,EAAMC,EAAIC,EAAI5D,EAAI6D,EAAIC,EAAIpqC,EAAIoqC,EAAIR,GAErDgD,IACDhD,EAAMF,GAAMH,EAAGK,EAAKqC,IAC5B,CACA,OAAOpE,GAAIG,EAAG,EAAGuE,EAAM3E,GAAKgC,GAAO4C,EACvC,CAgDW4B,CAAKvE,EAAkB,MAAbyC,EAAIvuC,MAAgB,EAAIuuC,EAAIvuC,MAAkB,MAAXuuC,EAAI+B,IAAc9/B,KAAKmO,KAAuD,IAAlDnO,KAAKihB,IAAI,EAAGjhB,KAAKuR,IAAI,GAAIvR,KAAKiwB,IAAIqL,EAAIxrC,WAAoB,GAAKiuC,EAAI+B,IAAM9B,EAAKC,GAAOC,EACzK,EA8HI6B,GAAS,SAAUnc,EAAGrlB,EAAG5K,GACzB,KAAOA,IAAK4K,EACRqlB,EAAErlB,GAAK5K,EAAGA,KAAO,CACzB,EAEIqsC,GAAM,SAAU98B,EAAGu2B,GACnB,IAAIpmC,EAAKomC,EAAEwG,SAIX,GAHA/8B,EAAE,GAAK,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,EAAGA,EAAE,GAAKu2B,EAAEjqC,MAAQ,EAAI,EAAe,GAAXiqC,EAAEjqC,MAAa,EAAI,EAAG0T,EAAE,GAAK,EACxE,GAAXu2B,EAAEyG,OACFH,GAAO78B,EAAG,EAAGlD,KAAKoO,MAAM,IAAIlb,KAAKumC,EAAEyG,OAAShtC,KAAKC,OAAS,MAC1DE,EAAI,CACJ6P,EAAE,GAAK,EACP,IAAK,IAAIzR,EAAI,EAAGA,GAAK4B,EAAGvD,SAAU2B,EAC9ByR,EAAEzR,EAAI,IAAM4B,EAAGkC,WAAW9D,EAClC,CACJ,EAoBI0uC,GAAO,SAAU1G,GAAK,OAAO,IAAOA,EAAEwG,UAAaxG,EAAEwG,SAASnwC,OAAS,GAAO,EAAI,EAsO/E,SAASswC,GAASxrC,EAAMyrC,QACd,IAATA,IAAmBA,EAAO,CAAA,GAC9B,IAAIn9B,EAAI06B,KAAOlsC,EAAIkD,EAAK9E,OACxBoT,EAAEzP,EAAEmB,GACJ,IAAIgvB,EAAIka,GAAKlpC,EAAMyrC,EAAMF,GAAKE,GAAO,GAAIruC,EAAI4xB,EAAE9zB,OAC/C,OAAOkwC,GAAIpc,EAAGyc,GAAON,GAAOnc,EAAG5xB,EAAI,EAAGkR,EAAE0gB,KAAMmc,GAAOnc,EAAG5xB,EAAI,EAAGN,GAAIkyB,CACvE,CA2VO,SAAS0c,GAAQlvC,EAAKmvC,GACzB,IAAI7uC,EAAIN,EAAItB,OACZ,IAAKywC,GAAgC,oBAAfC,YAClB,OAAO,IAAIA,aAAcC,OAAOrvC,GAIpC,IAHA,IAAIsvC,EAAK,IAAInJ,GAAGnmC,EAAItB,QAAUsB,EAAItB,SAAW,IACzC6wC,EAAK,EACL3F,EAAI,SAAUrnC,GAAK+sC,EAAGC,KAAQhtC,GACzBlC,EAAI,EAAGA,EAAIC,IAAKD,EAAG,CACxB,GAAIkvC,EAAK,EAAID,EAAG5wC,OAAQ,CACpB,IAAImC,EAAI,IAAIslC,GAAGoJ,EAAK,GAAMjvC,EAAID,GAAM,IACpCQ,EAAEsgB,IAAImuB,GACNA,EAAKzuC,CACT,CACA,IAAIiR,EAAI9R,EAAImE,WAAW9D,GACnByR,EAAI,KAAOq9B,EACXvF,EAAE93B,GACGA,EAAI,MACT83B,EAAE,IAAO93B,IAAM,GAAK83B,EAAE,IAAW,GAAJ93B,IACxBA,EAAI,OAASA,EAAI,OAElB83B,EAAE,KADN93B,EAAI,OAAa,QAAJA,GAAyC,KAAtB9R,EAAImE,aAAa9D,MAC9B,IAAMupC,EAAE,IAAQ93B,IAAM,GAAM,IAAM83B,EAAE,IAAQ93B,IAAM,EAAK,IAAM83B,EAAE,IAAW,GAAJ93B,KAEzF83B,EAAE,IAAO93B,IAAM,IAAM83B,EAAE,IAAQ93B,IAAM,EAAK,IAAM83B,EAAE,IAAW,GAAJ93B,GACjE,CACA,OAAOo2B,GAAIoH,EAAI,EAAGC,EACtB,EChxCC,SAHWxH,GAAAA,EAAW,OAAA,UAAXA,EAAW,OAAA,QAAXA,CAGX,CAHWA,KAAAA,GAsCZ,CAAA,IC3NO,IAAMyH,GAAiB,SAC1BlmC,EACAmmC,EACAC,GAEA,IAAM/wC,EAAO8wC,GAAgB,GAC7B9wC,EAAS,GAAI+wC,EAAqB,GAAI,EAAI,EAC1C/wC,EAAQ,GAAI,IAAImD,MAAOkS,UAAUjY,WACjC4C,EAAU,IAAItD,EAAOE,YAErB,IAAMo0C,EAASrmC,EAAIlC,MAAM,KACzB,GAAIuoC,EAAOjxC,OAAS,EAAG,CACnB,IACsB8B,EADaC,EAAAC,EAApBivC,EAAO,GAAGvoC,MAAM,MACT,IAAtB,IAAA3G,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAwB,CAAA,IACdK,EADEX,EAAAQ,MACMoG,MAAM,KAAK,GACpB5K,EAAamC,EAAKwC,YACZxC,EAAKwC,EAEpB,CAAC,CAAA,MAAAF,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACL,CAEA,IAAMszC,EAAetmC,EAAI7L,QAAQ,MAAQ,EAAI,IAAM,IACnD,OAAO6L,EAAMsmC,EAAevsB,GAAiB1kB,EACjD,EAEakxC,GAAiB,SAAjBA,EAAkBrsC,EAA6B8V,GACxD,GAAIA,EAAQw2B,MAAQtsC,EAAKub,OACrB,OAAO,IAAIuS,KAAK,CAACn1B,EAAcqH,GAAQA,EAAOA,EAAKub,QAAS,CAAExZ,KAAM,eAGxE,GAAI+T,EAAQy2B,YAAcz2B,EAAQw2B,KAAM,CACpC,IAAM7oC,EAAO4oC,EAAersC,EAAM,CAAE4V,OAAQ,SAC5C,OAAO,IAAIkY,KAAK,CAACrqB,GAAO,CAAE1B,KAAM,qCACpC,CAEA,MAAuB,SAAnB+T,EAAQF,OACD,MAOP42B,EAFAh0C,EAASwH,IAASrH,EAAcqH,GAEpB,QAAUqe,mBAAmBre,GAE7B,QAAUqe,mBAAmBre,EAAKA,MAG9C,gBAAiBA,GAAQA,EAAKysC,cAC9BD,GAAa,gBAAkBxsC,EAAKysC,aAGjCD,GAbP,IAAIA,CAcR,EAEa9J,GAAU,SAAC5d,GAEpB,GAAIzqB,GAAsC,UAA7ByqB,EAAOhP,QAAQ2sB,UAAuB,CAAA,IAAAiK,EACzCjpC,EAAO4oC,GAAevnB,EAAO9kB,KAAM8kB,EAAOhP,SAE1C4X,EAAU,IAAIif,QACpB5vC,EAAM2wB,GAAS,SAAUkf,EAAaC,GAClCnf,EAAQof,OAAOD,EAAYD,EAC/B,IAE8B,SAA1B9nB,EAAOhP,QAAQF,QAAsBkP,EAAOhP,QAAQw2B,MACpD5e,EAAQof,OAAO,eAAgB,qCAGnC,IAAIhnC,EAAMgf,EAAOhf,IAqDjB,OAnDI1M,EAAU0rB,EAAOioB,wBAA0BjoB,EAAOioB,sBAAwB,IAC1EjnC,EAAMkmC,GAAelmC,EAAK,CAAEknC,YAAaloB,EAAOioB,uBAAyB,CAAE,SAG/E1yC,EAAMyL,EAAK,CACP8P,QAAsB82B,QAAdA,EAAA5nB,EAAOhP,eAAP42B,IAAcA,OAAdA,EAAAA,EAAgB92B,SAAU,MAClC8X,QAAAA,EACAuf,UAAqC,SAA1BnoB,EAAOhP,QAAQF,OAC1BnS,KAAAA,IAECypC,MAAK,SAAC7iC,GACH,IAAM8iC,EAAa9iC,EAAS+yB,OAE5B,OAAO/yB,EAASpC,OAAOilC,MAAK,SAACE,GAAiB,IAAAC,EAAAC,EAM1C,GALiB,QAAjBD,EAAAvoB,EAAOyoB,kBAAU,IAAAF,GAAjBA,EAAA30C,KAAAosB,EAAoB,CAChBqoB,WAAAA,EACAC,aAAAA,IAGe,MAAfD,EASAt0C,EAAYisB,EAAO0oB,UACnB1oB,EAAO0oB,QAAQ,CACXL,WAAAA,EACAC,aAAAA,KAKJD,EAAa,KAAOA,EAAa,MACjCroB,EAAO2oB,WAAWC,QAAOxkC,EAAAA,EAAA,GAClB4b,GAAM,GAAA,CACT4I,QAAAA,EACAqf,uBAAwBjoB,EAAOioB,uBAAyB,GAAK,KAGtD,QAAfO,EAAAxoB,EAAOjiB,gBAAQ,IAAAyqC,GAAfA,EAAA50C,KAAAosB,EAAkB,CAAEsY,OAAQ,SAvBxB,IAAI,IAAAuQ,EACeA,QAAfA,EAAA7oB,EAAOjiB,oBAAQ8qC,GAAfA,EAAAj1C,KAAAosB,EAAkB9P,KAAK0I,MAAM0vB,GAChC,CAAC,MAAO1vC,GACLhD,EAAOmB,MAAM6B,EACjB,CAoBR,GACJ,IACCkwC,OAAM,SAAC/xC,GAAU,IAAAgyC,EACdnzC,EAAOmB,MAAMA,GACE,QAAfgyC,EAAA/oB,EAAOjiB,gBAAQ,IAAAgrC,GAAfA,EAAAn1C,KAAAosB,EAAkB,CAAEsY,OAAQ,GAChC,GAGR,CAEA,OAAO0Q,GAAIhpB,EACf,EAEMgpB,GAAM,SAAHvkC,GAWU,IAVfzD,EAAGyD,EAAHzD,IACA9F,EAAIuJ,EAAJvJ,KACA0tB,EAAOnkB,EAAPmkB,QACA5X,EAAOvM,EAAPuM,QACAjT,EAAQ0G,EAAR1G,SACAkqC,EAAqBxjC,EAArBwjC,sBACAU,EAAUlkC,EAAVkkC,WACAD,EAAOjkC,EAAPikC,QAAOO,EAAAxkC,EACPykC,QAAAA,OAAU,IAAHD,EAAG,IAAKA,EACfR,EAAUhkC,EAAVgkC,WAEIn0C,EAAU2zC,IAA0BA,EAAwB,IAC5DjnC,EAAMkmC,GAAelmC,EAAK,CAAEknC,YAAaD,GAAyB,CAAE,IAGxE,IAAMkB,EAAM,IAAI3zC,eAChB2zC,EAAIC,KAAKp4B,EAAQF,QAAU,MAAO9P,GAAK,GAEvC,IAAMrC,EAAO4oC,GAAersC,EAAM8V,GAElC/Y,EAAM2wB,GAAS,SAAUkf,EAAaC,GAClCoB,EAAIE,iBAAiBtB,EAAYD,EACrC,IAEuB,SAAnB92B,EAAQF,QAAsBE,EAAQw2B,MACtC2B,EAAIE,iBAAiB,eAAgB,qCAGzCF,EAAID,QAAUA,EAGdC,EAAIG,iBAAkB,EACtBH,EAAII,mBAAqB,WAErB,GAAuB,IAAnBJ,EAAIK,WAAkB,CACtB,IAAMC,EAA8C,CAChDpB,WAAYc,EAAI7Q,OAChBgQ,aAAca,EAAIb,cAGtB,GADAG,SAAAA,EAAagB,GACM,MAAfN,EAAI7Q,QACJ,GAAIv6B,EAAU,CACV,IAAIwH,EACJ,IACIA,EAAW2K,KAAK0I,MAAMuwB,EAAIb,aAC7B,CAAC,MAAO1vC,GAEL,YADAhD,EAAOmB,MAAM6B,EAEjB,CACAmF,EAASwH,EACb,OAEIxR,EAAY20C,IACZA,EAAQe,IAIRN,EAAI7Q,OAAS,KAAO6Q,EAAI7Q,OAAS,MACjCqQ,EAAWC,QAAQ,CACf5nC,IAAAA,EACA9F,KAAAA,EACA8V,QAAAA,EACA4X,QAAAA,EACAqf,uBAAwBA,GAAyB,GAAK,EACtDlqC,SAAAA,IAIRA,SAAAA,EAAW,CAAEu6B,OAAQ,GAE7B,GAEJ6Q,EAAIO,KAAK/qC,EACb,ECrLagrC,ICtBDC,GDsBCD,YAAU5M,GAAAC,EAAA2M,EAAA5M,GAAA,IAAAE,EAAAC,EAAAyM,GAOnB,SAAAA,EAAYE,EAAmDC,GAA0B,IAAAv/B,EAgBpF,OAhBoFvE,OAAA2jC,IACrFp/B,EAAA0yB,EAAArpC,KAAAiG,OACK0iC,WAAY,EACjBhyB,EAAKw/B,MAAQ,GACbx/B,EAAKy/B,aAAc,EACnBz/B,EAAKs/B,eAAiBA,EACtBt/B,EAAKu/B,YAAcA,GAEd51C,EAAaS,IAAW,WAAYA,EAAOS,YAC5CmV,EAAKy/B,YAAcr1C,EAAOS,UAAU60C,OACpCt1C,EAAO0I,iBAAiB,UAAU,WAC9BkN,EAAK2/B,uBACT,IACAv1C,EAAO0I,iBAAiB,WAAW,WAC/BkN,EAAKy/B,aAAc,CACvB,KACHz/B,CACL,CA8FC,OA9FArE,EAAAyjC,EAAA,CAAA,CAAA9wC,IAAA,UAAAH,MAED,SAAQyxC,GACJ,IAAMlC,EAAwBkC,EAAYlC,uBAAyB,EACnE,KAAIA,GAAyB,IAA7B,CAGA,IAAMmC,EAxCP,SAA4BnC,GAC/B,IAAMoC,EAAiB,IAAI/jC,KAAAuP,IAAG,EAAKoyB,GAC7BqC,EAAaD,EAAiB,EAC9BE,EAAoBjkC,KAAKuR,IAfb,KAegCwyB,GAE5CG,GADiBlkC,KAAKgQ,SAAW,KACNi0B,EAAoBD,GACrD,OAAOhkC,KAAKmO,KAAK81B,EAAoBC,EACzC,CAiC8BC,CAAmBxC,GACnCyC,EAAU,IAAIlxC,KAAKA,KAAKC,MAAQ2wC,GAEtCvwC,KAAKkwC,MAAMhvC,KAAK,CAAE2vC,QAAAA,EAASP,YAAAA,IAE3B,IAAIQ,EAAU,wCAAAn0C,OAA2C4zC,GACpDh1C,UAAU60C,SACXU,GAAc,yBAElB/0C,EAAOgB,KAAK+zC,GAEP9wC,KAAK0iC,YACN1iC,KAAK0iC,WAAY,EACjB1iC,KAAKgjC,OAdT,CAgBJ,GAAC,CAAAhkC,IAAA,OAAAH,MAED,WAAa,IAAAwS,EAAArR,KACTA,KAAK6iC,SAAW1D,aAAan/B,KAAK6iC,SAClC7iC,KAAK6iC,QAAU/sB,YAAW,WAClBzE,EAAK8+B,aAAe9+B,EAAK6+B,MAAM3zC,OAAS,GACxC8U,EAAK0/B,QAET1/B,EAAK2xB,MACT,GAAGhjC,KAAK8iC,cACZ,GAAC,CAAA9jC,IAAA,QAAAH,MAED,WAEI,IAAMe,EAAM,IAAID,KAAKA,KAAKC,OACpBoxC,EAAUhxC,KAAKkwC,MAAMzqC,QAAO,SAAAmF,GAAU,OAAAA,EAAPimC,QAAwBjxC,KAC7D,GAAIoxC,EAAQz0C,OAAS,EAAG,CACpByD,KAAKkwC,MAAQlwC,KAAKkwC,MAAMzqC,QAAO,SAAAoF,GAAU,OAAAA,EAAPgmC,SAAyBjxC,KAAI,IAC1BvB,EAD0BC,EAAAC,EACjCyyC,GAAO,IAArC,IAAA1yC,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAuC,CAAA,IAA1B2xC,EAAWjyC,EAAAQ,MAAXyxC,YACTtwC,KAAKixC,mBAAmBX,EAC5B,CAAC,CAAA,MAAAxxC,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACL,CACJ,GAAC,CAAA6E,IAAA,SAAAH,MAED,WACQmB,KAAK6iC,UACL1D,aAAan/B,KAAK6iC,SAClB7iC,KAAK6iC,aAAU9nC,GAClB,IAEuCyN,EAFvCC,EAAAlK,EAE6ByB,KAAKkwC,OAAK,IAAxC,IAAAznC,EAAAhK,MAAA+J,EAAAC,EAAA/J,KAAAC,MAA0C,CAAA,IAA7B2xC,EAAW9nC,EAAA3J,MAAXyxC,YACDnpC,EAAuBmpC,EAAvBnpC,IAAK9F,EAAkBivC,EAAlBjvC,KAAM8V,EAAYm5B,EAAZn5B,QAEnB,GAAInX,KAAKiwC,YAAYiB,cAAc/5B,EAAQ2oB,WACvC/jC,EAAOgB,KAAK,yDAIhB,IAGIjC,SAAAA,EAAQS,UAAUqyC,WAAWzmC,EAAKumC,GAAersC,EAAIkJ,EAAAA,KAAO4M,GAAO,GAAA,CAAEy2B,YAAY,KACpF,CAAC,MAAO7uC,GAGLhD,EAAOmB,MAAM6B,EACjB,CACJ,CAAC,CAAA,MAAAD,GAAA2J,EAAA1J,EAAAD,EAAA,CAAA,QAAA2J,EAAAtO,GAAA,CACD6F,KAAKkwC,MAAQ,EACjB,GAAC,CAAAlxC,IAAA,qBAAAH,MAED,SAAAsyC,GAA8G,IAAzFhqC,EAAGgqC,EAAHhqC,IAAK9F,EAAI8vC,EAAJ9vC,KAAM8V,EAAOg6B,EAAPh6B,QAAS4X,EAAOoiB,EAAPpiB,QAAS7qB,EAAQitC,EAARjtC,SAAUkqC,EAAqB+C,EAArB/C,sBACpDpuC,KAAKiwC,YAAYiB,cAAc/5B,EAAQ2oB,YAI3CiE,GAAQ,CACJ58B,IAAAA,EACA9F,KAAMA,GAAQ,CAAE,EAChB8V,QAASA,GAAW,CAAE,EACtB4X,QAASA,GAAW,CAAE,EACtBqf,sBAAuBA,GAAyB,EAChDlqC,SAAAA,EACA4qC,WAAY9uC,KACZ6uC,QAAS7uC,KAAKgwC,eACdpB,WAAY5uC,KAAKiwC,YAAYmB,kBAErC,GAAC,CAAApyC,IAAA,wBAAAH,MAED,WACImB,KAAKmwC,aAAc,EACnBnwC,KAAK+wC,OACT,KAACjB,CAAA,EAtH2BtN,IEpB1B6O,GAA2B,KAIpBC,GAAgB,WAezB,SAAAA,EACIziC,EACAH,EACA6iC,EACAC,GACFrlC,OAAAmlC,GAAAx9B,mCAP8D,IAQ5D9T,KAAK6O,OAASA,EACd7O,KAAK0O,YAAcA,EACnB1O,KAAKyxC,eAAY12C,EACjBiF,KAAK0xC,gBAAa32C,EAClBiF,KAAK2xC,uBAAyB,KAC9B3xC,KAAK4xC,0BAA4B,KACjC5xC,KAAK6xC,oBAAsBN,GAAsBp0B,GACjDnd,KAAK8xC,mBAAqBN,GAAqBr0B,GAE/C,IAAM40B,EAAkBljC,EAAyB,kBAAKA,EAAc,MAChEmjC,EAAiBnjC,EAAqC,8BAAKwiC,GAkB/D,GAhBK52C,EAAUu3C,GAGJA,EAAiBX,GACxBt1C,EAAOgB,KAAK,8FACLi1C,EAzCc,IA0CrBj2C,EAAOgB,KAAK,2FALZhB,EAAOgB,KAAK,4EACZi1C,EAAiBX,IAOrBrxC,KAAKiyC,kBACwF,IAAzFxlC,KAAKuR,IAAIvR,KAAKihB,IAAIskB,EA9CG,IA8CwCX,IACjErxC,KAAKkyC,uBAAyB,MAAQH,EAAkB,aACxD/xC,KAAKmyC,mCAAqC,MAAQJ,EAAkB,yBAIhE/xC,KAAKoyC,wBAAyB,CAC9B,IAAMC,EAAe3xB,GAAa3B,MAAM/e,KAAKkyC,wBAEvCI,EAAsB5xB,GAAa3B,MAAM/e,KAAKmyC,oCAChDE,IAAiBC,EAEjBtyC,KAAKyxC,UAAYY,EAGjB3xB,GAAaf,OAAO3f,KAAKkyC,wBAG7BxxB,GAAa1B,IAAIhf,KAAKmyC,oCAAoC,EAC9D,CAEAnyC,KAAKuyC,uBACT,CAkKC,OAlKAlmC,EAAAilC,EAAA,CAAA,CAAAtyC,IAAA,cAAAH,MAED,SAAYqF,GAAgD,IAAAwM,EAAA1Q,KAWxD,OARI3F,EAAa2F,KAAKwyC,6BAClBxyC,KAAKwyC,0BAA4B,IAGrCxyC,KAAKwyC,0BAA0BtxC,KAAKgD,GAChClE,KAAK0xC,YACLxtC,EAASlE,KAAK0xC,WAAY1xC,KAAKyxC,WAE5B,WACH/gC,EAAK8hC,0BAA4B9hC,EAAK8hC,0BAA0B/sC,QAAO,SAACsS,GAAC,OAAKA,IAAM7T,KAE5F,GAAC,CAAAlF,IAAA,wBAAAH,MAED,WAEI,MAAmC,WAA5BmB,KAAK6O,OAAOH,cAA6B1O,KAAK0O,YAAY0b,UAAY1J,GAAajC,cAC9F,GAKA,CAAAzf,IAAA,eAAAH,MACA,SAAqBy7B,GACbA,IAAat6B,KAAKyxC,YAClBzxC,KAAKyxC,UAAYnX,EACbt6B,KAAKoyC,yBACL1xB,GAAa1B,IAAIhf,KAAKkyC,uBAAwB5X,GAG1D,GAAC,CAAAt7B,IAAA,eAAAH,MAED,WACI,OAAImB,KAAKyxC,UACEzxC,KAAKyxC,UAEZzxC,KAAKoyC,wBACE1xB,GAAa3B,MAAM/e,KAAKkyC,wBAG5B,IACX,GAGA,CAAAlzC,IAAA,gBAAAH,MACA,SACI43B,EACAgc,EACA1d,GAGI0B,IAAcz2B,KAAK0xC,YACnBe,IAA6BzyC,KAAK4xC,2BAClC7c,IAA0B/0B,KAAK2xC,yBAE/B3xC,KAAK2xC,uBAAyB5c,EAC9B/0B,KAAK4xC,0BAA4Ba,EACjCzyC,KAAK0xC,WAAajb,EAElBz2B,KAAK0O,YAAYmF,SAAQC,EACpB1G,CAAAA,EAAAA,GAAa,CAACqlC,EAA0Bhc,EAAW1B,KAGhE,GAAC,CAAA/1B,IAAA,gBAAAH,MAED,WACI,GAAImB,KAAK0xC,YAAc1xC,KAAK4xC,2BAA6B5xC,KAAK2xC,uBAC1D,MAAO,CAAC3xC,KAAK4xC,0BAA2B5xC,KAAK0xC,WAAY1xC,KAAK2xC,wBAElE,IAAMlb,EAAYz2B,KAAK0O,YAAYC,MAAMvB,IAOzC,OALIvT,EAAS48B,IAAmC,IAArBA,EAAUl6B,QAEjCk6B,EAAUv1B,KAAKu1B,EAAU,IAGtBA,GAAa,CAAC,EAAG,KAAM,EAClC,GAGA,CAAAz3B,IAAA,iBAAAH,MACA,WACImB,KAAK0yC,cAAc,KAAM,KAAM,KACnC,GAEA,CAAA1zC,IAAA,wBAAAH,MAMA,WAAsC,IAAAwS,EAAArR,KAClClF,SAAAA,EAAQ0I,iBAAiB,gBAAgB,WACjC6N,EAAK+gC,yBACL1xB,GAAaf,OAAOtO,EAAK8gC,mCAEjC,GACJ,GAEA,CAAAnzC,IAAA,gCAAAH,MAgBA,WAAkF,IAApD8zC,EAAQr2C,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GAC5BiQ,GAD+DjQ,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,QACxC,IAAIqD,MAAOkS,UAG0B+gC,EAAA7nC,EAApB/K,KAAK6yC,gBAAe,GAAhEC,EAAaF,EAAA,GAAEnc,EAASmc,EAAA,GAAEG,EAAcH,EAAA,GACzCtY,EAAWt6B,KAAKgzC,eAEdC,EACFF,GAAkBA,EAAiB,GAAKtmC,KAAKC,IAAIH,EAAYwmC,GAlM5C,MAoMjBG,GAAgB,EACdC,GAAe1c,EACf2c,GAAmBT,GAAYlmC,KAAKC,IAAIH,EAAYumC,GAAiB9yC,KAAKiyC,kBAC5EkB,GAAeC,GAAmBH,GAClCxc,EAAYz2B,KAAK6xC,sBACjBvX,EAAWt6B,KAAK8xC,qBAChB/1C,EAAOa,KAAK,uCAAwC,CAChD65B,UAAAA,EACA6D,SAAAA,EACA+Y,aAAc,CAAEF,YAAAA,EAAaC,gBAAAA,EAAiBH,yBAAAA,KAElDF,EAAiBxmC,EACjB2mC,GAAgB,GACR5Y,IACRA,EAAWt6B,KAAK8xC,qBAChBoB,GAAgB,GAGpB,IAAMI,EAAiC,IAAlBR,IAAwBH,GAAYM,EAA2B1mC,EAAYumC,EAC1F/d,EAA2C,IAAnBge,GAAuB,IAAIpzC,MAAOkS,UAAYkhC,EAS5E,OAPA/yC,KAAKuzC,aAAajZ,GAClBt6B,KAAK0yC,cAAcjc,EAAW6c,EAAcve,GAExCme,GACAlzC,KAAKwyC,0BAA0Bp3C,SAAQ,SAACiI,GAAO,OAAKA,EAAQozB,EAAW6D,MAGpE,CACH7D,UAAAA,EACA6D,SAAAA,EACAvF,sBAAAA,EAER,KAACuc,CAAA,CAnOwB,IDF5B,SAJWvB,GAAAA,EAAmB,GAAA,KAAnBA,EAAmB,GAAA,KAAnBA,EAAmB,OAAA,QAAnBA,CAIX,CAJWA,KAAAA,GAAmB,CAAA,IAQ/B,IAAayD,GAAa,WAItB,SAAAA,EAAYjlC,GAAmBpC,OAAAqnC,GAAA1/B,EAAA9T,KAAA,eAF6B,CAAA,GAGxDA,KAAKuO,SAAWA,CACpB,CA4CC,OA5CAlC,EAAAmnC,EAAA,CAAA,CAAAx0C,IAAA,UAAA2f,IAED,WACI,OAAO3e,KAAKuO,SAASM,OAAO4kC,SAASjqC,OAAO1L,QAAQ,MAAO,GAC/D,GAAC,CAAAkB,IAAA,SAAA2f,IACD,WAAiC,IAAA4W,EAC7B,eAAAA,EAAOv1B,KAAKuO,SAASM,OAAO6kC,eAAO,IAAAne,OAAA,EAA5BA,EAA8Bz3B,QAAQ,MAAO,GACxD,GAAC,CAAAkB,IAAA,SAAA2f,IAED,WAWI,OATK3e,KAAK2zC,aAAa3zC,KAAK4zC,WACpB,oDAAoD1qC,KAAKlJ,KAAK4zC,SAC9D5zC,KAAK2zC,aAAa3zC,KAAK4zC,SAAW7D,GAAoB8D,GAC/C,gDAAgD3qC,KAAKlJ,KAAK4zC,SACjE5zC,KAAK2zC,aAAa3zC,KAAK4zC,SAAW7D,GAAoB+D,GAEtD9zC,KAAK2zC,aAAa3zC,KAAK4zC,SAAW7D,GAAoBgE,QAGvD/zC,KAAK2zC,aAAa3zC,KAAK4zC,QAClC,GAAC,CAAA50C,IAAA,cAAAH,MAED,SAAYwK,GAAwD,IAA3BinB,EAAYh0B,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,GAKpD,GAJIg0B,IACAA,EAAmB,MAAZA,EAAK,GAAaA,EAAI,IAAA3zB,OAAO2zB,IAGzB,OAAXjnB,EACA,OAAQrJ,KAAKg0C,QAAUh0C,KAAK4zC,SAAWtjB,EAG3C,GAAItwB,KAAKgiC,SAAW+N,GAAoBgE,OACpC,OAAO/zC,KAAK4zC,QAAUtjB,EAG1B,IAAM2jB,EAAS,gBAAkB3jB,EAEjC,OAAQjnB,GACJ,IAAK,SACD,MAAA1M,WAAAA,OAAkBqD,KAAKgiC,OAAMrlC,YAAAA,OAAWs3C,GAC5C,IAAK,MACD,MAAAt3C,WAAAA,OAAkBqD,KAAKgiC,OAAMrlC,KAAAA,OAAIs3C,GAE7C,KAACT,CAAA,CAlDqB,GEkCbU,GAAiB7nC,GAQ1B,SAAA6nC,EAAYC,EAAmBC,EAAuBC,EAAoBC,GAAiBnoC,OAAA+nC,GAEvFl0C,KAAKgJ,KAAO,aACZhJ,KAAKu0C,UAAY,SAAUC,GACvBA,GAAwB,SAAC1xC,GAAwB,IAAA2xC,EAAAC,EAAAC,EAAAC,EAAAC,EAC7C,GAAoB,UAAhB/xC,EAAM7G,QAAsBk4C,EAASv7B,SAAU,OAAO9V,EACrDA,EAAMgyC,OAAMhyC,EAAMgyC,KAAO,CAAA,GAE9B,IAAMC,EAAYZ,EAASp9B,cAAcC,YAAY,KAAM,WAAam9B,EAAS39B,mBACjF1T,EAAMgyC,KAAK,sBAAwBC,EAC/BZ,EAASa,4BACTlyC,EAAMgyC,KAAK,yBAA2BX,EAASc,uBAAuB,CAAEC,eAAe,KAG3F,IAAMC,GAA4B,QAAfV,EAAA3xC,EAAMsyC,iBAANX,IAAeA,OAAfA,EAAAA,EAAiB7Q,SAAU,GAExCviC,EAMF,CAEAg0C,mBAAiC,QAAfX,EAAES,EAAW,UAAE,IAAAT,OAAA,EAAbA,EAAe71C,MACnCy2C,gBAA8B,QAAfX,EAAEQ,EAAW,UAAE,IAAAR,OAAA,EAAbA,EAAevxC,KAChCmyC,qBAAsBR,EAEtBS,iBAAkB1yC,EAAM2yC,SACxBC,kBAAmB5yC,EAAMsyC,UACzBO,0BAAwC,QAAff,EAAEO,EAAW,UAAE,IAAAP,OAAA,EAAbA,EAAe/1C,MAC1C+2C,uBAAqC,QAAff,EAAEM,EAAW,UAAE,IAAAN,OAAA,EAAbA,EAAezxC,KACvCyyC,aAAc/yC,EAAMgyC,MAYxB,OATIV,GAAgBC,IAChBhzC,EAAkB,aACbizC,GAAU,oCACXF,EACA,oBACAC,EACA,UACAvxC,EAAM2yC,UACdtB,EAASnhC,QAAQ,aAAc3R,GACxByB,CACX,IAER,ICxESgzC,GAAe,WAKxB,SAAAA,EAAYvnC,GAAmB,IAAAmC,EAAA1Q,KAAAmM,OAAA2pC,GAAAhiC,2BAHZ,GAAKA,4BAuFJ,WAAM,IAAAiiC,EAAAC,EAAAC,EAAAC,EACjBxlC,EAAKylC,gBACNzlC,EAAKylC,cAAgBzlC,EAAK0lC,uBAE9B,IAAMC,EAAe3lC,EAAKylC,cAEpBG,EAAU5lC,EAAK6lC,WACfC,EAAe9lC,EAAK+lC,gBACpBC,EAAWhmC,EAAKimC,YAChBC,EAAgBlmC,EAAKmmC,iBAE3BR,EAAaS,YAAcR,EAC3BD,EAAaU,WAAatqC,KAAKihB,IAAI4oB,EAAgCP,QAAzBA,EAAEM,EAAaU,sBAAUhB,EAAAA,EAAI,GACvEM,EAAaW,gBAAkBvqC,KAAKihB,IAAI8oB,EAA0CR,QAA9BA,EAAEK,EAAaW,2BAAehB,EAAAA,EAAI,GAEtFK,EAAaY,aAAeP,EAC5BL,EAAaa,YAAczqC,KAAKihB,IAAIgpB,EAAkCT,QAA1BA,EAAEI,EAAaa,uBAAWjB,EAAAA,EAAI,GAC1EI,EAAac,iBAAmB1qC,KAAKihB,IAAIkpB,EAA4CV,QAA/BA,EAAEG,EAAac,4BAAgBjB,EAAAA,EAAI,MApGzFl2C,KAAKo3C,UAAY7oC,CACrB,CA6JC,OA7JAlC,EAAAypC,EAAA,CAAA,CAAA92C,IAAA,sBAAAH,MAED,WAAoC,IAAAw4C,EAChC,MAAO,CACH/uB,SAAmC,QAA3B+uB,EAAEv8C,aAAAA,EAAAA,EAAQW,SAAS6sB,gBAAQ,IAAA+uB,EAAAA,EAAI,GAE/C,GAAC,CAAAr4C,IAAA,aAAAH,MAED,WAAsC,IAAAy4C,EAC9BC,EAkBJ,OAfKv3C,KAAKw3C,kBAOND,EAAmBv3C,KAAKm2C,cACxBn2C,KAAKm2C,cAAgBn2C,KAAKo2C,wBAP1Bp2C,KAAKw3C,kBAAmB,EACxBD,OAAmBx8C,EACdiF,KAAKm2C,gBACNn2C,KAAKm2C,cAAgBn2C,KAAKo2C,wBASlCtgC,WAAW9V,KAAKy3C,kBAAmB,GAEnCltC,EAAA,CACImtC,gCAAuBJ,EAAEC,SAAgB,IAAAD,OAAA,EAAhBA,EAAkBhvB,UACxCtoB,KAAK23C,mCAAmCJ,GAEnD,GAAC,CAAAv4C,IAAA,cAAAH,MAED,WACI,IAAM04C,EAAmBv3C,KAAKm2C,cAC9B,OAAA5rC,EAAA,CACImtC,wBAAyBH,aAAgB,EAAhBA,EAAkBjvB,UACxCtoB,KAAK23C,mCAAmCJ,GAEnD,GAAC,CAAAv4C,IAAA,qCAAAH,MAED,SAAmC04C,GAC/B,IACKA,GACmC,MAApCA,EAAiBP,iBACe,MAAhCO,EAAiBT,aACc,MAA/BS,EAAiBR,YACoB,MAArCQ,EAAiBJ,kBACgB,MAAjCI,EAAiBN,cACe,MAAhCM,EAAiBL,YAEjB,MAAO,GAGX,IAAMF,EAA0FO,EAA1FP,gBAAiBF,EAAyES,EAAzET,YAAaC,EAA4DQ,EAA5DR,WAAYI,EAAgDI,EAAhDJ,iBAAkBF,EAA8BM,EAA9BN,aAAcC,EAAgBK,EAAhBL,YAgBhF,OAbAF,EAAkBvqC,KAAKmO,KAAKo8B,GAC5BF,EAAcrqC,KAAKmO,KAAKk8B,GACxBC,EAAatqC,KAAKmO,KAAKm8B,GACvBI,EAAmB1qC,KAAKmO,KAAKu8B,GAC7BF,EAAexqC,KAAKmO,KAAKq8B,GACzBC,EAAczqC,KAAKmO,KAAKs8B,GAQjB,CACHU,2BAA4Bd,EAC5Be,sCAPyBb,GAAmB,EAAI,EAAIc,GAAMhB,EAAcE,EAAiB,EAAG,GAQ5Fe,0BAA2BhB,EAC3BiB,qCARwBhB,GAAmB,EAAI,EAAIc,GAAMf,EAAaC,EAAiB,EAAG,GAS1FiB,4BAA6BhB,EAC7BiB,uCAT0Bf,GAAoB,EAAI,EAAIW,GAAMb,EAAeE,EAAkB,EAAG,GAUhGgB,2BAA4BjB,EAC5BkB,sCAVyBjB,GAAoB,EAAI,EAAIW,GAAMZ,EAAcC,EAAkB,EAAG,GAYtG,GAAC,CAAAn4C,IAAA,+BAAAH,MAsBD,WAII/D,SAAAA,EAAQ0I,iBAAiB,SAAUxD,KAAKy3C,mBAAmB,GAC3D38C,SAAAA,EAAQ0I,iBAAiB,YAAaxD,KAAKy3C,mBAAmB,GAC9D38C,SAAAA,EAAQ0I,iBAAiB,SAAUxD,KAAKy3C,kBAC5C,GAAC,CAAAz4C,IAAA,8BAAAH,MAED,WACI/D,SAAAA,EAAQu9C,oBAAoB,SAAUr4C,KAAKy3C,mBAC3C38C,SAAAA,EAAQu9C,oBAAoB,YAAar4C,KAAKy3C,mBAC9C38C,SAAAA,EAAQu9C,oBAAoB,SAAUr4C,KAAKy3C,kBAC/C,GAAC,CAAAz4C,IAAA,iBAAAH,MAED,WACI,IAAImB,KAAKo3C,UAAUvoC,OAAOypC,qBAYtB,OAAOx9C,aAAM,EAANA,EAAQU,SAAS+8C,gBAXxB,IAGgCl6C,EADkBC,EAAAC,EAFhC1E,EAASmG,KAAKo3C,UAAUvoC,OAAOypC,sBAC3Ct4C,KAAKo3C,UAAUvoC,OAAOypC,qBACtB,CAACt4C,KAAKo3C,UAAUvoC,OAAOypC,uBACG,IAAhC,IAAAh6C,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAkC,CAAA,IAAvBgK,EAAQtK,EAAAQ,MACTsE,EAAUrI,aAAM,EAANA,EAAQU,SAASg9C,cAAc7vC,GAC/C,GAAIxF,EACA,OAAOA,CAEf,CAAC,CAAA,MAAArE,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CAKT,GAAC,CAAA6E,IAAA,gBAAAH,MAED,WACI,IAAMsE,EAAUnD,KAAKy4C,iBACrB,OAAOt1C,EAAUsJ,KAAKihB,IAAI,EAAGvqB,EAAQqzC,aAAerzC,EAAQu1C,cAAgB,CAChF,GAAC,CAAA15C,IAAA,WAAAH,MAED,WACI,GAAImB,KAAKo3C,UAAUvoC,OAAOypC,qBAAsB,CAC5C,IAAMn1C,EAAUnD,KAAKy4C,iBACrB,OAAQt1C,GAAWA,EAAQw1C,WAAc,CAC7C,CACI,OAAO79C,IAASA,EAAOw7C,SAAWx7C,EAAO89C,aAAe99C,EAAOU,SAAS+8C,gBAAgBI,YAAiB,CAEjH,GAAC,CAAA35C,IAAA,iBAAAH,MAED,WACI,IAAMsE,EAAUnD,KAAKy4C,iBACrB,OAAOt1C,eAAAA,EAASqzC,eAAgB,CACpC,GAAC,CAAAx3C,IAAA,YAAAH,MAED,WACI,IAAMsE,EAAUnD,KAAKy4C,iBACfC,GAAev1C,aAAO,EAAPA,EAASu1C,eAAgB,EAC9C,OAAO14C,KAAKu2C,WAAamC,CAC7B,KAAC5C,CAAA,CApKuB,GAuK5B,SAASgC,GAAM79C,EAAW+jB,EAAa0P,GACnC,OAAOjhB,KAAKihB,IAAI1P,EAAKvR,KAAKuR,IAAI/jB,EAAGyzB,GACrC,CCpMO,IC2EFmrB,GAKDC,GAGAC,GDnFSC,GAAyF,CAClGC,UAAW,SAACC,GAAa,QACnBp+C,GAAUA,EAAOW,SAAS2L,KAAKX,cAAcnL,QAAQ49C,EAAczyC,gBAAkB,CAAC,EAC5Fc,MAAO,SAAC2xC,GAAa,QAAOp+C,GAAUimB,GAAoBjmB,EAAOW,SAAS2L,KAAM8xC,EAAc,EAC9FC,MAAO,SAACD,GAAa,OAAKp+C,aAAM,EAANA,EAAQW,SAAS2L,QAAS8xC,CAAa,GAGxDE,GAAc,WAGvB,SAAAA,EAAY7qC,GAAmBpC,OAAAitC,GAC3Bp5C,KAAKuO,SAAWA,CACpB,CAsDC,OAtDAlC,EAAA+sC,EAAA,CAAA,CAAAp6C,IAAA,aAAAH,MAED,SAAWqF,GAA+C,IAAAwM,EAAA1Q,KAArBq5C,EAAW/8C,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GACtCg9C,EAAkBt5C,KAAKuO,SAAS+G,aAAa5H,IACnD,GAAK4rC,IAAmBD,EAYpB,OAAOn1C,EAASo1C,GAXhBt5C,KAAKuO,SAASuI,cACV9W,KAAKuO,SAASwI,cAAcC,YAAY,MAAKra,uBAAAA,OAAyBqD,KAAKuO,SAASM,OAAO+E,QAC3F,GACA,CAAEqD,OAAQ,QACV,SAACvL,GAAa,IAAA4L,EACJiiC,EAAU7tC,EAAS6tC,SAAW,GAEpC,eADAjiC,EAAA5G,EAAKnC,SAASG,mBAAW,IAAA4I,GAAzBA,EAA2BzD,SAAQC,EAAA,CAAA,EAAIpG,GAAU6rC,IAC1Cr1C,EAASq1C,EACpB,GAKZ,GAAC,CAAAv6C,IAAA,2BAAAH,MAED,SAAyBqF,GAA+C,IAAAmN,EAAArR,KAArBq5C,EAAW/8C,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GAC1D0D,KAAKw5C,YAAW,SAACD,GACb,IAiBME,EAjBgBF,EAAQ9zC,QAAO,SAACi0C,GAClC,SAAUA,EAAOC,YAAeD,EAAOE,SAC3C,IAC8Cn0C,QAAO,SAACi0C,GAAW,IAAAG,EAAAC,EAAAC,EAAAC,EAC7D,IAAKN,EAAOO,WACR,OAAO,EAIX,IAAMC,EAA4BL,QAAjBA,EAAAH,EAAOO,sBAAUJ,IAAjBA,EAAmB1yC,KAC9B6xC,GAAsD,QAAhCc,EAAkB,QAAlBC,EAACL,EAAOO,kBAAPF,IAAiBA,OAAjBA,EAAAA,EAAmBI,oBAAYL,IAAAA,EAAAA,EAAI,aAAaJ,EAAOO,WAAW9yC,KAEzFizC,EAAiCJ,QAAjBA,EAAAN,EAAOO,kBAAPD,IAAiBA,IAAjBA,EAAmBrxC,WACnCnN,aAAQ,EAARA,EAAUg9C,cAAckB,EAAOO,WAAWtxC,WAEhD,OAAOuxC,GAAYE,CACvB,IACwD30C,QAAO,SAACi0C,GAC5D,IAAKA,EAAOW,kBAAoBX,EAAOY,mBACnC,OAAO,EAEX,IAAMC,GAAkBb,EAAOW,iBACzBhpC,EAAK9C,SAASqG,aAAa4lC,iBAAiBd,EAAOW,iBAEnDI,GAAqBf,EAAOY,oBAC5BjpC,EAAK9C,SAASqG,aAAa4lC,iBAAiBd,EAAOY,oBAEzD,OAAOC,GAAmBE,CAC9B,IAEA,OAAOv2C,EAASu1C,EACnB,GAAEJ,EACP,KAACD,CAAA,CA3DsB,GEJdsB,GAAW,WAAA,SAAAA,IAAA,IAAAhqC,EAAA1Q,KAAAmM,OAAAuuC,GAAA5mC,EAAA9T,KAAA,SACa,CAAA,GAAE8T,EAAA9T,KAAA,oBAWT,SAAC26C,GACvB,IAAMrxC,EAA2BqxC,EAAalM,aAE9C,GAAKnlC,GAASA,EAAK/M,OAInB,KACsC8Z,KAAK0I,MAAMzV,GACPsxC,eAAiB,IAClCx/C,SAAQ,SAACy/C,GAC1B9+C,EAAOa,KAAID,iBAAAA,OAAkBk+C,GAAY,SAAQ,uBACjDnqC,EAAKoqC,OAAOD,IAAY,IAAIl7C,MAAOkS,UA9BnB,GA+BpB,GACH,CAAC,MAAO9S,GAEL,YADAhD,EAAOgB,KAAIJ,4DAAAA,OAA6DoC,aAAAA,EAAAA,EAAGm6B,QAAY,KAAA,CAAE5vB,KAAAA,GAE7F,IACH,CApBA,OAoBA+C,EAAAquC,EAAA,CAAA,CAAA17C,IAAA,gBAAAH,MA3BD,SAAqBg8C,GACjB,IAAME,EAAa/6C,KAAK86C,OAAOD,GAAY,YAAa,EAExD,OAAmB,IAAfE,IAGG,IAAIp7C,MAAOkS,UAAYkpC,CAClC,KAACL,CAAA,CAVmB,GCoBlBM,GAA8B,WAChC,OAAAzwC,EAAA,CACI0wC,iBAAiBx/C,eAAAA,EAAU6sB,WAAY,GACvCb,gBAAiB1B,GAAM0B,mBACpB1B,GAAMC,iBAEjB,EAEak1B,GAAmB,WAK5B,SAAAA,EACIC,EACAzsC,EACA0sC,GACF,IAAA1qC,EAAA1Q,KAAAmM,OAAA+uC,GAAApnC,EAAA9T,KAAA,wBAYqB,SAACy2B,GACpB,IAAM4kB,EAAS3qC,EAAK4qC,kBACpB,IAAID,GAAUA,EAAO5kB,YAAcA,EAAnC,CAIA,IAAM8kB,EAAqC,CACvC9kB,UAAAA,EACA9nB,MAAO+B,EAAK8qC,gCAEhB9qC,EAAK+qC,aAAa5nC,SAAQC,EAAA,CAAA,EAAIhG,GAAuBytC,GANrD,KAfAv7C,KAAK07C,kBAAoBP,EACzBn7C,KAAKy7C,aAAe/sC,EACpB1O,KAAKw7C,6BAA+BJ,GAA+BJ,GAEnEh7C,KAAK07C,kBAAkBpjB,YAAYt4B,KAAK27C,qBAC5C,CAkCC,OAlCAtvC,EAAA6uC,EAAA,CAAA,CAAAl8C,IAAA,kBAAAH,MAED,WACI,OAAOmB,KAAKy7C,aAAa9sC,MAAMb,GACnC,GAAC,CAAA9O,IAAA,kBAAAH,MAeD,WAAkB,IAAA+8C,EACR17C,EAA0B07C,QAAzBA,EAAG57C,KAAKs7C,yBAALM,IAAsBA,OAAtBA,EAAAA,EAAwBjtC,MAClC,OAAKzO,EAIE,CACH27C,uCAAwC37C,EAAEunB,gBAC1Cq0B,iCAAkC57C,EAAE+6C,gBACpCc,mCAAoC77C,EAAE87C,WACtCC,qCAAsC/7C,EAAEg8C,aACxCC,mCAAoCj8C,EAAEk8C,WACtCC,oCAAqCn8C,EAAEo8C,YACvCC,iCAAkCr8C,EAAEs8C,UAV7B,EAYf,KAACtB,CAAA,CAjD2B,GCrCnBuB,GAA0B,CACnC,YACA,kBACA,WACA,cACA,UACA,cACA,UACA,UACA,UACA,cACA,mBACA,kBACA,SACA,yBACA,UACA,cACA,cACA,UACA,SACA,SACA,WACA,YACA,YACA,WACA,iBACA,aACA,WACA,QACA,WACA,aACA,YACA,eACA,YAIA,gBACA,cACA,mBACA,qBACA,iBACA,qBACA,oBACA,YACA,iBACA,uBACA,mBAMSC,GAAe,SAAU53B,EAAY63B,GAC9C,IAAK73B,EACD,OAAO,EAEX,IAAM83B,EAAU93B,EAAGre,cACnB,OAAOg2C,GAAwB9/C,OAAOggD,GAA2B,IAAIr1C,MAAK,SAACu1C,GACvE,IAAMC,EAAiBD,EAAUp2C,cACjC,OAAIm2C,EAAQzzC,SACDyzC,EAAQzzC,SAAS2zC,IAGoB,IAArCF,EAAQthD,QAAQwhD,EAE/B,GACJ,GHca,SAARjE,GAAAA,EAAAA,EAAQ,YAAA,GAAA,cAARA,EAAAA,EAAQ,aAAA,GAAA,cAARA,CAAQ,CAARA,KAAAA,GAAQ,CAAA,IAab,IAAMkE,GAAS,aACTC,GAAc,CAAA,EAEdC,GAAwB,UAW1BC,IAAoBr8B,KAAoD,KAAhCjlB,aAAAA,EAAAA,EAAWN,QAAQ,WAAqD,KAAnCM,aAAS,EAATA,EAAWN,QAAQ,YAEvF6hD,GAAgB,WAAH,IAAAC,E9BsXUC,EAC1B3/B,E8BvXgB,MAAyB,CAC/C+1B,SAAU,0BACV6J,WAAY,OACZC,cAAe,MACf7J,QAAS,KACT9/B,MAAO,GACP1F,aAAa,EACbwF,WAAW,EACX8pC,wB9B8WgCH,E8B9WY7hD,aAAAA,EAAAA,EAAUC,S9B+WhDiiB,EAAW2/B,aAAAA,EAAAA,EAAkB3/B,WAE9BpjB,EAAUojB,IAMoC,kBAA5CA,EAASzY,MAAM,KAAKvE,OAAO,GAAGwB,KAAK,M8BtX1CwM,YAAa,sBACb+uC,iBAAkB,GAClBC,YAAa,GACbC,OAAQZ,GACRa,cAAc,EACdlzB,uBAAwB,GACxBmzB,0BAA2B,GAC3BC,eAAe,EACfC,kBAAkB,EAClBC,mBAAmB,EACnBC,OAAO,EACP7d,SAAS,EACT8d,kBAAmB,IACnBC,SAAS,EACTjpB,2BAA2B,EAC3BkpB,qBAAqB,EACrBC,gBAAgB,EAChBlpB,kCAA8Bp6B,EAC9BujD,cAA8C,YAA/BxjD,iBAAMsiD,EAANtiD,EAAQW,gBAAQ,IAAA2hD,OAAV,EAANA,EAAkBmB,UACjCC,IAAI,EACJC,8BAA8B,EAC9BC,gCAAgC,EAChCC,0BAA0B,EAC1B3rB,mCAAoC,eACpCC,gCAAiC,KACjC4N,kBAAkB,EAElB+d,mBAAoB,GACpBC,kBAAmB,GACnB9rB,aAAa,EACb+rB,oBAAqB,KACrBC,gBAAiB,CAAE,EACnBC,eAAgB,KAChBC,uBAAuB,EACvBC,kBAAkB,EAClBC,6BAA8B,MAC9BxvB,kBAAmB,CAAE,EACrBtd,6BAA6B,EAC7BC,eAAe,EACf8sC,yBAAyB,EACzBppC,gCAAgC,EAChCmqB,8CAA8C,EAC9C8B,kCAAkC,EAClCod,iBAAkB,SAAC/P,GACf,IAAMpyC,EAAQ,oBAAsBoyC,EAAId,WAAa,IAAMc,EAAIb,aAC/D1yC,EAAOmB,MAAMA,EAChB,EACDoiD,cAAe,SAACC,GAAI,OAAKA,CAAI,EAE7BC,WAAYzC,GACZ9mB,yBAAqBl7B,EACrBiO,KAAM,UACNy2C,UAAW,CAAE,EACbC,qBAAqB,EACrBC,6BAA8B,KACjC,EAUKC,GAAe,SACjBhsC,EACA/E,EACA7F,EACA62C,GAEA,IAAItxC,EACElF,EACFL,IAASi0C,IAA0BlE,GAA8B/vC,EAAO+vC,GAAa/vC,QAAQjO,EAA3Cg+C,GAChD+G,EAAmB,CACrBC,cAAc,EACdC,UAAU,GAERC,EAAiB,SAACC,GAA2C,OAAK,SAAC3xC,GAChEuxC,EAAiBI,KAClBJ,EAAiBI,IAAgB,EAC7BJ,EAAiBC,cAAgBD,EAAiBE,WAClDH,SAAAA,EAAiBtxC,KAG5B,EAED,GAAIlF,GAAUyvC,KAAcD,GAASsH,YACjC5xC,EAAWlF,MACR,CACH,GAAIA,IAAWxP,EAASwP,GAKpB,YAJAtN,EAAOmB,MAAM,gCAAkC8L,GAMnDuF,EAAW,IAAI6xC,EACnB,CAcA,GAZA7xC,EAAS8xC,MAAMzsC,EAAO/E,EAAQ7F,EAAMi3C,EAAe,iBACnD1xC,EAAS+xB,QAAQiC,mBAEjBh0B,EAASipB,iBAAmB,IAAItD,GAAiB3lB,GACjDA,EAASipB,iBAAiByB,0BAErB1qB,EAASM,OAAOyxC,2BACjB/xC,EAASgyC,gBAAgBC,+BAG7BjyC,EAASiF,cAAgBjF,EAASM,OAAOX,YACzCA,GAAYI,yBAAyBC,GACjCL,GAAYG,sBAAuB,CACnCE,EAASiF,cAAgBjF,EAASM,OAAOX,YAGpCA,GAAY6F,kBAAkBxF,EAASM,OAAO+E,MAF/B,IACQ,KAIhB1F,GAAYiG,qBAIpBjG,GAAYoF,KAAK/E,IAHjBA,EAASiF,eAAgB,EACzBzX,EAAOa,KAAK,gFAJZ2R,EAASiF,eAAgB,EACzBzX,EAAOa,KAAK,+DAOpB,CAgBA,OAZA1D,EAAOC,MAAQD,EAAOC,OAASoV,EAASM,OAAOovC,OAI1C5jD,EAAagP,IAAWxP,EAASwP,KAGlCkF,EAASkyC,eAAe1mD,KAAKwU,EAASmyC,OAASr3C,EAAeq3C,QAC9DnyC,EAASkyC,eAAep3C,IAG5B42C,EAAe,WAAfA,CAA2B1xC,GACpBA,CACX,EAEMoyC,GAAgC,WAAA,SAAAA,IAAAx0C,OAAAw0C,GAAA7sC,gCAUO,EAAK,CAD7C,OAC6CzH,EAAAs0C,EAAA,CAAA,CAAA3hD,IAAA,uBAAA2f,IAT9C,WACI,OAAO3e,KAAK4gD,qBACf,EAAA5hC,IACD,SAAyBngB,GACrB9C,EAAOmB,MACH,qJAEJ8C,KAAK4gD,sBAAwB/hD,CACjC,KAAC8hD,CAAA,CATiC,GAiBzBP,GAAO,WAyChB,SAAAA,IAAc,IAAA1vC,EAAA1Q,KAAAmM,OAAAi0C,GAAAtsC,EApBG9T,KAAA,iBAAA,IAAI2gD,IAqBjB3gD,KAAK6O,OAASsuC,KACdn9C,KAAK8tC,YAAc,GACnB9tC,KAAKoX,sBAAuB,EAC5BpX,KAAKk0C,kBAAoBA,GACzBl0C,KAAK6gD,mBAAqB,WAAA,OIvRM,SAAChuB,GAChCiuB,SAAYA,QAAQC,SACrBhlD,EAAOgB,KAAK,uFAGhB,IAAMikD,EAAc,SAACC,EAA2B3vC,GACvC2vC,EAAIn+C,MAAMo+C,QAAUD,EAAIn+C,MAAMq+C,cAAgBtuB,EAAQrc,mBAEvDqc,EAAQuuB,QAERH,EAAIn+C,MAAMo+C,QAAUD,EAAIn+C,MAAMo+C,SAAWruB,EAAQrc,oBACjDqc,EAAQhf,SAAS,CACb0C,YAAa0qC,EAAIn+C,MAAMo+C,SAE3BruB,EAAQtY,sBAGZ,IAAM8mC,EAAuBxuB,EAAQyuB,4BAA4BhwC,EAAW2vC,EAAIn+C,MAAMwX,YAEtF,OADA2mC,EAAIn+C,MAAMwX,WAAa7gB,OAAO8/B,OAAO,GAAI8nB,EAAsBJ,EAAIn+C,MAAMwX,YAClE2mC,GAGX,MAAO,CACHj4C,KAAM,aACN5F,KAAM,aACNsiB,QAAS,QACT67B,SAAU,WAAA,OAAM,CAAI,EAGpBx3B,KAAM,WAAA,OAAM+2B,QAAQC,SAAS,EAC7BS,MAAO,SAACP,GAAG,OAAKD,EAAYC,EAAKA,EAAIn+C,MAAMA,MAAM,EACjD2+C,KAAM,SAACR,GAAG,OAAKD,EAAYC,EAAK,YAAY,EAC5CS,SAAU,SAACT,GAAG,OAAKD,EAAYC,EAAK,YAAY,EAChDt4B,OAAQ,SAACs4B,GAAG,OAAKD,EAAYC,EAAK,UAAU,EAEpD,CJoPwCU,CAAyBjxC,EAAK,EAC9D1Q,KAAK4hD,eAAiB,GACtB5hD,KAAK6hD,gBAAkB,GACvB7hD,KAAK4Y,UAAW,EAChB5Y,KAAK05B,+BAA4B3+B,EACjCiF,KAAKwT,mBAAgBzY,EACrBiF,KAAK8hD,yBAA2B,MAChC9hD,KAAKwS,uBAAwB,EAE7BxS,KAAK4U,aAAe,IAAIG,GAAoB/U,MAC5CA,KAAKsgC,QAAU,IAAIU,GAAQhhC,MAC3BA,KAAKugD,gBAAkB,IAAIzK,GAAgB91C,MAC3CA,KAAKu5C,QAAU,IAAIH,GAAep5C,MAClCA,KAAKiwC,YAAc,IAAIyK,GACvB16C,KAAK+W,cAAgB,IAAIy8B,GAAcxzC,MAGvCA,KAAK0gD,OAAS,CACV1hC,IAAK,SAAC7f,EAA2B4iD,EAAa79C,GAC1C,IAAM89C,EAAW1nD,EAAU6E,GAAK2U,EAAM3U,CAAAA,EAAAA,EAAO4iD,GAAO5iD,EACpDuR,EAAKuxC,oBAAoBD,GACzB99C,SAAAA,EAAW,CAAA,EACd,EACDg+C,SAAU,SAAC/iD,EAA2B4iD,EAAa79C,GAC/C,IAAM89C,EAAW1nD,EAAU6E,GAAK2U,EAAM3U,CAAAA,EAAAA,EAAO4iD,GAAO5iD,EACpDuR,EAAKuxC,yBAAoBlnD,EAAWinD,GACpC99C,SAAAA,EAAW,CAAA,EACf,EAER,CAytDC,OArtDDmI,EAAA+zC,EAAA,CAAA,CAAAphD,IAAA,OAAAH,MAgBA,SAAK+U,EAAe/E,EAAiC7F,GACjD,GAAI3O,EAAa2O,GACbjN,EAAOsB,SAAS,kEAIpB,GAAIhD,EAAauZ,IjC/UK,SAAU3Z,GACpC,OAAOK,EAAUL,IAA0B,IAApBA,EAAEuP,OAAOjN,MACpC,CiC6UmC4lD,CAAevuC,GACtC7X,EAAOsB,SAAS,sDADpB,CAKA,GAAI2L,IAASi0C,GAAb,CAOA,IAAM1uC,EAAoBqxC,GAAahsC,EAAO/E,EAAQ7F,GAAM,SAACuF,GACzDwqC,GAAa/vC,GAAQuF,EACrBA,EAAS6zC,SACb,IAGA,OAFArJ,GAAa/vC,GAAQuF,EAEdA,CARP,CAJIxS,EAAOsB,SACH,6FAJR,CAgBJ,GAcA,CAAA2B,IAAA,QAAAH,MACA,SACI+U,GAII,IAAAyuC,EAAAC,EAAAC,EAAAlxC,EAAArR,KAHJ6O,EAA8BvS,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG,CAAA,EACjC0M,EAAa1M,UAAAC,OAAAD,EAAAA,kBAAAvB,EACbglD,EAA0CzjD,UAAAC,OAAAD,EAAAA,kBAAAvB,EAE1CiF,KAAK4Y,UAAW,EAChB5Y,KAAK6O,OAAS,GACd7O,KAAKwiD,kBAAoB,GAOzB,IA0BkDC,EA1B5C3C,EAAmB,CAAE4C,iBAAiB,EAAO1C,UAAU,GACvD2C,EAAqB,SAACzC,GAA2C,OAAK,WAInEJ,EAAiBI,KAClBJ,EAAiBI,IAAgB,EAC7BJ,EAAiB4C,iBAAmB5C,EAAiBE,WACrDD,SAAAA,EAAe1uC,KAG1B,GAGDxC,EAAOkwC,gBAAkBlwC,EAAOkwC,iBAAmBlwC,EAAO+zC,YAE1D5iD,KAAK6iD,WACD5jD,EAAQ,CAAE,EAAEk+C,KAAiBtuC,EAAQ,CACjC7F,KAAMA,EACN4K,MAAOA,KAOX9Y,SAAaunD,QAAPA,EAANvnD,EAAQ2wB,iBAAK42B,GAAbA,EAAermB,QAAUlhC,SAAAA,EAAQ8/B,eAGjC56B,KAAK05B,0BAA4B5+B,SAAa,QAAP2nD,EAAN3nD,EAAQ2wB,aAARg3B,IAAaA,OAAPA,EAANA,EAAe/8B,SAsCpD,GAnCA1lB,KAAK0O,YAAc,IAAIgb,GAAmB1pB,KAAK6O,QAC/C7O,KAAK8iD,mBAC2B,mBAA5B9iD,KAAK6O,OAAOH,YACN1O,KAAK0O,YACL,IAAIgb,GAAkBnf,EAAAA,EAAA,CAAA,EAAMvK,KAAK6O,QAAM,GAAA,CAAEH,YAAa,oBAEhE1O,KAAK+iD,cAAgB,IAAI9f,GAAajjC,KAAKgjD,qBAAqB3uC,KAAKrU,OACrEA,KAAKijD,YAAc,IAAInT,GAAW9vC,KAAK6O,OAAOwwC,iBAAkBr/C,KAAKiwC,aACrEjwC,KAAK4hD,eAAiB,GACtB5hD,KAAK6hD,gBAAkB,GAEvB7hD,KAAKy0B,eAAiB,IAAI6c,GAAiBtxC,KAAK6O,OAAQ7O,KAAK0O,aAC7D1O,KAAKkjD,oBAAsB,IAAIhI,GAAoBl7C,KAAKy0B,eAAgBz0B,KAAK0O,aAE7E1O,KAAKmjD,aAEDt0C,EAAOu0C,SAEPpjD,KAAK6O,OAAOywC,cAAgB,WAAA,OAAMzwC,EAAOu0C,QAAQC,OAAOlC,aAAa,EAGjEtyC,EAAOu0C,QAAQC,OAAOp6C,OACtBjJ,KAAK6T,SAAS,CACV0C,YAAa1H,EAAOu0C,QAAQC,OAAOp6C,OAEvCjJ,KAAK0O,YAAY40C,eAAe,eAGpCz0C,EAAOu0C,QAAQvvC,SAAS7T,KAAK6gD,sBAAsBtS,KAAKoU,EAAmB,qBAE3EA,EAAmB,kBAAnBA,QAKiC5nD,KAAjB,QAAhBunD,EAAAzzC,EAAO4wC,iBAAS,IAAA6C,OAAA,EAAhBA,EAAkBiB,YAA0B,CAAA,IAAAC,EAAAC,EACtClE,EAAOv/C,KAAK6O,OAAOywC,cAAcniC,MACjCumC,EAA2BF,QAAhBA,EAAA30C,EAAO4wC,qBAAS+D,GAAhBA,EAAkBG,eAAiBpE,EAAO1wC,EAAO4wC,UAAU8D,WAC5EvjD,KAAK0O,YAAY40C,eAA+BG,QAAhBA,EAAA50C,EAAO4wC,qBAASgE,GAAhBA,EAAkBE,eAAiB,aAAe,aAClF3jD,KAAK6T,SAAS,CACV0C,YAAa1H,EAAO4wC,UAAU8D,WAC9BK,WAAYF,GAEpB,CAEA,GAAI1jD,KAAKkgC,+BAAgC,CAAA,IAAA2jB,EAAAC,EAC/BC,EAActqD,OAAO+F,MAAqB,QAAhBqkD,EAAAh1C,EAAO4wC,iBAAPoE,IAAgBA,OAAhBA,EAAAA,EAAkBjvC,eAAgB,CAAA,GAC7DnP,QAAO,SAACwU,GAAI,IAAA+pC,EAAAC,EAAA,gBAAMD,EAACn1C,EAAO4wC,iBAAS,IAAAuE,GAAc,QAAdC,EAAhBD,EAAkBpvC,oBAAlBqvC,IAA8BA,IAA9BA,EAAiChqC,GAAK,IACzDE,QACG,SAACC,EAAuCpb,GAAG,IAAAklD,EAAAC,EAAA,OACtC/pC,EAAIpb,IAAuB,QAAhBklD,EAAAr1C,EAAO4wC,iBAAS,IAAAyE,GAAc,QAAdC,EAAhBD,EAAkBtvC,oBAAY,IAAAuvC,OAAd,EAAhBA,EAAiCnlD,MAAQ,EAAQob,CAChE,GACD,CACJ,GACEgqC,EAAsB3qD,OAAO+F,MAAqB,QAAhBskD,EAAAj1C,EAAO4wC,iBAAPqE,IAAgBA,OAAhBA,EAAAA,EAAkBM,sBAAuB,CAAA,GAC5E3+C,QAAO,SAACzG,GAAG,OAAK+kD,EAAY/kD,EAAI,IAChCmb,QAAO,SAACC,EAA+Bpb,GAAQ,IAAAqlD,EAAAC,EACMC,EAAAC,EAA9BH,QAApBA,EAAIx1C,EAAO4wC,qBAAS4E,WAAAC,EAAhBD,EAAkBD,2BAAmB,IAAAE,GAArCA,EAAwCtlD,KACxCob,EAAIpb,GAAuBulD,QAAnBA,EAAG11C,EAAO4wC,qBAAS8E,GAAqB,QAArBC,EAAhBD,EAAkBH,2BAAlBI,IAAqCA,SAArCA,EAAwCxlD,IAEvD,OAAOob,CACV,GAAE,CAAE,GAETpa,KAAK4U,aAAasC,qBAAqB,CAAEtC,aAAcmvC,EAAaK,oBAAAA,GACxE,CAEA,IAAKpkD,KAAKwW,kBAAmB,CAIzB,IAAM+oC,EAAOv/C,KAAK6O,OAAOywC,cAAcniC,MACvCnd,KAAKykD,cACD,CACIluC,YAAagpC,EACbqE,WAAYrE,GAEhB,IAGJv/C,KAAK0O,YAAY40C,eAAe,YACpC,CAGAxoD,SAAwB,QAAlBynD,EAANznD,EAAQ0I,wBAAgB,IAAA++C,GAAxBA,EAAAxoD,KAAAe,EAA2B,eAAgB4pD,KAAO,WAAa,SAAU1kD,KAAK2kD,eAAetwC,KAAKrU,OAIlG2iD,EAAmB,WAAnBA,EACJ,GAEA,CAAA3jD,IAAA,uBAAAH,MAEA,SAAqB6M,GAA0B,IAAAk5C,EAE3C,GADA5kD,KAAK8tC,YAAc,GACfpiC,EAASm5C,uBAAyB7kD,KAAK6O,OAAO6wC,oBAAqB,CACnE,IACqDrhD,EAD/CyvC,EAAqD,CAAA,EAAExvC,EAAAC,EACxCmN,EAA+B,sBAAC,IAArD,IAAApN,EAAAG,MAAAJ,EAAAC,EAAAI,KAAAC,MAAuD,CACnDmvC,EADazvC,EAAAQ,QACS,CAC1B,CAAC,CAAA,MAAAC,GAAAR,EAAAS,EAAAD,EAAA,CAAA,QAAAR,EAAAnE,GAAA,CACD6F,KAAK8tC,YAAcA,CACvB,CAEsB8W,QAAtBA,EAAIl5C,EAASo5C,iBAATF,IAAkBA,GAAlBA,EAAoBvsB,WACpBr4B,KAAK8hD,yBAA2Bp2C,EAASo5C,UAAUzsB,UAGnD3sB,EAAS8G,wBACTxS,KAAKwS,sBAAwB9G,EAAS8G,sBAE9C,GAAC,CAAAxT,IAAA,UAAAH,MAED,WAII,IAAMkmD,EAAgB/kD,KAAK6O,OAAOuwC,wBAC7B2F,GACD/kD,KAAK4U,aAAaqB,oBAAmB,GAGzC,IACIjW,KAAK6O,OAAO8uC,OAAO39C,KACtB,CAAC,MAAOlB,GACL/C,EAAOsB,SAAS,2BAA4ByB,EAChD,CAEAkB,KAAKglD,2BAIDhlD,KAAK6O,OAAOkvC,kBAAoBviD,GAChCwE,KAAKgT,QAAQ,YAAa,CAAE0uB,MAAOlmC,EAASkmC,OAAS,CAAE/O,gBAAgB,IAMtEoyB,IACD,IAAI9kB,GAAOjgC,MAAMjG,OAIjBiG,KAAK4U,aAAaqwC,oBAE1B,GAAC,CAAAjmD,IAAA,2BAAAH,MAED,WAE0C,IAAAqmD,EADjCllD,KAAKmlD,2BACFnlD,KAAK6O,OAAOqwC,mBACM,QAAlBgG,EAAIllD,KAAC+iD,qBAAa,IAAAmC,GAAlBA,EAAoBliB,OAGhC,GAAC,CAAAhkC,IAAA,cAAAH,MAED,WAAoB,IAAAsU,EAAAnT,KACXA,KAAKmlD,2BACNpnD,EAAWiC,KAAK6hD,iBAAiB,SAACuD,GAC9BjyC,EAAK2D,cAAapa,MAAlByW,EAAI0rB,EAAkBumB,GAC1B,IAGJplD,KAAK6hD,gBAAkB,GAEvB7hD,KAAKglD,0BACT,GAAC,CAAAhmD,IAAA,iBAAAH,MAED,WAAuB,IAAAwmD,EAAAC,EACdtlD,KAAK6O,OAAOqwC,kBAObl/C,KAAK6O,OAAOkvC,kBAAoB/9C,KAAK6O,OAAOmvC,mBAC5Ch+C,KAAKgT,QAAQ,cAGC,QAAlBqyC,EAAIrlD,KAAC+iD,qBAAa,IAAAsC,GAAlBA,EAAoBE,SACJ,QAAhBD,EAAItlD,KAACijD,mBAAW,IAAAqC,GAAhBA,EAAkBC,UAXVvlD,KAAK6O,OAAOkvC,kBAAoB/9C,KAAK6O,OAAOmvC,mBAC5Ch+C,KAAKgT,QAAQ,aAAc,KAAM,CAAE8wB,UAAW,cAW1D,GAAC,CAAA9kC,IAAA,uBAAAH,MAED,SAAqBsI,EAAa9F,EAA2B8V,GACzD,IAAMquC,EAAWnvC,KAAKC,UAAUjV,GAChCrB,KAAKylD,iCAAiCt+C,EAAKq+C,EAAUruC,GAAW6lC,GAAaD,GACjF,GAAC,CAAA/9C,IAAA,mCAAAH,MAED,SACIsI,EACAq+C,EACAruC,EACAjT,GAEA,IAAAwhD,EKnoBD,SACH5X,EACA0X,EACAruC,GAEA,OAAI22B,IAAgBlI,GAAY+f,OAErB,CACH9Y,GAASE,GAAQyY,GAAW,CAAE7Y,MAAO,IAAIpiC,EAAAA,KACpC4M,GAAO,CAAA,EAAA,CAAEw2B,MAAM,EAAML,aAAc,CAAEQ,YAAalI,GAAY+f,WAGhE,CAAC,CAAEtkD,KAAMD,GAAcokD,IAAaruC,EAEnD,CLqnBiCyuC,CAA+B5lD,KAAK8tC,YK1oB1ClI,GAAY+f,QACxB/f,GAAY+f,OAEZ/f,GAAYigB,OLuoBwDL,EAAUruC,GAAQ2uC,EAAA/6C,EAAA26C,EAAA,GAAtFrkD,EAAIykD,EAAA,GAAEC,EAAQD,EAAA,GACrB9lD,KAAK8W,cAAc3P,EAAK9F,EAAM0kD,EAAU7hD,EAC5C,GAAC,CAAAlF,IAAA,gBAAAH,MAED,SAAcsI,EAAa9F,EAA2B8V,EAAyBjT,GAC3E,GAAKlE,KAAK4Y,UAAa5Y,KAAKijD,cAGxBjjD,KAAKiwC,YAAYiB,cAAc/5B,EAAQ2oB,WAI3C,GAAIod,GACAl9C,KAAK6hD,gBAAgB3gD,KAAK,CAACiG,EAAK9F,EAAM8V,EAASjT,QADnD,CAKA,IAAM8hD,EAAkB,CACpB/uC,OAAQjX,KAAK6O,OAAOyuC,WACpBxZ,UAAW9jC,KAAK6O,OAAO0uC,cACvBnd,QAASpgC,KAAK6O,OAAOuxB,SAGzBjpB,EAAUlY,EAAQ+mD,EAAiB7uC,GAAW,CAAE,GAC3C0J,KACD1J,EAAQF,OAAS,OAGrB,IAAMgvC,EAAgBnrD,GAAU,eAAgBA,EAAOS,WAAmC,eAAtB4b,EAAQ2sB,UAK5E,GAJA38B,EAAMkmC,GAAelmC,EAAKgQ,EAAQm2B,cAAgB,CAAA,EAAI,CAClDkR,GAAIx+C,KAAK6O,OAAO2vC,KAGhByH,EAGA,IACInrD,SAAAA,EAAQS,UAAUqyC,WAAWzmC,EAAKumC,GAAersC,EAAIkJ,EAAAA,KAAO4M,GAAO,GAAA,CAAEy2B,YAAY,KACpF,CAAC,MAAO7uC,GAEL,MAED,GAAI8hB,KAAqBrlB,EAC5B,IACIuoC,GAAQ,CACJ58B,IAAAA,EACA9F,KAAAA,EACA0tB,QAAS/uB,KAAK6O,OAAOkwC,gBACrB5nC,QAAAA,EACAjT,SAAAA,EACAkqC,sBAAuB,EACvBU,WAAY9uC,KAAKijD,YACjBpU,QAAS7uC,KAAK6O,OAAOwwC,iBACrBzQ,WAAY5uC,KAAKiwC,YAAYmB,kBAEpC,CAAC,MAAOryC,GACLhD,EAAOmB,MAAM6B,EACjB,KACG,CAAA,IAAAmnD,EACGC,EAAS3qD,EAAS6I,cAAc,UACtC8hD,EAAO/iD,KAAO,kBACd+iD,EAAOC,OAAQ,EACfD,EAAOE,OAAQ,EACfF,EAAO7hD,IAAM6C,EACb,IAAM1I,EAAIjD,EAAS8qD,qBAAqB,UAAU,GACtCJ,QAAZA,EAAAznD,EAAEmG,kBAAFshD,IAAYA,GAAZA,EAAcrhD,aAAashD,EAAQ1nD,EACvC,CAnDA,CAoDJ,GAEA,CAAAO,IAAA,iBAAAH,MAYA,SAAe0nD,GAAiC,IACxCC,EADwC5sC,EAAA5Z,KAEtCymD,EAAkC,GAClCC,EAAkC,GAClCC,EAAsC,GAC5C5oD,EAAWwoD,GAAO,SAACnB,GACXA,IACAoB,EAAUpB,EAAK,GACXvrD,EAAS2sD,GACTG,EAAgBzlD,KAAKkkD,GACdlrD,EAAYkrD,GACjBA,EAAarrD,KAAK6f,GACb/f,EAASurD,IAAqB,UAAZoB,EACzBC,EAAYvlD,KAAKkkD,GACVvrD,EAASurD,KAAyC,IAAhCoB,EAAQlrD,QAAQ,YAAqBpB,EAAa0f,EAAa4sC,IACxFG,EAAgBzlD,KAAKkkD,GAErBsB,EAAYxlD,KAAKkkD,GAG7B,IAEA,IAAMwB,EAAU,SAAUC,EAA2B5oD,GACjDF,EACI8oD,GACA,SAAUzB,GACN,GAAIvrD,EAASurD,EAAK,IAAK,CAEnB,IAAI0B,EAAS7oD,EACbG,EAAMgnD,GAAM,SAAUrrD,GAClB+sD,EAASA,EAAO/sD,EAAK,IAAI2C,MAAMoqD,EAAQ/sD,EAAK2G,MAAM,GACtD,GACJ,MAGIV,KAAKolD,EAAK,IAAI1oD,MAAMsD,KAAMolD,EAAK1kD,MAAM,GAE5C,GACDzC,IAIR2oD,EAAQH,EAAazmD,MACrB4mD,EAAQF,EAAa1mD,MACrB4mD,EAAQD,EAAiB3mD,KAC7B,GAAC,CAAAhB,IAAA,+BAAAH,MAED,WAAwC,IAAAkoD,EAAAC,EACpC,OAC0B,QAArBD,EAAA/mD,KAAK6O,OAAO4wC,iBAAS,IAAAsH,OAAA,EAArBA,EAAuBnyC,eAAgBnb,OAAO+F,aAAIwnD,EAAChnD,KAAK6O,OAAO4wC,iBAAS,IAAAuH,OAAA,EAArBA,EAAuBpyC,cAAcrY,OAAS,IAClG,CAER,GAEA,CAAAyC,IAAA,OAAAH,MAYA,SAAKumD,GACDplD,KAAKygD,eAAe,CAAC2E,GACzB,GAEA,CAAApmD,IAAA,UAAAH,MAkBA,SACIssB,EACA7Q,GAEoB,IAAA2sC,EADpB9vC,EAAuB7a,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,GAAAA,UAAA,GAAG0gD,GAI1B,IAAKh9C,KAAK4Y,WAAa5Y,KAAK8iD,qBAAuB9iD,KAAK+iD,cACpD,OAAOhnD,EAAO0B,qBAAqB,mBAGvC,IAAIm1B,GAAa5yB,MAAjB,CAKA,IAAM8jC,GADN3sB,EAAUA,GAAW6lC,IACgB,UAMrC,GALIlZ,IACA3sB,EAAQ2sB,UAAYA,IAIpBzpC,EAAa8wB,IAAgB7wB,EAAU6wB,IAK3C,IACIvvB,GACCoE,KAAK6O,OAAO8vC,2BACbjC,GAAa9gD,EAAWoE,KAAK6O,OAAOgvC,2BAHxC,CASA79C,KAAK8iD,mBAAmBoE,wBAEpBlnD,KAAK6O,OAAO+uC,cACZ59C,KAAK8iD,mBAAmBqE,yBAExBnnD,KAAK6O,OAAOivC,eACZ99C,KAAK8iD,mBAAmBsE,uBAG5B,IAAI/lD,EAAsB,CACtBk+C,KAAMpiC,KACNra,MAAOqoB,EACP7Q,WAAYta,KAAKshD,4BAA4Bn2B,EAAY7Q,GAAc,CAAA,IAGxD,cAAf6Q,IACA9pB,EAAW,KAAI8V,EAAc,KAC7B9V,EAAgB,UAAI8V,EAAmB,YAG3C9V,EAAOf,GAAwBe,EAAM8V,EAAQ0oB,YAAc,KAAO7/B,KAAK6O,OAAOswC,+BACzE5yC,UAAY4K,EAAQ5K,WAAa,IAAI5M,KACrCtF,EAAa8c,EAAQ5K,aACtBlL,EAAKiZ,WAA0C,+BAAI,EACnDjZ,EAAKiZ,WAA6C,iCAAI,IAAI3a,MAK9D,IAAM0nD,EAAQ98C,EAAAA,KAAQlJ,EAAKiZ,WAAiB,MAAMjZ,EAAW,OjC/1BvC,SAAUpH,GACpC,GAAIG,EAAUH,GAAI,CACd,IAAK,IAAM+E,KAAO/E,EACd,GAAIN,EAAeI,KAAKE,EAAG+E,GACvB,OAAO,EAGf,OAAO,CACX,CACA,OAAO,CACX,EiCs1BasoD,CAAeD,IAChBrnD,KAAK0Z,4BAA4B2tC,GAGrCtrD,EAAOa,KAAK,OAAQyE,GACpB,IAAMmkD,EAAWnvC,KAAKC,UAAUjV,GAE1B8F,EAAkB8/C,QAAfA,EAAG9vC,EAAQyoB,YAAIqnB,IAAAA,EAAAA,EAAIjnD,KAAK+W,cAAcC,YAAY,MAAOhX,KAAK8hD,0BAEjEyF,EAAoBpwC,IAAY6lC,GAUtC,OARIh9C,KAAK6O,OAAOqwC,kBAAsBqI,IAAqBpwC,EAAQ2oB,WAAe3oB,EAAQwb,eAGtF3yB,KAAKylD,iCAAiCt+C,EAAKq+C,EAAUruC,GAFrDnX,KAAK+iD,cAAchU,QAAQ5nC,EAAK9F,EAAM8V,GAK1CnX,KAAKwnD,oBAAoBr8B,EAAY9pB,GAE9BA,CApDP,OAVItF,EAAOmB,MAAM,4CAVjB,CAyEJ,GAAC,CAAA8B,IAAA,kBAAAH,MAED,SAAgBqF,GACZlE,KAAK4hD,eAAe1gD,KAAKgD,EAC7B,GAAC,CAAAlF,IAAA,sBAAAH,MAED,SAAoByS,EAAmBm2C,GACnCznD,KAAK6O,OAAO2wC,WAAWluC,EAAWm2C,GAClCrpD,EAAM4B,KAAK4hD,gBAAgB,SAAC19C,GAAQ,OAAKA,EAASoN,KACtD,GAAC,CAAAtS,IAAA,8BAAAH,MAED,SAA4BssB,EAAoBu8B,GAC5C,IAAK1nD,KAAK0O,cAAgB1O,KAAK8iD,mBAC3B,OAAO4E,EAIX,IAAMC,EAAkB3nD,KAAK0O,YAAYk5C,mBAAmBz8B,GACxD7Q,EAAU/P,EAAA,CAAA,EAAQm9C,GAGtB,GAFAptC,EAAkB,MAAIta,KAAK6O,OAAO+E,MAEf,cAAfuX,EAA4B,CAC5B,IAAM08B,EAAgBt9C,EAAAA,EAAQ,CAAA,EAAAvK,KAAK0O,YAAY4L,cAAiBta,KAAK8iD,mBAAmBxoC,cAExF,OADAA,EAAwB,YAAIutC,EAAiBtxC,YACtC+D,CACX,CAEA,IAAMwtC,EAAiB/hC,GAAMzL,aAE7B,GAAIta,KAAKy0B,eAAgB,CACrB,IAAAszB,EAAgC/nD,KAAKy0B,eAAeO,gCAA5CyB,EAASsxB,EAATtxB,UAAW6D,EAAQytB,EAARztB,SACnBhgB,EAAwB,YAAImc,EAC5Bnc,EAAuB,WAAIggB,CAC/B,CAEA,GACIt6B,KAAKkjD,qBACLljD,KAAK6O,OAAOm5C,uCACI,cAAf78B,GAA6C,eAAfA,GAA8C,iBAAfA,GAChE,CACE,IAAM88B,EAAejoD,KAAKkjD,oBAAoBgF,kBAC9C5tC,EAAarb,EAAQqb,EAAY2tC,EACrC,CAEA,IAAKjoD,KAAK6O,OAAOyxC,0BAA2B,CACxC,IAAI6H,EAA6C,CAAA,EAC9B,cAAfh9B,EACAg9B,EAAwBnoD,KAAKugD,gBAAgB6H,aACvB,eAAfj9B,IACPg9B,EAAwBnoD,KAAKugD,gBAAgB8H,eAEjD/tC,EAAarb,EAAQqb,EAAY6tC,EACrC,CAMA,GAJmB,cAAfh9B,GAA8B3vB,IAC9B8e,EAAkB,MAAI9e,EAASkmC,OAGhB,uBAAfvW,EAAqC,CACrC,IAAM08B,EAAmB7nD,KAAK0O,YAAY4L,aAI1C,OAFAA,EAAwB,YAAIutC,EAAiBtxC,YAC7C+D,EAAyB,aAAIwtC,EAAe3/B,aACrC7N,CACX,CAGA,IAAKjgB,EAAastD,GAAkB,CAChC,IAAMW,GAAiB,IAAI3oD,MAAOkS,UAAY81C,EAC9CrtC,EAAsB,UAAIyM,YAAYuhC,EAAiB,KAAMC,QAAQ,GACzE,EAII3sD,GAAaoE,KAAK6O,OAAO8vC,2BACzBrkC,EAA0B,cAAIoiC,GAAa9gD,EAAWoE,KAAK6O,OAAOgvC,2BAC5D,MACA,WAQVvjC,EAAarb,EACT,CAAA,EACA8mB,GAAMzL,aACNta,KAAK0O,YAAY4L,aACjBta,KAAK8iD,mBAAmBxoC,aACxBA,GAGAzgB,EAASmG,KAAK6O,OAAOgwC,oBAAsBhlD,EAASmG,KAAK6O,OAAO+vC,qBAIhExgD,EADuBzB,GAAAA,OAAAkiC,EAAO7+B,KAAK6O,OAAO+vC,oBAAkB/f,EAAK7+B,KAAK6O,OAAOgwC,qBACpD,SAAU2J,UACxBluC,EAAWkuC,EACtB,IAEAzsD,EAAOmB,MACH,+CACI8C,KAAK6O,OAAOgwC,kBACZ,kCACA7+C,KAAK6O,OAAO+vC,oBAIxB,IAAME,EAAsB9+C,KAAK6O,OAAOiwC,oBAKxC,OAJIA,IACAxkC,EAAawkC,EAAoBxkC,EAAY6Q,IAG1C7Q,CACX,GAEA,CAAAtb,IAAA,WAAAH,MAsBA,SAASyb,EAAwB2E,GAAqB,IAAAwpC,UAClDA,EAAAzoD,KAAK0O,mBAAW,IAAA+5C,GAAhBA,EAAkB50C,SAASyG,EAAY2E,EAC3C,GAEA,CAAAjgB,IAAA,gBAAAH,MAuBA,SAAcyb,EAAwBiQ,EAA0BtL,GAAqB,IAAAypC,EACjE,QAAhBA,EAAI1oD,KAAC0O,mBAALg6C,IAAgBA,GAAhBA,EAAkBjE,cAAcnqC,EAAYiQ,EAAetL,EAC/D,GAEA,CAAAjgB,IAAA,uBAAAH,MAuBA,SAAqByb,GAA8B,IAAAquC,EACxBA,QAAvBA,EAAA3oD,KAAK8iD,0BAAL6F,IAAuBA,GAAvBA,EAAyB90C,SAASyG,EACtC,GAEA,CAAAtb,IAAA,aAAAH,MAKA,SAAW+pD,GAAwB,IAAAC,EACfA,QAAhBA,EAAA7oD,KAAK0O,mBAALm6C,IAAgBA,GAAhBA,EAAkBhwC,WAAW+vC,EACjC,GAEA,CAAA5pD,IAAA,yBAAAH,MAKA,SAAuB+pD,GAAwB,IAAAE,EACpBA,QAAvBA,EAAA9oD,KAAK8iD,0BAALgG,IAAuBA,GAAvBA,EAAyBjwC,WAAW+vC,EACxC,GAAC,CAAA5pD,IAAA,mBAAAH,MAED,SAAiBM,EAAcN,GAC3BmB,KAAK6T,SAAQC,KAAI3U,EAAON,GAC5B,GAEA,CAAAG,IAAA,iBAAAH,MAUA,SAAeG,EAAamY,GACxB,OAAOnX,KAAK4U,aAAakD,eAAe9Y,EAAKmY,EACjD,GAEA,CAAAnY,IAAA,wBAAAH,MAYA,SAAsBG,GAClB,IAAM8vB,EAAU9uB,KAAK4U,aAAam0C,sBAAsB/pD,GACxD,IACI,OAAOqX,KAAK0I,MAAM+P,EACrB,CAAC,MAAAk6B,GACE,OAAOl6B,CACX,CACJ,GAEA,CAAA9vB,IAAA,mBAAAH,MAUA,SAAiBG,EAAamY,GAC1B,OAAOnX,KAAK4U,aAAa4lC,iBAAiBx7C,EAAKmY,EACnD,GAAC,CAAAnY,IAAA,qBAAAH,MAED,WACImB,KAAK4U,aAAa2F,oBACtB,GAEA,CAAAvb,IAAA,qCAAAH,MACA,SAAmCG,EAAaoa,GAC5CpZ,KAAK4U,aAAaq0C,mCAAmCjqD,EAAKoa,EAC9D,GAEA,CAAApa,IAAA,yBAAAH,MACA,SAAuBqF,GAAkE,IAA5B2V,EAAYvd,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GACrE,OAAO0D,KAAK4U,aAAas0C,uBAAuBhlD,EAAU2V,EAC9D,GAEA,CAAA7a,IAAA,iBAAAH,MAYA,SAAeqF,GACX,OAAOlE,KAAK4U,aAAagkB,eAAe10B,EAC5C,GAEA,CAAAlF,IAAA,cAAAH,MAaA,SAAYqF,GAAgD,IAAAm2B,EAAA8uB,EACxD,OAAiD9uB,QAAjDA,EAA0B8uB,QAA1BA,EAAOnpD,KAAKy0B,sBAAL00B,IAAmBA,OAAnBA,EAAAA,EAAqB7wB,YAAYp0B,cAASm2B,EAAAA,EAAK,YAC1D,GAEA,CAAAr7B,IAAA,aAAAH,MACA,SAAWqF,GAAqD,IAA3Bm1C,EAAW/8C,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GAC5C0D,KAAKu5C,QAAQC,WAAWt1C,EAAUm1C,EACtC,GAEA,CAAAr6C,IAAA,2BAAAH,MACA,SAAyBqF,GAAqD,IAA3Bm1C,EAAW/8C,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,IAAAA,UAAA,GAC1D0D,KAAKu5C,QAAQ6P,yBAAyBllD,EAAUm1C,EACpD,GAEA,CAAAr6C,IAAA,WAAAH,MA8CA,SAASwqD,EAA0BC,EAAkCC,GACjE,IAAKvpD,KAAK4Y,WAAa5Y,KAAK0O,YACxB,OAAO3S,EAAO0B,qBAAqB,oBAUvC,GARIhD,EAAU4uD,KACVA,EAAmBA,EAA2BzvD,WAC9CmC,EAAOgB,KACH,uHAKHssD,EAKL,G9BjyBG,CAAC,cAAe,cAAclgD,S8BiyBNkgD,E9BjyBqB5iD,e8BkyB5C1K,EAAOsB,SAAQ,eAAAV,OACI0sD,mIAFvB,C9BlyBD,I8ByyBOG,EAAuBxpD,KAAKwW,kBAGlC,GAFAxW,KAAK6T,SAAS,CAAE41C,SAAUJ,KAErBrpD,KAAKsV,aAAa,cAAe,CAGlC,IAAMo0C,EAAYF,EAClBxpD,KAAKykD,cACD,CACIkF,4BAA4B,EAC5B/F,WAAY8F,GAEhB,GAER,CAGIL,IAAoBG,GAAwBH,IAAoBrpD,KAAKsV,aAAa1I,MAClF5M,KAAK6Y,WAAWjM,IAChB5M,KAAK6T,SAAS,CAAE0C,YAAa8yC,KAGjC,IAAMO,EAAyD,cAAtC5pD,KAAK0O,YAAYm7C,iBAItCR,IAAoBG,GAAwBI,GAC5C5pD,KAAK0O,YAAY40C,eAAe,cAGhCtjD,KAAK0Z,4BAA4B4vC,GAAuB,CAAE,GAAE,GAE5DtpD,KAAKgT,QACD,YACA,CACIuD,YAAa8yC,EACbzzC,kBAAmB4zC,GAEvB,CAAE/vC,KAAM6vC,GAAuB,CAAE,EAAEQ,UAAWP,GAA2B,CAAC,IAI9EvpD,KAAK4U,aAAam1C,uBAAuBP,KAClCF,GAAuBC,IAE9BvpD,KAAKiiD,oBAAoBqH,EAAqBC,GAK9CF,IAAoBG,IACpBxpD,KAAKua,qBAELva,KAAK6Y,WAAWlL,IAvDpB,MATI5R,EAAOmB,MAAM,sDAkErB,GAEA,CAAA8B,IAAA,sBAAAH,MAOA,SAAoByqD,EAAkCC,IAC7CD,GAAwBC,KAK7BvpD,KAAK0Z,4BAA4B4vC,GAAuB,CAAA,GAExDtpD,KAAKgT,QAAQ,OAAQ,CAAEyG,KAAM6vC,GAAuB,CAAE,EAAEQ,UAAWP,GAA2B,CAAC,IACnG,GAEA,CAAAvqD,IAAA,QAAAH,MASA,SAAM4b,EAAmBuvC,EAAkBC,GACvC,GAAKxvC,GAAcuvC,EAAnB,CAKA,IAAME,EAAiBlqD,KAAK0W,YAGxBwzC,EAAezvC,KAAeuvC,GAC9BhqD,KAAKmqD,6BAA6B1vC,GAGtCza,KAAK6T,SAAS,CAAEu2C,QAAO7/C,EAAAA,EAAA,CAAA,EAAO2/C,GAAc,CAAA,EAAAp2C,EAAA,CAAA,EAAG2G,EAAYuvC,MAEvDC,IACAjqD,KAAKgT,QAAQ,iBAAkB,CAC3Bq3C,YAAa5vC,EACb6vC,WAAYN,EACZO,WAAYN,IAEhBjqD,KAAKwqD,2BAA0B12C,KAAI2G,EAAYwvC,KAK/CC,EAAezvC,KAAeuvC,GAAaC,GAC3CjqD,KAAKua,oBAvBT,MAFIxe,EAAOmB,MAAM,oDA2BrB,GAEA,CAAA8B,IAAA,cAAAH,MAGA,WACImB,KAAK6T,SAAS,CAAEu2C,QAAS,CAAC,IAC1BpqD,KAAKmqD,+BAGLnqD,KAAKua,oBACT,GAEA,CAAAvb,IAAA,8BAAAH,MAKA,SAA4Byb,GAAyD,IAAjCC,IAAkBje,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,KAAAA,UAAA,GAClE0D,KAAK4U,aAAa8E,4BAA4BY,EAAYC,EAC9D,GAAC,CAAAvb,IAAA,gCAAAH,MAED,WACImB,KAAK4U,aAAa61C,+BACtB,GAEA,CAAAzrD,IAAA,6BAAAH,MAQA,SAA2Byb,GAA6E,IAAjCC,IAAkBje,UAAAC,OAAA,QAAAxB,IAAAuB,UAAA,KAAAA,UAAA,GACrF0D,KAAK4U,aAAa41C,2BAA2BlwC,EAAYC,EAC7D,GAAC,CAAAvb,IAAA,+BAAAH,MAED,SAA6B6b,GACzB1a,KAAK4U,aAAau1C,6BAA6BzvC,EACnD,GAEA,CAAA1b,IAAA,QAAAH,MAIA,SAAM6rD,GAAiC,IAAAC,EAAAC,EAAAC,EAAAC,EACnC,IAAK9qD,KAAK4Y,SACN,OAAO7c,EAAO0B,qBAAqB,iBAEvC,IAAMisD,EAAY1pD,KAAKsV,aAAa,cACpB,QAAhBq1C,EAAI3qD,KAAC0O,mBAAW,IAAAi8C,GAAhBA,EAAkBz/B,QACK,QAAvB0/B,EAAI5qD,KAAC8iD,0BAAkB,IAAA8H,GAAvBA,EAAyB1/B,QACT2/B,QAAhBA,EAAA7qD,KAAK0O,mBAALm8C,IAAgBA,GAAhBA,EAAkBvH,eAAe,aACd,QAAnBwH,EAAI9qD,KAACy0B,sBAAc,IAAAq2B,GAAnBA,EAAqBC,iBACrB,IAAMxL,EAAOv/C,KAAK6O,OAAOywC,cAAcniC,MACvCnd,KAAKykD,cACD,CACIluC,YAAagpC,EACbqE,WAAY8G,EAAkBnL,EAAOmK,GAEzC,GAER,GAEA,CAAA1qD,IAAA,kBAAAH,MAgBA,WACI,OAAOmB,KAAKsV,aAAa,cAC7B,GAAC,CAAAtW,IAAA,YAAAH,MAED,WACI,OAAOmB,KAAKsV,aAAa,YAAc,CAAA,CAC3C,GAEA,CAAAtW,IAAA,iBAAAH,MAOA,WAAyB,IAAAmsD,EAAAC,EACrB,eAAAD,EAA0BC,QAA1BA,EAAOjrD,KAAKy0B,sBAALw2B,IAAmBA,OAAnBA,EAAAA,EAAqBj2B,+BAA8B,GAAMyB,iBAAS,IAAAu0B,EAAAA,EAAI,EACjF,GAEA,CAAAhsD,IAAA,yBAAAH,MAOA,SAAuBsY,GACnB,IAAKnX,KAAKy0B,eACN,MAAO,GAEX,IAAAy2B,EAA6ClrD,KAAKy0B,eAAeO,+BAA8B,GAAvFyB,EAASy0B,EAATz0B,UAAW1B,EAAqBm2B,EAArBn2B,sBACf5tB,EAAMnH,KAAK+W,cAAcC,YAAY,KAAM,WAAayf,GAC5D,GAAItf,SAAAA,EAAS+9B,eAAiBngB,EAAuB,CAAA,IAAAo2B,EAC3CC,EAAqC,QAA5BD,EAAGh0C,EAAQk0C,yBAAiB,IAAAF,EAAAA,EAAI,GAC/C,IAAKp2B,EACD,OAAO5tB,EAEX,IAAMmkD,EAAqB7+C,KAAKihB,IAC5BjhB,KAAKoO,QAAO,IAAIlb,MAAOkS,UAAYkjB,GAAyB,KAAQq2B,EACpE,GAEJjkD,GAAGxK,MAAAA,OAAU2uD,EACjB,CAEA,OAAOnkD,CACX,GAEA,CAAAnI,IAAA,QAAAH,MAqBA,SAAM0sD,EAAeC,GAIjB,OAAID,IAAUvrD,KAAKsV,aAAa3I,KAC5B5Q,EAAOsB,SAAS,oEACR,IAGRhD,EAAamxD,KACbA,EAAWxrD,KAAKwW,mBAEhB+0C,IAAUC,GACVxrD,KAAKyrD,iBAAiB7+C,GAAc2+C,GAC7BvrD,KAAKgT,QAAQ,gBAAiB,CAAEu4C,MAAOA,EAAOh1C,YAAai1C,MAElEzvD,EAAOgB,KAAK,0DACZiD,KAAK0hD,SAAS6J,IACN,GAEhB,GAEA,CAAAvsD,IAAA,aAAAH,MA6IA,SAAWgQ,GACP,IACuB68C,EADjB7gC,EAAStgB,KAAQvK,KAAK6O,QAC5B,GAAIzU,EAAUyU,KACV5P,EAAQe,KAAK6O,OAAQA,GAEhB7O,KAAK6O,OAAO4uC,mBACbz9C,KAAK6O,OAAO4uC,iBAAmBz9C,KAAK6O,OAAO6uC,aAE1C19C,KAAK6O,OAAOuvC,sBACbp+C,KAAK6O,OAAOuvC,oBAAsBp+C,KAAK6O,OAAOwvC,gBAGlC,QAAhBqN,EAAI1rD,KAAC0O,mBAALg9C,IAAgBA,GAAhBA,EAAkB1hC,cAAchqB,KAAK6O,OAAQgc,GAC7C7qB,KAAK8iD,mBAC2B,mBAA5B9iD,KAAK6O,OAAOH,YACN1O,KAAK0O,YACL,IAAIgb,GAAkBnf,EAAAA,EAAA,CAAA,EAAMvK,KAAK6O,QAAM,GAAA,CAAEH,YAAa,oBAE5DmR,GAAWpB,gBAAiD,SAA/BoB,GAAWlB,IAAI,cAC5C3e,KAAK6O,OAAOovC,OAAQ,GAEpBj+C,KAAK6O,OAAOovC,QACZ/kD,EAAOC,OAAQ,GAGf6G,KAAKw3B,mBAAqBn9B,EAAawU,EAAOqmB,4BAA4B,CAC1E,IAAMy2B,EACF9gC,EAAUqK,4BAA8BrmB,EAAOqmB,0BAE7C02B,GACDh5B,GAAa5yB,QAAU6O,EAAOqmB,4BAA8Bl1B,KAAKw3B,iBAAiBq0B,SAEnFF,GAAyCC,KACrC/8C,EAAOqmB,0BACPl1B,KAAKw3B,iBAAiBhB,gBAEtBx2B,KAAKw3B,iBAAiByB,0BAGlC,CAER,GAEA,CAAAj6B,IAAA,wBAAAH,MAIA,WACImB,KAAK6iD,WAAW,CAAE3tB,2BAA2B,GACjD,GAEA,CAAAl2B,IAAA,uBAAAH,MAIA,WACImB,KAAK6iD,WAAW,CAAE3tB,2BAA2B,GACjD,GAEA,CAAAl2B,IAAA,0BAAAH,MAIA,WAAmC,IAAAitD,EAC/B,QAA8B,QAAtBA,EAAC9rD,KAAKw3B,wBAAgB,IAAAs0B,IAArBA,EAAuBD,QACpC,GAEA,CAAA7sD,IAAA,cAAAH,MAKA,SAAYsnB,GACR,OAAOnmB,KAAKsgC,QAAQa,YAAYhb,EACpC,GAEA,CAAAnnB,IAAA,eAAAH,MAkBA,SAAaktD,GAA6C,IAAAC,EACtD,OAAuBA,QAAvBA,EAAOhsD,KAAK0O,mBAALs9C,IAAgBA,OAAhBA,EAAAA,EAA0B,MAAED,EACvC,GAEA,CAAA/sD,IAAA,qBAAAH,MAmBA,SAAmBktD,GAA6C,IAAAE,EAC5D,OAA8BA,QAA9BA,EAAOjsD,KAAK8iD,0BAALmJ,IAAuBA,OAAvBA,EAAAA,EAAiC,MAAEF,EAC9C,GAAC,CAAA/sD,IAAA,WAAAH,MAED,WAAmB,IAAAqtD,EACXljD,EAAuBkjD,QAAnBA,EAAGlsD,KAAK6O,OAAO7F,YAAIkjD,IAAAA,EAAAA,EAAIjP,GAI/B,OAHIj0C,IAASi0C,KACTj0C,EAAOi0C,GAAwB,IAAMj0C,GAElCA,CACX,GAEA,CAAAhK,IAAA,aAAAH,MACA,WACyF,iBAAnDmB,KAAK6O,OAAOmkB,oCAGbnT,GAAWpB,kBACnCze,KAAKmsD,0BAA4BnsD,KAAKmsD,uBAAuB,CAAEC,iBAAkB,YAClFpsD,KAAKqsD,iBAAiB,CAAEC,oBAAoB,KAE3CtsD,KAAKmlD,2BAA6BnlD,KAAKmlD,wBAAwB,CAAEiH,iBAAkB,YACpFpsD,KAAKusD,kBAAkB,CAAEC,mBAAmB,IAEhDxsD,KAAKysD,2BAA2B,CAC5BL,iBAAkB,SAClBE,oBAAoB,KAKxBtsD,KAAKmlD,0BACLnlD,KAAK0sD,yBAAyB,CAAEF,mBAAmB,IAMlDxsD,KAAKmsD,2BACLnsD,KAAK6O,OAAO4vC,+BAAgCjgC,GAAYG,IAAI,eAE7DH,GAAYmB,OAAO,aACnB3f,KAAKusD,kBAAkB,CACnBC,kBAAmBxsD,KAAK6O,OAAO6vC,iCAG3C,GAEA,CAAA1/C,IAAA,2BAAAH,MAMA,SAAyBsY,GAAkD,IAAAw1C,EAAAC,EACnExiC,EAS6EyiC,EAGOC,EAXxF,GAAI31C,GAAWA,EAA2B,kBACtCiT,GAAW,MACR,KAAIjT,IAAWA,EAA4B,mBAG9C,OAFAiT,GAAW,CAGf,CAEKpqB,KAAK6O,OAAOuvC,sBAAuC,QAAhBuO,EAAA3sD,KAAK0O,mBAALi+C,IAAgBA,OAAhBA,EAAAA,EAAkBviC,YAAaA,IACnDyiC,QAAhBA,EAAA7sD,KAAK0O,mBAALm+C,IAAgBA,GAAhBA,EAAkB/hC,aAAaV,IAE9BpqB,KAAK6O,OAAOuvC,sBAA8C,QAAvBwO,EAAA5sD,KAAK8iD,0BAAL8J,IAAuBA,OAAvBA,EAAAA,EAAyBxiC,YAAaA,IACnD0iC,QAAvBA,EAAA9sD,KAAK8iD,0BAALgK,IAAuBA,GAAvBA,EAAyBhiC,aAAaV,GAE9C,GAEA,CAAAprB,IAAA,kBAAAH,MACA,SACIuV,EACA+C,GAmBA,OAjBAA,EAAUlY,EACN,CACI+T,QAAShT,KAAKgT,QAAQqB,KAAKrU,MAC3BosD,iBAAkBpsD,KAAK6O,OAAOmkB,mCAC9B+5B,cAAe/sD,KAAK6O,OAAOokB,gCAC3BirB,kBAAmBl+C,KAAK6O,OAAOqvC,kBAC/BV,uBAAwBx9C,KAAK6O,OAAO2uC,uBACpCc,cAAet+C,KAAK6O,OAAOyvC,eAE/BnnC,GAAW,CAAA,GAIV0I,GAAWpB,gBAAkD,iBAAhCtH,EAA0B,mBACxDA,EAA0B,iBAAI,UAG3B/C,EAAKpU,KAAK6O,OAAO+E,MAAO,CAC3BZ,QAASmE,EAAiB,QAC1Bsb,iBAAkBtb,EAA4B,mBAC9Cub,kBAAmBvb,EAA4B,mBAC/Cib,gBAAiBjb,EAA0B,iBAC3Ckb,kBAAmBlb,EAAuB,cAC1Cob,iBAAkBpb,EAA2B,kBAC7Cgb,qBAAsBhb,EAAgC,uBACtDqb,aAAcrb,EAAuB,eAE7C,GAEA,CAAAnY,IAAA,mBAAAH,MA6BA,SAAiBsY,GACbA,EAAUlY,EACN,CACIqtD,oBAAoB,GAExBn1C,GAAW,CAAA,GAGfnX,KAAKgtD,gBAAgB57B,GAAOja,GAC5BnX,KAAK0sD,yBAAyBv1C,EAClC,GAEA,CAAAnY,IAAA,oBAAAH,MAsBA,SAAkBsY,GACd,IAAM4uC,EAAW9mD,EACb,CACIutD,mBAAmB,GAEvBr1C,GAAW,CAAA,GAGfnX,KAAKgtD,gBAAgB17B,GAAQy0B,GAC7B/lD,KAAK0sD,yBAAyB3G,EAClC,GAEA,CAAA/mD,IAAA,yBAAAH,MAaA,SAAuBsY,GACnB,OAAOnX,KAAKgtD,gBAAgBz7B,GAAYpa,EAC5C,GAEA,CAAAnY,IAAA,0BAAAH,MAaA,SAAwBsY,GACpB,OAAOnX,KAAKgtD,gBAAgBv7B,GAAata,EAC7C,GAEA,CAAAnY,IAAA,6BAAAH,MAuBA,SAA2BsY,GACvB,IAAM4uC,EAA8C9mD,EAChD,CACIqtD,oBAAoB,GAExBn1C,QAAAA,EAAW,CAAA,GAEfnX,KAAKgtD,gBAAgBh7B,GAAe+zB,GACpC/lD,KAAK0sD,yBAAyB3G,EAClC,GAAC,CAAA/mD,IAAA,QAAAH,MAED,SAAMo/C,IACY,IAAVA,GACAnjD,SAAAA,EAAQqB,QAAQugC,IAAI,+BACpB3c,cAAgBA,aAAaG,WAAW,YACxClgB,KAAK6iD,WAAW,CAAE5E,OAAO,MAEzBnjD,SAAAA,EAAQqB,QAAQugC,IACZ,qIAEJ3c,cAAgBA,aAAaE,QAAQ,WAAY,QACjDjgB,KAAK6iD,WAAW,CAAE5E,OAAO,IAEjC,KAACmC,CAAA,CApyDe,I9B/EW,SAAU6M,EAAiBC,GACtD,IAAK,IAAIhvD,EAAI,EAAGA,EAAIgvD,EAAU3wD,OAAQ2B,IAClC+uD,EAAMvzD,UAAUwzD,EAAUhvD,IAAM6B,GAAUktD,EAAMvzD,UAAUwzD,EAAUhvD,IAE5E,C8Bk3DAivD,CAAgB/M,GAAS,CAAC,aAE1B,IAAMgN,GAAqC,CAAA,EAUrCC,GAAwB,WAG1BtU,GAAmB,KAAI,SAAUnlC,EAAgB/E,EAAiC7F,GAC9E,GAAIA,EAaA,OAXK+vC,GAAa/vC,KACd+vC,GAAa/vC,GAAQokD,GAAUpkD,GAAQ42C,GACnChsC,GAAS,GACT/E,GAAU,CAAA,EACV7F,GACA,SAACuF,GACGwqC,GAAa/vC,GAAQokD,GAAUpkD,GAAQuF,EACvCA,EAAS6zC,SACb,KAGDrJ,GAAa/vC,GAEpB,IAAIuF,EAAoBwqC,GAmBxB,OAjBIqU,GAAUnQ,IAEV1uC,EAAW6+C,GAAUnQ,IACdrpC,IAEPrF,EAAWqxC,GAAahsC,EAAO/E,GAAU,CAAA,EAAIouC,IAAuB,SAAC1uC,GACjE6+C,GAAUnQ,IAAyB1uC,EACnCA,EAAS6zC,SACb,IACAgL,GAAUnQ,IAAyB1uC,GAGrCwqC,GAAuBxqC,EACrBuqC,KAAcD,GAASyU,eACvBzxD,EAAiBohD,IAAyBlE,IA1CtD36C,EAAMgvD,IAAW,SAAU7+C,EAAUvF,GAC7BA,IAASi0C,KACTlE,GAAa/vC,GAAQuF,EAE7B,IAyCeA,EAGnB,EAqCIuqC,GAAYD,GAASyU,aACjBjzD,EAAawB,EAAiBg3B,WAC9Bh3B,EAAiBg3B,QAAU,KAE/BkmB,GAAel9C,EAAiBg3B,SAEL,UAAMkmB,GAAqB,QAAKA,GAA0B,YAEjFh9C,EAAOsB,SAAS,+DAKpBe,EAAM26C,GAAiB,IAAG,SAAUqM,GAC5BA,GAAQvrD,EAASurD,KACjBgI,GAAUhI,EAAK,IAAMxF,GAAYljD,WAAA,EAAAmiC,EAAIumB,IAE7C,IAEAiI,KACEtU,GAAmB,OAGrB36C,EAAMgvD,IAAW,SAAU7+C,GACvBA,EAAS6zC,SACb,IA5D2B,WAE3B,SAASmL,IAEAA,EAA2B5uD,OAG9B4uD,EAA2B5uD,MAAO,EAEpCu+C,IAAmB,EAEnB9+C,EAAMgvD,IAAW,SAAUI,GACvBA,EAAKC,aACT,IACJ,CAEIjyD,SAAAA,EAAUgI,mBACkB,aAAxBhI,EAASm0C,WAKT4d,IAEA/xD,EAASgI,iBAAiB,mBAAoB+pD,GAAoB,IAKtEzyD,GACA8H,GAAgB9H,EAAQ,OAAQyyD,GAAoB,EAE5D,CA8BIG","x_google_ignoreList":[17,25]}