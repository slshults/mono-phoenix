{"version":3,"file":"autocapture.js","sourceRoot":"","sources":["../../src/autocapture.ts"],"names":[],"mappings":"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","sourcesContent":["import { _bind_instance_methods, _each, _extend, _includes, _register_event, _safewrap_instance_methods } from './utils'\nimport {\n    autocaptureCompatibleElements,\n    getClassNames,\n    getDirectAndNestedSpanText,\n    getElementsChainString,\n    getSafeText,\n    isAngularStyleAttr,\n    isDocumentFragment,\n    isElementNode,\n    isSensitiveElement,\n    isTag,\n    isTextNode,\n    makeSafeText,\n    shouldCaptureDomEvent,\n    shouldCaptureElement,\n    shouldCaptureValue,\n    splitClassString,\n} from './autocapture-utils'\nimport RageClick from './extensions/rageclick'\nimport { AutocaptureConfig, AutoCaptureCustomProperty, DecideResponse, Properties } from './types'\nimport { PostHog } from './posthog-core'\nimport { AUTOCAPTURE_DISABLED_SERVER_SIDE } from './constants'\n\nimport { _isBoolean, _isFunction, _isNull, _isObject, _isUndefined } from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { document, window } from './utils/globals'\n\nconst COPY_AUTOCAPTURE_EVENT = '$copy_autocapture'\n\nfunction limitText(length: number, text: string): string {\n    if (text.length > length) {\n        return text.slice(0, length) + '...'\n    }\n    return text\n}\n\nconst autocapture = {\n    _initializedTokens: [] as string[],\n    _isDisabledServerSide: null as boolean | null,\n    _isAutocaptureEnabled: false as boolean,\n\n    _setIsAutocaptureEnabled: function (instance: PostHog): void {\n        const disabled_server_side = _isNull(this._isDisabledServerSide)\n            ? !!instance.persistence?.props[AUTOCAPTURE_DISABLED_SERVER_SIDE]\n            : this._isDisabledServerSide\n        const enabled_client_side = !!instance.config.autocapture\n        this._isAutocaptureEnabled = enabled_client_side && !disabled_server_side\n    },\n\n    _previousElementSibling: function (el: Element): Element | null {\n        if (el.previousElementSibling) {\n            return el.previousElementSibling\n        } else {\n            let _el: Element | null = el\n            do {\n                _el = _el.previousSibling as Element | null // resolves to ChildNode->Node, which is Element's parent class\n            } while (_el && !isElementNode(_el))\n            return _el\n        }\n    },\n\n    _getAugmentPropertiesFromElement: function (elem: Element): Properties {\n        const shouldCaptureEl = shouldCaptureElement(elem)\n        if (!shouldCaptureEl) {\n            return {}\n        }\n\n        const props: Properties = {}\n\n        _each(elem.attributes, function (attr: Attr) {\n            if (attr.name.indexOf('data-ph-capture-attribute') === 0) {\n                const propertyKey = attr.name.replace('data-ph-capture-attribute-', '')\n                const propertyValue = attr.value\n                if (propertyKey && propertyValue && shouldCaptureValue(propertyValue)) {\n                    props[propertyKey] = propertyValue\n                }\n            }\n        })\n        return props\n    },\n\n    _getPropertiesFromElement: function (elem: Element, maskInputs: boolean, maskText: boolean): Properties {\n        const tag_name = elem.tagName.toLowerCase()\n        const props: Properties = {\n            tag_name: tag_name,\n        }\n        if (autocaptureCompatibleElements.indexOf(tag_name) > -1 && !maskText) {\n            if (tag_name.toLowerCase() === 'a' || tag_name.toLowerCase() === 'button') {\n                props['$el_text'] = limitText(1024, getDirectAndNestedSpanText(elem))\n            } else {\n                props['$el_text'] = limitText(1024, getSafeText(elem))\n            }\n        }\n\n        const classes = getClassNames(elem)\n        if (classes.length > 0)\n            props['classes'] = classes.filter(function (c) {\n                return c !== ''\n            })\n\n        // capture the deny list here because this not-a-class class makes it tricky to use this.config in the function below\n        const elementAttributeIgnorelist = this.config?.element_attribute_ignorelist\n        _each(elem.attributes, function (attr: Attr) {\n            // Only capture attributes we know are safe\n            if (isSensitiveElement(elem) && ['name', 'id', 'class'].indexOf(attr.name) === -1) return\n\n            if (elementAttributeIgnorelist?.includes(attr.name)) return\n\n            if (!maskInputs && shouldCaptureValue(attr.value) && !isAngularStyleAttr(attr.name)) {\n                let value = attr.value\n                if (attr.name === 'class') {\n                    // html attributes can _technically_ contain linebreaks,\n                    // but we're very intolerant of them in the class string,\n                    // so we strip them.\n                    value = splitClassString(value).join(' ')\n                }\n                props['attr__' + attr.name] = limitText(1024, value)\n            }\n        })\n\n        let nthChild = 1\n        let nthOfType = 1\n        let currentElem: Element | null = elem\n        while ((currentElem = this._previousElementSibling(currentElem))) {\n            // eslint-disable-line no-cond-assign\n            nthChild++\n            if (currentElem.tagName === elem.tagName) {\n                nthOfType++\n            }\n        }\n        props['nth_child'] = nthChild\n        props['nth_of_type'] = nthOfType\n\n        return props\n    },\n\n    _getDefaultProperties: function (eventType: string): Properties {\n        return {\n            $event_type: eventType,\n            $ce_version: 1,\n        }\n    },\n\n    _extractCustomPropertyValue: function (customProperty: AutoCaptureCustomProperty): string {\n        const propValues: string[] = []\n        _each(document?.querySelectorAll(customProperty['css_selector']), function (matchedElem) {\n            let value\n\n            if (['input', 'select'].indexOf(matchedElem.tagName.toLowerCase()) > -1) {\n                value = matchedElem['value']\n            } else if (matchedElem['textContent']) {\n                value = matchedElem['textContent']\n            }\n\n            if (shouldCaptureValue(value)) {\n                propValues.push(value)\n            }\n        })\n        return propValues.join(', ')\n    },\n\n    // TODO: delete custom_properties after changeless typescript refactor\n    _getCustomProperties: function (targetElementList: Element[]): Properties {\n        const props: Properties = {} // will be deleted\n        _each(this._customProperties, (customProperty) => {\n            _each(customProperty['event_selectors'], (eventSelector) => {\n                const eventElements = document?.querySelectorAll(eventSelector)\n                _each(eventElements, (eventElement) => {\n                    if (_includes(targetElementList, eventElement) && shouldCaptureElement(eventElement)) {\n                        props[customProperty['name']] = this._extractCustomPropertyValue(customProperty)\n                    }\n                })\n            })\n        })\n        return props\n    },\n\n    _getEventTarget: function (e: Event): Element | null {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Event/target#Compatibility_notes\n        if (_isUndefined(e.target)) {\n            return (e.srcElement as Element) || null\n        } else {\n            if ((e.target as HTMLElement)?.shadowRoot) {\n                return (e.composedPath()[0] as Element) || null\n            }\n            return (e.target as Element) || null\n        }\n    },\n\n    _captureEvent: function (\n        e: Event,\n        instance: PostHog,\n        eventName = '$autocapture',\n        extraProps?: Properties\n    ): boolean | void {\n        /*** Don't mess with this code without running IE8 tests on it ***/\n        let target = this._getEventTarget(e)\n        if (isTextNode(target)) {\n            // defeat Safari bug (see: http://www.quirksmode.org/js/events_properties.html)\n            target = (target.parentNode || null) as Element | null\n        }\n\n        if (eventName === '$autocapture' && e.type === 'click' && e instanceof MouseEvent) {\n            if (this.rageclicks?.isRageClick(e.clientX, e.clientY, new Date().getTime())) {\n                this._captureEvent(e, instance, '$rageclick')\n            }\n        }\n\n        const isCopyAutocapture = eventName === COPY_AUTOCAPTURE_EVENT\n        if (\n            target &&\n            shouldCaptureDomEvent(\n                target,\n                e,\n                this.config,\n                // mostly this method cares about the target element, but in the case of copy events,\n                // we want some of the work this check does without insisting on the target element's type\n                isCopyAutocapture,\n                // we also don't want to restrict copy checks to clicks,\n                // so we pass that knowledge in here, rather than add the logic inside the check\n                isCopyAutocapture ? ['copy', 'cut'] : undefined\n            )\n        ) {\n            const targetElementList = [target]\n            let curEl = target\n            while (curEl.parentNode && !isTag(curEl, 'body')) {\n                if (isDocumentFragment(curEl.parentNode)) {\n                    targetElementList.push((curEl.parentNode as any).host)\n                    curEl = (curEl.parentNode as any).host\n                    continue\n                }\n                targetElementList.push(curEl.parentNode as Element)\n                curEl = curEl.parentNode as Element\n            }\n\n            const elementsJson: Properties[] = []\n            const autocaptureAugmentProperties: Properties = {}\n            let href,\n                explicitNoCapture = false\n            _each(targetElementList, (el) => {\n                const shouldCaptureEl = shouldCaptureElement(el)\n\n                // if the element or a parent element is an anchor tag\n                // include the href as a property\n                if (el.tagName.toLowerCase() === 'a') {\n                    href = el.getAttribute('href')\n                    href = shouldCaptureEl && shouldCaptureValue(href) && href\n                }\n\n                // allow users to programmatically prevent capturing of elements by adding class 'ph-no-capture'\n                const classes = getClassNames(el)\n                if (_includes(classes, 'ph-no-capture')) {\n                    explicitNoCapture = true\n                }\n\n                elementsJson.push(\n                    this._getPropertiesFromElement(\n                        el,\n                        instance.config.mask_all_element_attributes,\n                        instance.config.mask_all_text\n                    )\n                )\n\n                const augmentProperties = this._getAugmentPropertiesFromElement(el)\n                _extend(autocaptureAugmentProperties, augmentProperties)\n            })\n\n            if (!instance.config.mask_all_text) {\n                // if the element is a button or anchor tag get the span text from any\n                // children and include it as/with the text property on the parent element\n                if (target.tagName.toLowerCase() === 'a' || target.tagName.toLowerCase() === 'button') {\n                    elementsJson[0]['$el_text'] = getDirectAndNestedSpanText(target)\n                } else {\n                    elementsJson[0]['$el_text'] = getSafeText(target)\n                }\n            }\n\n            if (href) {\n                elementsJson[0]['attr__href'] = href\n            }\n\n            if (explicitNoCapture) {\n                return false\n            }\n\n            const props = _extend(\n                this._getDefaultProperties(e.type),\n                instance.elementsChainAsString\n                    ? {\n                          $elements_chain: getElementsChainString(elementsJson),\n                      }\n                    : {\n                          $elements: elementsJson,\n                      },\n                elementsJson[0]?.['$el_text'] ? { $el_text: elementsJson[0]?.['$el_text'] } : {},\n                this._getCustomProperties(targetElementList),\n                autocaptureAugmentProperties,\n                extraProps || {}\n            )\n\n            if (eventName === COPY_AUTOCAPTURE_EVENT) {\n                // you can't read the data from the clipboard event,\n                // but you can guess that you can read it from the window's current selection\n                const selectedContent = makeSafeText(window?.getSelection()?.toString())\n                const clipType = (e as ClipboardEvent).type || 'clipboard'\n                if (!selectedContent) {\n                    return false\n                }\n                props['$selected_content'] = selectedContent\n                props['$copy_type'] = clipType\n            }\n\n            instance.capture(eventName, props)\n            return true\n        }\n    },\n\n    // only reason is to stub for unit tests\n    // since you can't override window.location props\n    _navigate: function (href: string): void {\n        if (!window) {\n            return\n        }\n        window.location.href = href\n    },\n\n    _addDomEventHandlers: function (instance: PostHog): void {\n        if (!window || !document) {\n            return\n        }\n        const handler = (e: Event) => {\n            e = e || window?.event\n            this._captureEvent(e, instance)\n        }\n\n        const copiedTextHandler = (e: Event) => {\n            e = e || window?.event\n            this._captureEvent(e, instance, COPY_AUTOCAPTURE_EVENT)\n        }\n\n        _register_event(document, 'submit', handler, false, true)\n        _register_event(document, 'change', handler, false, true)\n        _register_event(document, 'click', handler, false, true)\n\n        if (_isObject(instance.config.autocapture) && instance.config.autocapture.capture_copied_text) {\n            _register_event(document, 'copy', copiedTextHandler, false, true)\n            _register_event(document, 'cut', copiedTextHandler, false, true)\n        }\n    },\n\n    _customProperties: [] as AutoCaptureCustomProperty[],\n    rageclicks: null as RageClick | null,\n    config: undefined as AutocaptureConfig | undefined,\n\n    init: function (instance: PostHog): void {\n        if (!_isBoolean(instance.__autocapture)) {\n            this.config = instance.__autocapture\n        }\n\n        // precompile the regex\n        if (this.config?.url_allowlist) {\n            this.config.url_allowlist = this.config.url_allowlist.map((url) => new RegExp(url))\n        }\n\n        this.rageclicks = new RageClick(instance.config.rageclick)\n    },\n\n    afterDecideResponse: function (response: DecideResponse, instance: PostHog): void {\n        const token = instance.config.token\n        if (this._initializedTokens.indexOf(token) > -1) {\n            logger.info('autocapture already initialized for token \"' + token + '\"')\n            return\n        }\n\n        if (instance.persistence) {\n            instance.persistence.register({\n                [AUTOCAPTURE_DISABLED_SERVER_SIDE]: !!response['autocapture_opt_out'],\n            })\n        }\n        // store this in-memory incase persistence is disabled\n        this._isDisabledServerSide = !!response['autocapture_opt_out']\n\n        this._setIsAutocaptureEnabled(instance)\n\n        this._initializedTokens.push(token)\n\n        if (\n            response &&\n            response['config'] &&\n            response['config']['enable_collect_everything'] &&\n            this._isAutocaptureEnabled\n        ) {\n            // TODO: delete custom_properties after changeless typescript refactor\n            if (response['custom_properties']) {\n                this._customProperties = response['custom_properties']\n            }\n            this._addDomEventHandlers(instance)\n        } else {\n            instance['__autocapture'] = false\n        }\n    },\n\n    // this is a mechanism to ramp up CE with no server-side interaction.\n    // when CE is active, every page load results in a decide request. we\n    // need to gently ramp this up, so we don't overload decide. this decides\n    // deterministically if CE is enabled for this project by modding the char\n    // value of the project token.\n    enabledForProject: function (\n        token: string | null | undefined,\n        numBuckets: number,\n        numEnabledBuckets: number\n    ): boolean {\n        if (!token) {\n            return true\n        }\n        numBuckets = !_isUndefined(numBuckets) ? numBuckets : 10\n        numEnabledBuckets = !_isUndefined(numEnabledBuckets) ? numEnabledBuckets : 10\n        let charCodeSum = 0\n        for (let i = 0; i < token.length; i++) {\n            charCodeSum += token.charCodeAt(i)\n        }\n        return charCodeSum % numBuckets < numEnabledBuckets\n    },\n\n    isBrowserSupported: function (): boolean {\n        return _isFunction(document?.querySelectorAll)\n    },\n}\n\n_bind_instance_methods(autocapture)\n_safewrap_instance_methods(autocapture)\n\nexport { autocapture }\n"]}