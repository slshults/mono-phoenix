import { logger } from './utils/logger';
var oneMinuteInMilliseconds = 60 * 1000;
var RateLimiter = /** @class */ (function () {
    function RateLimiter() {
        var _this = this;
        this.limits = {};
        this.checkForLimiting = function (httpResponse) {
            var text = httpResponse.text;
            if (!text || !text.length) {
                return;
            }
            try {
                var response = JSON.parse(text);
                var quotaLimitedProducts = response.quota_limited || [];
                quotaLimitedProducts.forEach(function (batchKey) {
                    logger.info("[RateLimiter] ".concat(batchKey || 'events', " is quota limited."));
                    _this.limits[batchKey] = new Date().getTime() + oneMinuteInMilliseconds;
                });
            }
            catch (e) {
                logger.warn("[RateLimiter] could not rate limit - continuing. Error: \"".concat(e === null || e === void 0 ? void 0 : e.message, "\""), { text: text });
                return;
            }
        };
    }
    RateLimiter.prototype.isRateLimited = function (batchKey) {
        var retryAfter = this.limits[batchKey || 'events'] || false;
        if (retryAfter === false) {
            return false;
        }
        return new Date().getTime() < retryAfter;
    };
    return RateLimiter;
}());
export { RateLimiter };
//# sourceMappingURL=rate-limiter.js.map